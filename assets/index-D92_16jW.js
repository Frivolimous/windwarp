const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./browserAll-CJXx4aeh.js","./webworkerAll-CvqzS4Fk.js","./Filter-C4OuANBi.js","./WebGPURenderer-CFehuQw_.js","./BufferResource-CjlEfb1W.js","./RenderTargetSystem-B_JUT8Me.js","./WebGLRenderer-vNNLyAwt.js","./CanvasRenderer-CBobAK1a.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();const Sv="modulepreload",Av=function(s,t){return new URL(s,t).href},Uc={},Hs=function(t,e,i){let r=Promise.resolve();if(e&&e.length>0){let f=function(d){return Promise.all(d.map(g=>Promise.resolve(g).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};const h=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");r=f(e.map(d=>{if(d=Av(d,i),d in Uc)return;Uc[d]=!0;const g=d.endsWith(".css"),x=g?'[rel="stylesheet"]':"";if(i)for(let v=h.length-1;v>=0;v--){const T=h[v];if(T.href===d&&(!g||T.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${x}`))return;const _=document.createElement("link");if(_.rel=g?"stylesheet":Sv,g||(_.as="script"),_.crossOrigin="",_.href=d,c&&_.setAttribute("nonce",c),document.head.appendChild(_),g)return new Promise((v,T)=>{_.addEventListener("load",v),_.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(h){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=h,window.dispatchEvent(l),!l.defaultPrevented)throw h}return r.then(h=>{for(const l of h||[])l.status==="rejected"&&a(l.reason);return t().catch(a)})};var V=(s=>(s.Application="application",s.WebGLPipes="webgl-pipes",s.WebGLPipesAdaptor="webgl-pipes-adaptor",s.WebGLSystem="webgl-system",s.WebGPUPipes="webgpu-pipes",s.WebGPUPipesAdaptor="webgpu-pipes-adaptor",s.WebGPUSystem="webgpu-system",s.CanvasSystem="canvas-system",s.CanvasPipesAdaptor="canvas-pipes-adaptor",s.CanvasPipes="canvas-pipes",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s.MaskEffect="mask-effect",s.BlendMode="blend-mode",s.TextureSource="texture-source",s.Environment="environment",s.ShapeBuilder="shape-builder",s.Batcher="batcher",s))(V||{});const xh=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},Dr=(s,t)=>xh(s).priority??t,Mt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(xh).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...s){return s.map(xh).forEach(t=>{t.type.forEach(e=>{const i=this._addHandlers,r=this._queue;i[e]?i[e]?.(t):(r[e]=r[e]||[],r[e]?.push(t))})}),this},handle(s,t,e){const i=this._addHandlers,r=this._removeHandlers;if(i[s]||r[s])throw new Error(`Extension type ${s} already has a handler`);i[s]=t,r[s]=e;const a=this._queue;return a[s]&&(a[s]?.forEach(h=>t(h)),delete a[s]),this},handleByMap(s,t){return this.handle(s,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByNamedList(s,t,e=-1){return this.handle(s,i=>{t.findIndex(a=>a.name===i.name)>=0||(t.push({name:i.name,value:i.ref}),t.sort((a,h)=>Dr(h.value,e)-Dr(a.value,e)))},i=>{const r=t.findIndex(a=>a.name===i.name);r!==-1&&t.splice(r,1)})},handleByList(s,t,e=-1){return this.handle(s,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((r,a)=>Dr(a,e)-Dr(r,e)))},i=>{const r=t.indexOf(i.ref);r!==-1&&t.splice(r,1)})},mixin(s,...t){for(const e of t)Object.defineProperties(s.prototype,Object.getOwnPropertyDescriptors(e))}},Tv={extension:{type:V.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await Hs(()=>import("./browserAll-CJXx4aeh.js"),__vite__mapDeps([0,1,2]),import.meta.url)}},Cv={extension:{type:V.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await Hs(()=>import("./webworkerAll-CvqzS4Fk.js"),__vite__mapDeps([1,2]),import.meta.url)}};class he{constructor(t,e,i){this._x=e||0,this._y=i||0,this._observer=t}clone(t){return new he(t??this._observer,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this._observer._onUpdate(this)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this._observer._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer._onUpdate(this))}}var Wr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zh(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Ua={exports:{}},Hc;function Mv(){return Hc||(Hc=1,(function(s){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function r(c,f,d){this.fn=c,this.context=f,this.once=d||!1}function a(c,f,d,g,x){if(typeof d!="function")throw new TypeError("The listener must be a function");var _=new r(d,g||c,x),v=e?e+f:f;return c._events[v]?c._events[v].fn?c._events[v]=[c._events[v],_]:c._events[v].push(_):(c._events[v]=_,c._eventsCount++),c}function h(c,f){--c._eventsCount===0?c._events=new i:delete c._events[f]}function l(){this._events=new i,this._eventsCount=0}l.prototype.eventNames=function(){var f=[],d,g;if(this._eventsCount===0)return f;for(g in d=this._events)t.call(d,g)&&f.push(e?g.slice(1):g);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(d)):f},l.prototype.listeners=function(f){var d=e?e+f:f,g=this._events[d];if(!g)return[];if(g.fn)return[g.fn];for(var x=0,_=g.length,v=new Array(_);x<_;x++)v[x]=g[x].fn;return v},l.prototype.listenerCount=function(f){var d=e?e+f:f,g=this._events[d];return g?g.fn?1:g.length:0},l.prototype.emit=function(f,d,g,x,_,v){var T=e?e+f:f;if(!this._events[T])return!1;var w=this._events[T],A=arguments.length,I,M;if(w.fn){switch(w.once&&this.removeListener(f,w.fn,void 0,!0),A){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,d),!0;case 3:return w.fn.call(w.context,d,g),!0;case 4:return w.fn.call(w.context,d,g,x),!0;case 5:return w.fn.call(w.context,d,g,x,_),!0;case 6:return w.fn.call(w.context,d,g,x,_,v),!0}for(M=1,I=new Array(A-1);M<A;M++)I[M-1]=arguments[M];w.fn.apply(w.context,I)}else{var P=w.length,L;for(M=0;M<P;M++)switch(w[M].once&&this.removeListener(f,w[M].fn,void 0,!0),A){case 1:w[M].fn.call(w[M].context);break;case 2:w[M].fn.call(w[M].context,d);break;case 3:w[M].fn.call(w[M].context,d,g);break;case 4:w[M].fn.call(w[M].context,d,g,x);break;default:if(!I)for(L=1,I=new Array(A-1);L<A;L++)I[L-1]=arguments[L];w[M].fn.apply(w[M].context,I)}}return!0},l.prototype.on=function(f,d,g){return a(this,f,d,g,!1)},l.prototype.once=function(f,d,g){return a(this,f,d,g,!0)},l.prototype.removeListener=function(f,d,g,x){var _=e?e+f:f;if(!this._events[_])return this;if(!d)return h(this,_),this;var v=this._events[_];if(v.fn)v.fn===d&&(!x||v.once)&&(!g||v.context===g)&&h(this,_);else{for(var T=0,w=[],A=v.length;T<A;T++)(v[T].fn!==d||x&&!v[T].once||g&&v[T].context!==g)&&w.push(v[T]);w.length?this._events[_]=w.length===1?w[0]:w:h(this,_)}return this},l.prototype.removeAllListeners=function(f){var d;return f?(d=e?e+f:f,this._events[d]&&h(this,d)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=e,l.EventEmitter=l,s.exports=l})(Ua)),Ua.exports}var Pv=Mv();const fi=zh(Pv),Ev=Math.PI*2,kv=180/Math.PI,Iv=Math.PI/180;class qt{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new qt(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return Ha.x=0,Ha.y=0,Ha}}const Ha=new qt;class pt{constructor(t=1,e=0,i=0,r=1,a=0,h=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=r,this.tx=a,this.ty=h}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,r,a,h){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=a,this.ty=h,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new qt;const i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e}applyInverse(t,e){e=e||new qt;const i=this.a,r=this.b,a=this.c,h=this.d,l=this.tx,c=this.ty,f=1/(i*h+a*-r),d=t.x,g=t.y;return e.x=h*f*d+-a*f*g+(c*a-l*h)*f,e.y=i*f*g+-r*f*d+(-c*i+l*r)*f,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),r=this.a,a=this.c,h=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=a*e-this.d*i,this.d=a*i+this.d*e,this.tx=h*e-this.ty*i,this.ty=h*i+this.ty*e,this}append(t){const e=this.a,i=this.b,r=this.c,a=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*a,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*a,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*a+this.ty,this}appendFrom(t,e){const i=t.a,r=t.b,a=t.c,h=t.d,l=t.tx,c=t.ty,f=e.a,d=e.b,g=e.c,x=e.d;return this.a=i*f+r*g,this.b=i*d+r*x,this.c=a*f+h*g,this.d=a*d+h*x,this.tx=l*f+c*g+e.tx,this.ty=l*d+c*x+e.ty,this}setTransform(t,e,i,r,a,h,l,c,f){return this.a=Math.cos(l+f)*a,this.b=Math.sin(l+f)*a,this.c=-Math.sin(l-c)*h,this.d=Math.cos(l-c)*h,this.tx=t-(i*this.a+r*this.c),this.ty=e-(i*this.b+r*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,r=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,r=this.c,a=this.d,h=t.pivot,l=-Math.atan2(-r,a),c=Math.atan2(i,e),f=Math.abs(l+c);return f<1e-5||Math.abs(Ev-f)<1e-5?(t.rotation=c,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=l,t.skew.y=c),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(r*r+a*a),t.position.x=this.tx+(h.x*e+h.y*r),t.position.y=this.ty+(h.x*i+h.y*a),t}invert(){const t=this.a,e=this.b,i=this.c,r=this.d,a=this.tx,h=t*r-e*i;return this.a=r/h,this.b=-e/h,this.c=-i/h,this.d=t/h,this.tx=(i*this.ty-r*a)/h,this.ty=-(t*this.ty-e*a)/h,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new pt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return Lv.identity()}static get shared(){return Rv.identity()}}const Rv=new pt,Lv=new pt,as=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],hs=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ls=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],us=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],yh=[],af=[],Ur=Math.sign;function Bv(){for(let s=0;s<16;s++){const t=[];yh.push(t);for(let e=0;e<16;e++){const i=Ur(as[s]*as[e]+ls[s]*hs[e]),r=Ur(hs[s]*as[e]+us[s]*hs[e]),a=Ur(as[s]*ls[e]+ls[s]*us[e]),h=Ur(hs[s]*ls[e]+us[s]*us[e]);for(let l=0;l<16;l++)if(as[l]===i&&hs[l]===r&&ls[l]===a&&us[l]===h){t.push(l);break}}}for(let s=0;s<16;s++){const t=new pt;t.set(as[s],hs[s],ls[s],us[s],0,0),af.push(t)}}Bv();const ut={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>as[s],uY:s=>hs[s],vX:s=>ls[s],vY:s=>us[s],inv:s=>s&8?s&15:-s&7,add:(s,t)=>yh[s][t],sub:(s,t)=>yh[s][ut.inv(t)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,t)=>Math.abs(s)*2<=Math.abs(t)?t>=0?ut.S:ut.N:Math.abs(t)*2<=Math.abs(s)?s>0?ut.E:ut.W:t>0?s>0?ut.SE:ut.SW:s>0?ut.NE:ut.NW,matrixAppendRotationInv:(s,t,e=0,i=0,r=0,a=0)=>{const h=af[ut.inv(t)],l=h.a,c=h.b,f=h.c,d=h.d,g=e-Math.min(0,l*r,f*a,l*r+f*a),x=i-Math.min(0,c*r,d*a,c*r+d*a),_=s.a,v=s.b,T=s.c,w=s.d;s.a=l*_+c*T,s.b=l*v+c*w,s.c=f*_+d*T,s.d=f*v+d*w,s.tx=g*_+x*T+s.tx,s.ty=g*v+x*w+s.ty},transformRectCoords:(s,t,e,i)=>{const{x:r,y:a,width:h,height:l}=s,{x:c,y:f,width:d,height:g}=t;return e===ut.E?(i.set(r+c,a+f,h,l),i):e===ut.S?i.set(d-a-l+c,r+f,l,h):e===ut.W?i.set(d-r-h+c,g-a-l+f,h,l):e===ut.N?i.set(a+c,g-r-h+f,l,h):i.set(r+c,a+f,h,l)}},Hr=[new qt,new qt,new qt,new qt];class kt{constructor(t=0,e=0,i=0,r=0){this.type="rectangle",this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(r)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new kt(0,0,0,0)}clone(){return new kt(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}strokeContains(t,e,i,r=.5){const{width:a,height:h}=this;if(a<=0||h<=0)return!1;const l=this.x,c=this.y,f=i*(1-r),d=i-f,g=l-f,x=l+a+f,_=c-f,v=c+h+f,T=l+d,w=l+a-d,A=c+d,I=c+h-d;return t>=g&&t<=x&&e>=_&&e<=v&&!(t>T&&t<w&&e>A&&e<I)}intersects(t,e){if(!e){const Y=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=Y)return!1;const H=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>H}const i=this.left,r=this.right,a=this.top,h=this.bottom;if(r<=i||h<=a)return!1;const l=Hr[0].set(t.left,t.top),c=Hr[1].set(t.left,t.bottom),f=Hr[2].set(t.right,t.top),d=Hr[3].set(t.right,t.bottom);if(f.x<=l.x||c.y<=l.y)return!1;const g=Math.sign(e.a*e.d-e.b*e.c);if(g===0||(e.apply(l,l),e.apply(c,c),e.apply(f,f),e.apply(d,d),Math.max(l.x,c.x,f.x,d.x)<=i||Math.min(l.x,c.x,f.x,d.x)>=r||Math.max(l.y,c.y,f.y,d.y)<=a||Math.min(l.y,c.y,f.y,d.y)>=h))return!1;const x=g*(c.y-l.y),_=g*(l.x-c.x),v=x*i+_*a,T=x*r+_*a,w=x*i+_*h,A=x*r+_*h;if(Math.max(v,T,w,A)<=x*l.x+_*l.y||Math.min(v,T,w,A)>=x*d.x+_*d.y)return!1;const I=g*(l.y-f.y),M=g*(f.x-l.x),P=I*i+M*a,L=I*r+M*a,R=I*i+M*h,G=I*r+M*h;return!(Math.max(P,L,R,G)<=I*l.x+M*l.y||Math.min(P,L,R,G)>=I*d.x+M*d.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),a=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=r,this.height=Math.max(a-r,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=r-this.y,this}scale(t,e=t){return this.x*=t,this.y*=e,this.width*=t,this.height*=e,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),a=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=r,this.height=a-r,this}getBounds(t){return t||(t=new kt),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const e=t.x,i=t.y,r=t.x+t.width,a=t.y+t.height;return e>=this.x&&e<this.x+this.width&&i>=this.y&&i<this.y+this.height&&r>=this.x&&r<this.x+this.width&&a>=this.y&&a<this.y+this.height}set(t,e,i,r){return this.x=t,this.y=e,this.width=i,this.height=r,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const za={default:-1};function Yt(s="default"){return za[s]===void 0&&(za[s]=-1),++za[s]}const zc=new Set,Nt="8.0.0",Fv="8.3.4",Os={quiet:!1,noColor:!1},wt=((s,t,e=3)=>{if(Os.quiet||zc.has(t))return;let i=new Error().stack;const r=`${t}
Deprecated since v${s}`,a=typeof console.groupCollapsed=="function"&&!Os.noColor;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",r):(i=i.split(`
`).splice(e).join(`
`),a?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",r),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",r),console.warn(i))),zc.add(t)});Object.defineProperties(wt,{quiet:{get:()=>Os.quiet,set:s=>{Os.quiet=s},enumerable:!0,configurable:!1},noColor:{get:()=>Os.noColor,set:s=>{Os.noColor=s},enumerable:!0,configurable:!1}});const Nh=()=>{};function Xs(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function Nc(s){return!(s&s-1)&&!!s}function hf(s){const t={};for(const e in s)s[e]!==void 0&&(t[e]=s[e]);return t}const Yc=Object.create(null);function Gv(s){const t=Yc[s];return t===void 0&&(Yc[s]=Yt("resource")),t}const lf=class uf extends fi{constructor(t={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,t={...uf.defaultOptions,...t},this.addressMode=t.addressMode,this.addressModeU=t.addressModeU??this.addressModeU,this.addressModeV=t.addressModeV??this.addressModeV,this.addressModeW=t.addressModeW??this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=t.magFilter??this.magFilter,this.minFilter=t.minFilter??this.minFilter,this.mipmapFilter=t.mipmapFilter??this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=t.maxAnisotropy??1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){wt(Nt,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this._sharedResourceId=null,this.emit("change",this)}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=Gv(t),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};lf.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let $s=lf;const cf=class df extends fi{constructor(t={}){super(),this.options=t,this._gpuData=Object.create(null),this._gcLastUsed=-1,this.uid=Yt("textureSource"),this._resourceType="textureSource",this._resourceId=Yt("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.viewDimension="2d",this.arrayLayerCount=1,this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,t={...df.defaultOptions,...t},this.label=t.label??"",this.resource=t.resource,this.autoGarbageCollect=t.autoGarbageCollect,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.viewDimension=t.viewDimension??t.dimensions,this.arrayLayerCount=t.arrayLayerCount,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode,this.style=new $s(hf(t)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(t){this.style!==t&&(this._style?.off("change",this._onStyleChange,this),this._style=t,this._style?.on("change",this._onStyleChange,this),this._onStyleChange())}set maxAnisotropy(t){this._style.maxAnisotropy=t}get maxAnisotropy(){return this._style.maxAnisotropy}get addressMode(){return this._style.addressMode}set addressMode(t){this._style.addressMode=t}get repeatMode(){return this._style.addressMode}set repeatMode(t){this._style.addressMode=t}get magFilter(){return this._style.magFilter}set magFilter(t){this._style.magFilter=t}get minFilter(){return this._style.minFilter}set minFilter(t){this._style.minFilter=t}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(t){this._style.mipmapFilter=t}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(t){this._style.lodMinClamp=t}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(t){this._style.lodMaxClamp=t}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const t=this._resolution;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.unload(),this.emit("destroy",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=Yt("resource"),this.emit("change",this),this.emit("unload",this);for(const t in this._gpuData)this._gpuData[t]?.destroy?.();this._gpuData=Object.create(null)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,i){i||(i=this._resolution),t||(t=this.width),e||(e=this.height);const r=Math.round(t*i),a=Math.round(e*i);return this.width=r/i,this.height=a/i,this._resolution=i,this.pixelWidth===r&&this.pixelHeight===a?!1:(this._refreshPOT(),this.pixelWidth=r,this.pixelHeight=a,this.emit("resize",this),this._resourceId=Yt("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this._style.wrapMode=t}get wrapMode(){return this._style.wrapMode}set scaleMode(t){this._style.scaleMode=t}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=Nc(this.pixelWidth)&&Nc(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};cf.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",viewDimension:"2d",arrayLayerCount:1,mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let Xe=cf;class Yh extends Xe{constructor(t){const e=t.resource||new Float32Array(t.width*t.height*4);let i=t.format;i||(e instanceof Float32Array?i="rgba32float":e instanceof Int32Array||e instanceof Uint32Array?i="rgba32uint":e instanceof Int16Array||e instanceof Uint16Array?i="rgba16uint":(e instanceof Int8Array,i="bgra8unorm")),super({...t,resource:e,format:i}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}Yh.extension=V.TextureSource;const Xc=new pt;class Ov{constructor(t,e){this.mapCoord=new pt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof e>"u"?this.clampMargin=t.width<10?0:.5:this.clampMargin=e,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){this.texture!==t&&(this._texture?.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let r=0;r<t.length;r+=2){const a=t[r],h=t[r+1];e[r]=a*i.a+h*i.c+i.tx,e[r+1]=a*i.b+h*i.d+i.ty}return e}update(){const t=this._texture;this._updateID++;const e=t.uvs;this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0);const i=t.orig,r=t.trim;r&&(Xc.set(i.width/r.width,0,0,i.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(Xc));const a=t.source,h=this.uClampFrame,l=this.clampMargin/a._resolution,c=this.clampOffset/a._resolution;return h[0]=(t.frame.x+l+c)/a.width,h[1]=(t.frame.y+l+c)/a.height,h[2]=(t.frame.x+t.frame.width-l+c)/a.width,h[3]=(t.frame.y+t.frame.height-l+c)/a.height,this.uClampOffset[0]=this.clampOffset/a.pixelWidth,this.uClampOffset[1]=this.clampOffset/a.pixelHeight,this.isSimple=t.frame.width===a.width&&t.frame.height===a.height&&t.rotate===0,!0}}class ht extends fi{constructor({source:t,label:e,frame:i,orig:r,trim:a,defaultAnchor:h,defaultBorders:l,rotate:c,dynamic:f}={}){if(super(),this.uid=Yt("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new kt,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=e,this.source=t?.source??new Xe,this.noFrame=!i,i)this.frame.copyFrom(i);else{const{width:d,height:g}=this._source;this.frame.width=d,this.frame.height=g}this.orig=r||this.frame,this.trim=a,this.rotate=c??0,this.defaultAnchor=h,this.defaultBorders=l,this.destroyed=!1,this.dynamic=f||!1,this.updateUvs()}set source(t){this._source&&this._source.off("resize",this.update,this),this._source=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new Ov(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:e}=this,{width:i,height:r}=this._source,a=e.x/i,h=e.y/r,l=e.width/i,c=e.height/r;let f=this.rotate;if(f){const d=l/2,g=c/2,x=a+d,_=h+g;f=ut.add(f,ut.NW),t.x0=x+d*ut.uX(f),t.y0=_+g*ut.uY(f),f=ut.add(f,2),t.x1=x+d*ut.uX(f),t.y1=_+g*ut.uY(f),f=ut.add(f,2),t.x2=x+d*ut.uX(f),t.y2=_+g*ut.uY(f),f=ut.add(f,2),t.x3=x+d*ut.uX(f),t.y3=_+g*ut.uY(f)}else t.x0=a,t.y0=h,t.x1=a+l,t.y1=h,t.x2=a+l,t.y2=h+c,t.x3=a,t.y3=h+c}destroy(t=!1){this._source&&(this._source.off("resize",this.update,this),t&&(this._source.destroy(),this._source=null)),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return wt(Nt,"Texture.baseTexture is now Texture.source"),this._source}}ht.EMPTY=new ht({label:"EMPTY",source:new Xe({label:"EMPTY"})});ht.EMPTY.destroy=Nh;ht.WHITE=new ht({source:new Yh({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});ht.WHITE.destroy=Nh;function ff(s,t,e){const{width:i,height:r}=e.orig,a=e.trim;if(a){const h=a.width,l=a.height;s.minX=a.x-t._x*i,s.maxX=s.minX+h,s.minY=a.y-t._y*r,s.maxY=s.minY+l}else s.minX=-t._x*i,s.maxX=s.minX+i,s.minY=-t._y*r,s.maxY=s.minY+r}const $c=new pt;class Re{constructor(t=1/0,e=1/0,i=-1/0,r=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=$c,this.minX=t,this.minY=e,this.maxX=i,this.maxY=r}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new kt);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=$c,this}set(t,e,i,r){this.minX=t,this.minY=e,this.maxX=i,this.maxY=r}addFrame(t,e,i,r,a){a||(a=this.matrix);const h=a.a,l=a.b,c=a.c,f=a.d,d=a.tx,g=a.ty;let x=this.minX,_=this.minY,v=this.maxX,T=this.maxY,w=h*t+c*e+d,A=l*t+f*e+g;w<x&&(x=w),A<_&&(_=A),w>v&&(v=w),A>T&&(T=A),w=h*i+c*e+d,A=l*i+f*e+g,w<x&&(x=w),A<_&&(_=A),w>v&&(v=w),A>T&&(T=A),w=h*t+c*r+d,A=l*t+f*r+g,w<x&&(x=w),A<_&&(_=A),w>v&&(v=w),A>T&&(T=A),w=h*i+c*r+d,A=l*i+f*r+g,w<x&&(x=w),A<_&&(_=A),w>v&&(v=w),A>T&&(T=A),this.minX=x,this.minY=_,this.maxX=v,this.maxY=T}addRect(t,e){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,e)}addBounds(t,e){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,e)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,i=this.minY,r=this.maxX,a=this.maxY,{a:h,b:l,c,d:f,tx:d,ty:g}=t;let x=h*e+c*i+d,_=l*e+f*i+g;this.minX=x,this.minY=_,this.maxX=x,this.maxY=_,x=h*r+c*i+d,_=l*r+f*i+g,this.minX=x<this.minX?x:this.minX,this.minY=_<this.minY?_:this.minY,this.maxX=x>this.maxX?x:this.maxX,this.maxY=_>this.maxY?_:this.maxY,x=h*e+c*a+d,_=l*e+f*a+g,this.minX=x<this.minX?x:this.minX,this.minY=_<this.minY?_:this.minY,this.maxX=x>this.maxX?x:this.maxX,this.maxY=_>this.maxY?_:this.maxY,x=h*r+c*a+d,_=l*r+f*a+g,this.minX=x<this.minX?x:this.minX,this.minY=_<this.minY?_:this.minY,this.maxX=x>this.maxX?x:this.maxX,this.maxY=_>this.maxY?_:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,e,i,r){return this.minX<t&&(this.minX=t),this.maxX>e&&(this.maxX=e),this.minY<i&&(this.minY=i),this.maxY>r&&(this.maxY=r),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new Re(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}set x(t){const e=this.maxX-this.minX;this.minX=t,this.maxX=t+e}get y(){return this.minY}set y(t){const e=this.maxY-this.minY;this.minY=t,this.maxY=t+e}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,i,r){let a=this.minX,h=this.minY,l=this.maxX,c=this.maxY;r||(r=this.matrix);const f=r.a,d=r.b,g=r.c,x=r.d,_=r.tx,v=r.ty;for(let T=e;T<i;T+=2){const w=t[T],A=t[T+1],I=f*w+g*A+_,M=d*w+x*A+v;a=I<a?I:a,h=M<h?M:h,l=I>l?I:l,c=M>c?M:c}this.minX=a,this.minY=h,this.maxX=l,this.maxY=c}containsPoint(t,e){return this.minX<=t&&this.minY<=e&&this.maxX>=t&&this.maxY>=e}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}var Dv={grad:.9,turn:360,rad:360/(2*Math.PI)},Si=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},se=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*s)/e+0},Ye=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),s>e?e:s>t?s:t},pf=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},Vc=function(s){return{r:Ye(s.r,0,255),g:Ye(s.g,0,255),b:Ye(s.b,0,255),a:Ye(s.a)}},Na=function(s){return{r:se(s.r),g:se(s.g),b:se(s.b),a:se(s.a,3)}},Wv=/^#([0-9a-f]{3,8})$/i,zr=function(s){var t=s.toString(16);return t.length<2?"0"+t:t},gf=function(s){var t=s.r,e=s.g,i=s.b,r=s.a,a=Math.max(t,e,i),h=a-Math.min(t,e,i),l=h?a===t?(e-i)/h:a===e?2+(i-t)/h:4+(t-e)/h:0;return{h:60*(l<0?l+6:l),s:a?h/a*100:0,v:a/255*100,a:r}},mf=function(s){var t=s.h,e=s.s,i=s.v,r=s.a;t=t/360*6,e/=100,i/=100;var a=Math.floor(t),h=i*(1-e),l=i*(1-(t-a)*e),c=i*(1-(1-t+a)*e),f=a%6;return{r:255*[i,l,h,h,c,i][f],g:255*[c,i,i,l,h,h][f],b:255*[h,h,c,i,i,l][f],a:r}},qc=function(s){return{h:pf(s.h),s:Ye(s.s,0,100),l:Ye(s.l,0,100),a:Ye(s.a)}},jc=function(s){return{h:se(s.h),s:se(s.s),l:se(s.l),a:se(s.a,3)}},Zc=function(s){return mf((e=(t=s).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},In=function(s){return{h:(t=gf(s)).h,s:(r=(200-(e=t.s))*(i=t.v)/100)>0&&r<200?e*i/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,e,i,r},Uv=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Hv=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,zv=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Nv=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,bh={string:[[function(s){var t=Wv.exec(s);return t?(s=t[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?se(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?se(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var t=zv.exec(s)||Nv.exec(s);return t?t[2]!==t[4]||t[4]!==t[6]?null:Vc({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(s){var t=Uv.exec(s)||Hv.exec(s);if(!t)return null;var e,i,r=qc({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*(Dv[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Zc(r)},"hsl"]],object:[[function(s){var t=s.r,e=s.g,i=s.b,r=s.a,a=r===void 0?1:r;return Si(t)&&Si(e)&&Si(i)?Vc({r:Number(t),g:Number(e),b:Number(i),a:Number(a)}):null},"rgb"],[function(s){var t=s.h,e=s.s,i=s.l,r=s.a,a=r===void 0?1:r;if(!Si(t)||!Si(e)||!Si(i))return null;var h=qc({h:Number(t),s:Number(e),l:Number(i),a:Number(a)});return Zc(h)},"hsl"],[function(s){var t=s.h,e=s.s,i=s.v,r=s.a,a=r===void 0?1:r;if(!Si(t)||!Si(e)||!Si(i))return null;var h=(function(l){return{h:pf(l.h),s:Ye(l.s,0,100),v:Ye(l.v,0,100),a:Ye(l.a)}})({h:Number(t),s:Number(e),v:Number(i),a:Number(a)});return mf(h)},"hsv"]]},Kc=function(s,t){for(var e=0;e<t.length;e++){var i=t[e][0](s);if(i)return[i,t[e][1]]}return[null,void 0]},Yv=function(s){return typeof s=="string"?Kc(s.trim(),bh.string):typeof s=="object"&&s!==null?Kc(s,bh.object):[null,void 0]},Ya=function(s,t){var e=In(s);return{h:e.h,s:Ye(e.s+100*t,0,100),l:e.l,a:e.a}},Xa=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},Jc=function(s,t){var e=In(s);return{h:e.h,s:e.s,l:Ye(e.l+100*t,0,100),a:e.a}},vh=(function(){function s(t){this.parsed=Yv(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return se(Xa(this.rgba),2)},s.prototype.isDark=function(){return Xa(this.rgba)<.5},s.prototype.isLight=function(){return Xa(this.rgba)>=.5},s.prototype.toHex=function(){return t=Na(this.rgba),e=t.r,i=t.g,r=t.b,h=(a=t.a)<1?zr(se(255*a)):"","#"+zr(e)+zr(i)+zr(r)+h;var t,e,i,r,a,h},s.prototype.toRgb=function(){return Na(this.rgba)},s.prototype.toRgbString=function(){return t=Na(this.rgba),e=t.r,i=t.g,r=t.b,(a=t.a)<1?"rgba("+e+", "+i+", "+r+", "+a+")":"rgb("+e+", "+i+", "+r+")";var t,e,i,r,a},s.prototype.toHsl=function(){return jc(In(this.rgba))},s.prototype.toHslString=function(){return t=jc(In(this.rgba)),e=t.h,i=t.s,r=t.l,(a=t.a)<1?"hsla("+e+", "+i+"%, "+r+"%, "+a+")":"hsl("+e+", "+i+"%, "+r+"%)";var t,e,i,r,a},s.prototype.toHsv=function(){return t=gf(this.rgba),{h:se(t.h),s:se(t.s),v:se(t.v),a:se(t.a,3)};var t},s.prototype.invert=function(){return ci({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},s.prototype.saturate=function(t){return t===void 0&&(t=.1),ci(Ya(this.rgba,t))},s.prototype.desaturate=function(t){return t===void 0&&(t=.1),ci(Ya(this.rgba,-t))},s.prototype.grayscale=function(){return ci(Ya(this.rgba,-1))},s.prototype.lighten=function(t){return t===void 0&&(t=.1),ci(Jc(this.rgba,t))},s.prototype.darken=function(t){return t===void 0&&(t=.1),ci(Jc(this.rgba,-t))},s.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},s.prototype.alpha=function(t){return typeof t=="number"?ci({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):se(this.rgba.a,3);var e},s.prototype.hue=function(t){var e=In(this.rgba);return typeof t=="number"?ci({h:t,s:e.s,l:e.l,a:e.a}):se(e.h)},s.prototype.isEqual=function(t){return this.toHex()===ci(t).toHex()},s})(),ci=function(s){return s instanceof vh?s:new vh(s)},Qc=[],Xv=function(s){s.forEach(function(t){Qc.indexOf(t)<0&&(t(vh,bh),Qc.push(t))})};function $v(s,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var r in e)i[e[r]]=r;var a={};s.prototype.toName=function(h){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var l,c,f=i[this.toHex()];if(f)return f;if(h?.closest){var d=this.toRgb(),g=1/0,x="black";if(!a.length)for(var _ in e)a[_]=new s(e[_]).toRgb();for(var v in e){var T=(l=d,c=a[v],Math.pow(l.r-c.r,2)+Math.pow(l.g-c.g,2)+Math.pow(l.b-c.b,2));T<g&&(g=T,x=v)}return x}},t.string.push([function(h){var l=h.toLowerCase(),c=l==="transparent"?"#0000":e[l];return c?new s(c).toRgb():null},"name"])}Xv([$v]);const Vs=class Cn{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Cn)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,t))&&(this._value=this._cloneSource(t),this._normalize(this._value))}}get value(){return this._value}_cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}_isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((a,h)=>a===e[h]);if(t!==null&&e!==null){const a=Object.keys(t),h=Object.keys(e);return a.length!==h.length?!1:a.every(l=>t[l]===e[l])}return t===e}toRgba(){const[t,e,i,r]=this._components;return{r:t,g:e,b:i,a:r}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,r]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb),t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(r*255),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t||(t=this._arrayRgba);const[e,i,r,a]=this._components;return t[0]=e,t[1]=i,t[2]=r,t[3]=a,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb);const[e,i,r]=this._components;return t[0]=e,t[1]=i,t[2]=r,t}toNumber(){return this._int}toBgrNumber(){const[t,e,i]=this.toUint8RgbArray();return(i<<16)+(e<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,i,r,a]=Cn._temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=r,this._components[3]*=a,this._refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,r=this._int>>8&255,a=this._int&255;return e&&(i=i*t+.5|0,r=r*t+.5|0,a=a*t+.5|0),(t*255<<24)+(i<<16)+(r<<8)+a}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(t){let e,i,r,a;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const h=t;e=(h>>16&255)/255,i=(h>>8&255)/255,r=(h&255)/255,a=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,r,a=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,r,a=255]=t,e/=255,i/=255,r/=255,a/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const l=Cn.HEX_PATTERN.exec(t);l&&(t=`#${l[2]}`)}const h=ci(t);h.isValid()&&({r:e,g:i,b:r,a}=h.rgba,e/=255,i/=255,r/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=r,this._components[3]=a,this._refreshInt();else throw new Error(`Unable to convert color ${t}`)}_refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((r,a)=>{t[a]=Math.min(Math.max(r,e),i)}),t)}static isColorLike(t){return typeof t=="number"||typeof t=="string"||t instanceof Number||t instanceof Cn||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t.r!==void 0&&t.g!==void 0&&t.b!==void 0||t.r!==void 0&&t.g!==void 0&&t.b!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0&&t.a!==void 0}};Vs.shared=new Vs;Vs._temp=new Vs;Vs.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let te=Vs;const Vv={cullArea:null,cullable:!1,cullableChildren:!0};let $a=0;const td=500;function Ot(...s){$a!==td&&($a++,$a===td?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...s))}const zn={_registeredResources:new Set,register(s){this._registeredResources.add(s)},unregister(s){this._registeredResources.delete(s)},release(){this._registeredResources.forEach(s=>s.clear())},get registeredCount(){return this._registeredResources.size},isRegistered(s){return this._registeredResources.has(s)},reset(){this._registeredResources.clear()}};class qv{constructor(t,e){this._pool=[],this._count=0,this._index=0,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){let e;return this._index>0?e=this._pool[--this._index]:(e=new this._classType,this._count++),e.init?.(t),e}return(t){t.reset?.(),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){if(this._pool.length>0&&this._pool[0].destroy)for(let t=0;t<this._index;t++)this._pool[t].destroy();this._pool.length=0,this._count=0,this._index=0}}class jv{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){return this.getPool(t).get(e)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new qv(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(e=>{const i=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[i]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}}),t}clear(){this._poolsByClass.forEach(t=>t.clear()),this._poolsByClass.clear()}}const be=new jv;zn.register(be);const Zv={get isCachedAsTexture(){return!!this.renderGroup?.isCachedAsTexture},cacheAsTexture(s){typeof s=="boolean"&&s===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(s===!0?{}:s))},updateCacheTexture(){this.renderGroup?.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(s){wt("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(s)}};function Kv(s,t,e){const i=s.length;let r;if(t>=i||e===0)return;e=t+e>i?i-t:e;const a=i-e;for(r=t;r<a;++r)s[r]=s[r+e];s.length=a}const Jv={allowChildren:!0,removeChildren(s=0,t){const e=t??this.children.length,i=e-s,r=[];if(i>0&&i<=e){for(let h=e-1;h>=s;h--){const l=this.children[h];l&&(r.push(l),l.parent=null)}Kv(this.children,s,e);const a=this.renderGroup||this.parentRenderGroup;a&&a.removeChildren(r);for(let h=0;h<r.length;++h){const l=r[h];l.parentRenderLayer?.detach(l),this.emit("childRemoved",l,this,h),r[h].emit("removed",this)}return r.length>0&&this._didViewChangeTick++,r}else if(i===0&&this.children.length===0)return r;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(s){const t=this.getChildAt(s);return this.removeChild(t)},getChildAt(s){if(s<0||s>=this.children.length)throw new Error(`getChildAt: Index (${s}) does not exist.`);return this.children[s]},setChildIndex(s,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(s),this.addChildAt(s,t)},getChildIndex(s){const t=this.children.indexOf(s);if(t===-1)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(s,t){this.allowChildren||wt(Nt,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:e}=this;if(t<0||t>e.length)throw new Error(`${s}addChildAt: The index ${t} supplied is out of bounds ${e.length}`);if(s.parent){const r=s.parent.children.indexOf(s);if(s.parent===this&&r===t)return s;r!==-1&&s.parent.children.splice(r,1)}t===e.length?e.push(s):e.splice(t,0,s),s.parent=this,s.didChange=!0,s._updateFlags=15;const i=this.renderGroup||this.parentRenderGroup;return i&&i.addChild(s),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",s,this,t),s.emit("added",this),s},swapChildren(s,t){if(s===t)return;const e=this.getChildIndex(s),i=this.getChildIndex(t);this.children[e]=t,this.children[i]=s;const r=this.renderGroup||this.parentRenderGroup;r&&(r.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){this.parent?.removeChild(this)},reparentChild(...s){return s.length===1?this.reparentChildAt(s[0],this.children.length):(s.forEach(t=>this.reparentChildAt(t,this.children.length)),s[0])},reparentChildAt(s,t){if(s.parent===this)return this.setChildIndex(s,t),s;const e=s.worldTransform.clone();s.removeFromParent(),this.addChildAt(s,t);const i=this.worldTransform.clone();return i.invert(),e.prepend(i),s.setFromMatrix(e),s},replaceChild(s,t){s.updateLocalTransform(),this.addChildAt(t,this.getChildIndex(s)),t.setFromMatrix(s.localTransform),t.updateLocalTransform(),this.removeChild(s)}},Qv={collectRenderables(s,t,e){this.parentRenderLayer&&this.parentRenderLayer!==e||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(s,t,e):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,s):this.collectRenderablesWithEffects(s,t,e))},collectRenderablesSimple(s,t,e){const i=this.children,r=i.length;for(let a=0;a<r;a++)i[a].collectRenderables(s,t,e)},collectRenderablesWithEffects(s,t,e){const{renderPipes:i}=t;for(let r=0;r<this.effects.length;r++){const a=this.effects[r];i[a.pipe].push(a,this,s)}this.collectRenderablesSimple(s,t,e);for(let r=this.effects.length-1;r>=0;r--){const a=this.effects[r];i[a.pipe].pop(a,this,s)}}};class ed{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}class t1{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this._tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let e=0;e<this._tests.length;e++){const i=this._tests[e];if(i.test(t))return be.get(i.maskClass,t)}return t}returnMaskEffect(t){be.return(t)}}const wh=new t1;Mt.handleByList(V.MaskEffect,wh._effectClasses);const e1={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)},addEffect(s){this.effects.indexOf(s)===-1&&(this.effects.push(s),this.effects.sort((e,i)=>e.priority-i.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(s){const t=this.effects.indexOf(s);t!==-1&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(s){const t=this._maskEffect;t?.mask!==s&&(t&&(this.removeEffect(t),wh.returnMaskEffect(t),this._maskEffect=null),s!=null&&(this._maskEffect=wh.getMaskEffect(s),this.addEffect(this._maskEffect)))},get mask(){return this._maskEffect?.mask},setMask(s){this._maskOptions={...this._maskOptions,...s},s.mask&&(this.mask=s.mask),this._markStructureAsChanged()},set filters(s){!Array.isArray(s)&&s&&(s=[s]);const t=this._filterEffect||(this._filterEffect=new ed);s=s;const e=s?.length>0,i=t.filters?.length>0,r=e!==i;s=Array.isArray(s)?s.slice(0):s,t.filters=Object.freeze(s),r&&(e?this.addEffect(t):(this.removeEffect(t),t.filters=s??null))},get filters(){return this._filterEffect?.filters},set filterArea(s){this._filterEffect||(this._filterEffect=new ed),this._filterEffect.filterArea=s},get filterArea(){return this._filterEffect?.filterArea}},i1={label:null,get name(){return wt(Nt,"Container.name property has been removed, use Container.label instead"),this.label},set name(s){wt(Nt,"Container.name property has been removed, use Container.label instead"),this.label=s},getChildByName(s,t=!1){return this.getChildByLabel(s,t)},getChildByLabel(s,t=!1){const e=this.children;for(let i=0;i<e.length;i++){const r=e[i];if(r.label===s||s instanceof RegExp&&s.test(r.label))return r}if(t)for(let i=0;i<e.length;i++){const a=e[i].getChildByLabel(s,!0);if(a)return a}return null},getChildrenByLabel(s,t=!1,e=[]){const i=this.children;for(let r=0;r<i.length;r++){const a=i[r];(a.label===s||s instanceof RegExp&&s.test(a.label))&&e.push(a)}if(t)for(let r=0;r<i.length;r++)i[r].getChildrenByLabel(s,!0,e);return e}},ge=be.getPool(pt),Mi=be.getPool(Re),s1=new pt,n1={getFastGlobalBounds(s,t){t||(t=new Re),t.clear(),this._getGlobalBoundsRecursive(!!s,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const e=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(e.worldTransform),t},_getGlobalBoundsRecursive(s,t,e){let i=t;if(s&&this.parentRenderLayer&&this.parentRenderLayer!==e||this.localDisplayStatus!==7||!this.measurable)return;const r=!!this.effects.length;if((this.renderGroup||r)&&(i=Mi.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const h=this.bounds;i.addFrame(h.minX,h.minY,h.maxX,h.maxY,this.groupTransform)}const a=this.children;for(let h=0;h<a.length;h++)a[h]._getGlobalBoundsRecursive(s,i,e)}if(r){let a=!1;const h=this.renderGroup||this.parentRenderGroup;for(let l=0;l<this.effects.length;l++)this.effects[l].addBounds&&(a||(a=!0,i.applyMatrix(h.worldTransform)),this.effects[l].addBounds(i,!0));a&&i.applyMatrix(h.worldTransform.copyTo(s1).invert()),t.addBounds(i),Mi.return(i)}else this.renderGroup&&(t.addBounds(i,this.relativeGroupTransform),Mi.return(i))}};function _f(s,t,e){e.clear();let i,r;return s.parent?t?i=s.parent.worldTransform:(r=ge.get().identity(),i=Xh(s,r)):i=pt.IDENTITY,xf(s,e,i,t),r&&ge.return(r),e.isValid||e.set(0,0,0,0),e}function xf(s,t,e,i){if(!s.visible||!s.measurable)return;let r;i?r=s.worldTransform:(s.updateLocalTransform(),r=ge.get(),r.appendFrom(s.localTransform,e));const a=t,h=!!s.effects.length;if(h&&(t=Mi.get().clear()),s.boundsArea)t.addRect(s.boundsArea,r);else{const l=s.bounds;l&&!l.isEmpty()&&(t.matrix=r,t.addBounds(l));for(let c=0;c<s.children.length;c++)xf(s.children[c],t,r,i)}if(h){for(let l=0;l<s.effects.length;l++)s.effects[l].addBounds?.(t);a.addBounds(t,pt.IDENTITY),Mi.return(t)}i||ge.return(r)}function Xh(s,t){const e=s.parent;return e&&(Xh(e,t),e.updateLocalTransform(),t.append(e.localTransform)),t}function yf(s,t){if(s===16777215||!t)return t;if(t===16777215||!s)return s;const e=s>>16&255,i=s>>8&255,r=s&255,a=t>>16&255,h=t>>8&255,l=t&255,c=e*a/255|0,f=i*h/255|0,d=r*l/255|0;return(c<<16)+(f<<8)+d}const id=16777215;function sd(s,t){return s===id?t:t===id?s:yf(s,t)}function eo(s){return((s&255)<<16)+(s&65280)+(s>>16&255)}const r1={getGlobalAlpha(s){if(s)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,e=this.parent;for(;e;)t*=e.alpha,e=e.parent;return t},getGlobalTransform(s=new pt,t){if(t)return s.copyFrom(this.worldTransform);this.updateLocalTransform();const e=Xh(this,ge.get().identity());return s.appendFrom(this.localTransform,e),ge.return(e),s},getGlobalTint(s){if(s)return this.renderGroup?eo(this.renderGroup.worldColor):this.parentRenderGroup?eo(sd(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,e=this.parent;for(;e;)t=sd(t,e.localColor),e=e.parent;return eo(t)}};function bf(s,t,e){return t.clear(),e||(e=pt.IDENTITY),vf(s,t,e,s,!0),t.isValid||t.set(0,0,0,0),t}function vf(s,t,e,i,r){let a;if(r)a=ge.get(),a=e.copyTo(a);else{if(!s.visible||!s.measurable)return;s.updateLocalTransform();const c=s.localTransform;a=ge.get(),a.appendFrom(c,e)}const h=t,l=!!s.effects.length;if(l&&(t=Mi.get().clear()),s.boundsArea)t.addRect(s.boundsArea,a);else{s.renderPipeId&&(t.matrix=a,t.addBounds(s.bounds));const c=s.children;for(let f=0;f<c.length;f++)vf(c[f],t,a,i,!1)}if(l){for(let c=0;c<s.effects.length;c++)s.effects[c].addLocalBounds?.(t,i);h.addBounds(t,pt.IDENTITY),Mi.return(t)}ge.return(a)}function wf(s,t){const e=s.children;for(let i=0;i<e.length;i++){const r=e[i],a=r.uid,h=(r._didViewChangeTick&65535)<<16|r._didContainerChangeTick&65535,l=t.index;(t.data[l]!==a||t.data[l+1]!==h)&&(t.data[t.index]=a,t.data[t.index+1]=h,t.didChange=!0),t.index=l+2,r.children.length&&wf(r,t)}return t.didChange}const o1=new pt,a1={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(s,t){const e=Math.sign(this.scale.x)||1;t!==0?this.scale.x=s/t*e:this.scale.x=e},_setHeight(s,t){const e=Math.sign(this.scale.y)||1;t!==0?this.scale.y=s/t*e:this.scale.y=e},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new Re});const s=this._localBoundsCacheData;return s.index=1,s.didChange=!1,s.data[0]!==this._didViewChangeTick&&(s.didChange=!0,s.data[0]=this._didViewChangeTick),wf(this,s),s.didChange&&bf(this,s.localBounds,o1),s.localBounds},getBounds(s,t){return _f(this,s,t||new Re)}},h1={_onRender:null,set onRender(s){const t=this.renderGroup||this.parentRenderGroup;if(!s){this._onRender&&t?.removeOnRender(this),this._onRender=null;return}this._onRender||t?.addOnRender(this),this._onRender=s},get onRender(){return this._onRender}},l1={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(s){this._zIndex!==s&&(this._zIndex=s,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(u1))}};function u1(s,t){return s._zIndex-t._zIndex}const c1={getGlobalPosition(s=new qt,t=!1){return this.parent?this.parent.toGlobal(this._position,s,t):(s.x=this._position.x,s.y=this._position.y),s},toGlobal(s,t,e=!1){const i=this.getGlobalTransform(ge.get(),e);return t=i.apply(s,t),ge.return(i),t},toLocal(s,t,e,i){t&&(s=t.toGlobal(s,e,i));const r=this.getGlobalTransform(ge.get(),i);return e=r.applyInverse(s,e),ge.return(r),e}};class $h{constructor(){this.uid=Yt("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}destroy(){this.instructions.length=0,this.renderables.length=0,this.renderPipes=null,this.gcTick=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let d1=0;class f1{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this.textureStyle=new $s(this.textureOptions)}createTexture(t,e,i){const r=new Xe({...this.textureOptions,width:t,height:e,resolution:1,antialias:i,autoGarbageCollect:!1});return new ht({source:r,label:`texturePool_${d1++}`})}getOptimalTexture(t,e,i=1,r){let a=Math.ceil(t*i-1e-6),h=Math.ceil(e*i-1e-6);a=Xs(a),h=Xs(h);const l=(a<<17)+(h<<1)+(r?1:0);this._texturePool[l]||(this._texturePool[l]=[]);let c=this._texturePool[l].pop();return c||(c=this.createTexture(a,h,r)),c.source._resolution=i,c.source.width=a/i,c.source.height=h/i,c.source.pixelWidth=a,c.source.pixelHeight=h,c.frame.x=0,c.frame.y=0,c.frame.width=t,c.frame.height=e,c.updateUvs(),this._poolKeyHash[c.uid]=l,c}getSameSizeTexture(t,e=!1){const i=t.source;return this.getOptimalTexture(t.width,t.height,i._resolution,e)}returnTexture(t,e=!1){const i=this._poolKeyHash[t.uid];e&&(t.source.style=this.textureStyle),this._texturePool[i].push(t)}clear(t){if(t=t!==!1,t)for(const e in this._texturePool){const i=this._texturePool[e];if(i)for(let r=0;r<i.length;r++)i[r].destroy(!0)}this._texturePool={}}}const co=new f1;zn.register(co);class p1{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new pt,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new $h,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const e=t.children;for(let i=0;i<e.length;i++){const r=e[i];r._updateFlags=15,this.addChild(r)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(co.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0;const t=this._parentCacheAsTextureRenderGroup;t&&!t.textureNeedsUpdate&&t.updateCacheTexture()}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const e=this.childrenToUpdate[t];e.list.fill(null),e.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const e=this.renderGroupChildren.indexOf(t);e>-1&&this.renderGroupChildren.splice(e,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup){this.addRenderGroupChild(t.renderGroup);return}t._onRender&&this.addOnRender(t);const e=t.children;for(let i=0;i<e.length;i++)this.addChild(e[i])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup){this._removeRenderGroupChild(t.renderGroup);return}const e=t.children;for(let i=0;i<e.length;i++)this.removeChild(e[i])}removeChildren(t){for(let e=0;e<t.length;e++)this.removeChild(t[e])}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeRenderGroupDepth];e||(e=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const e=this.root.children;for(let i=0;i<e.length;i++)this._getChildren(e[i],t);return t}_getChildren(t,e=[]){if(e.push(t),t.renderGroup)return e;const i=t.children;for(let r=0;r<i.length;r++)this._getChildren(i[r],e);return e}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return(this._matrixDirty&1)===0?this._inverseWorldTransform:(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new pt),this._inverseWorldTransform.copyFrom(this.worldTransform).invert())}get textureOffsetInverseTransform(){return(this._matrixDirty&2)===0?this._textureOffsetInverseTransform:(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new pt),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y))}get inverseParentTextureTransform(){if((this._matrixDirty&4)===0)return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new pt),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this.isCachedAsTexture?this.textureOffsetInverseTransform:this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function g1(s,t,e={}){for(const i in t)!e[i]&&t[i]!==void 0&&(s[i]=t[i])}const Va=new he(null),Nr=new he(null),qa=new he(null,1,1),Yr=new he(null),nd=1,m1=2,ja=4;class Gt extends fi{constructor(t={}){super(),this.uid=Yt("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.parentRenderLayer=null,this.updateTick=-1,this.localTransform=new pt,this.relativeGroupTransform=new pt,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new he(this,0,0),this._scale=qa,this._pivot=Nr,this._origin=Yr,this._skew=Va,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],g1(this,t,{children:!0,parent:!0,effects:!0}),t.children?.forEach(e=>this.addChild(e)),t.parent?.addChild(this)}static mixin(t){wt("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),Mt.mixin(Gt,t)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=t&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...t){if(this.allowChildren||wt(Nt,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let r=0;r<t.length;r++)this.addChild(t[r]);return t[0]}const e=t[0],i=this.renderGroup||this.parentRenderGroup;return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),i&&(i.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),this.sortableChildren&&(this.sortDirty=!0),e.parent=this,e.didChange=!0,e._updateFlags=15,i&&i.addChild(e),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this),this._didViewChangeTick++,e._zIndex!==0&&e.depthOfChildModified(),e)}removeChild(...t){if(t.length>1){for(let r=0;r<t.length;r++)this.removeChild(t[r]);return t[0]}const e=t[0],i=this.children.indexOf(e);return i>-1&&(this._didViewChangeTick++,this.children.splice(i,1),this.renderGroup?this.renderGroup.removeChild(e):this.parentRenderGroup&&this.parentRenderGroup.removeChild(e),e.parentRenderLayer&&e.parentRenderLayer.detach(e),e.parent=null,this.emit("childRemoved",e,this,i),e.emit("removed",this)),e}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;t?.removeChild(this),this.renderGroup=be.get(p1,this),this.groupTransform=pt.IDENTITY,t?.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;t?.removeChild(this),be.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,t?.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new pt),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*kv}set angle(t){this.rotation=t*Iv}get pivot(){return this._pivot===Nr&&(this._pivot=new he(this,0,0)),this._pivot}set pivot(t){this._pivot===Nr&&(this._pivot=new he(this,0,0),this._origin!==Yr&&Ot("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===Va&&(this._skew=new he(this,0,0)),this._skew}set skew(t){this._skew===Va&&(this._skew=new he(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===qa&&(this._scale=new he(this,1,1)),this._scale}set scale(t){this._scale===qa&&(this._scale=new he(this,0,0)),typeof t=="string"&&(t=parseFloat(t)),typeof t=="number"?this._scale.set(t):this._scale.copyFrom(t)}get origin(){return this._origin===Yr&&(this._origin=new he(this,0,0)),this._origin}set origin(t){this._origin===Yr&&(this._origin=new he(this,0,0),this._pivot!==Nr&&Ot("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._origin.set(t):this._origin.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const e=this.getLocalBounds().width;this._setWidth(t,e)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const e=this.getLocalBounds().height;this._setHeight(t,e)}getSize(t){t||(t={});const e=this.getLocalBounds();return t.width=Math.abs(this.scale.x*e.width),t.height=Math.abs(this.scale.y*e.height),t}setSize(t,e){const i=this.getLocalBounds();typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,i.width),e!==void 0&&this._setHeight(e,i.height)}_updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}updateTransform(t){return this.position.set(typeof t.x=="number"?t.x:this.position.x,typeof t.y=="number"?t.y:this.position.y),this.scale.set(typeof t.scaleX=="number"?t.scaleX||1:this.scale.x,typeof t.scaleY=="number"?t.scaleY||1:this.scale.y),this.rotation=typeof t.rotation=="number"?t.rotation:this.rotation,this.skew.set(typeof t.skewX=="number"?t.skewX:this.skew.x,typeof t.skewY=="number"?t.skewY:this.skew.y),this.pivot.set(typeof t.pivotX=="number"?t.pivotX:this.pivot.x,typeof t.pivotY=="number"?t.pivotY:this.pivot.y),this.origin.set(typeof t.originX=="number"?t.originX:this.origin.x,typeof t.originY=="number"?t.originY:this.origin.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const e=this.localTransform,i=this._scale,r=this._pivot,a=this._origin,h=this._position,l=i._x,c=i._y,f=r._x,d=r._y,g=-a._x,x=-a._y;e.a=this._cx*l,e.b=this._sx*l,e.c=this._cy*c,e.d=this._sy*c,e.tx=h._x-(f*e.a+d*e.c)+(g*e.a+x*e.c)-g,e.ty=h._y-(f*e.b+d*e.d)+(g*e.b+x*e.d)-x}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=nd,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const i=te.shared.setValue(t??16777215).toBgrNumber();i!==this.localColor&&(this.localColor=i,this._updateFlags|=nd,this._onUpdate())}get tint(){return eo(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=m1,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(t){const e=t?2:0;(this.localDisplayStatus&2)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=ja,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(t){const e=t?0:4;(this.localDisplayStatus&4)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=ja,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(t){const e=t?1:0;(this.localDisplayStatus&1)!==e&&(this._updateFlags|=ja,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(t=!1){if(this.destroyed)return;this.destroyed=!0;let e;if(this.children.length&&(e=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof t=="boolean"?t:t?.children)&&e)for(let r=0;r<e.length;++r)e[r].destroy(t);this.renderGroup?.destroy(),this.renderGroup=null}}Mt.mixin(Gt,Jv,n1,c1,h1,a1,e1,i1,l1,Vv,Zv,r1,Qv);class fo extends Gt{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this._bounds=new Re(0,1,0,0),this._boundsDirty=!0,this.autoGarbageCollect=t.autoGarbageCollect??!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const e=this.bounds,{x:i,y:r}=t;return i>=e.minX&&i<=e.maxX&&r>=e.minY&&r<=e.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}unload(){this.emit("unload",this);for(const t in this._gpuData)this._gpuData[t]?.destroy();this._gpuData=Object.create(null),this.onViewUpdate()}destroy(t){this.unload(),super.destroy(t),this._bounds=null}collectRenderablesSimple(t,e,i){const{renderPipes:r}=e;r.blendMode.pushBlendMode(this,this.groupBlendMode,t);const h=r[this.renderPipeId];h?.addRenderable&&h.addRenderable(this,t),this.didViewUpdate=!1;const l=this.children,c=l.length;for(let f=0;f<c;f++)l[f].collectRenderables(t,e,i);r.blendMode.popBlendMode(t)}}class ii extends fo{constructor(t=ht.EMPTY){t instanceof ht&&(t={texture:t});const{texture:e=ht.EMPTY,anchor:i,roundPixels:r,width:a,height:h,...l}=t;super({label:"Sprite",...l}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new he({_onUpdate:()=>{this.onViewUpdate()}}),i?this.anchor=i:e.defaultAnchor&&(this.anchor=e.defaultAnchor),this.texture=e,this.allowChildren=!1,this.roundPixels=r??!1,a!==void 0&&(this.width=a),h!==void 0&&(this.height=h)}static from(t,e=!1){return t instanceof ht?new ii(t):new ii(ht.from(t,e))}set texture(t){t||(t=ht.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return ff(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return wt("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this._anchor,e=this._texture,i=this._bounds,{width:r,height:a}=e.orig;i.minX=-t._x*r,i.maxX=i.minX+r,i.minY=-t._y*a,i.maxY=i.minY+a}destroy(t=!1){if(super.destroy(t),typeof t=="boolean"?t:t?.texture){const i=typeof t=="boolean"?t:t?.textureSource;this._texture.destroy(i)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this._texture.orig.width),e!==void 0&&this._setHeight(e,this._texture.orig.height)}}const _1=new Re;function Sf(s,t,e){const i=_1;s.measurable=!0,_f(s,e,i),t.addBoundsMask(i),s.measurable=!1}function Af(s,t,e){const i=Mi.get();s.measurable=!0;const r=ge.get().identity(),a=Tf(s,e,r);bf(s,i,a),s.measurable=!1,t.addBoundsMask(i),ge.return(r),Mi.return(i)}function Tf(s,t,e){return s?(s!==t&&(Tf(s.parent,t,e),s.updateLocalTransform(),e.append(s.localTransform)),e):(Ot("Mask bounds, renderable is not inside the root container"),e)}class Cf{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof ii),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask=null)}addBounds(t,e){this.inverse||Sf(this.mask,t,e)}addLocalBounds(t,e){Af(this.mask,t,e)}containsPoint(t,e){const i=this.mask;return e(i,t)}destroy(){this.reset()}static test(t){return t instanceof ii}}Cf.extension=V.MaskEffect;class Mf{constructor(t){this.priority=0,this.pipe="colorMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}Mf.extension=V.MaskEffect;class Pf{constructor(t){this.priority=0,this.pipe="stencilMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null)}addBounds(t,e){Sf(this.mask,t,e)}addLocalBounds(t,e){Af(this.mask,t,e)}containsPoint(t,e){const i=this.mask;return e(i,t)}destroy(){this.reset()}static test(t){return t instanceof Gt}}Pf.extension=V.MaskEffect;const x1={createCanvas:(s,t)=>{const e=document.createElement("canvas");return e.width=s,e.height=t,e},createImage:()=>new Image,getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,t)=>fetch(s,t),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")};let rd=x1;const Lt={get(){return rd},set(s){rd=s}};class Ef extends Xe{constructor(t){t.resource||(t.resource=Lt.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,e=this.height,i=this._resolution){const r=super.resize(t,e,i);return r&&this.resizeCanvas(),r}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}Ef.extension=V.TextureSource;class qs extends Xe{constructor(t){super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}qs.extension=V.TextureSource;var ro=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(ro||{});class Za{constructor(t,e=null,i=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=e,this.priority=i,this._once=r}match(t,e=null){return this._fn===t&&this._context===e}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const e=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const kf=class ke{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Za(null,null,1/0),this.deltaMS=1/ke.targetFPMS,this.elapsedMS=1/ke.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=ro.NORMAL){return this._addListener(new Za(t,e,i))}addOnce(t,e,i=ro.NORMAL){return this._addListener(new Za(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const a=t-this._lastFrame|0;if(a<this._minElapsedMS)return;this._lastFrame=t-a%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*ke.targetFPMS;const i=this._head;let r=i.next;for(;r;)r=r.emit(this);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,ke.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!ke._shared){const t=ke._shared=new ke;t.autoStart=!0,t._protected=!0}return ke._shared}static get system(){if(!ke._system){const t=ke._system=new ke;t.autoStart=!0,t._protected=!0}return ke._system}};kf.targetFPMS=.06;let Ds=kf,Ka;async function If(){return Ka??(Ka=(async()=>{const t=Lt.get().createCanvas(1,1).getContext("webgl");if(!t)return"premultiply-alpha-on-upload";const e=await new Promise(h=>{const l=document.createElement("video");l.onloadeddata=()=>h(l),l.onerror=()=>h(null),l.autoplay=!1,l.crossOrigin="anonymous",l.preload="auto",l.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",l.load()});if(!e)return"premultiply-alpha-on-upload";const i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const a=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,a),t.deleteFramebuffer(r),t.deleteTexture(i),t.getExtension("WEBGL_lose_context")?.loseContext(),a[0]<=a[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),Ka}const po=class Rf extends Xe{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...Rf.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=Ds.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource,e=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(e.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlayThrough),t.addEventListener("error",this._onError,!0)),this.alphaMode=await If(),this._load=new Promise((i,r)=>{this.isValid?i(this):(this._resolve=i,this._reject=r,e.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${e.preloadTimeoutMs}ms`))})),t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlayThrough),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(Ds.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Ds.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Ds.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};po.extension=V.TextureSource;po.defaultOptions={...Xe.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};po.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Rn=po;const ei=(s,t,e=!1)=>(Array.isArray(s)||(s=[s]),t?s.map(i=>typeof i=="string"||e?t(i):i):s);class y1{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||Ot(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=ei(t);let r;for(let c=0;c<this.parsers.length;c++){const f=this.parsers[c];if(f.test(e)){r=f.getCacheableAssets(i,e);break}}const a=new Map(Object.entries(r||{}));r||i.forEach(c=>{a.set(c,e)});const h=[...a.keys()],l={cacheKeys:h,keys:i};i.forEach(c=>{this._cacheMap.set(c,l)}),h.forEach(c=>{const f=r?r[c]:e;this._cache.has(c)&&this._cache.get(c)!==f&&Ot("[Cache] already has key:",c),this._cache.set(c,a.get(c))})}remove(t){if(!this._cacheMap.has(t)){Ot(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(r=>{this._cache.delete(r)}),e.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const ne=new y1,Sh=[];Mt.handleByList(V.TextureSource,Sh);function Lf(s={}){const t=s&&s.resource,e=t?s.resource:s,i=t?s:{resource:s};for(let r=0;r<Sh.length;r++){const a=Sh[r];if(a.test(e))return new a(i)}throw new Error(`Could not find a source type for resource: ${i.resource}`)}function b1(s={},t=!1){const e=s&&s.resource,i=e?s.resource:s,r=e?s:{resource:s};if(!t&&ne.has(i))return ne.get(i);const a=new ht({source:Lf(r)});return a.on("destroy",()=>{ne.has(i)&&ne.remove(i)}),t||ne.set(i,a),a}function v1(s,t=!1){return typeof s=="string"?ne.get(s):s instanceof Xe?new ht({source:s}):b1(s,t)}ht.from=v1;Xe.from=Lf;Mt.add(Cf,Mf,Pf,Rn,qs,Ef,Yh);var ji=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(ji||{});function Ke(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function yn(s){return s.split("?")[0].split("#")[0]}function w1(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function S1(s,t,e){return s.replace(new RegExp(w1(t),"g"),e)}function A1(s,t){let e="",i=0,r=-1,a=0,h=-1;for(let l=0;l<=s.length;++l){if(l<s.length)h=s.charCodeAt(l);else{if(h===47)break;h=47}if(h===47){if(!(r===l-1||a===1))if(r!==l-1&&a===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const c=e.lastIndexOf("/");if(c!==e.length-1){c===-1?(e="",i=0):(e=e.slice(0,c),i=e.length-1-e.lastIndexOf("/")),r=l,a=0;continue}}else if(e.length===2||e.length===1){e="",i=0,r=l,a=0;continue}}}else e.length>0?e+=`/${s.slice(r+1,l)}`:e=s.slice(r+1,l),i=l-r-1;r=l,a=0}else h===46&&a!==-1?++a:a=-1}return e}const Ie={toPosix(s){return S1(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},isBlobUrl(s){return s.startsWith("blob:")},hasProtocol(s){return/^[^/:]+:/.test(this.toPosix(s))},getProtocol(s){Ke(s),s=this.toPosix(s);const t=/^file:\/\/\//.exec(s);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(s);return e?e[0]:""},toAbsolute(s,t,e){if(Ke(s),this.isDataUrl(s)||this.isBlobUrl(s))return s;const i=yn(this.toPosix(t??Lt.get().getBaseUrl())),r=yn(this.toPosix(e??this.rootname(i)));return s=this.toPosix(s),s.startsWith("/")?Ie.join(r,s.slice(1)):this.isAbsolute(s)?s:this.join(i,s)},normalize(s){if(Ke(s),s.length===0)return".";if(this.isDataUrl(s)||this.isBlobUrl(s))return s;s=this.toPosix(s);let t="";const e=s.startsWith("/");this.hasProtocol(s)&&(t=this.rootname(s),s=s.slice(t.length));const i=s.endsWith("/");return s=A1(s),s.length>0&&i&&(s+="/"),e?`/${s}`:t+s},isAbsolute(s){return Ke(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let t;for(let e=0;e<s.length;++e){const i=s[e];if(Ke(i),i.length>0)if(t===void 0)t=i;else{const r=s[e-1]??"";this.joinExtensions.includes(this.extname(r).toLowerCase())?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(s){if(Ke(s),s.length===0)return".";s=this.toPosix(s);let t=s.charCodeAt(0);const e=t===47;let i=-1,r=!0;const a=this.getProtocol(s),h=s;s=s.slice(a.length);for(let l=s.length-1;l>=1;--l)if(t=s.charCodeAt(l),t===47){if(!r){i=l;break}}else r=!1;return i===-1?e?"/":this.isUrl(h)?a+s:a:e&&i===1?"//":a+s.slice(0,i)},rootname(s){Ke(s),s=this.toPosix(s);let t="";if(s.startsWith("/")?t="/":t=this.getProtocol(s),this.isUrl(s)){const e=s.indexOf("/",t.length);e!==-1?t=s.slice(0,e):t=s,t.endsWith("/")||(t+="/")}return t},basename(s,t){Ke(s),t&&Ke(t),s=yn(this.toPosix(s));let e=0,i=-1,r=!0,a;if(t!==void 0&&t.length>0&&t.length<=s.length){if(t.length===s.length&&t===s)return"";let h=t.length-1,l=-1;for(a=s.length-1;a>=0;--a){const c=s.charCodeAt(a);if(c===47){if(!r){e=a+1;break}}else l===-1&&(r=!1,l=a+1),h>=0&&(c===t.charCodeAt(h)?--h===-1&&(i=a):(h=-1,i=l))}return e===i?i=l:i===-1&&(i=s.length),s.slice(e,i)}for(a=s.length-1;a>=0;--a)if(s.charCodeAt(a)===47){if(!r){e=a+1;break}}else i===-1&&(r=!1,i=a+1);return i===-1?"":s.slice(e,i)},extname(s){Ke(s),s=yn(this.toPosix(s));let t=-1,e=0,i=-1,r=!0,a=0;for(let h=s.length-1;h>=0;--h){const l=s.charCodeAt(h);if(l===47){if(!r){e=h+1;break}continue}i===-1&&(r=!1,i=h+1),l===46?t===-1?t=h:a!==1&&(a=1):t!==-1&&(a=-1)}return t===-1||i===-1||a===0||a===1&&t===i-1&&t===e+1?"":s.slice(t,i)},parse(s){Ke(s);const t={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return t;s=yn(this.toPosix(s));let e=s.charCodeAt(0);const i=this.isAbsolute(s);let r;t.root=this.rootname(s),i||this.hasProtocol(s)?r=1:r=0;let a=-1,h=0,l=-1,c=!0,f=s.length-1,d=0;for(;f>=r;--f){if(e=s.charCodeAt(f),e===47){if(!c){h=f+1;break}continue}l===-1&&(c=!1,l=f+1),e===46?a===-1?a=f:d!==1&&(d=1):a!==-1&&(d=-1)}return a===-1||l===-1||d===0||d===1&&a===l-1&&a===h+1?l!==-1&&(h===0&&i?t.base=t.name=s.slice(1,l):t.base=t.name=s.slice(h,l)):(h===0&&i?(t.name=s.slice(1,a),t.base=s.slice(1,l)):(t.name=s.slice(h,a),t.base=s.slice(h,l)),t.ext=s.slice(a,l)),t.dir=this.dirname(s),t},sep:"/",delimiter:":",joinExtensions:[".html"]};function Bf(s,t,e,i,r){const a=t[e];for(let h=0;h<a.length;h++){const l=a[h];e<t.length-1?Bf(s.replace(i[e],l),t,e+1,i,r):r.push(s.replace(i[e],l))}}function T1(s){const t=/\{(.*?)\}/g,e=s.match(t),i=[];if(e){const r=[];e.forEach(a=>{const h=a.substring(1,a.length-1).split(",");r.push(h)}),Bf(s,r,0,e,i)}else i.push(s);return i}const oo=s=>!Array.isArray(s);class Zs{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}getAlias(t){const{alias:e,src:i}=t;return ei(e||i,a=>typeof a=="string"?a:Array.isArray(a)?a.map(h=>h?.src??h):a?.src?a.src:a,!0)}addManifest(t){this._manifest&&Ot("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];let r=e;Array.isArray(e)||(r=Object.entries(e).map(([a,h])=>typeof h=="string"||Array.isArray(h)?{alias:a,src:h}:{alias:a,...h})),r.forEach(a=>{const h=a.src,l=a.alias;let c;if(typeof l=="string"){const f=this._createBundleAssetId(t,l);i.push(f),c=[l,f]}else{const f=l.map(d=>this._createBundleAssetId(t,d));i.push(...f),c=[...l,...f]}this.add({...a,alias:c,src:h})}),this._bundles[t]=i}add(t){const e=[];Array.isArray(t)?e.push(...t):e.push(t);let i;i=a=>{this.hasKey(a)&&Ot(`[Resolver] already has key: ${a} overwriting`)},ei(e).forEach(a=>{const{src:h}=a;let{data:l,format:c,loadParser:f,parser:d}=a;const g=ei(h).map(T=>typeof T=="string"?T1(T):Array.isArray(T)?T:[T]),x=this.getAlias(a);Array.isArray(x)?x.forEach(i):i(x);const _=[],v=T=>{const w=this._parsers.find(A=>A.test(T));return{src:T,...w?.parse(T)}};g.forEach(T=>{T.forEach(w=>{let A={};if(typeof w!="object"?A=v(w):(l=w.data??l,c=w.format??c,(w.loadParser||w.parser)&&(f=w.loadParser??f,d=w.parser??d),A={...v(w.src),...w}),!x)throw new Error(`[Resolver] alias is undefined for this asset: ${A.src}`);A=this._buildResolvedAsset(A,{aliases:x,data:l,format:c,loadParser:f,parser:d,progressSize:a.progressSize}),_.push(A)})}),x.forEach(T=>{this._assetMap[T]=_})})}resolveBundle(t){const e=oo(t);t=ei(t);const i={};return t.forEach(r=>{const a=this._bundles[r];if(a){const h=this.resolve(a),l={};for(const c in h){const f=h[c];l[this._extractAssetIdFromBundle(r,c)]=f}i[r]=l}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const i={};for(const r in e)i[r]=e[r].src;return i}return e.src}resolve(t){const e=oo(t);t=ei(t);const i={};return t.forEach(r=>{if(!this._resolverHash[r])if(this._assetMap[r]){let a=this._assetMap[r];const h=this._getPreferredOrder(a);h?.priority.forEach(l=>{h.params[l].forEach(c=>{const f=a.filter(d=>d[l]?d[l]===c:!1);f.length&&(a=f)})}),this._resolverHash[r]=a[0]}else this._resolverHash[r]=this._buildResolvedAsset({alias:[r],src:r},{});i[r]=this._resolverHash[r]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[e],r=this._preferredOrder.find(a=>a.params.format.includes(i.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}_buildResolvedAsset(t,e){const{aliases:i,data:r,loadParser:a,parser:h,format:l,progressSize:c}=e;return(this._basePath||this._rootPath)&&(t.src=Ie.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...r||{},...t.data},t.loadParser=a??t.loadParser,t.parser=h??t.parser,t.format=l??t.format??C1(t.src),c!==void 0&&(t.progressSize=c),t}}Zs.RETINA_PREFIX=/@([0-9\.]+)x/;function C1(s){return s.split(".").pop().split("?").shift().split("#").shift()}const Ah=(s,t)=>{const e=t.split("?")[1];return e&&(s+=`?${e}`),s},Ff=class Mn{constructor(t,e){this.linkedSheets=[];let i=t;t?.source instanceof Xe&&(i={texture:t,data:e});const{texture:r,data:a,cachePrefix:h=""}=i;this.cachePrefix=h,this._texture=r instanceof ht?r:null,this.textureSource=r.source,this.textures={},this.animations={},this.data=a;const l=parseFloat(a.meta.scale);l?(this.resolution=l,r.source.resolution=this.resolution):this.resolution=r.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Mn.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}parseSync(){return this._processFrames(0,!0),this._processAnimations(),this.textures}_processFrames(t,e=!1){let i=t;const r=e?1/0:Mn.BATCH_SIZE;for(;i-t<r&&i<this._frameKeys.length;){const a=this._frameKeys[i],h=this._frames[a],l=h.frame;if(l){let c=null,f=null;const d=h.trimmed!==!1&&h.sourceSize?h.sourceSize:h.frame,g=new kt(0,0,Math.floor(d.w)/this.resolution,Math.floor(d.h)/this.resolution);h.rotated?c=new kt(Math.floor(l.x)/this.resolution,Math.floor(l.y)/this.resolution,Math.floor(l.h)/this.resolution,Math.floor(l.w)/this.resolution):c=new kt(Math.floor(l.x)/this.resolution,Math.floor(l.y)/this.resolution,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution),h.trimmed!==!1&&h.spriteSourceSize&&(f=new kt(Math.floor(h.spriteSourceSize.x)/this.resolution,Math.floor(h.spriteSourceSize.y)/this.resolution,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution)),this.textures[a]=new ht({source:this.textureSource,frame:c,orig:g,trim:f,rotate:h.rotated?2:0,defaultAnchor:h.anchor,defaultBorders:h.borders,label:a.toString()})}i++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const r=t[e][i];this.animations[e].push(this.textures[r])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Mn.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Mn.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};Ff.BATCH_SIZE=1e3;let od=Ff;const M1=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function Gf(s,t,e){const i={};if(s.forEach(r=>{i[r]=t}),Object.keys(t.textures).forEach(r=>{i[`${t.cachePrefix}${r}`]=t.textures[r]}),!e){const r=Ie.dirname(s[0]);t.linkedSheets.forEach((a,h)=>{const l=Gf([`${r}/${t.data.meta.related_multi_packs[h]}`],a,!0);Object.assign(i,l)})}return i}const P1={extension:V.Asset,cache:{test:s=>s instanceof od,getCacheableAssets:(s,t)=>Gf(s,t,!1)},resolver:{extension:{type:V.ResolveParser,name:"resolveSpritesheet"},test:s=>{const e=s.split("?")[0].split("."),i=e.pop(),r=e.pop();return i==="json"&&M1.includes(r)},parse:s=>{const t=s.split(".");return{resolution:parseFloat(Zs.RETINA_PREFIX.exec(s)?.[1]??"1"),format:t[t.length-2],src:s}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:V.LoadParser,priority:ji.Normal,name:"spritesheetLoader"},async testParse(s,t){return Ie.extname(t.src).toLowerCase()===".json"&&!!s.frames},async parse(s,t,e){const{texture:i,imageFilename:r,textureOptions:a,cachePrefix:h}=t?.data??{};let l=Ie.dirname(t.src);l&&l.lastIndexOf("/")!==l.length-1&&(l+="/");let c;if(i instanceof ht)c=i;else{const g=Ah(l+(r??s.meta.image),t.src);c=(await e.load([{src:g,data:a}]))[g]}const f=new od({texture:c.source,data:s,cachePrefix:h});await f.parse();const d=s?.meta?.related_multi_packs;if(Array.isArray(d)){const g=[];for(const _ of d){if(typeof _!="string")continue;let v=l+_;t.data?.ignoreMultiPack||(v=Ah(v,t.src),g.push(e.load({src:v,data:{textureOptions:a,ignoreMultiPack:!0}})))}const x=await Promise.all(g);f.linkedSheets=x,x.forEach(_=>{_.linkedSheets=[f].concat(f.linkedSheets.filter(v=>v!==_))})}return f},async unload(s,t,e){await e.unload(s.textureSource._sourceOrigin),s.destroy(!1)}}};Mt.add(P1);const Ja=Object.create(null),ad=Object.create(null);function Vh(s,t){let e=ad[s];return e===void 0&&(Ja[t]===void 0&&(Ja[t]=1),ad[s]=e=Ja[t]++),e}let Xr;function Of(){return(!Xr||Xr?.isContextLost())&&(Xr=Lt.get().createCanvas().getContext("webgl",{})),Xr}let $r;function E1(){if(!$r){$r="mediump";const s=Of();s&&s.getShaderPrecisionFormat&&($r=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision?"highp":"mediump")}return $r}function k1(s,t,e){return t?s:e?(s=s.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${s}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${s}
        `}function I1(s,t,e){const i=e?t.maxSupportedFragmentPrecision:t.maxSupportedVertexPrecision;if(s.substring(0,9)!=="precision"){let r=e?t.requestedFragmentPrecision:t.requestedVertexPrecision;return r==="highp"&&i!=="highp"&&(r="mediump"),`precision ${r} float;
${s}`}else if(i!=="highp"&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}function R1(s,t){return t?`#version 300 es
${s}`:s}const L1={},B1={};function F1(s,{name:t="pixi-program"},e=!0){t=t.replace(/\s+/g,"-"),t+=e?"-fragment":"-vertex";const i=e?L1:B1;return i[t]?(i[t]++,t+=`-${i[t]}`):i[t]=1,s.indexOf("#define SHADER_NAME")!==-1?s:`${`#define SHADER_NAME ${t}`}
${s}`}function G1(s,t){return t?s.replace("#version 300 es",""):s}const Qa={stripVersion:G1,ensurePrecision:I1,addProgramDefines:k1,setProgramName:F1,insertVersion:R1},bn=Object.create(null),Df=class Th{constructor(t){t={...Th.defaultOptions,...t};const e=t.fragment.indexOf("#version 300 es")!==-1,i={stripVersion:e,ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:E1()},setProgramName:{name:t.name},addProgramDefines:e,insertVersion:e};let r=t.fragment,a=t.vertex;Object.keys(Qa).forEach(h=>{const l=i[h];r=Qa[h](r,l,!0),a=Qa[h](a,l,!1)}),this.fragment=r,this.vertex=a,this.transformFeedbackVaryings=t.transformFeedbackVaryings,this._key=Vh(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null,bn[this._cacheKey]=null}static from(t){const e=`${t.vertex}:${t.fragment}`;return bn[e]||(bn[e]=new Th(t),bn[e]._cacheKey=e),bn[e]}};Df.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let qh=Df;const hd={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function O1(s){return hd[s]??hd.float32}const D1={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"},ld=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|\)|$)/g;function ud(s,t){let e;for(;(e=ld.exec(s))!==null;){const i=D1[e[3]]??"float32";t[e[2]]={location:parseInt(e[1],10),format:i,stride:O1(i).stride,offset:0,instance:!1,start:0}}ld.lastIndex=0}function W1(s){return s.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"")}function U1({source:s,entryPoint:t}){const e={},i=W1(s),r=i.indexOf(`fn ${t}(`);if(r===-1)return e;const a=i.indexOf("->",r);if(a===-1)return e;const h=i.substring(r,a);if(ud(h,e),Object.keys(e).length===0){const l=h.match(/\(\s*\w+\s*:\s*(\w+)/);if(l){const c=l[1],f=new RegExp(`struct\\s+${c}\\s*\\{([^}]+)\\}`,"s"),d=i.match(f);d&&ud(d[1],e)}}return e}function th(s){const t=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,e=/@group\((\d+)\)/,i=/@binding\((\d+)\)/,r=/var(<[^>]+>)? (\w+)/,a=/:\s*([\w<>]+)/,h=/struct\s+(\w+)\s*{([^}]+)}/g,l=/(\w+)\s*:\s*([\w\<\>]+)/g,c=/struct\s+(\w+)/,f=s.match(t)?.map(g=>({group:parseInt(g.match(e)[1],10),binding:parseInt(g.match(i)[1],10),name:g.match(r)[2],isUniform:g.match(r)[1]==="<uniform>",type:g.match(a)[1]}));if(!f)return{groups:[],structs:[]};const d=s.match(h)?.map(g=>{const x=g.match(c)[1],_=g.match(l).reduce((v,T)=>{const[w,A]=T.split(":");return v[w.trim()]=A.trim(),v},{});return _?{name:x,members:_}:null}).filter(({name:g})=>f.some(x=>x.type===g||x.type.includes(`<${g}>`)))??[];return{groups:f,structs:d}}var cs=(s=>(s[s.VERTEX=1]="VERTEX",s[s.FRAGMENT=2]="FRAGMENT",s[s.COMPUTE=4]="COMPUTE",s))(cs||{});function H1({groups:s}){const t=[];for(let e=0;e<s.length;e++){const i=s[e];t[i.group]||(t[i.group]=[]),i.isUniform?t[i.group].push({binding:i.binding,visibility:cs.VERTEX|cs.FRAGMENT,buffer:{type:"uniform"}}):i.type==="sampler"?t[i.group].push({binding:i.binding,visibility:cs.FRAGMENT,sampler:{type:"filtering"}}):i.type==="texture_2d"||i.type.startsWith("texture_2d<")?t[i.group].push({binding:i.binding,visibility:cs.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}}):i.type==="texture_2d_array"||i.type.startsWith("texture_2d_array<")?t[i.group].push({binding:i.binding,visibility:cs.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d-array",multisampled:!1}}):(i.type==="texture_cube"||i.type.startsWith("texture_cube<"))&&t[i.group].push({binding:i.binding,visibility:cs.FRAGMENT,texture:{sampleType:"float",viewDimension:"cube",multisampled:!1}})}for(let e=0;e<t.length;e++)t[e]||(t[e]=[]);return t}function z1({groups:s}){const t=[];for(let e=0;e<s.length;e++){const i=s[e];t[i.group]||(t[i.group]={}),t[i.group][i.name]=i.binding}return t}function N1(s,t){const e=new Set,i=new Set,r=[...s.structs,...t.structs].filter(h=>e.has(h.name)?!1:(e.add(h.name),!0)),a=[...s.groups,...t.groups].filter(h=>{const l=`${h.name}-${h.binding}`;return i.has(l)?!1:(i.add(l),!0)});return{structs:r,groups:a}}const vn=Object.create(null);class Nn{constructor(t){this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:e,vertex:i,layout:r,gpuLayout:a,name:h}=t;if(this.name=h,this.fragment=e,this.vertex=i,e.source===i.source){const l=th(e.source);this.structsAndGroups=l}else{const l=th(i.source),c=th(e.source);this.structsAndGroups=N1(l,c)}this.layout=r??z1(this.structsAndGroups),this.gpuLayout=a??H1(this.structsAndGroups),this.autoAssignGlobalUniforms=this.layout[0]?.globalUniforms!==void 0,this.autoAssignLocalUniforms=this.layout[1]?.localUniforms!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,i=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=Vh(i,"program")}get attributeData(){return this._attributeData??(this._attributeData=U1(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,vn[this._cacheKey]=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return vn[e]||(vn[e]=new Nn(t),vn[e]._cacheKey=e),vn[e]}}const Wf=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],Y1=Wf.reduce((s,t)=>(s[t]=!0,s),{});function X1(s,t){switch(s){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*t);case"vec3<f32>":return new Float32Array(3*t);case"vec4<f32>":return new Float32Array(4*t);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Uf=class Hf{constructor(t,e){this._touched=0,this.uid=Yt("uniform"),this._resourceType="uniformGroup",this._resourceId=Yt("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,e={...Hf.defaultOptions,...e},this.uniformStructures=t;const i={};for(const r in t){const a=t[r];if(a.name=r,a.size=a.size??1,!Y1[a.type]){const h=a.type.match(/^array<(\w+(?:<\w+>)?),\s*(\d+)>$/);if(h){const[,l,c]=h;throw new Error(`Uniform type ${a.type} is not supported. Use type: '${l}', size: ${c} instead.`)}throw new Error(`Uniform type ${a.type} is not supported. Supported uniform types are: ${Wf.join(", ")}`)}a.value??(a.value=X1(a.type,a.size)),i[r]=a.value}this.uniforms=i,this._dirtyId=1,this.ubo=e.ubo,this.isStatic=e.isStatic,this._signature=Vh(Object.keys(i).map(r=>`${r}-${t[r].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};Uf.defaultOptions={ubo:!1,isStatic:!1};let Yn=Uf;class zs{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const i in t){const r=t[i];this.setResource(r,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const i in this.resources)t[e++]=this.resources[i]._resourceId;this._key=t.join("|")}setResource(t,e){const i=this.resources[e];t!==i&&(i&&t.off?.("change",this.onResourceChange,this),t.on?.("change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t,e){const i=this.resources;for(const r in i)i[r]._gcLastUsed=t,i[r]._touched=e}destroy(){const t=this.resources;for(const e in t)t[e]?.off?.("change",this.onResourceChange,this);this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const i in e)e[i]===t&&(e[i]=null)}else this._updateKey()}}var Ch=(s=>(s[s.WEBGL=1]="WEBGL",s[s.WEBGPU=2]="WEBGPU",s[s.CANVAS=4]="CANVAS",s[s.BOTH=3]="BOTH",s))(Ch||{});class Xn extends fi{constructor(t){super(),this.uid=Yt("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[],this._destroyed=!1;let{gpuProgram:e,glProgram:i,groups:r,resources:a,compatibleRenderers:h,groupMap:l}=t;this.gpuProgram=e,this.glProgram=i,h===void 0&&(h=0,e&&(h|=Ch.WEBGPU),i&&(h|=Ch.WEBGL)),this.compatibleRenderers=h;const c={};if(!a&&!r&&(a={}),a&&r)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&r&&!l)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&r&&l)for(const f in l)for(const d in l[f]){const g=l[f][d];c[g]={group:f,binding:d,name:g}}else if(e&&r&&!l){const f=e.structsAndGroups.groups;l={},f.forEach(d=>{l[d.group]=l[d.group]||{},l[d.group][d.binding]=d.name,c[d.name]=d})}else if(a){r={},l={},e&&e.structsAndGroups.groups.forEach(g=>{l[g.group]=l[g.group]||{},l[g.group][g.binding]=g.name,c[g.name]=g});let f=0;for(const d in a)c[d]||(r[99]||(r[99]=new zs,this._ownedBindGroups.push(r[99])),c[d]={group:99,binding:f,name:d},l[99]=l[99]||{},l[99][f]=d,f++);for(const d in a){const g=d;let x=a[d];!x.source&&!x._resourceType&&(x=new Yn(x));const _=c[g];_&&(r[_.group]||(r[_.group]=new zs,this._ownedBindGroups.push(r[_.group])),r[_.group].setResource(x,_.binding))}}this.groups=r,this._uniformBindMap=l,this.resources=this._buildResourceAccessor(r,c)}addResource(t,e,i){var r,a;(r=this._uniformBindMap)[e]||(r[e]={}),(a=this._uniformBindMap[e])[i]||(a[i]=t),this.groups[e]||(this.groups[e]=new zs,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const i={};for(const r in e){const a=e[r];Object.defineProperty(i,a.name,{get(){return t[a.group].getResource(a.binding)},set(h){t[a.group].setResource(h,a.binding)}})}return i}destroy(t=!1){this._destroyed||(this._destroyed=!0,this.emit("destroy",this),t&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(e=>{e.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null)}static from(t){const{gpu:e,gl:i,...r}=t;let a,h;return e&&(a=Nn.from(e)),i&&(h=qh.from(i)),new Xn({gpuProgram:a,glProgram:h,...r})}}const $1={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},eh=0,ih=1,sh=2,nh=3,rh=4,oh=5,Mh=class zf{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<eh)}set blend(t){!!(this.data&1<<eh)!==t&&(this.data^=1<<eh)}get offsets(){return!!(this.data&1<<ih)}set offsets(t){!!(this.data&1<<ih)!==t&&(this.data^=1<<ih)}set cullMode(t){if(t==="none"){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace=t==="front"}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(this.data&1<<sh)}set culling(t){!!(this.data&1<<sh)!==t&&(this.data^=1<<sh)}get depthTest(){return!!(this.data&1<<nh)}set depthTest(t){!!(this.data&1<<nh)!==t&&(this.data^=1<<nh)}get depthMask(){return!!(this.data&1<<oh)}set depthMask(t){!!(this.data&1<<oh)!==t&&(this.data^=1<<oh)}get clockwiseFrontFace(){return!!(this.data&1<<rh)}set clockwiseFrontFace(t){!!(this.data&1<<rh)!==t&&(this.data^=1<<rh)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!=="none",this._blendMode=t,this._blendModeId=$1[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new zf;return t.depthTest=!1,t.blend=!0,t}};Mh.default2d=Mh.for2d();let jh=Mh;const Ph=[];Mt.handleByNamedList(V.Environment,Ph);async function V1(s){if(!s)for(let t=0;t<Ph.length;t++){const e=Ph[t];if(e.value.test()){await e.value.load();return}}}let wn;function q1(){if(typeof wn=="boolean")return wn;try{wn=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{wn=!1}return wn}function cd(s,t,e=2){const i=t&&t.length,r=i?t[0]*e:s.length;let a=Nf(s,0,r,e,!0);const h=[];if(!a||a.next===a.prev)return h;let l,c,f;if(i&&(a=Q1(s,t,a,e)),s.length>80*e){l=s[0],c=s[1];let d=l,g=c;for(let x=e;x<r;x+=e){const _=s[x],v=s[x+1];_<l&&(l=_),v<c&&(c=v),_>d&&(d=_),v>g&&(g=v)}f=Math.max(d-l,g-c),f=f!==0?32767/f:0}return On(a,h,e,l,c,f,0),h}function Nf(s,t,e,i,r){let a;if(r===uw(s,t,e,i)>0)for(let h=t;h<e;h+=i)a=dd(h/i|0,s[h],s[h+1],a);else for(let h=e-i;h>=t;h-=i)a=dd(h/i|0,s[h],s[h+1],a);return a&&js(a,a.next)&&(Wn(a),a=a.next),a}function _s(s,t){if(!s)return s;t||(t=s);let e=s,i;do if(i=!1,!e.steiner&&(js(e,e.next)||Ut(e.prev,e,e.next)===0)){if(Wn(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function On(s,t,e,i,r,a,h){if(!s)return;!h&&a&&nw(s,i,r,a);let l=s;for(;s.prev!==s.next;){const c=s.prev,f=s.next;if(a?Z1(s,i,r,a):j1(s)){t.push(c.i,s.i,f.i),Wn(s),s=f.next,l=f.next;continue}if(s=f,s===l){h?h===1?(s=K1(_s(s),t),On(s,t,e,i,r,a,2)):h===2&&J1(s,t,e,i,r,a):On(_s(s),t,e,i,r,a,1);break}}}function j1(s){const t=s.prev,e=s,i=s.next;if(Ut(t,e,i)>=0)return!1;const r=t.x,a=e.x,h=i.x,l=t.y,c=e.y,f=i.y,d=Math.min(r,a,h),g=Math.min(l,c,f),x=Math.max(r,a,h),_=Math.max(l,c,f);let v=i.next;for(;v!==t;){if(v.x>=d&&v.x<=x&&v.y>=g&&v.y<=_&&Pn(r,l,a,c,h,f,v.x,v.y)&&Ut(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function Z1(s,t,e,i){const r=s.prev,a=s,h=s.next;if(Ut(r,a,h)>=0)return!1;const l=r.x,c=a.x,f=h.x,d=r.y,g=a.y,x=h.y,_=Math.min(l,c,f),v=Math.min(d,g,x),T=Math.max(l,c,f),w=Math.max(d,g,x),A=Eh(_,v,t,e,i),I=Eh(T,w,t,e,i);let M=s.prevZ,P=s.nextZ;for(;M&&M.z>=A&&P&&P.z<=I;){if(M.x>=_&&M.x<=T&&M.y>=v&&M.y<=w&&M!==r&&M!==h&&Pn(l,d,c,g,f,x,M.x,M.y)&&Ut(M.prev,M,M.next)>=0||(M=M.prevZ,P.x>=_&&P.x<=T&&P.y>=v&&P.y<=w&&P!==r&&P!==h&&Pn(l,d,c,g,f,x,P.x,P.y)&&Ut(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;M&&M.z>=A;){if(M.x>=_&&M.x<=T&&M.y>=v&&M.y<=w&&M!==r&&M!==h&&Pn(l,d,c,g,f,x,M.x,M.y)&&Ut(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;P&&P.z<=I;){if(P.x>=_&&P.x<=T&&P.y>=v&&P.y<=w&&P!==r&&P!==h&&Pn(l,d,c,g,f,x,P.x,P.y)&&Ut(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function K1(s,t){let e=s;do{const i=e.prev,r=e.next.next;!js(i,r)&&Xf(i,e,e.next,r)&&Dn(i,r)&&Dn(r,i)&&(t.push(i.i,e.i,r.i),Wn(e),Wn(e.next),e=s=r),e=e.next}while(e!==s);return _s(e)}function J1(s,t,e,i,r,a){let h=s;do{let l=h.next.next;for(;l!==h.prev;){if(h.i!==l.i&&aw(h,l)){let c=$f(h,l);h=_s(h,h.next),c=_s(c,c.next),On(h,t,e,i,r,a,0),On(c,t,e,i,r,a,0);return}l=l.next}h=h.next}while(h!==s)}function Q1(s,t,e,i){const r=[];for(let a=0,h=t.length;a<h;a++){const l=t[a]*i,c=a<h-1?t[a+1]*i:s.length,f=Nf(s,l,c,i,!1);f===f.next&&(f.steiner=!0),r.push(ow(f))}r.sort(tw);for(let a=0;a<r.length;a++)e=ew(r[a],e);return e}function tw(s,t){let e=s.x-t.x;if(e===0&&(e=s.y-t.y,e===0)){const i=(s.next.y-s.y)/(s.next.x-s.x),r=(t.next.y-t.y)/(t.next.x-t.x);e=i-r}return e}function ew(s,t){const e=iw(s,t);if(!e)return t;const i=$f(e,s);return _s(i,i.next),_s(e,e.next)}function iw(s,t){let e=t;const i=s.x,r=s.y;let a=-1/0,h;if(js(s,e))return e;do{if(js(s,e.next))return e.next;if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){const g=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(g<=i&&g>a&&(a=g,h=e.x<e.next.x?e:e.next,g===i))return h}e=e.next}while(e!==t);if(!h)return null;const l=h,c=h.x,f=h.y;let d=1/0;e=h;do{if(i>=e.x&&e.x>=c&&i!==e.x&&Yf(r<f?i:a,r,c,f,r<f?a:i,r,e.x,e.y)){const g=Math.abs(r-e.y)/(i-e.x);Dn(e,s)&&(g<d||g===d&&(e.x>h.x||e.x===h.x&&sw(h,e)))&&(h=e,d=g)}e=e.next}while(e!==l);return h}function sw(s,t){return Ut(s.prev,s,t.prev)<0&&Ut(t.next,s,s.next)<0}function nw(s,t,e,i){let r=s;do r.z===0&&(r.z=Eh(r.x,r.y,t,e,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==s);r.prevZ.nextZ=null,r.prevZ=null,rw(r)}function rw(s){let t,e=1;do{let i=s,r;s=null;let a=null;for(t=0;i;){t++;let h=i,l=0;for(let f=0;f<e&&(l++,h=h.nextZ,!!h);f++);let c=e;for(;l>0||c>0&&h;)l!==0&&(c===0||!h||i.z<=h.z)?(r=i,i=i.nextZ,l--):(r=h,h=h.nextZ,c--),a?a.nextZ=r:s=r,r.prevZ=a,a=r;i=h}a.nextZ=null,e*=2}while(t>1);return s}function Eh(s,t,e,i,r){return s=(s-e)*r|0,t=(t-i)*r|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function ow(s){let t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function Yf(s,t,e,i,r,a,h,l){return(r-h)*(t-l)>=(s-h)*(a-l)&&(s-h)*(i-l)>=(e-h)*(t-l)&&(e-h)*(a-l)>=(r-h)*(i-l)}function Pn(s,t,e,i,r,a,h,l){return!(s===h&&t===l)&&Yf(s,t,e,i,r,a,h,l)}function aw(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!hw(s,t)&&(Dn(s,t)&&Dn(t,s)&&lw(s,t)&&(Ut(s.prev,s,t.prev)||Ut(s,t.prev,t))||js(s,t)&&Ut(s.prev,s,s.next)>0&&Ut(t.prev,t,t.next)>0)}function Ut(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function js(s,t){return s.x===t.x&&s.y===t.y}function Xf(s,t,e,i){const r=qr(Ut(s,t,e)),a=qr(Ut(s,t,i)),h=qr(Ut(e,i,s)),l=qr(Ut(e,i,t));return!!(r!==a&&h!==l||r===0&&Vr(s,e,t)||a===0&&Vr(s,i,t)||h===0&&Vr(e,s,i)||l===0&&Vr(e,t,i))}function Vr(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function qr(s){return s>0?1:s<0?-1:0}function hw(s,t){let e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&Xf(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function Dn(s,t){return Ut(s.prev,s,s.next)<0?Ut(s,t,s.next)>=0&&Ut(s,s.prev,t)>=0:Ut(s,t,s.prev)<0||Ut(s,s.next,t)<0}function lw(s,t){let e=s,i=!1;const r=(s.x+t.x)/2,a=(s.y+t.y)/2;do e.y>a!=e.next.y>a&&e.next.y!==e.y&&r<(e.next.x-e.x)*(a-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==s);return i}function $f(s,t){const e=kh(s.i,s.x,s.y),i=kh(t.i,t.x,t.y),r=s.next,a=t.prev;return s.next=t,t.prev=s,e.next=r,r.prev=e,i.next=e,e.prev=i,a.next=i,i.prev=a,i}function dd(s,t,e,i){const r=kh(s,t,e);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Wn(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function kh(s,t,e){return{i:s,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function uw(s,t,e,i){let r=0;for(let a=t,h=e-i;a<e;a+=i)r+=(s[h]-s[a])*(s[a+1]+s[h+1]),h=a;return r}const cw=cd.default||cd;var Vf=(s=>(s[s.NONE=0]="NONE",s[s.COLOR=16384]="COLOR",s[s.STENCIL=1024]="STENCIL",s[s.DEPTH=256]="DEPTH",s[s.COLOR_DEPTH=16640]="COLOR_DEPTH",s[s.COLOR_STENCIL=17408]="COLOR_STENCIL",s[s.DEPTH_STENCIL=1280]="DEPTH_STENCIL",s[s.ALL=17664]="ALL",s))(Vf||{});class dw{constructor(t){this.items=[],this._name=t}emit(t,e,i,r,a,h,l,c){const{name:f,items:d}=this;for(let g=0,x=d.length;g<x;g++)d[g][f](t,e,i,r,a,h,l,c);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&this.items.splice(e,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const fw=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],qf=class jf extends fi{constructor(t){super(),this.tick=0,this.uid=Yt("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const e=[...fw,...this.config.runners??[]];this._addRunners(...e),this._unsafeEvalCheck()}async init(t={}){const e=t.skipExtensionImports===!0?!0:t.manageImports===!1;await V1(e),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const i in this._systemsHash)t={...this._systemsHash[i].constructor.defaultOptions,...t};t={...jf.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let i=0;i<this.runners.init.items.length;i++)await this.runners.init.items[i].init(t);this._initOptions=t}render(t,e){this.tick++;let i=t;if(i instanceof Gt&&(i={container:i},e&&(wt(Nt,"passing a second argument is deprecated, please use render options instead"),i.target=e.renderTexture)),i.target||(i.target=this.view.renderTarget),i.target===this.view.renderTarget&&(this._lastObjectRendered=i.container,i.clearColor??(i.clearColor=this.background.colorRgba),i.clear??(i.clear=this.background.clearBeforeRender)),i.clearColor){const r=Array.isArray(i.clearColor)&&i.clearColor.length===4;i.clearColor=r?i.clearColor:te.shared.setValue(i.clearColor).toArray()}i.transform||(i.container.updateLocalTransform(),i.transform=i.container.localTransform),i.container.visible&&(i.container.enableRenderGroup(),this.runners.prerender.emit(i),this.runners.renderStart.emit(i),this.runners.render.emit(i),this.runners.renderEnd.emit(i),this.runners.postrender.emit(i))}resize(t,e,i){const r=this.view.resolution;this.view.resize(t,e,i),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),i!==void 0&&i!==r&&this.runners.resolutionChange.emit(i)}clear(t={}){const e=this;t.target||(t.target=e.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=Vf.ALL);const{clear:i,clearColor:r,target:a,mipLevel:h,layer:l}=t;te.shared.setValue(r??this.background.colorRgba),e.renderTarget.clear(a,i,te.shared.toArray(),h??0,l??0)}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(e=>{this.runners[e]=new dw(e)})}_addSystems(t){let e;for(e in t){const i=t[e];this._addSystem(i.value,i.name)}}_addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const r in this.runners)this.runners[r].add(i);return this}_addPipes(t,e){const i=e.reduce((r,a)=>(r[a.name]=a.value,r),{});t.forEach(r=>{const a=r.value,h=r.name,l=i[h];this.renderPipes[h]=new a(this,l?new l:null),this.runners.destroy.add(this.renderPipes[h])})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),(t===!0||typeof t=="object"&&t.releaseGlobalResources)&&zn.release(),Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!q1())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};qf.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Zf=qf,jr;function pw(s){return jr!==void 0||(jr=(()=>{const t={stencil:!0,failIfMajorPerformanceCaveat:s??Zf.defaultOptions.failIfMajorPerformanceCaveat};try{if(!Lt.get().getWebGLRenderingContext())return!1;let i=Lt.get().createCanvas().getContext("webgl",t);const r=!!i?.getContextAttributes()?.stencil;if(i){const a=i.getExtension("WEBGL_lose_context");a&&a.loseContext()}return i=null,r}catch{return!1}})()),jr}let Zr;async function gw(s={}){return Zr!==void 0||(Zr=await(async()=>{const t=Lt.get().getNavigator().gpu;if(!t)return!1;try{return await(await t.requestAdapter(s)).requestDevice(),!0}catch{return!1}})()),Zr}const fd=["webgl","webgpu","canvas"];async function mw(s){let t=[];s.preference?(t.push(s.preference),fd.forEach(a=>{a!==s.preference&&t.push(a)})):t=fd.slice();let e,i={};for(let a=0;a<t.length;a++){const h=t[a];if(h==="webgpu"&&await gw()){const{WebGPURenderer:l}=await Hs(async()=>{const{WebGPURenderer:c}=await import("./WebGPURenderer-CFehuQw_.js");return{WebGPURenderer:c}},__vite__mapDeps([3,4,5,2]),import.meta.url);e=l,i={...s,...s.webgpu};break}else if(h==="webgl"&&pw(s.failIfMajorPerformanceCaveat??Zf.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:l}=await Hs(async()=>{const{WebGLRenderer:c}=await import("./WebGLRenderer-vNNLyAwt.js");return{WebGLRenderer:c}},__vite__mapDeps([6,4,5,2]),import.meta.url);e=l,i={...s,...s.webgl};break}else if(h==="canvas"){const{CanvasRenderer:l}=await Hs(async()=>{const{CanvasRenderer:c}=await import("./CanvasRenderer-CBobAK1a.js");return{CanvasRenderer:c}},__vite__mapDeps([7,5,2]),import.meta.url);e=l,i={...s,...s.canvasOptions};break}}if(delete i.webgpu,delete i.webgl,delete i.canvasOptions,!e)throw new Error("No available renderer for the current environment");const r=new e;return await r.init(i),r}const Kf="8.16.0";class Jf{static init(){globalThis.__PIXI_APP_INIT__?.(this,Kf)}static destroy(){}}Jf.extension=V.Application;class _w{constructor(t){this._renderer=t}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,Kf)}destroy(){this._renderer=null}}_w.extension={type:[V.WebGLSystem,V.WebGPUSystem],name:"initHook",priority:-10};class Qf{static init(t){Object.defineProperty(this,"resizeTo",{configurable:!0,set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this._cancelResize();let e,i;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:a}=this._resizeTo;e=r,i=a}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Qf.extension=V.Application;class tp{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{configurable:!0,set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,ro.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Ds.shared:new Ds,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}tp.extension=V.Application;Mt.add(Qf);Mt.add(tp);const ep=class Ih{constructor(...t){this.stage=new Gt,t[0]!==void 0&&wt(Nt,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.stage||(this.stage=new Gt),this.renderer=await mw(t),Ih._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return wt(Nt,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,e=!1){const i=Ih._plugins.slice(0);i.reverse(),i.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};ep._plugins=[];let ip=ep;Mt.handleByList(V.Application,ip._plugins);Mt.add(Jf);const ah={test(s){return typeof s=="string"&&s.startsWith("info face=")},parse(s){const t=s.match(/^[a-z]+\s+.+$/gm),e={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const g in t){const x=t[g].match(/^[a-z]+/gm)[0],_=t[g].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),v={};for(const T in _){const w=_[T].split("="),A=w[0],I=w[1].replace(/"/gm,""),M=parseFloat(I),P=isNaN(M)?I:M;v[A]=P}e[x].push(v)}const i={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[r]=e.info,[a]=e.common,[h]=e.distanceField??[];h&&(i.distanceField={range:parseInt(h.distanceRange,10),type:h.fieldType}),i.fontSize=parseInt(r.size,10),i.fontFamily=r.face,i.lineHeight=parseInt(a.lineHeight,10);const l=e.page;for(let g=0;g<l.length;g++)i.pages.push({id:parseInt(l[g].id,10)||0,file:l[g].file});const c={};i.baseLineOffset=i.lineHeight-parseInt(a.base,10);const f=e.char;for(let g=0;g<f.length;g++){const x=f[g],_=parseInt(x.id,10);let v=x.letter??x.char??String.fromCharCode(_);v==="space"&&(v=" "),c[_]=v,i.chars[v]={id:_,page:parseInt(x.page,10)||0,x:parseInt(x.x,10),y:parseInt(x.y,10),width:parseInt(x.width,10),height:parseInt(x.height,10),xOffset:parseInt(x.xoffset,10),yOffset:parseInt(x.yoffset,10),xAdvance:parseInt(x.xadvance,10),kerning:{}}}const d=e.kerning||[];for(let g=0;g<d.length;g++){const x=parseInt(d[g].first,10),_=parseInt(d[g].second,10),v=parseInt(d[g].amount,10);i.chars[c[_]].kerning[c[x]]=v}return i}},pd={test(s){const t=s;return typeof t!="string"&&"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(s){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},e=s.getElementsByTagName("info")[0],i=s.getElementsByTagName("common")[0],r=s.getElementsByTagName("distanceField")[0];r&&(t.distanceField={type:r.getAttribute("fieldType"),range:parseInt(r.getAttribute("distanceRange"),10)});const a=s.getElementsByTagName("page"),h=s.getElementsByTagName("char"),l=s.getElementsByTagName("kerning");t.fontSize=parseInt(e.getAttribute("size"),10),t.fontFamily=e.getAttribute("face"),t.lineHeight=parseInt(i.getAttribute("lineHeight"),10);for(let f=0;f<a.length;f++)t.pages.push({id:parseInt(a[f].getAttribute("id"),10)||0,file:a[f].getAttribute("file")});const c={};t.baseLineOffset=t.lineHeight-parseInt(i.getAttribute("base"),10);for(let f=0;f<h.length;f++){const d=h[f],g=parseInt(d.getAttribute("id"),10);let x=d.getAttribute("letter")??d.getAttribute("char")??String.fromCharCode(g);x==="space"&&(x=" "),c[g]=x,t.chars[x]={id:g,page:parseInt(d.getAttribute("page"),10)||0,x:parseInt(d.getAttribute("x"),10),y:parseInt(d.getAttribute("y"),10),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10),xOffset:parseInt(d.getAttribute("xoffset"),10),yOffset:parseInt(d.getAttribute("yoffset"),10),xAdvance:parseInt(d.getAttribute("xadvance"),10),kerning:{}}}for(let f=0;f<l.length;f++){const d=parseInt(l[f].getAttribute("first"),10),g=parseInt(l[f].getAttribute("second"),10),x=parseInt(l[f].getAttribute("amount"),10);t.chars[c[g]].kerning[c[d]]=x}return t}},gd={test(s){return typeof s=="string"&&s.match(/<font(\s|>)/)?pd.test(Lt.get().parseXML(s)):!1},parse(s){return pd.parse(Lt.get().parseXML(s))}},xw=[".xml",".fnt"],yw={extension:{type:V.CacheParser,name:"cacheBitmapFont"},test:s=>!!s?.pages&&!!s?.chars&&typeof s?.fontFamily=="string",getCacheableAssets(s,t){const e={};return s.forEach(i=>{e[i]=t,e[`${i}-bitmap`]=t}),e[`${t.fontFamily}-bitmap`]=t,e}},bw={extension:{type:V.LoadParser,priority:ji.Normal},name:"loadBitmapFont",id:"bitmap-font",test(s){return xw.includes(Ie.extname(s).toLowerCase())},async testParse(s){return ah.test(s)||gd.test(s)},async parse(s,t,e){const i=ah.test(s)?ah.parse(s):gd.parse(s),{src:r}=t,{pages:a}=i,h=[],l=i.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let x=0;x<a.length;++x){const _=a[x].file;let v=Ie.join(Ie.dirname(r),_);v=Ah(v,r),h.push({src:v,data:l})}const[c,{BitmapFont:f}]=await Promise.all([e.load(h),Hs(()=>import("./BitmapFont-BnGTa7LR.js"),[],import.meta.url)]),d=h.map(x=>c[x.src]);return new f({data:i,textures:d},r)},async load(s,t){return await(await Lt.get().fetch(s)).text()},async unload(s,t,e){await Promise.all(s.pages.map(i=>e.unload(i.texture.source._sourceOrigin))),s.destroy()}};class vw{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const ww={extension:{type:V.CacheParser,name:"cacheTextureArray"},test:s=>Array.isArray(s)&&s.every(t=>t instanceof ht),getCacheableAssets:(s,t)=>{const e={};return s.forEach(i=>{t.forEach((r,a)=>{e[i+(a===0?"":a+1)]=r})}),e}};async function sp(s){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=s});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(s)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const Sw={extension:{type:V.DetectionParser,priority:1},test:async()=>sp("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async s=>[...s,"avif"],remove:async s=>s.filter(t=>t!=="avif")},md=["png","jpg","jpeg"],Aw={extension:{type:V.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...md],remove:async s=>s.filter(t=>!md.includes(t))},Tw="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function go(s){return Tw?!1:document.createElement("video").canPlayType(s)!==""}const Cw={extension:{type:V.DetectionParser,priority:0},test:async()=>go("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(t=>t!=="mp4"&&t!=="m4v")},Mw={extension:{type:V.DetectionParser,priority:0},test:async()=>go("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(t=>t!=="ogv")},Pw={extension:{type:V.DetectionParser,priority:0},test:async()=>go("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(t=>t!=="webm")},Ew={extension:{type:V.DetectionParser,priority:0},test:async()=>sp("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async s=>[...s,"webp"],remove:async s=>s.filter(t=>t!=="webp")},np=class io{constructor(){this.loadOptions={...io.defaultOptions},this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{let r=null,a=null;if((e.parser||e.loadParser)&&(a=this._parserHash[e.parser||e.loadParser],e.loadParser&&Ot(`[Assets] "loadParser" is deprecated, use "parser" instead for ${t}`),a||Ot(`[Assets] specified load parser "${e.parser||e.loadParser}" not found while loading ${t}`)),!a){for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.load&&l.test?.(t,e,this)){a=l;break}}if(!a)return Ot(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=await a.load(t,e,this),i.parser=a;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];l.parse&&l.parse&&await l.testParse?.(r,e,this)&&(r=await l.parse(r,e,this)||r,i.parser=l)}return r})(),i}async load(t,e){this._parsersValidated||this._validateParsers();const i=typeof e=="function"?{...io.defaultOptions,...this.loadOptions,onProgress:e}:{...io.defaultOptions,...this.loadOptions,...e||{}},{onProgress:r,onError:a,strategy:h,retryCount:l,retryDelay:c}=i;let f=0;const d={},g=oo(t),x=ei(t,T=>({alias:[T],src:T,data:{}})),_=x.reduce((T,w)=>T+(w.progressSize||1),0),v=x.map(async T=>{const w=Ie.toAbsolute(T.src);d[T.src]||(await this._loadAssetWithRetry(w,T,{onProgress:r,onError:a,strategy:h,retryCount:l,retryDelay:c},d),f+=T.progressSize||1,r&&r(f/_))});return await Promise.all(v),g?d[x[0].src]:d}async unload(t){const i=ei(t,r=>({alias:[r],src:r})).map(async r=>{const a=Ie.toAbsolute(r.src),h=this.promiseCache[a];if(h){const l=await h.promise;delete this.promiseCache[a],await h.parser?.unload?.(l,r,this)}});await Promise.all(i)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name||t.id).reduce((t,e)=>(!e.name&&!e.id?Ot("[Assets] parser should have an id"):(t[e.name]||t[e.id])&&Ot(`[Assets] parser id conflict "${e.id}"`),t[e.name]=e,e.id&&(t[e.id]=e),t),{})}async _loadAssetWithRetry(t,e,i,r){let a=0;const{onError:h,strategy:l,retryCount:c,retryDelay:f}=i,d=g=>new Promise(x=>setTimeout(x,g));for(;;)try{this.promiseCache[t]||(this.promiseCache[t]=this._getLoadPromiseAndParser(t,e)),r[e.src]=await this.promiseCache[t].promise;return}catch(g){delete this.promiseCache[t],delete r[e.src],a++;const x=l!=="retry"||a>c;if(l==="retry"&&!x){h&&h(g,e),await d(f);continue}if(l==="skip"){h&&h(g,e);return}h&&h(g,e);const _=new Error(`[Loader.load] Failed to load ${t}.
${g}`);throw g instanceof Error&&g.stack&&(_.stack=g.stack),_}}};np.defaultOptions={onProgress:void 0,onError:void 0,strategy:"throw",retryCount:3,retryDelay:250};let kw=np;function Ks(s,t){if(Array.isArray(t)){for(const e of t)if(s.startsWith(`data:${e}`))return!0;return!1}return s.startsWith(`data:${t}`)}function Js(s,t){const e=s.split("?")[0],i=Ie.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const Iw=".json",Rw="application/json",Lw={extension:{type:V.LoadParser,priority:ji.Low},name:"loadJson",id:"json",test(s){return Ks(s,Rw)||Js(s,Iw)},async load(s){return await(await Lt.get().fetch(s)).json()}},Bw=".txt",Fw="text/plain",Gw={name:"loadTxt",id:"text",extension:{type:V.LoadParser,priority:ji.Low,name:"loadTxt"},test(s){return Ks(s,Fw)||Js(s,Bw)},async load(s){return await(await Lt.get().fetch(s)).text()}},Ow=["normal","bold","100","200","300","400","500","600","700","800","900"],Dw=[".ttf",".otf",".woff",".woff2"],Ww=["font/ttf","font/otf","font/woff","font/woff2"],Uw=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Hw(s){const t=Ie.extname(s),r=Ie.basename(s,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(l=>l.charAt(0).toUpperCase()+l.slice(1));let a=r.length>0;for(const l of r)if(!l.match(Uw)){a=!1;break}let h=r.join(" ");return a||(h=`"${h.replace(/[\\"]/g,"\\$&")}"`),h}const zw=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Nw(s){return zw.test(s)?s:encodeURI(s)}const Yw={extension:{type:V.LoadParser,priority:ji.Low},name:"loadWebFont",id:"web-font",test(s){return Ks(s,Ww)||Js(s,Dw)},async load(s,t){const e=Lt.get().getFontFaceSet();if(e){const i=[],r=t.data?.family??Hw(s),a=t.data?.weights?.filter(l=>Ow.includes(l))??["normal"],h=t.data??{};for(let l=0;l<a.length;l++){const c=a[l],f=new FontFace(r,`url(${Nw(s)})`,{...h,weight:c});await f.load(),e.add(f),i.push(f)}return ne.has(`${r}-and-url`)?ne.get(`${r}-and-url`).entries.push({url:s,faces:i}):ne.set(`${r}-and-url`,{entries:[{url:s,faces:i}]}),i.length===1?i[0]:i}return Ot("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){const t=Array.isArray(s)?s:[s],e=t[0].family,i=ne.get(`${e}-and-url`),r=i.entries.find(a=>a.faces.some(h=>t.indexOf(h)!==-1));r.faces=r.faces.filter(a=>t.indexOf(a)===-1),r.faces.length===0&&(i.entries=i.entries.filter(a=>a!==r)),t.forEach(a=>{Lt.get().getFontFaceSet().delete(a)}),i.entries.length===0&&ne.remove(`${e}-and-url`)}};var hh,_d;function Xw(){if(_d)return hh;_d=1,hh=e;var s={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},t=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function e(a){var h=[];return a.replace(t,function(l,c,f){var d=c.toLowerCase();for(f=r(f),d=="m"&&f.length>2&&(h.push([c].concat(f.splice(0,2))),d="l",c=c=="m"?"l":"L");;){if(f.length==s[d])return f.unshift(c),h.push(f);if(f.length<s[d])throw new Error("malformed path data");h.push([c].concat(f.splice(0,s[d])))}}),h}var i=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function r(a){var h=a.match(i);return h?h.map(Number):[]}return hh}var $w=Xw();const Vw=zh($w);function qw(s,t){const e=Vw(s),i=[];let r=null,a=0,h=0;for(let l=0;l<e.length;l++){const c=e[l],f=c[0],d=c;switch(f){case"M":a=d[1],h=d[2],t.moveTo(a,h);break;case"m":a+=d[1],h+=d[2],t.moveTo(a,h);break;case"H":a=d[1],t.lineTo(a,h);break;case"h":a+=d[1],t.lineTo(a,h);break;case"V":h=d[1],t.lineTo(a,h);break;case"v":h+=d[1],t.lineTo(a,h);break;case"L":a=d[1],h=d[2],t.lineTo(a,h);break;case"l":a+=d[1],h+=d[2],t.lineTo(a,h);break;case"C":a=d[5],h=d[6],t.bezierCurveTo(d[1],d[2],d[3],d[4],a,h);break;case"c":t.bezierCurveTo(a+d[1],h+d[2],a+d[3],h+d[4],a+d[5],h+d[6]),a+=d[5],h+=d[6];break;case"S":a=d[3],h=d[4],t.bezierCurveToShort(d[1],d[2],a,h);break;case"s":t.bezierCurveToShort(a+d[1],h+d[2],a+d[3],h+d[4]),a+=d[3],h+=d[4];break;case"Q":a=d[3],h=d[4],t.quadraticCurveTo(d[1],d[2],a,h);break;case"q":t.quadraticCurveTo(a+d[1],h+d[2],a+d[3],h+d[4]),a+=d[3],h+=d[4];break;case"T":a=d[1],h=d[2],t.quadraticCurveToShort(a,h);break;case"t":a+=d[1],h+=d[2],t.quadraticCurveToShort(a,h);break;case"A":a=d[6],h=d[7],t.arcToSvg(d[1],d[2],d[3],d[4],d[5],a,h);break;case"a":a+=d[6],h+=d[7],t.arcToSvg(d[1],d[2],d[3],d[4],d[5],a,h);break;case"Z":case"z":t.closePath(),i.length>0&&(r=i.pop(),r?(a=r.startX,h=r.startY):(a=0,h=0)),r=null;break;default:Ot(`Unknown SVG path command: ${f}`)}f!=="Z"&&f!=="z"&&r===null&&(r={startX:a,startY:h},i.push(r))}return t}class Zh{constructor(t=0,e=0,i=0){this.type="circle",this.x=t,this.y=e,this.radius=i}clone(){return new Zh(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let r=this.x-t,a=this.y-e;return r*=r,a*=a,r+a<=i}strokeContains(t,e,i,r=.5){if(this.radius===0)return!1;const a=this.x-t,h=this.y-e,l=this.radius,c=(1-r)*i,f=Math.sqrt(a*a+h*h);return f<=l+c&&f>l-(i-c)}getBounds(t){return t||(t=new kt),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Kh{constructor(t=0,e=0,i=0,r=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=i,this.halfHeight=r}clone(){return new Kh(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let i=(t-this.x)/this.halfWidth,r=(e-this.y)/this.halfHeight;return i*=i,r*=r,i+r<=1}strokeContains(t,e,i,r=.5){const{halfWidth:a,halfHeight:h}=this;if(a<=0||h<=0)return!1;const l=i*(1-r),c=i-l,f=a-c,d=h-c,g=a+l,x=h+l,_=t-this.x,v=e-this.y,T=_*_/(f*f)+v*v/(d*d),w=_*_/(g*g)+v*v/(x*x);return T>1&&w<=1}getBounds(t){return t||(t=new kt),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=this.halfWidth*2,t.height=this.halfHeight*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function jw(s,t,e,i,r,a){const h=s-e,l=t-i,c=r-e,f=a-i,d=h*c+l*f,g=c*c+f*f;let x=-1;g!==0&&(x=d/g);let _,v;x<0?(_=e,v=i):x>1?(_=r,v=a):(_=e+x*c,v=i+x*f);const T=s-_,w=t-v;return T*T+w*w}let Zw,Kw;class Ln{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const i=[];for(let r=0,a=e.length;r<a;r++)i.push(e[r].x,e[r].y);e=i}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,i=e.length;for(let r=0;r<i;r+=2){const a=e[r],h=e[r+1],l=e[(r+2)%i],c=e[(r+3)%i];t+=(l-a)*(c+h)}return t<0}containsPolygon(t){const e=this.getBounds(Zw),i=t.getBounds(Kw);if(!e.containsRect(i))return!1;const r=t.points;for(let a=0;a<r.length;a+=2){const h=r[a],l=r[a+1];if(!this.contains(h,l))return!1}return!0}clone(){const t=this.points.slice(),e=new Ln(t);return e.closePath=this.closePath,e}contains(t,e){let i=!1;const r=this.points.length/2;for(let a=0,h=r-1;a<r;h=a++){const l=this.points[a*2],c=this.points[a*2+1],f=this.points[h*2],d=this.points[h*2+1];c>e!=d>e&&t<(f-l)*((e-c)/(d-c))+l&&(i=!i)}return i}strokeContains(t,e,i,r=.5){const a=i*i,h=a*(1-r),l=a-h,{points:c}=this,f=c.length-(this.closePath?0:2);for(let d=0;d<f;d+=2){const g=c[d],x=c[d+1],_=c[(d+2)%c.length],v=c[(d+3)%c.length],T=jw(t,e,g,x,_,v),w=Math.sign((_-g)*(e-x)-(v-x)*(t-g));if(T<=(w<0?l:h))return!0}return!1}getBounds(t){t||(t=new kt);const e=this.points;let i=1/0,r=-1/0,a=1/0,h=-1/0;for(let l=0,c=e.length;l<c;l+=2){const f=e[l],d=e[l+1];i=f<i?f:i,r=f>r?f:r,a=d<a?d:a,h=d>h?d:h}return t.x=i,t.width=r-i,t.y=a,t.height=h-a,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return wt("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return wt("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const Kr=(s,t,e,i,r,a,h)=>{const l=s-e,c=t-i,f=Math.sqrt(l*l+c*c);return f>=r-a&&f<=r+h};class Jh{constructor(t=0,e=0,i=0,r=0,a=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=i,this.height=r,this.radius=a}getBounds(t){return t||(t=new kt),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new Jh(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let r=t-(this.x+i),a=e-(this.y+i);const h=i*i;if(r*r+a*a<=h||(r=t-(this.x+this.width-i),r*r+a*a<=h)||(a=e-(this.y+this.height-i),r*r+a*a<=h)||(r=t-(this.x+i),r*r+a*a<=h))return!0}return!1}strokeContains(t,e,i,r=.5){const{x:a,y:h,width:l,height:c,radius:f}=this,d=i*(1-r),g=i-d,x=a+f,_=h+f,v=l-f*2,T=c-f*2,w=a+l,A=h+c;return(t>=a-d&&t<=a+g||t>=w-g&&t<=w+d)&&e>=_&&e<=_+T||(e>=h-d&&e<=h+g||e>=A-g&&e<=A+d)&&t>=x&&t<=x+v?!0:t<x&&e<_&&Kr(t,e,x,_,f,g,d)||t>w-f&&e<_&&Kr(t,e,w-f,_,f,g,d)||t>w-f&&e>A-f&&Kr(t,e,w-f,A-f,f,g,d)||t<x&&e>A-f&&Kr(t,e,x,A-f,f,g,d)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const rp={};function Jw(s,t,e){let i=2166136261;for(let r=0;r<t;r++)i^=s[r].uid,i=Math.imul(i,16777619),i>>>=0;return rp[i]||Qw(s,t,i,e)}function Qw(s,t,e,i){const r={};let a=0;for(let l=0;l<i;l++){const c=l<t?s[l]:ht.EMPTY.source;r[a++]=c.source,r[a++]=c.style}const h=new zs(r);return rp[e]=h,h}class xd{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this.uint32View=null,this.float32View=null,this.uint16View=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._int32View=null,this._float64Array=null,this._bigUint64Array=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function yd(s,t,e,i){if(e??(e=0),i??(i=Math.min(s.byteLength-e,t.byteLength)),!(e&7)&&!(i&7)){const r=i/8;new Float64Array(t,0,r).set(new Float64Array(s,e,r))}else if(!(e&3)&&!(i&3)){const r=i/4;new Float32Array(t,0,r).set(new Float32Array(s,e,r))}else new Uint8Array(t).set(new Uint8Array(s,e,i))}const tS={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var eS=(s=>(s[s.DISABLED=0]="DISABLED",s[s.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",s[s.MASK_ACTIVE=2]="MASK_ACTIVE",s[s.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",s[s.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",s[s.NONE=5]="NONE",s))(eS||{});function bd(s,t){return t.alphaMode==="no-premultiply-alpha"&&tS[s]||s}const iS=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function sS(s){let t="";for(let e=0;e<s;++e)e>0&&(t+=`
else `),e<s-1&&(t+=`if(test == ${e}.0){}`);return t}function nS(s,t){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);try{for(;;){const i=iS.replace(/%forloop%/gi,sS(s));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))s=s/2|0;else break}}finally{t.deleteShader(e)}return s}let Fs=null;function rS(){if(Fs)return Fs;const s=Of();return Fs=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),Fs=nS(Fs,s),s.getExtension("WEBGL_lose_context")?.loseContext(),Fs}class oS{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class aS{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new oS,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null,this.elements=null}}const Bn=[];let ao=0;zn.register({clear:()=>{if(Bn.length>0)for(const s of Bn)s&&s.destroy();Bn.length=0,ao=0}});function vd(){return ao>0?Bn[--ao]:new aS}function wd(s){s.elements=null,Bn[ao++]=s}let Sn=0;const op=class ap{constructor(t){this.uid=Yt("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t={...ap.defaultOptions,...t},t.maxTextures||(wt("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),t.maxTextures=rS());const{maxTextures:e,attributesInitialSize:i,indicesInitialSize:r}=t;this.attributeBuffer=new xd(i*4),this.indexBuffer=new Uint16Array(r),this.maxTextures=e}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)wd(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const i=t._batch.textures.ids[e._source.uid];return!i&&i!==0?!1:(t._textureId=i,t.texture=e,!0)}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let i=vd(),r=i.textures;r.clear();const a=e[this.elementStart];let h=bd(a.blendMode,a.texture._source),l=a.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const c=this.attributeBuffer.float32View,f=this.attributeBuffer.uint32View,d=this.indexBuffer;let g=this._batchIndexSize,x=this._batchIndexStart,_="startBatch",v=[];const T=this.maxTextures;for(let w=this.elementStart;w<this.elementSize;++w){const A=e[w];e[w]=null;const M=A.texture._source,P=bd(A.blendMode,M),L=h!==P||l!==A.topology;if(M._batchTick===Sn&&!L){A._textureId=M._textureBindLocation,g+=A.indexSize,A.packAsQuad?(this.packQuadAttributes(A,c,f,A._attributeStart,A._textureId),this.packQuadIndex(d,A._indexStart,A._attributeStart/this.vertexSize)):(this.packAttributes(A,c,f,A._attributeStart,A._textureId),this.packIndex(A,d,A._indexStart,A._attributeStart/this.vertexSize)),A._batch=i,v.push(A);continue}M._batchTick=Sn,(r.count>=T||L)&&(this._finishBatch(i,x,g-x,r,h,l,t,_,v),_="renderBatch",x=g,h=P,l=A.topology,i=vd(),r=i.textures,r.clear(),v=[],++Sn),A._textureId=M._textureBindLocation=r.count,r.ids[M.uid]=r.count,r.textures[r.count++]=M,A._batch=i,v.push(A),g+=A.indexSize,A.packAsQuad?(this.packQuadAttributes(A,c,f,A._attributeStart,A._textureId),this.packQuadIndex(d,A._indexStart,A._attributeStart/this.vertexSize)):(this.packAttributes(A,c,f,A._attributeStart,A._textureId),this.packIndex(A,d,A._indexStart,A._attributeStart/this.vertexSize))}r.count>0&&(this._finishBatch(i,x,g-x,r,h,l,t,_,v),x=g,++Sn),this.elementStart=this.elementSize,this._batchIndexStart=x,this._batchIndexSize=g}_finishBatch(t,e,i,r,a,h,l,c,f){t.gpuBindGroup=null,t.bindGroup=null,t.action=c,t.batcher=this,t.textures=r,t.blendMode=a,t.topology=h,t.start=e,t.size=i,t.elements=f,++Sn,this.batches[this.batchIndex++]=t,l.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){t*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(t*4)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,this.attributeBuffer.size*2),i=new xd(e);yd(this.attributeBuffer.rawBinaryData,i.rawBinaryData),this.attributeBuffer=i}_resizeIndexBuffer(t){const e=this.indexBuffer;let i=Math.max(t,e.length*1.5);i+=i%2;const r=i>65535?new Uint32Array(i):new Uint16Array(i);if(r.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let a=0;a<e.length;a++)r[a]=e[a];else yd(e.buffer,r.buffer);this.indexBuffer=r}packQuadIndex(t,e,i){t[e]=i+0,t[e+1]=i+1,t[e+2]=i+2,t[e+3]=i+0,t[e+4]=i+2,t[e+5]=i+3}packIndex(t,e,i,r){const a=t.indices,h=t.indexSize,l=t.indexOffset,c=t.attributeOffset;for(let f=0;f<h;f++)e[i++]=r+a[f+l]-c}destroy(t={}){if(this.batches!==null){for(let e=0;e<this.batchIndex;e++)wd(this.batches[e]);this.batches=null,this.geometry.destroy(!0),this.geometry=null,t.shader&&(this.shader?.destroy(),this.shader=null);for(let e=0;e<this._elements.length;e++)this._elements[e]&&(this._elements[e]._batch=null);this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}};op.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let hS=op;var Vt=(s=>(s[s.MAP_READ=1]="MAP_READ",s[s.MAP_WRITE=2]="MAP_WRITE",s[s.COPY_SRC=4]="COPY_SRC",s[s.COPY_DST=8]="COPY_DST",s[s.INDEX=16]="INDEX",s[s.VERTEX=32]="VERTEX",s[s.UNIFORM=64]="UNIFORM",s[s.STORAGE=128]="STORAGE",s[s.INDIRECT=256]="INDIRECT",s[s.QUERY_RESOLVE=512]="QUERY_RESOLVE",s[s.STATIC=1024]="STATIC",s))(Vt||{});class $i extends fi{constructor(t){let{data:e,size:i}=t;const{usage:r,label:a,shrinkToFit:h}=t;super(),this._gpuData=Object.create(null),this._gcLastUsed=-1,this.autoGarbageCollect=!0,this.uid=Yt("buffer"),this._resourceType="buffer",this._resourceId=Yt("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,i??(i=e?.byteLength);const l=!!e;this.descriptor={size:i,usage:r,mappedAtCreation:l,label:a},this.shrinkToFit=h??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&Vt.STATIC)}set static(t){t?this.descriptor.usage|=Vt.STATIC:this.descriptor.usage&=~Vt.STATIC}setDataWithSize(t,e,i){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t){i&&this.emit("update",this);return}const r=this._data;if(this._data=t,this._dataInt32=null,!r||r.length!==t.length){!this.shrinkToFit&&r&&t.byteLength<r.byteLength?i&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=Yt("resource"),this.emit("change",this));return}i&&this.emit("update",this)}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}unload(){this.emit("unload",this);for(const t in this._gpuData)this._gpuData[t]?.destroy();this._gpuData=Object.create(null)}destroy(){this.destroyed=!0,this.unload(),this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function hp(s,t){if(!(s instanceof $i)){let e=t?Vt.INDEX:Vt.VERTEX;s instanceof Array&&(t?(s=new Uint32Array(s),e=Vt.INDEX|Vt.COPY_DST):(s=new Float32Array(s),e=Vt.VERTEX|Vt.COPY_DST)),s=new $i({data:s,label:t?"index-mesh-buffer":"vertex-mesh-buffer",usage:e})}return s}function lS(s,t,e){const i=s.getAttribute(t);if(!i)return e.minX=0,e.minY=0,e.maxX=0,e.maxY=0,e;const r=i.buffer.data;let a=1/0,h=1/0,l=-1/0,c=-1/0;const f=r.BYTES_PER_ELEMENT,d=(i.offset||0)/f,g=(i.stride||8)/f;for(let x=d;x<r.length;x+=g){const _=r[x],v=r[x+1];_>l&&(l=_),v>c&&(c=v),_<a&&(a=_),v<h&&(h=v)}return e.minX=a,e.minY=h,e.maxX=l,e.maxY=c,e}function uS(s){return(s instanceof $i||Array.isArray(s)||s.BYTES_PER_ELEMENT)&&(s={buffer:s}),s.buffer=hp(s.buffer,!1),s}class lp extends fi{constructor(t={}){super(),this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this.uid=Yt("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new Re,this._boundsDirty=!0;const{attributes:e,indexBuffer:i,topology:r}=t;if(this.buffers=[],this.attributes={},e)for(const a in e)this.addAttribute(a,e[a]);this.instanceCount=t.instanceCount??1,i&&this.addIndex(i),this.topology=r||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const i=uS(e);this.buffers.indexOf(i.buffer)===-1&&(this.buffers.push(i.buffer),i.buffer.on("update",this.onBufferUpdate,this),i.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=i}addIndex(t){this.indexBuffer=hp(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,lS(this,"aPosition",this._bounds)):this._bounds}unload(){this.emit("unload",this);for(const t in this._gpuData)this._gpuData[t]?.destroy();this._gpuData=Object.create(null)}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(e=>e.destroy()),this.unload(),this.indexBuffer?.destroy(),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const cS=new Float32Array(1),dS=new Uint32Array(1);class fS extends lp{constructor(){const e=new $i({data:cS,label:"attribute-batch-buffer",usage:Vt.VERTEX|Vt.COPY_DST,shrinkToFit:!1}),i=new $i({data:dS,label:"index-batch-buffer",usage:Vt.INDEX|Vt.COPY_DST,shrinkToFit:!1}),r=24;super({attributes:{aPosition:{buffer:e,format:"float32x2",stride:r,offset:0},aUV:{buffer:e,format:"float32x2",stride:r,offset:8},aColor:{buffer:e,format:"unorm8x4",stride:r,offset:16},aTextureIdAndRound:{buffer:e,format:"uint16x2",stride:r,offset:20}},indexBuffer:i})}}function Sd(s,t,e){if(s)for(const i in s){const r=i.toLocaleLowerCase(),a=t[r];if(a){let h=s[i];i==="header"&&(h=h.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),e&&a.push(`//----${e}----//`),a.push(h)}else Ot(`${i} placement hook does not exist in shader`)}}const pS=/\{\{(.*?)\}\}/g;function Ad(s){const t={};return(s.match(pS)?.map(i=>i.replace(/[{()}]/g,""))??[]).forEach(i=>{t[i]=[]}),t}function Td(s,t){let e;const i=/@in\s+([^;]+);/g;for(;(e=i.exec(s))!==null;)t.push(e[1])}function Cd(s,t,e=!1){const i=[];Td(t,i),s.forEach(l=>{l.header&&Td(l.header,i)});const r=i;e&&r.sort();const a=r.map((l,c)=>`       @location(${c}) ${l},`).join(`
`);let h=t.replace(/@in\s+[^;]+;\s*/g,"");return h=h.replace("{{in}}",`
${a}
`),h}function Md(s,t){let e;const i=/@out\s+([^;]+);/g;for(;(e=i.exec(s))!==null;)t.push(e[1])}function gS(s){const e=/\b(\w+)\s*:/g.exec(s);return e?e[1]:""}function mS(s){const t=/@.*?\s+/g;return s.replace(t,"")}function _S(s,t){const e=[];Md(t,e),s.forEach(c=>{c.header&&Md(c.header,e)});let i=0;const r=e.sort().map(c=>c.indexOf("builtin")>-1?c:`@location(${i++}) ${c}`).join(`,
`),a=e.sort().map(c=>`       var ${mS(c)};`).join(`
`),h=`return VSOutput(
            ${e.sort().map(c=>` ${gS(c)}`).join(`,
`)});`;let l=t.replace(/@out\s+[^;]+;\s*/g,"");return l=l.replace("{{struct}}",`
${r}
`),l=l.replace("{{start}}",`
${a}
`),l=l.replace("{{return}}",`
${h}
`),l}function Pd(s,t){let e=s;for(const i in t){const r=t[i];r.join(`
`).length?e=e.replace(`{{${i}}}`,`//-----${i} START-----//
${r.join(`
`)}
//----${i} FINISH----//`):e=e.replace(`{{${i}}}`,"")}return e}const Xi=Object.create(null),lh=new Map;let xS=0;function yS({template:s,bits:t}){const e=up(s,t);if(Xi[e])return Xi[e];const{vertex:i,fragment:r}=vS(s,t);return Xi[e]=cp(i,r,t),Xi[e]}function bS({template:s,bits:t}){const e=up(s,t);return Xi[e]||(Xi[e]=cp(s.vertex,s.fragment,t)),Xi[e]}function vS(s,t){const e=t.map(h=>h.vertex).filter(h=>!!h),i=t.map(h=>h.fragment).filter(h=>!!h);let r=Cd(e,s.vertex,!0);r=_S(e,r);const a=Cd(i,s.fragment,!0);return{vertex:r,fragment:a}}function up(s,t){return t.map(e=>(lh.has(e)||lh.set(e,xS++),lh.get(e))).sort((e,i)=>e-i).join("-")+s.vertex+s.fragment}function cp(s,t,e){const i=Ad(s),r=Ad(t);return e.forEach(a=>{Sd(a.vertex,i,a.name),Sd(a.fragment,r,a.name)}),{vertex:Pd(s,i),fragment:Pd(t,r)}}const wS=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,SS=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,AS=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,TS=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,CS={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},MS={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function PS({bits:s,name:t}){const e=yS({template:{fragment:SS,vertex:wS},bits:[CS,...s]});return Nn.from({name:t,vertex:{source:e.vertex,entryPoint:"main"},fragment:{source:e.fragment,entryPoint:"main"}})}function ES({bits:s,name:t}){return new qh({name:t,...bS({template:{vertex:AS,fragment:TS},bits:[MS,...s]})})}const kS={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},IS={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},uh={};function RS(s){const t=[];if(s===1)t.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),t.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let e=0;for(let i=0;i<s;i++)t.push(`@group(1) @binding(${e++}) var textureSource${i+1}: texture_2d<f32>;`),t.push(`@group(1) @binding(${e++}) var textureSampler${i+1}: sampler;`)}return t.join(`
`)}function LS(s){const t=[];if(s===1)t.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{t.push("switch vTextureId {");for(let e=0;e<s;e++)e===s-1?t.push("  default:{"):t.push(`  case ${e}:{`),t.push(`      outColor = textureSampleGrad(textureSource${e+1}, textureSampler${e+1}, vUV, uvDx, uvDy);`),t.push("      break;}");t.push("}")}return t.join(`
`)}function BS(s){return uh[s]||(uh[s]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${RS(s)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${LS(s)}
            `}}),uh[s]}const ch={};function FS(s){const t=[];for(let e=0;e<s;e++)e>0&&t.push("else"),e<s-1&&t.push(`if(vTextureId < ${e}.5)`),t.push("{"),t.push(`	outColor = texture(uTextures[${e}], vUV);`),t.push("}");return t.join(`
`)}function GS(s){return ch[s]||(ch[s]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${s}];

            `,main:`

                ${FS(s)}
            `}}),ch[s]}const OS={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},DS={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},Ed={};function WS(s){let t=Ed[s];if(t)return t;const e=new Int32Array(s);for(let i=0;i<s;i++)e[i]=i;return t=Ed[s]=new Yn({uTextures:{value:e,type:"i32",size:s}},{isStatic:!0}),t}class kd extends Xn{constructor(t){const e=ES({name:"batch",bits:[IS,GS(t),DS]}),i=PS({name:"batch",bits:[kS,BS(t),OS]});super({glProgram:e,gpuProgram:i,resources:{batchSamplers:WS(t)}}),this.maxTextures=t}}let An=null;const dp=class fp extends hS{constructor(t){super(t),this.geometry=new fS,this.name=fp.extension.name,this.vertexSize=6,An??(An=new kd(t.maxTextures)),this.shader=An}packAttributes(t,e,i,r,a){const h=a<<16|t.roundPixels&65535,l=t.transform,c=l.a,f=l.b,d=l.c,g=l.d,x=l.tx,_=l.ty,{positions:v,uvs:T}=t,w=t.color,A=t.attributeOffset,I=A+t.attributeSize;for(let M=A;M<I;M++){const P=M*2,L=v[P],R=v[P+1];e[r++]=c*L+d*R+x,e[r++]=g*R+f*L+_,e[r++]=T[P],e[r++]=T[P+1],i[r++]=w,i[r++]=h}}packQuadAttributes(t,e,i,r,a){const h=t.texture,l=t.transform,c=l.a,f=l.b,d=l.c,g=l.d,x=l.tx,_=l.ty,v=t.bounds,T=v.maxX,w=v.minX,A=v.maxY,I=v.minY,M=h.uvs,P=t.color,L=a<<16|t.roundPixels&65535;e[r+0]=c*w+d*I+x,e[r+1]=g*I+f*w+_,e[r+2]=M.x0,e[r+3]=M.y0,i[r+4]=P,i[r+5]=L,e[r+6]=c*T+d*I+x,e[r+7]=g*I+f*T+_,e[r+8]=M.x1,e[r+9]=M.y1,i[r+10]=P,i[r+11]=L,e[r+12]=c*T+d*A+x,e[r+13]=g*A+f*T+_,e[r+14]=M.x2,e[r+15]=M.y2,i[r+16]=P,i[r+17]=L,e[r+18]=c*w+d*A+x,e[r+19]=g*A+f*w+_,e[r+20]=M.x3,e[r+21]=M.y3,i[r+22]=P,i[r+23]=L}_updateMaxTextures(t){this.shader.maxTextures!==t&&(An=new kd(t),this.shader=An)}destroy(){this.shader=null,super.destroy()}};dp.extension={type:[V.Batcher],name:"default"};let US=dp;class $n{constructor(t){this.items=Object.create(null);const{renderer:e,type:i,onUnload:r,priority:a,name:h}=t;this._renderer=e,e.gc.addResourceHash(this,"items",i,a??0),this._onUnload=r,this.name=h}add(t){return this.items[t.uid]?!1:(this.items[t.uid]=t,t.once("unload",this.remove,this),t._gcLastUsed=this._renderer.gc.now,!0)}remove(t,...e){if(!this.items[t.uid])return;const i=t._gpuData[this._renderer.uid];i&&(this._onUnload?.(t,...e),i.destroy(),t._gpuData[this._renderer.uid]=null,this.items[t.uid]=null)}removeAll(...t){Object.values(this.items).forEach(e=>e&&this.remove(e,...t))}destroy(...t){this.removeAll(...t),this.items=Object.create(null),this._renderer=null,this._onUnload=null}}function HS(s,t,e,i,r,a,h,l=null){let c=0;e*=t,r*=a;const f=l.a,d=l.b,g=l.c,x=l.d,_=l.tx,v=l.ty;for(;c<h;){const T=s[e],w=s[e+1];i[r]=f*T+g*w+_,i[r+1]=d*T+x*w+v,r+=a,e+=t,c++}}function zS(s,t,e,i){let r=0;for(t*=e;r<i;)s[t]=0,s[t+1]=0,t+=e,r++}function pp(s,t,e,i,r){const a=t.a,h=t.b,l=t.c,c=t.d,f=t.tx,d=t.ty;e||(e=0),i||(i=2),r||(r=s.length/i-e);let g=e*i;for(let x=0;x<r;x++){const _=s[g],v=s[g+1];s[g]=a*_+l*v+f,s[g+1]=h*_+c*v+d,g+=i}}const NS=new pt;class Qh{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|t&65280|(t&255)<<16,i=this.renderable;return i?yf(e,i.groupColor)+(this.alpha*i.groupAlpha*255<<24):e+(this.alpha*255<<24)}get transform(){return this.renderable?.groupTransform||NS}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const Un={extension:{type:V.ShapeBuilder,name:"circle"},build(s,t){let e,i,r,a,h,l;if(s.type==="circle"){const P=s;if(h=l=P.radius,h<=0)return!1;e=P.x,i=P.y,r=a=0}else if(s.type==="ellipse"){const P=s;if(h=P.halfWidth,l=P.halfHeight,h<=0||l<=0)return!1;e=P.x,i=P.y,r=a=0}else{const P=s,L=P.width/2,R=P.height/2;e=P.x+L,i=P.y+R,h=l=Math.max(0,Math.min(P.radius,Math.min(L,R))),r=L-h,a=R-l}if(r<0||a<0)return!1;const c=Math.ceil(2.3*Math.sqrt(h+l)),f=c*8+(r?4:0)+(a?4:0);if(f===0)return!1;if(c===0)return t[0]=t[6]=e+r,t[1]=t[3]=i+a,t[2]=t[4]=e-r,t[5]=t[7]=i-a,!0;let d=0,g=c*4+(r?2:0)+2,x=g,_=f,v=r+h,T=a,w=e+v,A=e-v,I=i+T;if(t[d++]=w,t[d++]=I,t[--g]=I,t[--g]=A,a){const P=i-T;t[x++]=A,t[x++]=P,t[--_]=P,t[--_]=w}for(let P=1;P<c;P++){const L=Math.PI/2*(P/c),R=r+Math.cos(L)*h,G=a+Math.sin(L)*l,Y=e+R,q=e-R,H=i+G,U=i-G;t[d++]=Y,t[d++]=H,t[--g]=H,t[--g]=q,t[x++]=q,t[x++]=U,t[--_]=U,t[--_]=Y}v=r,T=a+l,w=e+v,A=e-v,I=i+T;const M=i-T;return t[d++]=w,t[d++]=I,t[--_]=M,t[--_]=w,r&&(t[d++]=A,t[d++]=I,t[--_]=M,t[--_]=A),!0},triangulate(s,t,e,i,r,a){if(s.length===0)return;let h=0,l=0;for(let d=0;d<s.length;d+=2)h+=s[d],l+=s[d+1];h/=s.length/2,l/=s.length/2;let c=i;t[c*e]=h,t[c*e+1]=l;const f=c++;for(let d=0;d<s.length;d+=2)t[c*e]=s[d],t[c*e+1]=s[d+1],d>0&&(r[a++]=c,r[a++]=f,r[a++]=c-1),c++;r[a++]=f+1,r[a++]=f,r[a++]=c-1}},YS={...Un,extension:{...Un.extension,name:"ellipse"}},XS={...Un,extension:{...Un.extension,name:"roundedRectangle"}},gp=1e-4,Id=1e-4;function $S(s){const t=s.length;if(t<6)return 1;let e=0;for(let i=0,r=s[t-2],a=s[t-1];i<t;i+=2){const h=s[i],l=s[i+1];e+=(h-r)*(l+a),r=h,a=l}return e<0?-1:1}function Rd(s,t,e,i,r,a,h,l){const c=s-e*r,f=t-i*r,d=s+e*a,g=t+i*a;let x,_;h?(x=i,_=-e):(x=-i,_=e);const v=c+x,T=f+_,w=d+x,A=g+_;return l.push(v,T),l.push(w,A),2}function rs(s,t,e,i,r,a,h,l){const c=e-s,f=i-t;let d=Math.atan2(c,f),g=Math.atan2(r-s,a-t);l&&d<g?d+=Math.PI*2:!l&&d>g&&(g+=Math.PI*2);let x=d;const _=g-d,v=Math.abs(_),T=Math.sqrt(c*c+f*f),w=(15*v*Math.sqrt(T)/Math.PI>>0)+1,A=_/w;if(x+=A,l){h.push(s,t),h.push(e,i);for(let I=1,M=x;I<w;I++,M+=A)h.push(s,t),h.push(s+Math.sin(M)*T,t+Math.cos(M)*T);h.push(s,t),h.push(r,a)}else{h.push(e,i),h.push(s,t);for(let I=1,M=x;I<w;I++,M+=A)h.push(s+Math.sin(M)*T,t+Math.cos(M)*T),h.push(s,t);h.push(r,a),h.push(s,t)}return w*2}function VS(s,t,e,i,r,a){const h=gp;if(s.length===0)return;const l=t;let c=l.alignment;if(t.alignment!==.5){let $=$S(s);c=(c-.5)*$+.5}const f=new qt(s[0],s[1]),d=new qt(s[s.length-2],s[s.length-1]),g=i,x=Math.abs(f.x-d.x)<h&&Math.abs(f.y-d.y)<h;if(g){s=s.slice(),x&&(s.pop(),s.pop(),d.set(s[s.length-2],s[s.length-1]));const $=(f.x+d.x)*.5,_t=(d.y+f.y)*.5;s.unshift($,_t),s.push($,_t)}const _=r,v=s.length/2;let T=s.length;const w=_.length/2,A=l.width/2,I=A*A,M=l.miterLimit*l.miterLimit;let P=s[0],L=s[1],R=s[2],G=s[3],Y=0,q=0,H=-(L-G),U=P-R,K=0,Q=0,J=Math.sqrt(H*H+U*U);H/=J,U/=J,H*=A,U*=A;const yt=c,N=(1-yt)*2,z=yt*2;g||(l.cap==="round"?T+=rs(P-H*(N-z)*.5,L-U*(N-z)*.5,P-H*N,L-U*N,P+H*z,L+U*z,_,!0)+2:l.cap==="square"&&(T+=Rd(P,L,H,U,N,z,!0,_))),_.push(P-H*N,L-U*N),_.push(P+H*z,L+U*z);for(let $=1;$<v-1;++$){P=s[($-1)*2],L=s[($-1)*2+1],R=s[$*2],G=s[$*2+1],Y=s[($+1)*2],q=s[($+1)*2+1],H=-(L-G),U=P-R,J=Math.sqrt(H*H+U*U),H/=J,U/=J,H*=A,U*=A,K=-(G-q),Q=R-Y,J=Math.sqrt(K*K+Q*Q),K/=J,Q/=J,K*=A,Q*=A;const _t=R-P,dt=L-G,Pt=R-Y,Dt=q-G,re=_t*Pt+dt*Dt,we=dt*Pt-Dt*_t,ni=we<0;if(Math.abs(we)<.001*Math.abs(re)){_.push(R-H*N,G-U*N),_.push(R+H*z,G+U*z),re>=0&&(l.join==="round"?T+=rs(R,G,R-H*N,G-U*N,R-K*N,G-Q*N,_,!1)+4:T+=2,_.push(R-K*z,G-Q*z),_.push(R+K*N,G+Q*N));continue}const Vn=(-H+P)*(-U+G)-(-H+R)*(-U+L),Ii=(-K+Y)*(-Q+G)-(-K+R)*(-Q+q),ri=(_t*Ii-Pt*Vn)/we,ys=(Dt*Vn-dt*Ii)/we,Ri=(ri-R)*(ri-R)+(ys-G)*(ys-G),Le=R+(ri-R)*N,oi=G+(ys-G)*N,jt=R-(ri-R)*z,Se=G-(ys-G)*z,xo=Math.min(_t*_t+dt*dt,Pt*Pt+Dt*Dt),Be=ni?N:z,qn=xo+Be*Be*I;Ri<=qn?l.join==="bevel"||Ri/I>M?(ni?(_.push(Le,oi),_.push(R+H*z,G+U*z),_.push(Le,oi),_.push(R+K*z,G+Q*z)):(_.push(R-H*N,G-U*N),_.push(jt,Se),_.push(R-K*N,G-Q*N),_.push(jt,Se)),T+=2):l.join==="round"?ni?(_.push(Le,oi),_.push(R+H*z,G+U*z),T+=rs(R,G,R+H*z,G+U*z,R+K*z,G+Q*z,_,!0)+4,_.push(Le,oi),_.push(R+K*z,G+Q*z)):(_.push(R-H*N,G-U*N),_.push(jt,Se),T+=rs(R,G,R-H*N,G-U*N,R-K*N,G-Q*N,_,!1)+4,_.push(R-K*N,G-Q*N),_.push(jt,Se)):(_.push(Le,oi),_.push(jt,Se)):(_.push(R-H*N,G-U*N),_.push(R+H*z,G+U*z),l.join==="round"?ni?T+=rs(R,G,R+H*z,G+U*z,R+K*z,G+Q*z,_,!0)+2:T+=rs(R,G,R-H*N,G-U*N,R-K*N,G-Q*N,_,!1)+2:l.join==="miter"&&Ri/I<=M&&(ni?(_.push(jt,Se),_.push(jt,Se)):(_.push(Le,oi),_.push(Le,oi)),T+=2),_.push(R-K*N,G-Q*N),_.push(R+K*z,G+Q*z),T+=2)}P=s[(v-2)*2],L=s[(v-2)*2+1],R=s[(v-1)*2],G=s[(v-1)*2+1],H=-(L-G),U=P-R,J=Math.sqrt(H*H+U*U),H/=J,U/=J,H*=A,U*=A,_.push(R-H*N,G-U*N),_.push(R+H*z,G+U*z),g||(l.cap==="round"?T+=rs(R-H*(N-z)*.5,G-U*(N-z)*.5,R-H*N,G-U*N,R+H*z,G+U*z,_,!1)+2:l.cap==="square"&&(T+=Rd(R,G,H,U,N,z,!1,_)));const rt=Id*Id;for(let $=w;$<T+w-2;++$)P=_[$*2],L=_[$*2+1],R=_[($+1)*2],G=_[($+1)*2+1],Y=_[($+2)*2],q=_[($+2)*2+1],!(Math.abs(P*(G-q)+R*(q-L)+Y*(L-G))<rt)&&a.push($,$+1,$+2)}function qS(s,t,e,i){const r=gp;if(s.length===0)return;const a=s[0],h=s[1],l=s[s.length-2],c=s[s.length-1],f=t||Math.abs(a-l)<r&&Math.abs(h-c)<r,d=e,g=s.length/2,x=d.length/2;for(let _=0;_<g;_++)d.push(s[_*2]),d.push(s[_*2+1]);for(let _=0;_<g-1;_++)i.push(x+_,x+_+1);f&&i.push(x+g-1,x)}function mp(s,t,e,i,r,a,h){const l=cw(s,t,2);if(!l)return;for(let f=0;f<l.length;f+=3)a[h++]=l[f]+r,a[h++]=l[f+1]+r,a[h++]=l[f+2]+r;let c=r*i;for(let f=0;f<s.length;f+=2)e[c]=s[f],e[c+1]=s[f+1],c+=i}const jS=[],ZS={extension:{type:V.ShapeBuilder,name:"polygon"},build(s,t){for(let e=0;e<s.points.length;e++)t[e]=s.points[e];return!0},triangulate(s,t,e,i,r,a){mp(s,jS,t,e,i,r,a)}},KS={extension:{type:V.ShapeBuilder,name:"rectangle"},build(s,t){const e=s,i=e.x,r=e.y,a=e.width,h=e.height;return a>0&&h>0?(t[0]=i,t[1]=r,t[2]=i+a,t[3]=r,t[4]=i+a,t[5]=r+h,t[6]=i,t[7]=r+h,!0):!1},triangulate(s,t,e,i,r,a){let h=0;i*=e,t[i+h]=s[0],t[i+h+1]=s[1],h+=e,t[i+h]=s[2],t[i+h+1]=s[3],h+=e,t[i+h]=s[6],t[i+h+1]=s[7],h+=e,t[i+h]=s[4],t[i+h+1]=s[5],h+=e;const l=i/e;r[a++]=l,r[a++]=l+1,r[a++]=l+2,r[a++]=l+1,r[a++]=l+3,r[a++]=l+2}},JS={extension:{type:V.ShapeBuilder,name:"triangle"},build(s,t){return t[0]=s.x,t[1]=s.y,t[2]=s.x2,t[3]=s.y2,t[4]=s.x3,t[5]=s.y3,!0},triangulate(s,t,e,i,r,a){let h=0;i*=e,t[i+h]=s[0],t[i+h+1]=s[1],h+=e,t[i+h]=s[2],t[i+h+1]=s[3],h+=e,t[i+h]=s[4],t[i+h+1]=s[5];const l=i/e;r[a++]=l,r[a++]=l+1,r[a++]=l+2}},Ld=[{offset:0,color:"white"},{offset:1,color:"black"}],tl=class Rh{constructor(...t){this.uid=Yt("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let e=QS(t);e={...e.type==="radial"?Rh.defaultRadialOptions:Rh.defaultLinearOptions,...hf(e)},this._textureSize=e.textureSize,this._wrapMode=e.wrapMode,e.type==="radial"?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(r=>{this.addColorStop(r.offset,r.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:te.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:i,y:r}=this.end,a=i-t,h=r-e;const l=a<0||h<0;if(this._wrapMode==="clamp-to-edge"){if(a<0){const w=t;t=i,i=w,a*=-1}if(h<0){const w=e;e=r,r=w,h*=-1}}const c=this.colorStops.length?this.colorStops:Ld,f=this._textureSize,{canvas:d,context:g}=Fd(f,1),x=l?g.createLinearGradient(this._textureSize,0,0,0):g.createLinearGradient(0,0,this._textureSize,0);Bd(x,c),g.fillStyle=x,g.fillRect(0,0,f,1),this.texture=new ht({source:new qs({resource:d,addressMode:this._wrapMode})});const _=Math.sqrt(a*a+h*h),v=Math.atan2(h,a),T=new pt;T.scale(_/f,1),T.rotate(v),T.translate(t,e),this.textureSpace==="local"&&T.scale(f,f),this.transform=T}buildGradient(){this.texture||this._tick++,this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:Ld,e=this._textureSize,{canvas:i,context:r}=Fd(e,e),{x:a,y:h}=this.center,{x:l,y:c}=this.outerCenter,f=this.innerRadius,d=this.outerRadius,g=l-d,x=c-d,_=e/(d*2),v=(a-g)*_,T=(h-x)*_,w=r.createRadialGradient(v,T,f*_,(l-g)*_,(c-x)*_,d*_);Bd(w,t),r.fillStyle=t[t.length-1].color,r.fillRect(0,0,e,e),r.fillStyle=w,r.translate(v,T),r.rotate(this.rotation),r.scale(1,this.scale),r.translate(-v,-T),r.fillRect(0,0,e,e),this.texture=new ht({source:new qs({resource:i,addressMode:this._wrapMode})});const A=new pt;A.scale(1/_,1/_),A.translate(g,x),this.textureSpace==="local"&&A.scale(e,e),this.transform=A}destroy(){this.texture?.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};tl.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};tl.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let Ei=tl;function Bd(s,t){for(let e=0;e<t.length;e++){const i=t[e];s.addColorStop(i.offset,i.color)}}function Fd(s,t){const e=Lt.get().createCanvas(s,t),i=e.getContext("2d");return{canvas:e,context:i}}function QS(s){let t=s[0]??{};return(typeof t=="number"||s[1])&&(wt("8.5.2","use options object instead"),t={type:"linear",start:{x:s[0],y:s[1]},end:{x:s[2],y:s[3]},textureSpace:s[4],textureSize:s[5]??Ei.defaultLinearOptions.textureSize}),t}const tA=new pt,eA=new kt;function iA(s,t,e,i){const r=t.matrix?s.copyFrom(t.matrix).invert():s.identity();if(t.textureSpace==="local"){const h=e.getBounds(eA);t.width&&h.pad(t.width);const{x:l,y:c}=h,f=1/h.width,d=1/h.height,g=-l*f,x=-c*d,_=r.a,v=r.b,T=r.c,w=r.d;r.a*=f,r.b*=f,r.c*=d,r.d*=d,r.tx=g*_+x*T+r.tx,r.ty=g*v+x*w+r.ty}else r.translate(t.texture.frame.x,t.texture.frame.y),r.scale(1/t.texture.source.width,1/t.texture.source.height);const a=t.texture.source.style;return!(t.fill instanceof Ei)&&a.addressMode==="clamp-to-edge"&&(a.addressMode="repeat",a.update()),i&&r.append(tA.copyFrom(i).invert()),r}const mo={};Mt.handleByMap(V.ShapeBuilder,mo);Mt.add(KS,ZS,JS,Un,YS,XS);const sA=new kt,nA=new pt;function rA(s,t){const{geometryData:e,batches:i}=t;i.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let r=0;r<s.instructions.length;r++){const a=s.instructions[r];if(a.action==="texture")oA(a.data,i,e);else if(a.action==="fill"||a.action==="stroke"){const h=a.action==="stroke",l=a.data.path.shapePath,c=a.data.style,f=a.data.hole;h&&f&&Gd(f.shapePath,c,!0,i,e),f&&(l.shapePrimitives[l.shapePrimitives.length-1].holes=f.shapePath.shapePrimitives),Gd(l,c,h,i,e)}}}function oA(s,t,e){const i=[],r=mo.rectangle,a=sA;a.x=s.dx,a.y=s.dy,a.width=s.dw,a.height=s.dh;const h=s.transform;if(!r.build(a,i))return;const{vertices:l,uvs:c,indices:f}=e,d=f.length,g=l.length/2;h&&pp(i,h),r.triangulate(i,l,2,g,f,d);const x=s.image,_=x.uvs;c.push(_.x0,_.y0,_.x1,_.y1,_.x3,_.y3,_.x2,_.y2);const v=be.get(Qh);v.indexOffset=d,v.indexSize=f.length-d,v.attributeOffset=g,v.attributeSize=l.length/2-g,v.baseColor=s.style,v.alpha=s.alpha,v.texture=x,v.geometryData=e,t.push(v)}function Gd(s,t,e,i,r){const{vertices:a,uvs:h,indices:l}=r;s.shapePrimitives.forEach(({shape:c,transform:f,holes:d})=>{const g=[],x=mo[c.type];if(!x.build(c,g))return;const _=l.length,v=a.length/2;let T="triangle-list";if(f&&pp(g,f),e){const M=c.closePath??!0,P=t;P.pixelLine?(qS(g,M,a,l),T="line-list"):VS(g,P,!1,M,a,l)}else if(d){const M=[],P=g.slice();aA(d).forEach(R=>{M.push(P.length/2),P.push(...R)}),mp(P,M,a,2,v,l,_)}else x.triangulate(g,a,2,v,l,_);const w=h.length/2,A=t.texture;if(A!==ht.WHITE){const M=iA(nA,t,c,f);HS(a,2,v,h,w,2,a.length/2-v,M)}else zS(h,w,2,a.length/2-v);const I=be.get(Qh);I.indexOffset=_,I.indexSize=l.length-_,I.attributeOffset=v,I.attributeSize=a.length/2-v,I.baseColor=t.color,I.alpha=t.alpha,I.texture=A,I.geometryData=r,I.topology=T,i.push(I)})}function aA(s){const t=[];for(let e=0;e<s.length;e++){const i=s[e].shape,r=[];mo[i.type].build(i,r)&&t.push(r)}return t}class hA{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}reset(){this.batches&&this.batches.forEach(t=>{be.return(t)}),this.graphicsData&&be.return(this.graphicsData),this.isBatchable=!1,this.context=null,this.batches.length=0,this.geometryData.indices.length=0,this.geometryData.vertices.length=0,this.geometryData.uvs.length=0,this.graphicsData=null}destroy(){this.reset(),this.batches=null,this.geometryData=null}}class lA{constructor(){this.instructions=new $h}init(t){const e=t.maxTextures;this.batcher?this.batcher._updateMaxTextures(e):this.batcher=new US({maxTextures:e}),this.instructions.reset()}get geometry(){return wt(Fv,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const el=class Lh{constructor(t){this._renderer=t,this._managedContexts=new $n({renderer:t,type:"resource",name:"graphicsContext"})}init(t){Lh.defaultOptions.bezierSmoothness=t?.bezierSmoothness??Lh.defaultOptions.bezierSmoothness}getContextRenderData(t){return t._gpuData[this._renderer.uid].graphicsData||this._initContextRenderData(t)}updateGpuContext(t){const e=!!t._gpuData[this._renderer.uid],i=t._gpuData[this._renderer.uid]||this._initContext(t);if(t.dirty||!e){e&&i.reset(),rA(t,i);const r=t.batchMode;t.customShader||r==="no-batch"?i.isBatchable=!1:r==="auto"?i.isBatchable=i.geometryData.vertices.length<400:i.isBatchable=!0,t.dirty=!1}return i}getGpuContext(t){return t._gpuData[this._renderer.uid]||this._initContext(t)}_initContextRenderData(t){const e=be.get(lA,{maxTextures:this._renderer.limits.maxBatchableTextures}),i=t._gpuData[this._renderer.uid],{batches:r,geometryData:a}=i;i.graphicsData=e;const h=a.vertices.length,l=a.indices.length;for(let g=0;g<r.length;g++)r[g].applyTransform=!1;const c=e.batcher;c.ensureAttributeBuffer(h),c.ensureIndexBuffer(l),c.begin();for(let g=0;g<r.length;g++){const x=r[g];c.add(x)}c.finish(e.instructions);const f=c.geometry;f.indexBuffer.setDataWithSize(c.indexBuffer,c.indexSize,!0),f.buffers[0].setDataWithSize(c.attributeBuffer.float32View,c.attributeSize,!0);const d=c.batches;for(let g=0;g<d.length;g++){const x=d[g];x.bindGroup=Jw(x.textures.textures,x.textures.count,this._renderer.limits.maxBatchableTextures)}return e}_initContext(t){const e=new hA;return e.context=t,t._gpuData[this._renderer.uid]=e,this._managedContexts.add(t),e}destroy(){this._managedContexts.destroy(),this._renderer=null}};el.extension={type:[V.WebGLSystem,V.WebGPUSystem],name:"graphicsContext"};el.defaultOptions={bezierSmoothness:.5};let il=el;const uA=8,Jr=11920929e-14,cA=1;function _p(s,t,e,i,r,a,h,l,c,f){const g=Math.min(.99,Math.max(0,f??il.defaultOptions.bezierSmoothness));let x=(cA-g)/1;return x*=x,dA(t,e,i,r,a,h,l,c,s,x),s}function dA(s,t,e,i,r,a,h,l,c,f){Bh(s,t,e,i,r,a,h,l,c,f,0),c.push(h,l)}function Bh(s,t,e,i,r,a,h,l,c,f,d){if(d>uA)return;const g=(s+e)/2,x=(t+i)/2,_=(e+r)/2,v=(i+a)/2,T=(r+h)/2,w=(a+l)/2,A=(g+_)/2,I=(x+v)/2,M=(_+T)/2,P=(v+w)/2,L=(A+M)/2,R=(I+P)/2;if(d>0){let G=h-s,Y=l-t;const q=Math.abs((e-h)*Y-(i-l)*G),H=Math.abs((r-h)*Y-(a-l)*G);if(q>Jr&&H>Jr){if((q+H)*(q+H)<=f*(G*G+Y*Y)){c.push(L,R);return}}else if(q>Jr){if(q*q<=f*(G*G+Y*Y)){c.push(L,R);return}}else if(H>Jr){if(H*H<=f*(G*G+Y*Y)){c.push(L,R);return}}else if(G=L-(s+h)/2,Y=R-(t+l)/2,G*G+Y*Y<=f){c.push(L,R);return}}Bh(s,t,g,x,A,I,L,R,c,f,d+1),Bh(L,R,M,P,T,w,h,l,c,f,d+1)}const fA=8,pA=11920929e-14,gA=1;function mA(s,t,e,i,r,a,h,l){const f=Math.min(.99,Math.max(0,l??il.defaultOptions.bezierSmoothness));let d=(gA-f)/1;return d*=d,_A(t,e,i,r,a,h,s,d),s}function _A(s,t,e,i,r,a,h,l){Fh(h,s,t,e,i,r,a,l,0),h.push(r,a)}function Fh(s,t,e,i,r,a,h,l,c){if(c>fA)return;const f=(t+i)/2,d=(e+r)/2,g=(i+a)/2,x=(r+h)/2,_=(f+g)/2,v=(d+x)/2;let T=a-t,w=h-e;const A=Math.abs((i-a)*w-(r-h)*T);if(A>pA){if(A*A<=l*(T*T+w*w)){s.push(_,v);return}}else if(T=_-(t+a)/2,w=v-(e+h)/2,T*T+w*w<=l){s.push(_,v);return}Fh(s,t,e,f,d,_,v,l,c+1),Fh(s,_,v,g,x,a,h,l,c+1)}function xp(s,t,e,i,r,a,h,l){let c=Math.abs(r-a);(!h&&r>a||h&&a>r)&&(c=2*Math.PI-c),l||(l=Math.max(6,Math.floor(6*Math.pow(i,1/3)*(c/Math.PI)))),l=Math.max(l,3);let f=c/l,d=r;f*=h?-1:1;for(let g=0;g<l+1;g++){const x=Math.cos(d),_=Math.sin(d),v=t+x*i,T=e+_*i;s.push(v,T),d+=f}}function xA(s,t,e,i,r,a){const h=s[s.length-2],c=s[s.length-1]-e,f=h-t,d=r-e,g=i-t,x=Math.abs(c*g-f*d);if(x<1e-8||a===0){(s[s.length-2]!==t||s[s.length-1]!==e)&&s.push(t,e);return}const _=c*c+f*f,v=d*d+g*g,T=c*d+f*g,w=a*Math.sqrt(_)/x,A=a*Math.sqrt(v)/x,I=w*T/_,M=A*T/v,P=w*g+A*f,L=w*d+A*c,R=f*(A+I),G=c*(A+I),Y=g*(w+M),q=d*(w+M),H=Math.atan2(G-L,R-P),U=Math.atan2(q-L,Y-P);xp(s,P+t,L+e,a,H,U,f*d>g*c)}const Fn=Math.PI*2,dh={centerX:0,centerY:0,ang1:0,ang2:0},fh=({x:s,y:t},e,i,r,a,h,l,c)=>{s*=e,t*=i;const f=r*s-a*t,d=a*s+r*t;return c.x=f+h,c.y=d+l,c};function yA(s,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),i=t===1.5707963267948966?.551915024494:e,r=Math.cos(s),a=Math.sin(s),h=Math.cos(s+t),l=Math.sin(s+t);return[{x:r-a*i,y:a+r*i},{x:h+l*i,y:l-h*i},{x:h,y:l}]}const Od=(s,t,e,i)=>{const r=s*i-t*e<0?-1:1;let a=s*e+t*i;return a>1&&(a=1),a<-1&&(a=-1),r*Math.acos(a)},bA=(s,t,e,i,r,a,h,l,c,f,d,g,x)=>{const _=Math.pow(r,2),v=Math.pow(a,2),T=Math.pow(d,2),w=Math.pow(g,2);let A=_*v-_*w-v*T;A<0&&(A=0),A/=_*w+v*T,A=Math.sqrt(A)*(h===l?-1:1);const I=A*r/a*g,M=A*-a/r*d,P=f*I-c*M+(s+e)/2,L=c*I+f*M+(t+i)/2,R=(d-I)/r,G=(g-M)/a,Y=(-d-I)/r,q=(-g-M)/a,H=Od(1,0,R,G);let U=Od(R,G,Y,q);l===0&&U>0&&(U-=Fn),l===1&&U<0&&(U+=Fn),x.centerX=P,x.centerY=L,x.ang1=H,x.ang2=U};function vA(s,t,e,i,r,a,h,l=0,c=0,f=0){if(a===0||h===0)return;const d=Math.sin(l*Fn/360),g=Math.cos(l*Fn/360),x=g*(t-i)/2+d*(e-r)/2,_=-d*(t-i)/2+g*(e-r)/2;if(x===0&&_===0)return;a=Math.abs(a),h=Math.abs(h);const v=Math.pow(x,2)/Math.pow(a,2)+Math.pow(_,2)/Math.pow(h,2);v>1&&(a*=Math.sqrt(v),h*=Math.sqrt(v)),bA(t,e,i,r,a,h,c,f,d,g,x,_,dh);let{ang1:T,ang2:w}=dh;const{centerX:A,centerY:I}=dh;let M=Math.abs(w)/(Fn/4);Math.abs(1-M)<1e-7&&(M=1);const P=Math.max(Math.ceil(M),1);w/=P;let L=s[s.length-2],R=s[s.length-1];const G={x:0,y:0};for(let Y=0;Y<P;Y++){const q=yA(T,w),{x:H,y:U}=fh(q[0],a,h,g,d,A,I,G),{x:K,y:Q}=fh(q[1],a,h,g,d,A,I,G),{x:J,y:yt}=fh(q[2],a,h,g,d,A,I,G);_p(s,L,R,H,U,K,Q,J,yt),L=J,R=yt,T+=w}}function wA(s,t,e){const i=(h,l)=>{const c=l.x-h.x,f=l.y-h.y,d=Math.sqrt(c*c+f*f),g=c/d,x=f/d;return{len:d,nx:g,ny:x}},r=(h,l)=>{h===0?s.moveTo(l.x,l.y):s.lineTo(l.x,l.y)};let a=t[t.length-1];for(let h=0;h<t.length;h++){const l=t[h%t.length],c=l.radius??e;if(c<=0){r(h,l),a=l;continue}const f=t[(h+1)%t.length],d=i(l,a),g=i(l,f);if(d.len<1e-4||g.len<1e-4){r(h,l),a=l;continue}let x=Math.asin(d.nx*g.ny-d.ny*g.nx),_=1,v=!1;d.nx*g.nx-d.ny*-g.ny<0?x<0?x=Math.PI+x:(x=Math.PI-x,_=-1,v=!0):x>0&&(_=-1,v=!0);const T=x/2;let w,A=Math.abs(Math.cos(T)*c/Math.sin(T));A>Math.min(d.len/2,g.len/2)?(A=Math.min(d.len/2,g.len/2),w=Math.abs(A*Math.sin(T)/Math.cos(T))):w=c;const I=l.x+g.nx*A+-g.ny*w*_,M=l.y+g.ny*A+g.nx*w*_,P=Math.atan2(d.ny,d.nx)+Math.PI/2*_,L=Math.atan2(g.ny,g.nx)-Math.PI/2*_;h===0&&s.moveTo(I+Math.cos(P)*w,M+Math.sin(P)*w),s.arc(I,M,w,P,L,v),a=l}}function SA(s,t,e,i){const r=(l,c)=>Math.sqrt((l.x-c.x)**2+(l.y-c.y)**2),a=(l,c,f)=>({x:l.x+(c.x-l.x)*f,y:l.y+(c.y-l.y)*f}),h=t.length;for(let l=0;l<h;l++){const c=t[(l+1)%h],f=c.radius??e;if(f<=0){l===0?s.moveTo(c.x,c.y):s.lineTo(c.x,c.y);continue}const d=t[l],g=t[(l+2)%h],x=r(d,c);let _;if(x<1e-4)_=c;else{const w=Math.min(x/2,f);_=a(c,d,w/x)}const v=r(g,c);let T;if(v<1e-4)T=c;else{const w=Math.min(v/2,f);T=a(c,g,w/v)}l===0?s.moveTo(_.x,_.y):s.lineTo(_.x,_.y),s.quadraticCurveTo(c.x,c.y,T.x,T.y,i)}}const AA=new kt;class TA{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new Re,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const i=this._currentPoly.points,r=i[i.length-2],a=i[i.length-1];return(r!==t||a!==e)&&i.push(t,e),this}arc(t,e,i,r,a,h){this._ensurePoly(!1);const l=this._currentPoly.points;return xp(l,t,e,i,r,a,h),this}arcTo(t,e,i,r,a){this._ensurePoly();const h=this._currentPoly.points;return xA(h,t,e,i,r,a),this}arcToSvg(t,e,i,r,a,h,l){const c=this._currentPoly.points;return vA(c,this._currentPoly.lastX,this._currentPoly.lastY,h,l,t,e,i,r,a),this}bezierCurveTo(t,e,i,r,a,h,l){this._ensurePoly();const c=this._currentPoly;return _p(this._currentPoly.points,c.lastX,c.lastY,t,e,i,r,a,h,l),this}quadraticCurveTo(t,e,i,r,a){this._ensurePoly();const h=this._currentPoly;return mA(this._currentPoly.points,h.lastX,h.lastY,t,e,i,r,a),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));const i=this.shapePrimitives,r=i.length;for(let a=0;a<t.instructions.length;a++){const h=t.instructions[a];this[h.action](...h.data)}if(t.checkForHoles&&i.length-r>1){let a=null;for(let h=r;h<i.length;h++){const l=i[h];if(l.shape.type==="polygon"){const c=l.shape,f=a?.shape;f&&f.containsPolygon(c)?(a.holes||(a.holes=[]),a.holes.push(l),i.copyWithin(h,h+1),i.length--,h--):a=l}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,i,r,a){return this.drawShape(new kt(t,e,i,r),a),this}circle(t,e,i,r){return this.drawShape(new Zh(t,e,i),r),this}poly(t,e,i){const r=new Ln(t);return r.closePath=e,this.drawShape(r,i),this}regularPoly(t,e,i,r,a=0,h){r=Math.max(r|0,3);const l=-1*Math.PI/2+a,c=Math.PI*2/r,f=[];for(let d=0;d<r;d++){const g=l-d*c;f.push(t+i*Math.cos(g),e+i*Math.sin(g))}return this.poly(f,!0,h),this}roundPoly(t,e,i,r,a,h=0,l){if(r=Math.max(r|0,3),a<=0)return this.regularPoly(t,e,i,r,h);const c=i*Math.sin(Math.PI/r)-.001;a=Math.min(a,c);const f=-1*Math.PI/2+h,d=Math.PI*2/r,g=(r-2)*Math.PI/r/2;for(let x=0;x<r;x++){const _=x*d+f,v=t+i*Math.cos(_),T=e+i*Math.sin(_),w=_+Math.PI+g,A=_-Math.PI-g,I=v+a*Math.cos(w),M=T+a*Math.sin(w),P=v+a*Math.cos(A),L=T+a*Math.sin(A);x===0?this.moveTo(I,M):this.lineTo(I,M),this.quadraticCurveTo(v,T,P,L,l)}return this.closePath()}roundShape(t,e,i=!1,r){return t.length<3?this:(i?SA(this,t,e,r):wA(this,t,e),this.closePath())}filletRect(t,e,i,r,a){if(a===0)return this.rect(t,e,i,r);const h=Math.min(i,r)/2,l=Math.min(h,Math.max(-h,a)),c=t+i,f=e+r,d=l<0?-l:0,g=Math.abs(l);return this.moveTo(t,e+g).arcTo(t+d,e+d,t+g,e,g).lineTo(c-g,e).arcTo(c-d,e+d,c,e+g,g).lineTo(c,f-g).arcTo(c-d,f-d,t+i-g,f,g).lineTo(t+g,f).arcTo(t+d,f-d,t,f-g,g).closePath()}chamferRect(t,e,i,r,a,h){if(a<=0)return this.rect(t,e,i,r);const l=Math.min(a,Math.min(i,r)/2),c=t+i,f=e+r,d=[t+l,e,c-l,e,c,e+l,c,f-l,c-l,f,t+l,f,t,f-l,t,e+l];for(let g=d.length-1;g>=2;g-=2)d[g]===d[g-2]&&d[g-1]===d[g-3]&&d.splice(g-1,2);return this.poly(d,!0,h)}ellipse(t,e,i,r,a){return this.drawShape(new Kh(t,e,i,r),a),this}roundRect(t,e,i,r,a,h){return this.drawShape(new Jh(t,e,i,r,a),h),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let i=this._currentPoly;return i&&this.endPoly(),i=new Ln,i.points.push(t,e),this._currentPoly=i,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new Ln,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let i=e.shape.x,r=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const a=e.transform,h=i;i=a.a*i+a.c*r+a.tx,r=a.b*h+a.d*r+a.ty}this._currentPoly.points.push(i,r)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const i=t.instructions[e];this[i.action](...i.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let i=0;i<e.length;i++){const r=e[i],a=r.shape.getBounds(AA);r.transform?t.addRect(a,r.transform):t.addRect(a)}return t}}class Pi{constructor(t,e=!1){this.instructions=[],this.uid=Yt("graphicsPath"),this._dirty=!0,this.checkForHoles=e,typeof t=="string"?qw(t,this):this.instructions=t?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new TA(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,i,r,a){const h=this.instructions[this.instructions.length-1],l=this.getLastPoint(qt.shared);let c=0,f=0;if(!h||h.action!=="bezierCurveTo")c=l.x,f=l.y;else{c=h.data[2],f=h.data[3];const d=l.x,g=l.y;c=d+(d-c),f=g+(g-f)}return this.instructions.push({action:"bezierCurveTo",data:[c,f,t,e,i,r,a]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,i){const r=this.instructions[this.instructions.length-1],a=this.getLastPoint(qt.shared);let h=0,l=0;if(!r||r.action!=="quadraticCurveTo")h=a.x,l=a.y;else{h=r.data[0],l=r.data[1];const c=a.x,f=a.y;h=c+(c-h),l=f+(f-l)}return this.instructions.push({action:"quadraticCurveTo",data:[h,l,t,e,i]}),this._dirty=!0,this}rect(t,e,i,r,a){return this.instructions.push({action:"rect",data:[t,e,i,r,a]}),this._dirty=!0,this}circle(t,e,i,r){return this.instructions.push({action:"circle",data:[t,e,i,r]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,i,r,a,h,l){a||(a=r/2);const c=-1*Math.PI/2+h,f=i*2,d=Math.PI*2/f,g=[];for(let x=0;x<f;x++){const _=x%2?a:r,v=x*d+c;g.push(t+_*Math.cos(v),e+_*Math.sin(v))}return this.poly(g,!0,l),this}clone(t=!1){const e=new Pi;if(e.checkForHoles=this.checkForHoles,!t)e.instructions=this.instructions.slice();else for(let i=0;i<this.instructions.length;i++){const r=this.instructions[i];e.instructions.push({action:r.action,data:r.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,i=t.b,r=t.c,a=t.d,h=t.tx,l=t.ty;let c=0,f=0,d=0,g=0,x=0,_=0,v=0,T=0;for(let w=0;w<this.instructions.length;w++){const A=this.instructions[w],I=A.data;switch(A.action){case"moveTo":case"lineTo":c=I[0],f=I[1],I[0]=e*c+r*f+h,I[1]=i*c+a*f+l;break;case"bezierCurveTo":d=I[0],g=I[1],x=I[2],_=I[3],c=I[4],f=I[5],I[0]=e*d+r*g+h,I[1]=i*d+a*g+l,I[2]=e*x+r*_+h,I[3]=i*x+a*_+l,I[4]=e*c+r*f+h,I[5]=i*c+a*f+l;break;case"quadraticCurveTo":d=I[0],g=I[1],c=I[2],f=I[3],I[0]=e*d+r*g+h,I[1]=i*d+a*g+l,I[2]=e*c+r*f+h,I[3]=i*c+a*f+l;break;case"arcToSvg":c=I[5],f=I[6],v=I[0],T=I[1],I[0]=e*v+r*T,I[1]=i*v+a*T,I[5]=e*c+r*f+h,I[6]=i*c+a*f+l;break;case"circle":I[4]=Tn(I[3],t);break;case"rect":I[4]=Tn(I[4],t);break;case"ellipse":I[8]=Tn(I[8],t);break;case"roundRect":I[5]=Tn(I[5],t);break;case"addPath":I[0].transform(t);break;case"poly":I[2]=Tn(I[2],t);break;default:Ot("unknown transform action",A.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,i=this.instructions[e];if(!i)return t.x=0,t.y=0,t;for(;i.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;i=this.instructions[e]}switch(i.action){case"moveTo":case"lineTo":t.x=i.data[0],t.y=i.data[1];break;case"quadraticCurveTo":t.x=i.data[2],t.y=i.data[3];break;case"bezierCurveTo":t.x=i.data[4],t.y=i.data[5];break;case"arc":case"arcToSvg":t.x=i.data[5],t.y=i.data[6];break;case"addPath":i.data[0].getLastPoint(t);break}return t}}function Tn(s,t){return s?s.prepend(t):t.clone()}function zt(s,t,e){const i=s.getAttribute(t);return i?Number(i):e}function CA(s,t){const e=s.querySelectorAll("defs");for(let i=0;i<e.length;i++){const r=e[i];for(let a=0;a<r.children.length;a++){const h=r.children[a];switch(h.nodeName.toLowerCase()){case"lineargradient":t.defs[h.id]=MA(h);break;case"radialgradient":t.defs[h.id]=PA();break}}}}function MA(s){const t=zt(s,"x1",0),e=zt(s,"y1",0),i=zt(s,"x2",1),r=zt(s,"y2",0),a=s.getAttribute("gradientUnits")||"objectBoundingBox",h=new Ei(t,e,i,r,a==="objectBoundingBox"?"local":"global");for(let l=0;l<s.children.length;l++){const c=s.children[l],f=zt(c,"offset",0),d=te.shared.setValue(c.getAttribute("stop-color")).toNumber();h.addColorStop(f,d)}return h}function PA(s){return Ot("[SVG Parser] Radial gradients are not yet supported"),new Ei(0,0,1,0)}function Dd(s){const t=s.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const Wd={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function yp(s,t){const e=s.getAttribute("style"),i={},r={},a={strokeStyle:i,fillStyle:r,useFill:!1,useStroke:!1};for(const h in Wd){const l=s.getAttribute(h);l&&Ud(t,a,h,l.trim())}if(e){const h=e.split(";");for(let l=0;l<h.length;l++){const c=h[l].trim(),[f,d]=c.split(":");Wd[f]&&Ud(t,a,f,d.trim())}}return{strokeStyle:a.useStroke?i:null,fillStyle:a.useFill?r:null,useFill:a.useFill,useStroke:a.useStroke}}function Ud(s,t,e,i){switch(e){case"stroke":if(i!=="none"){if(i.startsWith("url(")){const r=Dd(i);t.strokeStyle.fill=s.defs[r]}else t.strokeStyle.color=te.shared.setValue(i).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(i);break;case"fill":if(i!=="none"){if(i.startsWith("url(")){const r=Dd(i);t.fillStyle.fill=s.defs[r]}else t.fillStyle.color=te.shared.setValue(i).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(i);break;case"stroke-opacity":t.strokeStyle.alpha=Number(i);break;case"opacity":t.fillStyle.alpha=Number(i),t.strokeStyle.alpha=Number(i);break}}function EA(s){if(s.length<=2)return!0;const t=s.map(l=>l.area).sort((l,c)=>c-l),[e,i]=t,r=t[t.length-1],a=e/i,h=i/r;return!(a>3&&h<2)}function kA(s){return s.split(/(?=[Mm])/).filter(i=>i.trim().length>0)}function IA(s){const t=s.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!t||t.length<4)return 0;const e=t.map(Number),i=[],r=[];for(let d=0;d<e.length;d+=2)d+1<e.length&&(i.push(e[d]),r.push(e[d+1]));if(i.length===0||r.length===0)return 0;const a=Math.min(...i),h=Math.max(...i),l=Math.min(...r),c=Math.max(...r);return(h-a)*(c-l)}function Hd(s,t){const e=new Pi(s,!1);for(const i of e.instructions)t.instructions.push(i)}function RA(s,t){if(typeof s=="string"){const h=document.createElement("div");h.innerHTML=s.trim(),s=h.querySelector("svg")}const e={context:t,defs:{},path:new Pi};CA(s,e);const i=s.children,{fillStyle:r,strokeStyle:a}=yp(s,e);for(let h=0;h<i.length;h++){const l=i[h];l.nodeName.toLowerCase()!=="defs"&&bp(l,e,r,a)}return t}function bp(s,t,e,i){const r=s.children,{fillStyle:a,strokeStyle:h}=yp(s,t);a&&e?e={...e,...a}:a&&(e=a),h&&i?i={...i,...h}:h&&(i=h);const l=!e&&!i;l&&(e={color:0});let c,f,d,g,x,_,v,T,w,A,I,M,P,L,R,G,Y;switch(s.nodeName.toLowerCase()){case"path":{L=s.getAttribute("d");const q=s.getAttribute("fill-rule"),H=kA(L),U=q==="evenodd",K=H.length>1;if(U&&K){const J=H.map(N=>({path:N,area:IA(N)}));if(J.sort((N,z)=>z.area-N.area),H.length>3||!EA(J))for(let N=0;N<J.length;N++){const z=J[N],rt=N===0;t.context.beginPath();const $=new Pi(void 0,!0);Hd(z.path,$),t.context.path($),rt?(e&&t.context.fill(e),i&&t.context.stroke(i)):t.context.cut()}else for(let N=0;N<J.length;N++){const z=J[N],rt=N%2===1;t.context.beginPath();const $=new Pi(void 0,!0);Hd(z.path,$),t.context.path($),rt?t.context.cut():(e&&t.context.fill(e),i&&t.context.stroke(i))}}else{const J=q?q==="evenodd":!0;R=new Pi(L,J),t.context.path(R),e&&t.context.fill(e),i&&t.context.stroke(i)}break}case"circle":v=zt(s,"cx",0),T=zt(s,"cy",0),w=zt(s,"r",0),t.context.ellipse(v,T,w,w),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"rect":c=zt(s,"x",0),f=zt(s,"y",0),G=zt(s,"width",0),Y=zt(s,"height",0),A=zt(s,"rx",0),I=zt(s,"ry",0),A||I?t.context.roundRect(c,f,G,Y,A||I):t.context.rect(c,f,G,Y),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"ellipse":v=zt(s,"cx",0),T=zt(s,"cy",0),A=zt(s,"rx",0),I=zt(s,"ry",0),t.context.beginPath(),t.context.ellipse(v,T,A,I),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"line":d=zt(s,"x1",0),g=zt(s,"y1",0),x=zt(s,"x2",0),_=zt(s,"y2",0),t.context.beginPath(),t.context.moveTo(d,g),t.context.lineTo(x,_),i&&t.context.stroke(i);break;case"polygon":P=s.getAttribute("points"),M=P.match(/-?\d+/g).map(q=>parseInt(q,10)),t.context.poly(M,!0),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"polyline":P=s.getAttribute("points"),M=P.match(/-?\d+/g).map(q=>parseInt(q,10)),t.context.poly(M,!1),i&&t.context.stroke(i);break;case"g":case"svg":break;default:{Ot(`[SVG parser] <${s.nodeName}> elements unsupported`);break}}l&&(e=null);for(let q=0;q<r.length;q++)bp(r[q],t,e,i)}const zd={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class _o{constructor(t,e){this.uid=Yt("fillPattern"),this._tick=0,this.transform=new pt,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=zd[e].addressModeU,t.source.style.addressModeV=zd[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._tick++}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}function LA(s){return te.isColorLike(s)}function Nd(s){return s instanceof _o}function Yd(s){return s instanceof Ei}function BA(s){return s instanceof ht}function FA(s,t,e){const i=te.shared.setValue(t??0);return s.color=i.toNumber(),s.alpha=i.alpha===1?e.alpha:i.alpha,s.texture=ht.WHITE,{...e,...s}}function GA(s,t,e){return s.texture=t,{...e,...s}}function Xd(s,t,e){return s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,{...e,...s}}function $d(s,t,e){return t.buildGradient(),s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,s.textureSpace=t.textureSpace,{...e,...s}}function OA(s,t){const e={...t,...s},i=te.shared.setValue(e.color);return e.alpha*=i.alpha,e.color=i.toNumber(),e}function fs(s,t){if(s==null)return null;const e={},i=s;return LA(s)?FA(e,s,t):BA(s)?GA(e,s,t):Nd(s)?Xd(e,s,t):Yd(s)?$d(e,s,t):i.fill&&Nd(i.fill)?Xd(i,i.fill,t):i.fill&&Yd(i.fill)?$d(i,i.fill,t):OA(i,t)}function ho(s,t){const{width:e,alignment:i,miterLimit:r,cap:a,join:h,pixelLine:l,...c}=t,f=fs(s,c);return f?{width:e,alignment:i,miterLimit:r,cap:a,join:h,pixelLine:l,...f}:null}const DA=new qt,Vd=new pt,sl=class di extends fi{constructor(){super(...arguments),this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this.uid=Yt("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this.destroyed=!1,this._activePath=new Pi,this._transform=new pt,this._fillStyle={...di.defaultFillStyle},this._strokeStyle={...di.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new Re,this._boundsDirty=!0}clone(){const t=new di;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=fs(t,di.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=ho(t,di.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=fs(t,di.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=fs(t,di.defaultStrokeStyle),this}texture(t,e,i,r,a,h){return this.instructions.push({action:"texture",data:{image:t,dx:i||0,dy:r||0,dw:a||t.frame.width,dh:h||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e||e===0?te.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new Pi,this}fill(t,e){let i;const r=this.instructions[this.instructions.length-1];return this._tick===0&&r?.action==="stroke"?i=r.data.path:i=this._activePath.clone(),i?(t!=null&&(e!==void 0&&typeof t=="number"&&(wt(Nt,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=fs(t,di.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:i}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(qt.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const i=this.instructions[this.instructions.length-1];return this._tick===0&&i?.action==="fill"?e=i.data.path:e=this._activePath.clone(),e?(t!=null&&(this._strokeStyle=ho(t,di.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],i=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(i);else{e.data.hole=i;break}}return this._initNextPathLocation(),this}arc(t,e,i,r,a,h){this._tick++;const l=this._transform;return this._activePath.arc(l.a*t+l.c*e+l.tx,l.b*t+l.d*e+l.ty,i,r,a,h),this}arcTo(t,e,i,r,a){this._tick++;const h=this._transform;return this._activePath.arcTo(h.a*t+h.c*e+h.tx,h.b*t+h.d*e+h.ty,h.a*i+h.c*r+h.tx,h.b*i+h.d*r+h.ty,a),this}arcToSvg(t,e,i,r,a,h,l){this._tick++;const c=this._transform;return this._activePath.arcToSvg(t,e,i,r,a,c.a*h+c.c*l+c.tx,c.b*h+c.d*l+c.ty),this}bezierCurveTo(t,e,i,r,a,h,l){this._tick++;const c=this._transform;return this._activePath.bezierCurveTo(c.a*t+c.c*e+c.tx,c.b*t+c.d*e+c.ty,c.a*i+c.c*r+c.tx,c.b*i+c.d*r+c.ty,c.a*a+c.c*h+c.tx,c.b*a+c.d*h+c.ty,l),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(t,e,i,r){return this._tick++,this._activePath.ellipse(t,e,i,r,this._transform.clone()),this}circle(t,e,i){return this._tick++,this._activePath.circle(t,e,i,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const i=this._transform;return this._activePath.lineTo(i.a*t+i.c*e+i.tx,i.b*t+i.d*e+i.ty),this}moveTo(t,e){this._tick++;const i=this._transform,r=this._activePath.instructions,a=i.a*t+i.c*e+i.tx,h=i.b*t+i.d*e+i.ty;return r.length===1&&r[0].action==="moveTo"?(r[0].data[0]=a,r[0].data[1]=h,this):(this._activePath.moveTo(a,h),this)}quadraticCurveTo(t,e,i,r,a){this._tick++;const h=this._transform;return this._activePath.quadraticCurveTo(h.a*t+h.c*e+h.tx,h.b*t+h.d*e+h.ty,h.a*i+h.c*r+h.tx,h.b*i+h.d*r+h.ty,a),this}rect(t,e,i,r){return this._tick++,this._activePath.rect(t,e,i,r,this._transform.clone()),this}roundRect(t,e,i,r,a){return this._tick++,this._activePath.roundRect(t,e,i,r,a,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,i,r,a=0,h){return this._tick++,this._activePath.regularPoly(t,e,i,r,a,h),this}roundPoly(t,e,i,r,a,h){return this._tick++,this._activePath.roundPoly(t,e,i,r,a,h),this}roundShape(t,e,i,r){return this._tick++,this._activePath.roundShape(t,e,i,r),this}filletRect(t,e,i,r,a){return this._tick++,this._activePath.filletRect(t,e,i,r,a),this}chamferRect(t,e,i,r,a,h){return this._tick++,this._activePath.chamferRect(t,e,i,r,a,h),this}star(t,e,i,r,a=0,h=0){return this._tick++,this._activePath.star(t,e,i,r,a,h,this._transform.clone()),this}svg(t){return this._tick++,RA(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,i,r,a,h){return t instanceof pt?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,i,r,a,h),this)}transform(t,e,i,r,a,h){return t instanceof pt?(this._transform.append(t),this):(Vd.set(t,e,i,r,a,h),this._transform.append(Vd),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,!this.dirty&&(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const i=this.instructions[e],r=i.action;if(r==="fill"){const a=i.data;t.addBounds(a.path.bounds)}else if(r==="texture"){const a=i.data;t.addFrame(a.dx,a.dy,a.dx+a.dw,a.dy+a.dh,a.transform)}if(r==="stroke"){const a=i.data,h=a.style.alignment,l=a.style.width*(1-h),c=a.path.bounds;t.addFrame(c.minX-l,c.minY-l,c.maxX+l,c.maxY+l)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let i=!1;for(let r=0;r<e.length;r++){const a=e[r],h=a.data,l=h.path;if(!a.action||!l)continue;const c=h.style,f=l.shapePath.shapePrimitives;for(let d=0;d<f.length;d++){const g=f[d].shape;if(!c||!g)continue;const x=f[d].transform,_=x?x.applyInverse(t,DA):t;if(a.action==="fill")i=g.contains(_.x,_.y);else{const T=c;i=g.strokeContains(_.x,_.y,T.width,T.alignment)}const v=h.hole;if(v){const T=v.shapePath?.shapePrimitives;if(T)for(let w=0;w<T.length;w++)T[w].shape.contains(_.x,_.y)&&(i=!1)}if(i)return!0}}return i}unload(){this.emit("unload",this);for(const t in this._gpuData)this._gpuData[t]?.destroy();this._gpuData=Object.create(null)}destroy(t=!1){if(this.destroyed)return;if(this.destroyed=!0,this._stateStack.length=0,this._transform=null,this.unload(),this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){const i=typeof t=="boolean"?t:t?.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(i)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(i))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};sl.defaultFillStyle={color:16777215,alpha:1,texture:ht.WHITE,matrix:null,fill:null,textureSpace:"local"};sl.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:ht.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let Ne=sl;function nl(s,t=1){const e=Zs.RETINA_PREFIX?.exec(s);return e?parseFloat(e[1]):t}function rl(s,t,e){s.label=e,s._sourceOrigin=e;const i=new ht({source:s,label:e}),r=()=>{delete t.promiseCache[e],ne.has(e)&&ne.remove(e)};return i.source.once("destroy",()=>{t.promiseCache[e]&&(Ot("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),r())}),i.once("destroy",()=>{s.destroyed||(Ot("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),r())}),i}const WA=".svg",UA="image/svg+xml",HA={extension:{type:V.LoadParser,priority:ji.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(s){return Ks(s,UA)||Js(s,WA)},async load(s,t,e){return t.data?.parseAsGraphicsContext??this.config.parseAsGraphicsContext?NA(s):zA(s,t,e,this.config.crossOrigin)},unload(s){s.destroy(!0)}};async function zA(s,t,e,i){const r=await Lt.get().fetch(s),a=Lt.get().createImage();a.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await r.text())}`,a.crossOrigin=i,await a.decode();const h=t.data?.width??a.width,l=t.data?.height??a.height,c=t.data?.resolution||nl(s),f=Math.ceil(h*c),d=Math.ceil(l*c),g=Lt.get().createCanvas(f,d),x=g.getContext("2d");x.imageSmoothingEnabled=!0,x.imageSmoothingQuality="high",x.drawImage(a,0,0,h*c,l*c);const{parseAsGraphicsContext:_,...v}=t.data??{},T=new qs({resource:g,alphaMode:"premultiply-alpha-on-upload",resolution:c,...v});return rl(T,e,s)}async function NA(s){const e=await(await Lt.get().fetch(s)).text(),i=new Ne;return i.svg(e),i}const YA=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function") return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let Ns=null,Gh=class{constructor(){Ns||(Ns=URL.createObjectURL(new Blob([YA],{type:"application/javascript"}))),this.worker=new Worker(Ns)}};Gh.revokeObjectURL=function(){Ns&&(URL.revokeObjectURL(Ns),Ns=null)};const XA=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let Ys=null;class vp{constructor(){Ys||(Ys=URL.createObjectURL(new Blob([XA],{type:"application/javascript"}))),this.worker=new Worker(Ys)}}vp.revokeObjectURL=function(){Ys&&(URL.revokeObjectURL(Ys),Ys=null)};let qd=0,ph;class $A{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new Gh;e.addEventListener("message",i=>{e.terminate(),Gh.revokeObjectURL(),t(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t,e){return this._run("loadImageBitmap",[t,e?.data?.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){ph===void 0&&(ph=navigator.hardwareConcurrency||4);let t=this._workerPool.pop();return!t&&this._createdWorkers<ph&&(this._createdWorkers++,t=new vp().worker,t.addEventListener("message",e=>{this._complete(e.data),this._returnWorker(e.target),this._next()})),t}_returnWorker(t){this._workerPool.push(t)}_complete(t){this._resolveHash[t.uuid]&&(t.error!==void 0?this._resolveHash[t.uuid].reject(t.error):this._resolveHash[t.uuid].resolve(t.data),delete this._resolveHash[t.uuid])}async _run(t,e){await this._initWorkers();const i=new Promise((r,a)=>{this._queue.push({id:t,arguments:e,resolve:r,reject:a})});return this._next(),i}_next(){if(!this._queue.length)return;const t=this._getWorker();if(!t)return;const e=this._queue.pop(),i=e.id;this._resolveHash[qd]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:qd++,id:i})}reset(){this._workerPool.forEach(t=>t.terminate()),this._workerPool.length=0,Object.values(this._resolveHash).forEach(({reject:t})=>{t?.(new Error("WorkerManager has been reset before completion"))}),this._resolveHash={},this._queue.length=0,this._initialized=!1,this._createdWorkers=0}}const jd=new $A,VA=[".jpeg",".jpg",".png",".webp",".avif"],qA=["image/jpeg","image/png","image/webp","image/avif"];async function jA(s,t){const e=await Lt.get().fetch(s);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${e.status} ${e.statusText}`);const i=await e.blob();return t?.data?.alphaMode==="premultiplied-alpha"?createImageBitmap(i,{premultiplyAlpha:"none"}):createImageBitmap(i)}const wp={name:"loadTextures",id:"texture",extension:{type:V.LoadParser,priority:ji.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return Ks(s,qA)||Js(s,VA)},async load(s,t,e){let i=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await jd.isImageBitmapSupported()?i=await jd.loadImageBitmap(s,t):i=await jA(s,t):i=await new Promise((a,h)=>{i=Lt.get().createImage(),i.crossOrigin=this.config.crossOrigin,i.src=s,i.complete?a(i):(i.onload=()=>{a(i)},i.onerror=h)});const r=new qs({resource:i,alphaMode:"premultiply-alpha-on-upload",resolution:t.data?.resolution||nl(s),...t.data});return rl(r,e,s)},unload(s){s.destroy(!0)}},ZA=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"];let gh,mh;function KA(s,t,e){e===void 0&&!t.startsWith("data:")?s.crossOrigin=QA(t):e!==!1&&(s.crossOrigin=typeof e=="string"?e:"anonymous")}function JA(s){return new Promise((t,e)=>{s.addEventListener("canplaythrough",i),s.addEventListener("error",r),s.load();function i(){a(),t()}function r(h){a(),e(h)}function a(){s.removeEventListener("canplaythrough",i),s.removeEventListener("error",r)}})}function QA(s,t=globalThis.location){if(s.startsWith("data:"))return"";t||(t=globalThis.location);const e=new URL(s,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function tT(){const s=[],t=[];for(const e of ZA){const i=Rn.MIME_TYPES[e.substring(1)]||`video/${e.substring(1)}`;go(i)&&(s.push(e),t.includes(i)||t.push(i))}return{validVideoExtensions:s,validVideoMime:t}}const eT={name:"loadVideo",id:"video",extension:{type:V.LoadParser,name:"loadVideo"},test(s){if(!gh||!mh){const{validVideoExtensions:i,validVideoMime:r}=tT();gh=i,mh=r}const t=Ks(s,mh),e=Js(s,gh);return t||e},async load(s,t,e){const i={...Rn.defaultOptions,resolution:t.data?.resolution||nl(s),alphaMode:t.data?.alphaMode||await If(),...t.data},r=document.createElement("video"),a={preload:i.autoLoad!==!1?"auto":void 0,"webkit-playsinline":i.playsinline!==!1?"":void 0,playsinline:i.playsinline!==!1?"":void 0,muted:i.muted===!0?"":void 0,loop:i.loop===!0?"":void 0,autoplay:i.autoPlay!==!1?"":void 0};Object.keys(a).forEach(c=>{const f=a[c];f!==void 0&&r.setAttribute(c,f)}),i.muted===!0&&(r.muted=!0),KA(r,s,i.crossorigin);const h=document.createElement("source");let l;if(i.mime)l=i.mime;else if(s.startsWith("data:"))l=s.slice(5,s.indexOf(";"));else if(!s.startsWith("blob:")){const c=s.split("?")[0].slice(s.lastIndexOf(".")+1).toLowerCase();l=Rn.MIME_TYPES[c]||`video/${c}`}return h.src=s,l&&(h.type=l),new Promise((c,f)=>{i.preload&&!i.autoPlay&&r.load(),r.addEventListener("canplay",d),r.addEventListener("error",g),h.addEventListener("error",g),r.appendChild(h);async function d(){const _=new Rn({...i,resource:r});x(),t.data.preload&&await JA(r),c(rl(_,e,s))}function g(_){x(),f(_)}function x(){r.removeEventListener("canplay",d),r.removeEventListener("error",g),h.removeEventListener("error",g)}})},unload(s){s.destroy(!0)}},Sp={extension:{type:V.ResolveParser,name:"resolveTexture"},test:wp.test,parse:s=>({resolution:parseFloat(Zs.RETINA_PREFIX.exec(s)?.[1]??"1"),format:s.split(".").pop(),src:s})},iT={extension:{type:V.ResolveParser,priority:-2,name:"resolveJson"},test:s=>Zs.RETINA_PREFIX.test(s)&&s.endsWith(".json"),parse:Sp.parse};class sT{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Zs,this.loader=new kw,this.cache=ne,this._backgroundLoader=new vw(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized){Ot("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let a=t.manifest;typeof a=="string"&&(a=await this.load(a)),this.resolver.addManifest(a)}const e=t.texturePreference?.resolution??1,i=typeof e=="number"?[e]:e,r=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:r,resolution:i}}),t.preferences&&this.setPreferences(t.preferences),t.loadOptions&&(this.loader.loadOptions={...this.loader.loadOptions,...t.loadOptions})}add(t){this.resolver.add(t)}async load(t,e){this._initialized||await this.init();const i=oo(t),r=ei(t).map(l=>{if(typeof l!="string"){const c=this.resolver.getAlias(l);return c.some(f=>!this.resolver.hasKey(f))&&this.add(l),Array.isArray(c)?c[0]:c}return this.resolver.hasKey(l)||this.add({alias:l,src:l}),l}),a=this.resolver.resolve(r),h=await this._mapLoadToResolve(a,e);return i?h[r[0]]:h}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const r=this.resolver.resolveBundle(t),a={},h=Object.keys(r);let l=0;const c=[],f=()=>{e?.(c.reduce((g,x)=>g+x,0)/l)},d=h.map((g,x)=>{const _=r[g],v=Object.values(_),w=[...new Set(v.flat())].reduce((A,I)=>A+(I.progressSize||1),0);return c.push(0),l+=w,this._mapLoadToResolve(_,A=>{c[x]=A*w,f()}).then(A=>{a[g]=A})});return await Promise.all(d),i?a[t[0]]:a}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return ne.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=ne.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=[...new Set(Object.values(t))];this._backgroundLoader.active=!1;const r=await this.loader.load(i,e);this._backgroundLoader.active=!0;const a={};return i.forEach(h=>{const l=r[h.src],c=[h.src];h.alias&&c.push(...h.alias),c.forEach(f=>{a[f]=l}),ne.set(c,l)}),a}async unload(t){this._initialized||await this.init();const e=ei(t).map(r=>typeof r!="string"?r.src:r),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=ei(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(r=>this._unloadFromResolved(e[r]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{ne.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,r)=>e.indexOf(i)===r),e}get detections(){return this._detections}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}}const Ws=new sT;Mt.handleByList(V.LoadParser,Ws.loader.parsers).handleByList(V.ResolveParser,Ws.resolver.parsers).handleByList(V.CacheParser,Ws.cache.parsers).handleByList(V.DetectionParser,Ws.detections);Mt.add(ww,Aw,Sw,Ew,Cw,Mw,Pw,Lw,Gw,Yw,HA,wp,eT,bw,yw,Sp,iT);const Zd={loader:V.LoadParser,resolver:V.ResolveParser,cache:V.CacheParser,detection:V.DetectionParser};Mt.handle(V.Asset,s=>{const t=s.ref;Object.entries(Zd).filter(([e])=>!!t[e]).forEach(([e,i])=>Mt.add(Object.assign(t[e],{extension:t[e].extension??i})))},s=>{const t=s.ref;Object.keys(Zd).filter(e=>!!t[e]).forEach(e=>Mt.remove(t[e]))});class nT{constructor(){this.isBatchable=!1}reset(){this.isBatchable=!1,this.context=null,this.graphicsData&&(this.graphicsData.destroy(),this.graphicsData=null)}destroy(){this.reset()}}class rT{constructor(){this.instructions=new $h}init(){this.instructions.reset()}destroy(){this.instructions.destroy(),this.instructions=null}}const ol=class Oh{constructor(t){this._renderer=t,this._managedContexts=new $n({renderer:t,type:"resource",name:"graphicsContext"})}init(t){Oh.defaultOptions.bezierSmoothness=t?.bezierSmoothness??Oh.defaultOptions.bezierSmoothness}getContextRenderData(t){return this.getGpuContext(t).graphicsData||this._initContextRenderData(t)}updateGpuContext(t){const e=t._gpuData,i=!!e[this._renderer.uid],r=e[this._renderer.uid]||this._initContext(t);return(t.dirty||!i)&&(i&&r.reset(),r.isBatchable=!1,t.dirty=!1),r}getGpuContext(t){return t._gpuData[this._renderer.uid]||this._initContext(t)}_initContextRenderData(t){const e=new rT,i=this.getGpuContext(t);return i.graphicsData=e,e.init(),e}_initContext(t){const e=new nT;return e.context=t,t._gpuData[this._renderer.uid]=e,this._managedContexts.add(t),e}destroy(){this._managedContexts.destroy(),this._renderer=null}};ol.extension={type:[V.CanvasSystem],name:"graphicsContext"};ol.defaultOptions={bezierSmoothness:.5};let oT=ol;class Ap{constructor(t,e){this.state=jh.for2d(),this.renderer=t,this._adaptor=e,this.renderer.runners.contextChange.add(this),this._managedGraphics=new $n({renderer:t,type:"renderable",priority:-1,name:"graphics"})}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){return!1}addRenderable(t,e){this._managedGraphics.add(t),this.renderer.renderPipes.batch.break(e),e.add(t)}updateRenderable(t){}execute(t){t.isRenderable&&this._adaptor.execute(this,t)}destroy(){this._managedGraphics.destroy(),this.renderer=null,this._adaptor.destroy(),this._adaptor=null}}Ap.extension={type:[V.CanvasPipes],name:"graphics"};function aT(s,t,e){const i=(s>>24&255)/255;t[e++]=(s&255)/255*i,t[e++]=(s>>8&255)/255*i,t[e++]=(s>>16&255)/255*i,t[e++]=i}class hT{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(t=>{be.return(t)}),this.batches.length=0}}class Tp{constructor(t,e){this.state=jh.for2d(),this.renderer=t,this._adaptor=e,this.renderer.runners.contextChange.add(this),this._managedGraphics=new $n({renderer:t,type:"renderable",priority:-1,name:"graphics"})}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){const e=t.context,i=!!t._gpuData,a=this.renderer.graphicsContext.updateGpuContext(e);return!!(a.isBatchable||i!==a.isBatchable)}addRenderable(t,e){const r=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this._rebuild(t),r.isBatchable?this._addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){const i=this._getGpuDataForRenderable(t).batches;for(let r=0;r<i.length;r++){const a=i[r];a._batcher.updateElement(a)}}execute(t){if(!t.isRenderable)return;const e=this.renderer,i=t.context;if(!e.graphicsContext.getGpuContext(i).batches.length)return;const a=i.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;const h=a.resources.localUniforms.uniforms;h.uTransformMatrix=t.groupTransform,h.uRound=e._roundPixels|t._roundPixels,aT(t.groupColorAlpha,h.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){const e=this._getGpuDataForRenderable(t),r=this.renderer.graphicsContext.updateGpuContext(t.context);e.destroy(),r.isBatchable&&this._updateBatchesForRenderable(t,e)}_addToBatcher(t,e){const i=this.renderer.renderPipes.batch,r=this._getGpuDataForRenderable(t).batches;for(let a=0;a<r.length;a++){const h=r[a];i.addToBatch(h,e)}}_getGpuDataForRenderable(t){return t._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(t)}_initGpuDataForRenderable(t){const e=new hT;return t._gpuData[this.renderer.uid]=e,this._managedGraphics.add(t),e}_updateBatchesForRenderable(t,e){const i=t.context,a=this.renderer.graphicsContext.getGpuContext(i),h=this.renderer._roundPixels|t._roundPixels;e.batches=a.batches.map(l=>{const c=be.get(Qh);return l.copyTo(c),c.renderable=t,c.roundPixels=h,c})}destroy(){this._managedGraphics.destroy(),this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}}Tp.extension={type:[V.WebGLPipes,V.WebGPUPipes],name:"graphics"};Mt.add(Ap);Mt.add(Tp);Mt.add(oT);Mt.add(il);class ve extends fo{constructor(t){t instanceof Ne&&(t={context:t});const{context:e,roundPixels:i,...r}=t||{};super({label:"Graphics",...r}),this.renderPipeId="graphics",e?this.context=e:(this.context=this._ownedContext=new Ne,this.context.autoGarbageCollect=this.autoGarbageCollect),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=i??!1}set context(t){t!==this._context&&(this._context&&(this._context.off("update",this.onViewUpdate,this),this._context.off("unload",this.unload,this)),this._context=t,this._context.on("update",this.onViewUpdate,this),this._context.on("unload",this.unload,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||t?.context===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_onTouch(t){this._gcLastUsed=t,this._context._gcLastUsed=t}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new ve(this._context.clone()):(this._ownedContext=null,new ve(this._context))}lineStyle(t,e,i){wt(Nt,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const r={};return t&&(r.width=t),e&&(r.color=e),i&&(r.alpha=i),this.context.strokeStyle=r,this}beginFill(t,e){wt(Nt,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const i={};return t!==void 0&&(i.color=t),e!==void 0&&(i.alpha=e),this.context.fillStyle=i,this}endFill(){wt(Nt,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==Ne.defaultStrokeStyle.width||t.color!==Ne.defaultStrokeStyle.color||t.alpha!==Ne.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return wt(Nt,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return wt(Nt,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return wt(Nt,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return wt(Nt,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return wt(Nt,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return wt(Nt,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}class lT extends fo{constructor(t,e){const{text:i,resolution:r,style:a,anchor:h,width:l,height:c,roundPixels:f,...d}=t;super({...d}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=e,this.text=i??"",this.style=a,this.resolution=r??null,this.allowChildren=!1,this._anchor=new he({_onUpdate:()=>{this.onViewUpdate()}}),h&&(this.anchor=h),this.roundPixels=f??!1,l!==void 0&&(this.width=l),c!==void 0&&(this.height=c)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}set text(t){t=t.toString(),this._text!==t&&(this._text=t,this.onViewUpdate())}get text(){return this._text}set resolution(t){this._autoResolution=t===null,this._resolution=t,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(t){t||(t={}),this._style?.off("update",this.onViewUpdate,this),t instanceof this._styleClass?this._style=t:this._style=new this._styleClass(t),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(t){this._setWidth(t,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(t){this._setHeight(t,this.bounds.height)}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this.bounds.width,t.height=Math.abs(this.scale.y)*this.bounds.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this.bounds.width),e!==void 0&&this._setHeight(e,this.bounds.height)}containsPoint(t){const e=this.bounds.width,i=this.bounds.height,r=-e*this.anchor.x;let a=0;return t.x>=r&&t.x<=r+e&&(a=-i*this.anchor.y,t.y>=a&&t.y<=a+i)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}destroy(t=!1){super.destroy(t),this.owner=null,this._bounds=null,this._anchor=null,(typeof t=="boolean"?t:t?.style)&&this._style.destroy(t),this._style=null,this._text=null}get styleKey(){return`${this._text}:${this._style.styleKey}:${this._resolution}`}}function uT(s,t){let e=s[0]??{};return(typeof e=="string"||s[1])&&(wt(Nt,`use new ${t}({ text: "hi!", style }) instead`),e={text:e,style:s[1]}),e}class cT{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const i=Lt.get().createCanvas();i.width=t,i.height=e;const r=i.getContext("2d");return{canvas:i,context:r}}getOptimalCanvasAndContext(t,e,i=1){t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),t=Xs(t),e=Xs(e);const r=(t<<17)+(e<<1);this._canvasPool[r]||(this._canvasPool[r]=[]);let a=this._canvasPool[r].pop();return a||(a=this._createCanvasAndContext(t,e)),a}returnCanvasAndContext(t){const e=t.canvas,{width:i,height:r}=e,a=(i<<17)+(r<<1);t.context.resetTransform(),t.context.clearRect(0,0,i,r),this._canvasPool[a].push(t)}clear(){this._canvasPool={}}}const Dh=new cT;zn.register(Dh);let os=null,Ti=null;function dT(s,t){os||(os=Lt.get().createCanvas(256,128),Ti=os.getContext("2d",{willReadFrequently:!0}),Ti.globalCompositeOperation="copy",Ti.globalAlpha=1),(os.width<s||os.height<t)&&(os.width=Xs(s),os.height=Xs(t))}function Kd(s,t,e){for(let i=0,r=4*e*t;i<t;++i,r+=4)if(s[r+3]!==0)return!1;return!0}function Jd(s,t,e,i,r){const a=4*t;for(let h=i,l=i*a+4*e;h<=r;++h,l+=a)if(s[l+3]!==0)return!1;return!0}function fT(...s){let t=s[0];t.canvas||(t={canvas:s[0],resolution:s[1]});const{canvas:e}=t,i=Math.min(t.resolution??1,1),r=t.width??e.width,a=t.height??e.height;let h=t.output;if(dT(r,a),!Ti)throw new TypeError("Failed to get canvas 2D context");Ti.drawImage(e,0,0,r,a,0,0,r*i,a*i);const c=Ti.getImageData(0,0,r,a).data;let f=0,d=0,g=r-1,x=a-1;for(;d<a&&Kd(c,r,d);)++d;if(d===a)return kt.EMPTY;for(;Kd(c,r,x);)--x;for(;Jd(c,r,f,d,x);)++f;for(;Jd(c,r,g,d,x);)--g;return++g,++x,Ti.globalCompositeOperation="source-over",Ti.strokeRect(f,d,g-f,x-d),Ti.globalCompositeOperation="copy",h??(h=new kt),h.set(f/i,d/i,(g-f)/i,(x-d)/i),h}class pT{constructor(t=0,e=0,i=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=i,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){const e=new Array(t.length);for(let i=0;i<t.length;i++){const r=t[i];e[i]=[r,this.get(r)]}return e}evict(t=!1){if(t||this.size>0){const e=this.first;delete this.items[e.key],--this.size===0?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){const e=this.items[t];if(e!==void 0){if(this.ttl>0&&e.expiry<=Date.now()){this.delete(t);return}return this.moveToEnd(e),e.value}}has(t){return t in this.items}moveToEnd(t){this.last!==t&&(t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),t.prev=this.last,t.next=null,this.last!==null&&(this.last.next=t),this.last=t,this.first===null&&(this.first=t))}keys(){const t=new Array(this.size);let e=this.first,i=0;for(;e!==null;)t[i++]=e.key,e=e.next;return t}setWithEvicted(t,e,i=this.resetTtl){let r=null;if(this.has(t))this.set(t,e,!0,i);else{this.max>0&&this.size===this.max&&(r={...this.first},this.evict(!0));let a=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e};++this.size===1?this.first=a:this.last.next=a,this.last=a}return r}set(t,e,i=!1,r=this.resetTtl){let a=this.items[t];return i||a!==void 0?(a.value=e,i===!1&&r&&(a.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.moveToEnd(a)):(this.max>0&&this.size===this.max&&this.evict(!0),a=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},++this.size===1?this.first=a:this.last.next=a,this.last=a),this}values(t=this.keys()){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=this.get(t[i]);return e}}function gT(s=1e3,t=0,e=!1){if(isNaN(s)||s<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if(typeof e!="boolean")throw new TypeError("Invalid resetTtl value");return new pT(s,t,e)}function Cp(s){return!!s.tagStyles&&Object.keys(s.tagStyles).length>0}function Mp(s){return s.includes("<")}function mT(s,t){return s.clone().assign(t)}function _T(s,t){const e=[],i=t.tagStyles;if(!Cp(t)||!Mp(s))return e.push({text:s,style:t}),e;const r=[t],a=[];let h="",l=0;for(;l<s.length;){const c=s[l];if(c==="<"){const f=s.indexOf(">",l);if(f===-1){h+=c,l++;continue}const d=s.slice(l+1,f);if(d.startsWith("/")){const g=d.slice(1).trim();if(a.length>0&&a[a.length-1]===g){h.length>0&&(e.push({text:h,style:r[r.length-1]}),h=""),r.pop(),a.pop(),l=f+1;continue}else{h+=s.slice(l,f+1),l=f+1;continue}}else{const g=d.trim();if(i[g]){h.length>0&&(e.push({text:h,style:r[r.length-1]}),h="");const x=r[r.length-1],_=mT(x,i[g]);r.push(_),a.push(g),l=f+1;continue}else{h+=s.slice(l,f+1),l=f+1;continue}}}else h+=c,l++}return h.length>0&&e.push({text:h,style:r[r.length-1]}),e}const xT=[10,13],yT=new Set(xT),bT=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],vT=new Set(bT),wT=/(\r\n|\r|\n)/,ST=/(?:\r\n|\r|\n)/;function al(s){return typeof s!="string"?!1:yT.has(s.charCodeAt(0))}function si(s,t){return typeof s!="string"?!1:vT.has(s.charCodeAt(0))}function Pp(s){return s==="normal"||s==="pre-line"}function Ep(s){return s==="normal"}function Ai(s){if(typeof s!="string")return"";let t=s.length-1;for(;t>=0&&si(s[t]);)t--;return t<s.length-1?s.slice(0,t+1):s}function kp(s){const t=[],e=[];if(typeof s!="string")return t;for(let i=0;i<s.length;i++){const r=s[i],a=s[i+1];if(si(r)||al(r)){e.length>0&&(t.push(e.join("")),e.length=0),r==="\r"&&a===`
`?(t.push(`\r
`),i++):t.push(r);continue}e.push(r)}return e.length>0&&t.push(e.join("")),t}function Ip(s,t,e,i){const r=e(s),a=[];for(let h=0;h<r.length;h++){let l=r[h],c=l,f=1;for(;r[h+f];){const d=r[h+f];if(!i(c,d,s,h,t))l+=d,c=d,f++;else break}h+=f-1,a.push(l)}return a}const AT=/\r\n|\r|\n/g;function TT(s,t,e,i,r,a,h,l){const c=_T(s,t);if(Ep(t.whiteSpace))for(let J=0;J<c.length;J++){const yt=c[J];c[J]={text:yt.text.replace(AT," "),style:yt.style}}const d=[];let g=[];for(const J of c){const yt=J.text.split(wT);for(let N=0;N<yt.length;N++){const z=yt[N];z===`\r
`||z==="\r"||z===`
`?(d.push(g),g=[]):z.length>0&&g.push({text:z,style:J.style})}}(g.length>0||d.length===0)&&d.push(g);const x=e?CT(d,t,i,r,h,l):d,_=[],v=[],T=[],w=[],A=[];let I=0;const M=t._fontString,P=a(M);P.fontSize===0&&(P.fontSize=t.fontSize,P.ascent=t.fontSize);let L="",R=!!t.dropShadow;for(const J of x){let yt=0,N=P.ascent,z=P.descent,rt="";for(const _t of J){const dt=_t.style._fontString,Pt=a(dt);dt!==L&&(i.font=dt,L=dt);const Dt=r(_t.text,_t.style.letterSpacing,i);yt+=Dt,N=Math.max(N,Pt.ascent),z=Math.max(z,Pt.descent),rt+=_t.text,!R&&_t.style.dropShadow&&(R=!0)}J.length===0&&(N=P.ascent,z=P.descent),_.push(yt),v.push(N),T.push(z),A.push(rt);const $=t.lineHeight||N+z;w.push($+t.leading),I=Math.max(I,yt)}const G=t._stroke?.width||0,H=(e&&t.align!=="left"&&t.align!=="justify"?Math.max(I,t.wordWrapWidth):I)+G+(t.dropShadow?t.dropShadow.distance:0);let U=0;for(let J=0;J<w.length;J++)U+=w[J];U=Math.max(U,w[0]+G);const K=U+(t.dropShadow?t.dropShadow.distance:0),Q=t.lineHeight||P.fontSize;return{width:H,height:K,lines:A,lineWidths:_,lineHeight:Q+t.leading,maxLineWidth:I,fontProperties:P,runsByLine:x,lineAscents:v,lineDescents:T,lineHeights:w,hasDropShadow:R}}function CT(s,t,e,i,r,a){const{letterSpacing:h,whiteSpace:l,wordWrapWidth:c,breakWords:f}=t,d=Pp(l),g=c+h,x={};let _="";const v=(w,A)=>{const I=`${w}|${A.styleKey}`;let M=x[I];if(M===void 0){const P=A._fontString;P!==_&&(e.font=P,_=P),M=i(w,A.letterSpacing,e)+A.letterSpacing,x[I]=M}return M},T=[];for(const w of s){const A=MT(w),I=T.length,M=U=>{let K=0,Q=U;do{const{token:J,style:yt}=A[Q];K+=v(J,yt),Q++}while(Q<A.length&&A[Q].continuesFromPrevious);return K},P=U=>{const K=[];let Q=U;do K.push({token:A[Q].token,style:A[Q].style}),Q++;while(Q<A.length&&A[Q].continuesFromPrevious);return K};let L=[],R=0,G=!d,Y=null;const q=()=>{Y&&Y.text.length>0&&L.push(Y),Y=null},H=()=>{if(q(),L.length>0){const U=L[L.length-1];U.text=Ai(U.text),U.text.length===0&&L.pop()}T.push(L),L=[],R=0,G=!1};for(let U=0;U<A.length;U++){const{token:K,style:Q,continuesFromPrevious:J}=A[U],yt=v(K,Q);if(d){const rt=si(K),$=Y?.text[Y.text.length-1]??L[L.length-1]?.text.slice(-1)??"",_t=$?si($):!1;if(rt&&_t)continue}const N=!J,z=N?M(U):yt;if(z>g&&N)if(R>0&&H(),f){const rt=P(U);for(let $=0;$<rt.length;$++){const _t=rt[$].token,dt=rt[$].style,Pt=Ip(_t,f,a,r);for(const Dt of Pt){const re=v(Dt,dt);re+R>g&&H(),!Y||Y.style!==dt?(q(),Y={text:Dt,style:dt}):Y.text+=Dt,R+=re}}U+=rt.length-1}else{const rt=P(U);q(),T.push(rt.map($=>({text:$.token,style:$.style}))),G=!1,U+=rt.length-1}else if(z+R>g&&N){if(si(K)){G=!1;continue}H(),Y={text:K,style:Q},R=yt}else if(J&&!f)!Y||Y.style!==Q?(q(),Y={text:K,style:Q}):Y.text+=K,R+=yt;else{const rt=si(K);if(R===0&&rt&&!G)continue;!Y||Y.style!==Q?(q(),Y={text:K,style:Q}):Y.text+=K,R+=yt}}if(q(),L.length>0){const U=L[L.length-1];U.text=Ai(U.text),U.text.length===0&&L.pop()}(L.length>0||T.length===I)&&T.push(L)}return T}function MT(s){const t=[];let e=!1;for(const i of s){const r=kp(i.text);let a=!0;for(const h of r){const l=si(h)||al(h),c=a&&e&&!l;t.push({token:h,style:i.style,continuesFromPrevious:c}),e=!l,a=!1}}return t}const PT={willReadFrequently:!0};function Qd(s,t,e,i,r){let a=e[s];return typeof a!="number"&&(a=r(s,t,i)+t,e[s]=a),a}function ET(s,t,e,i,r,a,h){const l=e.getContext("2d",PT);l.font=t._fontString;let c=0,f="";const d=[],g=Object.create(null),{letterSpacing:x,whiteSpace:_}=t,v=Pp(_),T=Ep(_);let w=!v;const A=t.wordWrapWidth+x,I=kp(s);for(let P=0;P<I.length;P++){let L=I[P];if(al(L)){if(!T){d.push(Ai(f)),w=!v,f="",c=0;continue}L=" "}if(v){const G=si(L),Y=si(f[f.length-1]);if(G&&Y)continue}const R=Qd(L,x,g,l,i);if(R>A)if(f!==""&&(d.push(Ai(f)),f="",c=0),r(L,t.breakWords)){const G=Ip(L,t.breakWords,h,a);for(const Y of G){const q=Qd(Y,x,g,l,i);q+c>A&&(d.push(Ai(f)),w=!1,f="",c=0),f+=Y,c+=q}}else f.length>0&&(d.push(Ai(f)),f="",c=0),d.push(Ai(L)),w=!1,f="",c=0;else R+c>A&&(w=!1,d.push(Ai(f)),f="",c=0),(f.length>0||!si(L)||w)&&(f+=L,c+=R)}const M=Ai(f);return M.length>0&&d.push(M),d.join(`
`)}const tf={willReadFrequently:!0},ki=class st{static get experimentalLetterSpacingSupported(){let t=st._experimentalLetterSpacingSupported;if(t===void 0){const e=Lt.get().getCanvasRenderingContext2D().prototype;t=st._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,r,a,h,l,c,f,d){this.text=t,this.style=e,this.width=i,this.height=r,this.lines=a,this.lineWidths=h,this.lineHeight=l,this.maxLineWidth=c,this.fontProperties=f,d&&(this.runsByLine=d.runsByLine,this.lineAscents=d.lineAscents,this.lineDescents=d.lineDescents,this.lineHeights=d.lineHeights,this.hasDropShadow=d.hasDropShadow)}static measureText(t=" ",e,i=st._canvas,r=e.wordWrap){const a=`${t}-${e.styleKey}-wordWrap-${r}`;if(st._measurementCache.has(a))return st._measurementCache.get(a);if(Cp(e)&&Mp(t)){const L=TT(t,e,r,st._context,st._measureText,st.measureFont,st.canBreakChars,st.wordWrapSplit),R=new st(t,e,L.width,L.height,L.lines,L.lineWidths,L.lineHeight,L.maxLineWidth,L.fontProperties,{runsByLine:L.runsByLine,lineAscents:L.lineAscents,lineDescents:L.lineDescents,lineHeights:L.lineHeights,hasDropShadow:L.hasDropShadow});return st._measurementCache.set(a,R),R}const l=e._fontString,c=st.measureFont(l);c.fontSize===0&&(c.fontSize=e.fontSize,c.ascent=e.fontSize,c.descent=0);const f=st._context;f.font=l;const g=(r?st._wordWrap(t,e,i):t).split(ST),x=new Array(g.length);let _=0;for(let L=0;L<g.length;L++){const R=st._measureText(g[L],e.letterSpacing,f);x[L]=R,_=Math.max(_,R)}const v=e._stroke?.width??0,T=e.lineHeight||c.fontSize,w=st._getAlignWidth(_,e,r),A=st._adjustWidthForStyle(w,e),I=Math.max(T,c.fontSize+v)+(g.length-1)*(T+e.leading),M=st._adjustHeightForStyle(I,e),P=new st(t,e,A,M,g,x,T+e.leading,_,c);return st._measurementCache.set(a,P),P}static _adjustWidthForStyle(t,e){const i=e._stroke?.width||0;let r=t+i;return e.dropShadow&&(r+=e.dropShadow.distance),r}static _adjustHeightForStyle(t,e){let i=t;return e.dropShadow&&(i+=e.dropShadow.distance),i}static _getAlignWidth(t,e,i){return i&&e.align!=="left"&&e.align!=="justify"?Math.max(t,e.wordWrapWidth):t}static _measureText(t,e,i){let r=!1;st.experimentalLetterSpacingSupported&&(st.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,r=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));const a=i.measureText(t);let h=a.width;const l=-(a.actualBoundingBoxLeft??0);let f=(a.actualBoundingBoxRight??0)-l;if(h>0)if(r)h-=e,f-=e;else{const d=(st.graphemeSegmenter(t).length-1)*e;h+=d,f+=d}return Math.max(h,f)}static _wordWrap(t,e,i=st._canvas){return ET(t,e,i,st._measureText,st.canBreakWords,st.canBreakChars,st.wordWrapSplit)}static isBreakingSpace(t,e){return si(t)}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,r,a){return!0}static wordWrapSplit(t){return st.graphemeSegmenter(t)}static measureFont(t){if(st._fonts[t])return st._fonts[t];const e=st._context;e.font=t;const i=e.measureText(st.METRICS_STRING+st.BASELINE_SYMBOL),r=i.actualBoundingBoxAscent??0,a=i.actualBoundingBoxDescent??0,h={ascent:r,descent:a,fontSize:r+a};return st._fonts[t]=h,h}static clearMetrics(t=""){t?delete st._fonts[t]:st._fonts={}}static get _canvas(){if(!st.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext("2d",tf)?.measureText)return st.__canvas=e,e;t=Lt.get().createCanvas()}catch{t=Lt.get().createCanvas()}t.width=t.height=10,st.__canvas=t}return st.__canvas}static get _context(){return st.__context||(st.__context=st._canvas.getContext("2d",tf)),st.__context}};ki.METRICS_STRING="|q";ki.BASELINE_SYMBOL="M";ki.BASELINE_MULTIPLIER=1.4;ki.HEIGHT_MULTIPLIER=2;ki.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){const s=new Intl.Segmenter;return t=>{const e=s.segment(t),i=[];let r=0;for(const a of e)i[r++]=a.segment;return i}}return s=>[...s]})();ki.experimentalLetterSpacing=!1;ki._fonts={};ki._measurementCache=gT(1e3);let zi=ki;const kT=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function Wh(s){const t=typeof s.fontSize=="number"?`${s.fontSize}px`:s.fontSize;let e=s.fontFamily;Array.isArray(s.fontFamily)||(e=s.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let r=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!kT.includes(r)&&(r=`"${r}"`),e[i]=r}return`${s.fontStyle} ${s.fontVariant} ${s.fontWeight} ${t} ${e.join(",")}`}const ef=1e5;function Qr(s,t,e,i=0,r=0,a=0){if(s.texture===ht.WHITE&&!s.fill)return te.shared.setValue(s.color).setAlpha(s.alpha??1).toHexa();if(s.fill){if(s.fill instanceof _o){const h=s.fill,l=t.createPattern(h.texture.source.resource,"repeat"),c=h.transform.copyTo(pt.shared);return c.scale(h.texture.source.pixelWidth,h.texture.source.pixelHeight),l.setTransform(c),l}else if(s.fill instanceof Ei){const h=s.fill,l=h.type==="linear",c=h.textureSpace==="local";let f=1,d=1;c&&e&&(f=e.width+i,d=e.height+i);let g,x=!1;if(l){const{start:_,end:v}=h;g=t.createLinearGradient(_.x*f+r,_.y*d+a,v.x*f+r,v.y*d+a),x=Math.abs(v.x-_.x)<Math.abs((v.y-_.y)*.1)}else{const{center:_,innerRadius:v,outerCenter:T,outerRadius:w}=h;g=t.createRadialGradient(_.x*f+r,_.y*d+a,v*f,T.x*f+r,T.y*d+a,w*f)}if(x&&c&&e){const _=e.lineHeight/d;for(let v=0;v<e.lines.length;v++){const T=(v*e.lineHeight+i/2)/d;h.colorStops.forEach(w=>{let A=T+w.offset*_;A=Math.max(0,Math.min(1,A)),g.addColorStop(Math.floor(A*ef)/ef,te.shared.setValue(w.color).toHex())})}}else h.colorStops.forEach(_=>{g.addColorStop(_.offset,te.shared.setValue(_.color).toHex())});return g}}else{const h=t.createPattern(s.texture.source.resource,"repeat"),l=s.matrix.copyTo(pt.shared);return l.scale(s.texture.source.pixelWidth,s.texture.source.pixelHeight),h.setTransform(l),h}return Ot("FillStyle not recognised",s),"red"}const sf=new kt;class IT{getCanvasAndContext(t){const{text:e,style:i,resolution:r=1}=t,a=i._getFinalPadding(),h=zi.measureText(e||" ",i),l=Math.ceil(Math.ceil(Math.max(1,h.width)+a*2)*r),c=Math.ceil(Math.ceil(Math.max(1,h.height)+a*2)*r),f=Dh.getOptimalCanvasAndContext(l,c);this._renderTextToCanvas(i,a,r,f,h);const d=i.trim?fT({canvas:f.canvas,width:l,height:c,resolution:1,output:sf}):sf.set(0,0,l,c);return{canvasAndContext:f,frame:d}}returnCanvasAndContext(t){Dh.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,i,r,a){if(a.runsByLine&&a.runsByLine.length>0){this._renderTaggedTextToCanvas(a,t,e,i,r);return}const{canvas:h,context:l}=r,c=Wh(t),f=a.lines,d=a.lineHeight,g=a.lineWidths,x=a.maxLineWidth,_=a.fontProperties,v=h.height;if(l.resetTransform(),l.scale(i,i),l.textBaseline=t.textBaseline,t._stroke?.width){const R=t._stroke;l.lineWidth=R.width,l.miterLimit=R.miterLimit,l.lineJoin=R.join,l.lineCap=R.cap}l.font=c;let T,w;const A=t.dropShadow?2:1,I=t.wordWrap?t.wordWrapWidth:x,P=(t._stroke?.width??0)/2;let L=(d-_.fontSize)/2;d-_.fontSize<0&&(L=0);for(let R=0;R<A;++R){const G=t.dropShadow&&R===0,Y=G?Math.ceil(Math.max(1,v)+e*2):0,q=Y*i;if(G)this._setupDropShadow(l,t,i,q);else{const H=t._gradientBounds,U=t._gradientOffset;if(H){const K={width:H.width,height:H.height,lineHeight:H.height,lines:a.lines};this._setFillAndStrokeStyles(l,t,K,e,P,U?.x??0,U?.y??0)}else U?this._setFillAndStrokeStyles(l,t,a,e,P,U.x,U.y):this._setFillAndStrokeStyles(l,t,a,e,P);l.shadowColor="black"}for(let H=0;H<f.length;H++)T=P,w=P+H*d+_.ascent+L,T+=this._getAlignmentOffset(g[H],I,t.align),t._stroke?.width&&this._drawLetterSpacing(f[H],t,r,T+e,w+e-Y,!0),t._fill!==void 0&&this._drawLetterSpacing(f[H],t,r,T+e,w+e-Y)}}_renderTaggedTextToCanvas(t,e,i,r,a){const{canvas:h,context:l}=a,{runsByLine:c,lineWidths:f,maxLineWidth:d,lineAscents:g,lineHeights:x,hasDropShadow:_}=t,v=h.height;l.resetTransform(),l.scale(r,r),l.textBaseline=e.textBaseline;const T=_?2:1,w=e.wordWrap?e.wordWrapWidth:d,I=(e._stroke?.width??0)/2,M=[];for(let P=0;P<c.length;P++){const L=c[P],R=[];for(const G of L){const Y=Wh(G.style);l.font=Y,R.push({width:zi._measureText(G.text,G.style.letterSpacing,l),font:Y})}M.push(R)}for(let P=0;P<T;++P){const L=_&&P===0,R=L?Math.ceil(Math.max(1,v)+i*2):0,G=R*r;L||(l.shadowColor="black");let Y=I;for(let q=0;q<c.length;q++){const H=c[q],U=f[q],K=g[q],Q=x[q],J=M[q];let yt=I;yt+=this._getAlignmentOffset(U,w,e.align);const N=Y+K;let z=yt+i;for(let rt=0;rt<H.length;rt++){const $=H[rt],{width:_t,font:dt}=J[rt];if(l.font=dt,l.textBaseline=$.style.textBaseline,$.style._stroke?.width){const Pt=$.style._stroke;if(l.lineWidth=Pt.width,l.miterLimit=Pt.miterLimit,l.lineJoin=Pt.join,l.lineCap=Pt.cap,L)if($.style.dropShadow)this._setupDropShadow(l,$.style,r,G);else{z+=_t;continue}else{const Dt=zi.measureFont(dt),re=$.style.lineHeight||Dt.fontSize,we={width:_t,height:re,lineHeight:re,lines:[$.text]};l.strokeStyle=Qr(Pt,l,we,i*2,z-i,Y)}this._drawLetterSpacing($.text,$.style,a,z,N+i-R,!0)}z+=_t}z=yt+i;for(let rt=0;rt<H.length;rt++){const $=H[rt],{width:_t,font:dt}=J[rt];if(l.font=dt,l.textBaseline=$.style.textBaseline,$.style._fill!==void 0){if(L)if($.style.dropShadow)this._setupDropShadow(l,$.style,r,G);else{z+=_t;continue}else{const Pt=zi.measureFont(dt),Dt=$.style.lineHeight||Pt.fontSize,re={width:_t,height:Dt,lineHeight:Dt,lines:[$.text]};l.fillStyle=Qr($.style._fill,l,re,i*2,z-i,Y)}this._drawLetterSpacing($.text,$.style,a,z,N+i-R,!1)}z+=_t}Y+=Q}}}_setFillAndStrokeStyles(t,e,i,r,a,h=0,l=0){if(t.fillStyle=e._fill?Qr(e._fill,t,i,r*2,h,l):null,e._stroke?.width){const c=a+r*2;t.strokeStyle=Qr(e._stroke,t,i,c,h,l)}}_setupDropShadow(t,e,i,r){t.fillStyle="black",t.strokeStyle="black";const a=e.dropShadow,h=a.color,l=a.alpha;t.shadowColor=te.shared.setValue(h).setAlpha(l).toRgbaString();const c=a.blur*i,f=a.distance*i;t.shadowBlur=c,t.shadowOffsetX=Math.cos(a.angle)*f,t.shadowOffsetY=Math.sin(a.angle)*f+r}_getAlignmentOffset(t,e,i){return i==="right"?e-t:i==="center"?(e-t)/2:0}_drawLetterSpacing(t,e,i,r,a,h=!1){const{context:l}=i,c=e.letterSpacing;let f=!1;if(zi.experimentalLetterSpacingSupported&&(zi.experimentalLetterSpacing?(l.letterSpacing=`${c}px`,l.textLetterSpacing=`${c}px`,f=!0):(l.letterSpacing="0px",l.textLetterSpacing="0px")),c===0||f){h?l.strokeText(t,r,a):l.fillText(t,r,a);return}let d=r;const g=zi.graphemeSegmenter(t);let x=l.measureText(t).width,_=0;for(let v=0;v<g.length;++v){const T=g[v];h?l.strokeText(T,d,a):l.fillText(T,d,a);let w="";for(let A=v+1;A<g.length;++A)w+=g[A];_=l.measureText(w).width,d+=x-_+c,x=_}}}const Us=new IT,hl=class ds extends fi{constructor(t={}){super(),this.uid=Yt("textStyle"),this._tick=0,this._cachedFontString=null,RT(t),t instanceof ds&&(t=t._toObject());const r={...ds.defaultTextStyle,...t};for(const a in r){const h=a;this[h]=r[a]}this._tagStyles=t.tagStyles??void 0,this.update(),this._tick=0}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.update())}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.update())}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...ds.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...ds.defaultDropShadow}):null,this.update())}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!==t&&(this._fontFamily=t,this.update())}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update())}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t.toLowerCase(),this.update())}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.update())}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.update())}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.update())}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.update())}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.update())}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.update())}get filters(){return this._filters}set filters(t){this._filters!==t&&(this._filters=Object.freeze(t),this.update())}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.update())}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.update())}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.update())}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.update())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.update())}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...Ne.defaultFillStyle,...t},()=>{this._fill=fs({...this._originalFill},Ne.defaultFillStyle)})),this._fill=fs(t===0?"black":t,Ne.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...Ne.defaultStrokeStyle,...t},()=>{this._stroke=ho({...this._originalStroke},Ne.defaultStrokeStyle)})),this._stroke=ho(t,Ne.defaultStrokeStyle),this.update())}get tagStyles(){return this._tagStyles}set tagStyles(t){this._tagStyles!==t&&(this._tagStyles=t??void 0,this.update())}update(){this._tick++,this._cachedFontString=null,this.emit("update",this)}reset(){const t=ds.defaultTextStyle;for(const e in t)this[e]=t[e]}assign(t){for(const e in t){const i=e;this[i]=t[e]}return this}get styleKey(){return`${this.uid}-${this._tick}`}get _fontString(){return this._cachedFontString===null&&(this._cachedFontString=Wh(this)),this._cachedFontString}_toObject(){return{align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill?{...this._fill}:void 0,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke?{...this._stroke}:void 0,textBaseline:this.textBaseline,trim:this.trim,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0,tagStyles:this._tagStyles?{...this._tagStyles}:void 0}}clone(){return new ds(this._toObject())}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){if(this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){const i=typeof t=="boolean"?t:t?.textureSource;this._fill?.texture&&this._fill.texture.destroy(i),this._originalFill?.texture&&this._originalFill.texture.destroy(i),this._stroke?.texture&&this._stroke.texture.destroy(i),this._originalStroke?.texture&&this._originalStroke.texture.destroy(i)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(i,r,a)=>(i[r]===a||(i[r]=a,e?.(r,a),this.update()),!0)})}_isFillStyle(t){return(t??null)!==null&&!(te.isColorLike(t)||t instanceof Ei||t instanceof _o)}};hl.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};hl.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let lo=hl;function RT(s){const t=s;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=lo.defaultDropShadow;s.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){wt(Nt,"strokeThickness is now a part of stroke");const e=t.stroke;let i={};if(te.isColorLike(e))i.color=e;else if(e instanceof Ei||e instanceof _o)i.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))i=e;else throw new Error("Invalid stroke value.");s.stroke={...i,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){if(wt(Nt,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(t.fill)||t.fill.length===0)throw new Error("Invalid fill value. Expected an array of colors for gradient fill.");t.fill.length!==t.fillGradientStops.length&&Ot("The number of fill colors must match the number of fill gradient stops.");const e=new Ei({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),i=t.fillGradientStops.slice(),r=t.fill.map(a=>te.shared.setValue(a).toNumber());i.forEach((a,h)=>{e.addColorStop(a,r[h])}),s.fill={fill:e}}}function LT(s,t){const{texture:e,bounds:i}=s,r=t._style._getFinalPadding();ff(i,t._anchor,e);const a=t._anchor._x*r*2,h=t._anchor._y*r*2;i.minX-=r-a,i.minY-=r-h,i.maxX-=r-a,i.maxY-=r-h}class BT{constructor(){this.batcherName="default",this.topology="triangle-list",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this._attributeStart=0,this._batcher=null,this._batch=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.bounds=null}destroy(){this.reset()}}class FT extends BT{}class Rp{constructor(t){this._renderer=t,t.runners.resolutionChange.add(this),this._managedTexts=new $n({renderer:t,type:"renderable",onUnload:this.onTextUnload.bind(this),name:"canvasText"})}resolutionChange(){for(const t in this._managedTexts.items){const e=this._managedTexts.items[t];e?._autoResolution&&e.onViewUpdate()}}validateRenderable(t){const e=this._getGpuText(t),i=t.styleKey;return e.currentKey!==i?!0:t._didTextUpdate}addRenderable(t,e){const i=this._getGpuText(t);if(t._didTextUpdate){const r=t._autoResolution?this._renderer.resolution:t.resolution;(i.currentKey!==t.styleKey||t._resolution!==r)&&this._updateGpuText(t),t._didTextUpdate=!1,LT(i,t)}this._renderer.renderPipes.batch.addToBatch(i,e)}updateRenderable(t){const e=this._getGpuText(t);e._batcher.updateElement(e)}_updateGpuText(t){const e=this._getGpuText(t);e.texture&&this._renderer.canvasText.decreaseReferenceCount(e.currentKey),t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,e.texture=this._renderer.canvasText.getManagedTexture(t),e.currentKey=t.styleKey}_getGpuText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const e=new FT;return e.currentKey="--",e.renderable=t,e.transform=t.groupTransform,e.bounds={minX:0,maxX:1,minY:0,maxY:0},e.roundPixels=this._renderer._roundPixels|t._roundPixels,t._gpuData[this._renderer.uid]=e,this._managedTexts.add(t),e}onTextUnload(t){const e=t._gpuData[this._renderer.uid];if(!e)return;const{canvasText:i}=this._renderer;i.getReferenceCount(e.currentKey)>0?i.decreaseReferenceCount(e.currentKey):e.texture&&i.returnTexture(e.texture)}destroy(){this._managedTexts.destroy(),this._renderer=null}}Rp.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"text"};const GT=new Re;function OT(s,t,e,i){const r=GT;r.minX=0,r.minY=0,r.maxX=s.width/i|0,r.maxY=s.height/i|0;const a=co.getOptimalTexture(r.width,r.height,i,!1);return a.source.uploadMethodId="image",a.source.resource=s,a.source.alphaMode="premultiply-alpha-on-upload",a.frame.width=t/i,a.frame.height=e/i,a.source.emit("update",a.source),a.updateUvs(),a}class Lp{constructor(t,e){this._activeTextures={},this._renderer=t,this._retainCanvasContext=e}getTexture(t,e,i,r){typeof t=="string"&&(wt("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),t={text:t,style:i,resolution:e}),t.style instanceof lo||(t.style=new lo(t.style)),t.textureStyle instanceof $s||(t.textureStyle=new $s(t.textureStyle)),typeof t.text!="string"&&(t.text=t.text.toString());const{text:a,style:h,textureStyle:l}=t,c=t.resolution??this._renderer.resolution,{frame:f,canvasAndContext:d}=Us.getCanvasAndContext({text:a,style:h,resolution:c}),g=OT(d.canvas,f.width,f.height,c);if(l&&(g.source.style=l),h.trim&&(f.pad(h.padding),g.frame.copyFrom(f),g.frame.scale(1/c),g.updateUvs()),h.filters){const x=this._applyFilters(g,h.filters);return this.returnTexture(g),Us.returnCanvasAndContext(d),x}return this._renderer.texture.initSource(g._source),this._retainCanvasContext||Us.returnCanvasAndContext(d),g}returnTexture(t){const e=t.source,i=e.resource;if(this._retainCanvasContext&&i?.getContext){const r=i.getContext("2d");r&&Us.returnCanvasAndContext({canvas:i,context:r})}e.resource=null,e.uploadMethodId="unknown",e.alphaMode="no-premultiply-alpha",co.returnTexture(t,!0)}renderTextToCanvas(){wt("8.10.0","CanvasTextSystem.renderTextToCanvas: no longer supported, use CanvasTextSystem.getTexture instead")}getManagedTexture(t){t._resolution=t._autoResolution?this._renderer.resolution:t.resolution;const e=t.styleKey;if(this._activeTextures[e])return this._increaseReferenceCount(e),this._activeTextures[e].texture;const i=this.getTexture({text:t.text,style:t.style,resolution:t._resolution,textureStyle:t.textureStyle});return this._activeTextures[e]={texture:i,usageCount:1},i}decreaseReferenceCount(t){const e=this._activeTextures[t];e&&(e.usageCount--,e.usageCount===0&&(this.returnTexture(e.texture),this._activeTextures[t]=null))}getReferenceCount(t){return this._activeTextures[t]?.usageCount??0}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}_applyFilters(t,e){const i=this._renderer.renderTarget.renderTarget,r=this._renderer.filter.generateFilteredTexture({texture:t,filters:e});return this._renderer.renderTarget.bind(i,!1),r}destroy(){this._renderer=null;for(const t in this._activeTextures)this._activeTextures[t]&&this.returnTexture(this._activeTextures[t].texture);this._activeTextures=null}}class Bp extends Lp{constructor(t){super(t,!0)}}Bp.extension={type:[V.CanvasSystem],name:"canvasText"};class Fp extends Lp{constructor(t){super(t,!1)}}Fp.extension={type:[V.WebGLSystem,V.WebGPUSystem],name:"canvasText"};Mt.add(Bp);Mt.add(Fp);Mt.add(Rp);class xs extends lT{constructor(...t){const e=uT(t,"Text");super(e,lo),this.renderPipeId="text",e.textureStyle&&(this.textureStyle=e.textureStyle instanceof $s?e.textureStyle:new $s(e.textureStyle))}updateBounds(){const t=this._bounds,e=this._anchor;let i=0,r=0;if(this._style.trim){const{frame:a,canvasAndContext:h}=Us.getCanvasAndContext({text:this.text,style:this._style,resolution:1});Us.returnCanvasAndContext(h),i=a.width,r=a.height}else{const a=zi.measureText(this._text,this._style);i=a.width,r=a.height}t.minX=-e._x*i,t.maxX=t.minX+i,t.minY=-e._y*r,t.maxY=t.minY+r}}Mt.add(Tv,Cv);var En={exports:{}};var DT=En.exports,nf;function WT(){return nf||(nf=1,(function(s,t){(function(){var e,i="4.17.23",r=200,a="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",l="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",f=500,d="__lodash_placeholder__",g=1,x=2,_=4,v=1,T=2,w=1,A=2,I=4,M=8,P=16,L=32,R=64,G=128,Y=256,q=512,H=30,U="...",K=800,Q=16,J=1,yt=2,N=3,z=1/0,rt=9007199254740991,$=17976931348623157e292,_t=NaN,dt=4294967295,Pt=dt-1,Dt=dt>>>1,re=[["ary",G],["bind",w],["bindKey",A],["curry",M],["curryRight",P],["flip",q],["partial",L],["partialRight",R],["rearg",Y]],we="[object Arguments]",ni="[object Array]",Vn="[object AsyncFunction]",Ii="[object Boolean]",ri="[object Date]",ys="[object DOMException]",Ri="[object Error]",Le="[object Function]",oi="[object GeneratorFunction]",jt="[object Map]",Se="[object Number]",xo="[object Null]",Be="[object Object]",qn="[object Promise]",ul="[object Proxy]",Qs="[object RegExp]",$e="[object Set]",tn="[object String]",jn="[object Symbol]",zp="[object Undefined]",en="[object WeakMap]",Np="[object WeakSet]",sn="[object ArrayBuffer]",bs="[object DataView]",yo="[object Float32Array]",bo="[object Float64Array]",vo="[object Int8Array]",wo="[object Int16Array]",So="[object Int32Array]",Ao="[object Uint8Array]",To="[object Uint8ClampedArray]",Co="[object Uint16Array]",Mo="[object Uint32Array]",Yp=/\b__p \+= '';/g,Xp=/\b(__p \+=) '' \+/g,$p=/(__e\(.*?\)|\b__t\)) \+\n'';/g,cl=/&(?:amp|lt|gt|quot|#39);/g,dl=/[&<>"']/g,Vp=RegExp(cl.source),qp=RegExp(dl.source),jp=/<%-([\s\S]+?)%>/g,Zp=/<%([\s\S]+?)%>/g,fl=/<%=([\s\S]+?)%>/g,Kp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Jp=/^\w*$/,Qp=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Po=/[\\^$.*+?()[\]{}|]/g,tg=RegExp(Po.source),Eo=/^\s+/,eg=/\s/,ig=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,sg=/\{\n\/\* \[wrapped with (.+)\] \*/,ng=/,? & /,rg=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,og=/[()=,{}\[\]\/\s]/,ag=/\\(\\)?/g,hg=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,pl=/\w*$/,lg=/^[-+]0x[0-9a-f]+$/i,ug=/^0b[01]+$/i,cg=/^\[object .+?Constructor\]$/,dg=/^0o[0-7]+$/i,fg=/^(?:0|[1-9]\d*)$/,pg=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Zn=/($^)/,gg=/['\n\r\u2028\u2029\\]/g,Kn="\\ud800-\\udfff",mg="\\u0300-\\u036f",_g="\\ufe20-\\ufe2f",xg="\\u20d0-\\u20ff",gl=mg+_g+xg,ml="\\u2700-\\u27bf",_l="a-z\\xdf-\\xf6\\xf8-\\xff",yg="\\xac\\xb1\\xd7\\xf7",bg="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",vg="\\u2000-\\u206f",wg=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",xl="A-Z\\xc0-\\xd6\\xd8-\\xde",yl="\\ufe0e\\ufe0f",bl=yg+bg+vg+wg,ko="[']",Sg="["+Kn+"]",vl="["+bl+"]",Jn="["+gl+"]",wl="\\d+",Ag="["+ml+"]",Sl="["+_l+"]",Al="[^"+Kn+bl+wl+ml+_l+xl+"]",Io="\\ud83c[\\udffb-\\udfff]",Tg="(?:"+Jn+"|"+Io+")",Tl="[^"+Kn+"]",Ro="(?:\\ud83c[\\udde6-\\uddff]){2}",Lo="[\\ud800-\\udbff][\\udc00-\\udfff]",vs="["+xl+"]",Cl="\\u200d",Ml="(?:"+Sl+"|"+Al+")",Cg="(?:"+vs+"|"+Al+")",Pl="(?:"+ko+"(?:d|ll|m|re|s|t|ve))?",El="(?:"+ko+"(?:D|LL|M|RE|S|T|VE))?",kl=Tg+"?",Il="["+yl+"]?",Mg="(?:"+Cl+"(?:"+[Tl,Ro,Lo].join("|")+")"+Il+kl+")*",Pg="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Eg="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Rl=Il+kl+Mg,kg="(?:"+[Ag,Ro,Lo].join("|")+")"+Rl,Ig="(?:"+[Tl+Jn+"?",Jn,Ro,Lo,Sg].join("|")+")",Rg=RegExp(ko,"g"),Lg=RegExp(Jn,"g"),Bo=RegExp(Io+"(?="+Io+")|"+Ig+Rl,"g"),Bg=RegExp([vs+"?"+Sl+"+"+Pl+"(?="+[vl,vs,"$"].join("|")+")",Cg+"+"+El+"(?="+[vl,vs+Ml,"$"].join("|")+")",vs+"?"+Ml+"+"+Pl,vs+"+"+El,Eg,Pg,wl,kg].join("|"),"g"),Fg=RegExp("["+Cl+Kn+gl+yl+"]"),Gg=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Og=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Dg=-1,Bt={};Bt[yo]=Bt[bo]=Bt[vo]=Bt[wo]=Bt[So]=Bt[Ao]=Bt[To]=Bt[Co]=Bt[Mo]=!0,Bt[we]=Bt[ni]=Bt[sn]=Bt[Ii]=Bt[bs]=Bt[ri]=Bt[Ri]=Bt[Le]=Bt[jt]=Bt[Se]=Bt[Be]=Bt[Qs]=Bt[$e]=Bt[tn]=Bt[en]=!1;var It={};It[we]=It[ni]=It[sn]=It[bs]=It[Ii]=It[ri]=It[yo]=It[bo]=It[vo]=It[wo]=It[So]=It[jt]=It[Se]=It[Be]=It[Qs]=It[$e]=It[tn]=It[jn]=It[Ao]=It[To]=It[Co]=It[Mo]=!0,It[Ri]=It[Le]=It[en]=!1;var Wg={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},Ug={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Hg={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},zg={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ng=parseFloat,Yg=parseInt,Ll=typeof Wr=="object"&&Wr&&Wr.Object===Object&&Wr,Xg=typeof self=="object"&&self&&self.Object===Object&&self,oe=Ll||Xg||Function("return this")(),Fo=t&&!t.nodeType&&t,Zi=Fo&&!0&&s&&!s.nodeType&&s,Bl=Zi&&Zi.exports===Fo,Go=Bl&&Ll.process,Fe=(function(){try{var E=Zi&&Zi.require&&Zi.require("util").types;return E||Go&&Go.binding&&Go.binding("util")}catch{}})(),Fl=Fe&&Fe.isArrayBuffer,Gl=Fe&&Fe.isDate,Ol=Fe&&Fe.isMap,Dl=Fe&&Fe.isRegExp,Wl=Fe&&Fe.isSet,Ul=Fe&&Fe.isTypedArray;function Ae(E,F,B){switch(B.length){case 0:return E.call(F);case 1:return E.call(F,B[0]);case 2:return E.call(F,B[0],B[1]);case 3:return E.call(F,B[0],B[1],B[2])}return E.apply(F,B)}function $g(E,F,B,j){for(var nt=-1,St=E==null?0:E.length;++nt<St;){var Zt=E[nt];F(j,Zt,B(Zt),E)}return j}function Ge(E,F){for(var B=-1,j=E==null?0:E.length;++B<j&&F(E[B],B,E)!==!1;);return E}function Vg(E,F){for(var B=E==null?0:E.length;B--&&F(E[B],B,E)!==!1;);return E}function Hl(E,F){for(var B=-1,j=E==null?0:E.length;++B<j;)if(!F(E[B],B,E))return!1;return!0}function Li(E,F){for(var B=-1,j=E==null?0:E.length,nt=0,St=[];++B<j;){var Zt=E[B];F(Zt,B,E)&&(St[nt++]=Zt)}return St}function Qn(E,F){var B=E==null?0:E.length;return!!B&&ws(E,F,0)>-1}function Oo(E,F,B){for(var j=-1,nt=E==null?0:E.length;++j<nt;)if(B(F,E[j]))return!0;return!1}function Ft(E,F){for(var B=-1,j=E==null?0:E.length,nt=Array(j);++B<j;)nt[B]=F(E[B],B,E);return nt}function Bi(E,F){for(var B=-1,j=F.length,nt=E.length;++B<j;)E[nt+B]=F[B];return E}function Do(E,F,B,j){var nt=-1,St=E==null?0:E.length;for(j&&St&&(B=E[++nt]);++nt<St;)B=F(B,E[nt],nt,E);return B}function qg(E,F,B,j){var nt=E==null?0:E.length;for(j&&nt&&(B=E[--nt]);nt--;)B=F(B,E[nt],nt,E);return B}function Wo(E,F){for(var B=-1,j=E==null?0:E.length;++B<j;)if(F(E[B],B,E))return!0;return!1}var jg=Uo("length");function Zg(E){return E.split("")}function Kg(E){return E.match(rg)||[]}function zl(E,F,B){var j;return B(E,function(nt,St,Zt){if(F(nt,St,Zt))return j=St,!1}),j}function tr(E,F,B,j){for(var nt=E.length,St=B+(j?1:-1);j?St--:++St<nt;)if(F(E[St],St,E))return St;return-1}function ws(E,F,B){return F===F?lm(E,F,B):tr(E,Nl,B)}function Jg(E,F,B,j){for(var nt=B-1,St=E.length;++nt<St;)if(j(E[nt],F))return nt;return-1}function Nl(E){return E!==E}function Yl(E,F){var B=E==null?0:E.length;return B?zo(E,F)/B:_t}function Uo(E){return function(F){return F==null?e:F[E]}}function Ho(E){return function(F){return E==null?e:E[F]}}function Xl(E,F,B,j,nt){return nt(E,function(St,Zt,Et){B=j?(j=!1,St):F(B,St,Zt,Et)}),B}function Qg(E,F){var B=E.length;for(E.sort(F);B--;)E[B]=E[B].value;return E}function zo(E,F){for(var B,j=-1,nt=E.length;++j<nt;){var St=F(E[j]);St!==e&&(B=B===e?St:B+St)}return B}function No(E,F){for(var B=-1,j=Array(E);++B<E;)j[B]=F(B);return j}function tm(E,F){return Ft(F,function(B){return[B,E[B]]})}function $l(E){return E&&E.slice(0,Zl(E)+1).replace(Eo,"")}function Te(E){return function(F){return E(F)}}function Yo(E,F){return Ft(F,function(B){return E[B]})}function nn(E,F){return E.has(F)}function Vl(E,F){for(var B=-1,j=E.length;++B<j&&ws(F,E[B],0)>-1;);return B}function ql(E,F){for(var B=E.length;B--&&ws(F,E[B],0)>-1;);return B}function em(E,F){for(var B=E.length,j=0;B--;)E[B]===F&&++j;return j}var im=Ho(Wg),sm=Ho(Ug);function nm(E){return"\\"+zg[E]}function rm(E,F){return E==null?e:E[F]}function Ss(E){return Fg.test(E)}function om(E){return Gg.test(E)}function am(E){for(var F,B=[];!(F=E.next()).done;)B.push(F.value);return B}function Xo(E){var F=-1,B=Array(E.size);return E.forEach(function(j,nt){B[++F]=[nt,j]}),B}function jl(E,F){return function(B){return E(F(B))}}function Fi(E,F){for(var B=-1,j=E.length,nt=0,St=[];++B<j;){var Zt=E[B];(Zt===F||Zt===d)&&(E[B]=d,St[nt++]=B)}return St}function er(E){var F=-1,B=Array(E.size);return E.forEach(function(j){B[++F]=j}),B}function hm(E){var F=-1,B=Array(E.size);return E.forEach(function(j){B[++F]=[j,j]}),B}function lm(E,F,B){for(var j=B-1,nt=E.length;++j<nt;)if(E[j]===F)return j;return-1}function um(E,F,B){for(var j=B+1;j--;)if(E[j]===F)return j;return j}function As(E){return Ss(E)?dm(E):jg(E)}function Ve(E){return Ss(E)?fm(E):Zg(E)}function Zl(E){for(var F=E.length;F--&&eg.test(E.charAt(F)););return F}var cm=Ho(Hg);function dm(E){for(var F=Bo.lastIndex=0;Bo.test(E);)++F;return F}function fm(E){return E.match(Bo)||[]}function pm(E){return E.match(Bg)||[]}var gm=(function E(F){F=F==null?oe:Ts.defaults(oe.Object(),F,Ts.pick(oe,Og));var B=F.Array,j=F.Date,nt=F.Error,St=F.Function,Zt=F.Math,Et=F.Object,$o=F.RegExp,mm=F.String,Oe=F.TypeError,ir=B.prototype,_m=St.prototype,Cs=Et.prototype,sr=F["__core-js_shared__"],nr=_m.toString,At=Cs.hasOwnProperty,xm=0,Kl=(function(){var n=/[^.]+$/.exec(sr&&sr.keys&&sr.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})(),rr=Cs.toString,ym=nr.call(Et),bm=oe._,vm=$o("^"+nr.call(At).replace(Po,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),or=Bl?F.Buffer:e,Gi=F.Symbol,ar=F.Uint8Array,Jl=or?or.allocUnsafe:e,hr=jl(Et.getPrototypeOf,Et),Ql=Et.create,tu=Cs.propertyIsEnumerable,lr=ir.splice,eu=Gi?Gi.isConcatSpreadable:e,rn=Gi?Gi.iterator:e,Ki=Gi?Gi.toStringTag:e,ur=(function(){try{var n=is(Et,"defineProperty");return n({},"",{}),n}catch{}})(),wm=F.clearTimeout!==oe.clearTimeout&&F.clearTimeout,Sm=j&&j.now!==oe.Date.now&&j.now,Am=F.setTimeout!==oe.setTimeout&&F.setTimeout,cr=Zt.ceil,dr=Zt.floor,Vo=Et.getOwnPropertySymbols,Tm=or?or.isBuffer:e,iu=F.isFinite,Cm=ir.join,Mm=jl(Et.keys,Et),Kt=Zt.max,ue=Zt.min,Pm=j.now,Em=F.parseInt,su=Zt.random,km=ir.reverse,qo=is(F,"DataView"),on=is(F,"Map"),jo=is(F,"Promise"),Ms=is(F,"Set"),an=is(F,"WeakMap"),hn=is(Et,"create"),fr=an&&new an,Ps={},Im=ss(qo),Rm=ss(on),Lm=ss(jo),Bm=ss(Ms),Fm=ss(an),pr=Gi?Gi.prototype:e,ln=pr?pr.valueOf:e,nu=pr?pr.toString:e;function y(n){if(Ht(n)&&!ot(n)&&!(n instanceof gt)){if(n instanceof De)return n;if(At.call(n,"__wrapped__"))return rc(n)}return new De(n)}var Es=(function(){function n(){}return function(o){if(!Wt(o))return{};if(Ql)return Ql(o);n.prototype=o;var u=new n;return n.prototype=e,u}})();function gr(){}function De(n,o){this.__wrapped__=n,this.__actions__=[],this.__chain__=!!o,this.__index__=0,this.__values__=e}y.templateSettings={escape:jp,evaluate:Zp,interpolate:fl,variable:"",imports:{_:y}},y.prototype=gr.prototype,y.prototype.constructor=y,De.prototype=Es(gr.prototype),De.prototype.constructor=De;function gt(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=dt,this.__views__=[]}function Gm(){var n=new gt(this.__wrapped__);return n.__actions__=me(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=me(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=me(this.__views__),n}function Om(){if(this.__filtered__){var n=new gt(this);n.__dir__=-1,n.__filtered__=!0}else n=this.clone(),n.__dir__*=-1;return n}function Dm(){var n=this.__wrapped__.value(),o=this.__dir__,u=ot(n),p=o<0,m=u?n.length:0,b=Z_(0,m,this.__views__),S=b.start,C=b.end,k=C-S,O=p?C:S-1,D=this.__iteratees__,W=D.length,X=0,Z=ue(k,this.__takeCount__);if(!u||!p&&m==k&&Z==k)return Pu(n,this.__actions__);var et=[];t:for(;k--&&X<Z;){O+=o;for(var lt=-1,it=n[O];++lt<W;){var ft=D[lt],xt=ft.iteratee,Pe=ft.type,pe=xt(it);if(Pe==yt)it=pe;else if(!pe){if(Pe==J)continue t;break t}}et[X++]=it}return et}gt.prototype=Es(gr.prototype),gt.prototype.constructor=gt;function Ji(n){var o=-1,u=n==null?0:n.length;for(this.clear();++o<u;){var p=n[o];this.set(p[0],p[1])}}function Wm(){this.__data__=hn?hn(null):{},this.size=0}function Um(n){var o=this.has(n)&&delete this.__data__[n];return this.size-=o?1:0,o}function Hm(n){var o=this.__data__;if(hn){var u=o[n];return u===c?e:u}return At.call(o,n)?o[n]:e}function zm(n){var o=this.__data__;return hn?o[n]!==e:At.call(o,n)}function Nm(n,o){var u=this.__data__;return this.size+=this.has(n)?0:1,u[n]=hn&&o===e?c:o,this}Ji.prototype.clear=Wm,Ji.prototype.delete=Um,Ji.prototype.get=Hm,Ji.prototype.has=zm,Ji.prototype.set=Nm;function pi(n){var o=-1,u=n==null?0:n.length;for(this.clear();++o<u;){var p=n[o];this.set(p[0],p[1])}}function Ym(){this.__data__=[],this.size=0}function Xm(n){var o=this.__data__,u=mr(o,n);if(u<0)return!1;var p=o.length-1;return u==p?o.pop():lr.call(o,u,1),--this.size,!0}function $m(n){var o=this.__data__,u=mr(o,n);return u<0?e:o[u][1]}function Vm(n){return mr(this.__data__,n)>-1}function qm(n,o){var u=this.__data__,p=mr(u,n);return p<0?(++this.size,u.push([n,o])):u[p][1]=o,this}pi.prototype.clear=Ym,pi.prototype.delete=Xm,pi.prototype.get=$m,pi.prototype.has=Vm,pi.prototype.set=qm;function gi(n){var o=-1,u=n==null?0:n.length;for(this.clear();++o<u;){var p=n[o];this.set(p[0],p[1])}}function jm(){this.size=0,this.__data__={hash:new Ji,map:new(on||pi),string:new Ji}}function Zm(n){var o=Pr(this,n).delete(n);return this.size-=o?1:0,o}function Km(n){return Pr(this,n).get(n)}function Jm(n){return Pr(this,n).has(n)}function Qm(n,o){var u=Pr(this,n),p=u.size;return u.set(n,o),this.size+=u.size==p?0:1,this}gi.prototype.clear=jm,gi.prototype.delete=Zm,gi.prototype.get=Km,gi.prototype.has=Jm,gi.prototype.set=Qm;function Qi(n){var o=-1,u=n==null?0:n.length;for(this.__data__=new gi;++o<u;)this.add(n[o])}function t_(n){return this.__data__.set(n,c),this}function e_(n){return this.__data__.has(n)}Qi.prototype.add=Qi.prototype.push=t_,Qi.prototype.has=e_;function qe(n){var o=this.__data__=new pi(n);this.size=o.size}function i_(){this.__data__=new pi,this.size=0}function s_(n){var o=this.__data__,u=o.delete(n);return this.size=o.size,u}function n_(n){return this.__data__.get(n)}function r_(n){return this.__data__.has(n)}function o_(n,o){var u=this.__data__;if(u instanceof pi){var p=u.__data__;if(!on||p.length<r-1)return p.push([n,o]),this.size=++u.size,this;u=this.__data__=new gi(p)}return u.set(n,o),this.size=u.size,this}qe.prototype.clear=i_,qe.prototype.delete=s_,qe.prototype.get=n_,qe.prototype.has=r_,qe.prototype.set=o_;function ru(n,o){var u=ot(n),p=!u&&ns(n),m=!u&&!p&&Hi(n),b=!u&&!p&&!m&&Ls(n),S=u||p||m||b,C=S?No(n.length,mm):[],k=C.length;for(var O in n)(o||At.call(n,O))&&!(S&&(O=="length"||m&&(O=="offset"||O=="parent")||b&&(O=="buffer"||O=="byteLength"||O=="byteOffset")||yi(O,k)))&&C.push(O);return C}function ou(n){var o=n.length;return o?n[oa(0,o-1)]:e}function a_(n,o){return Er(me(n),ts(o,0,n.length))}function h_(n){return Er(me(n))}function Zo(n,o,u){(u!==e&&!je(n[o],u)||u===e&&!(o in n))&&mi(n,o,u)}function un(n,o,u){var p=n[o];(!(At.call(n,o)&&je(p,u))||u===e&&!(o in n))&&mi(n,o,u)}function mr(n,o){for(var u=n.length;u--;)if(je(n[u][0],o))return u;return-1}function l_(n,o,u,p){return Oi(n,function(m,b,S){o(p,m,u(m),S)}),p}function au(n,o){return n&&hi(o,ee(o),n)}function u_(n,o){return n&&hi(o,xe(o),n)}function mi(n,o,u){o=="__proto__"&&ur?ur(n,o,{configurable:!0,enumerable:!0,value:u,writable:!0}):n[o]=u}function Ko(n,o){for(var u=-1,p=o.length,m=B(p),b=n==null;++u<p;)m[u]=b?e:Ia(n,o[u]);return m}function ts(n,o,u){return n===n&&(u!==e&&(n=n<=u?n:u),o!==e&&(n=n>=o?n:o)),n}function We(n,o,u,p,m,b){var S,C=o&g,k=o&x,O=o&_;if(u&&(S=m?u(n,p,m,b):u(n)),S!==e)return S;if(!Wt(n))return n;var D=ot(n);if(D){if(S=J_(n),!C)return me(n,S)}else{var W=ce(n),X=W==Le||W==oi;if(Hi(n))return Iu(n,C);if(W==Be||W==we||X&&!m){if(S=k||X?{}:Zu(n),!C)return k?H_(n,u_(S,n)):U_(n,au(S,n))}else{if(!It[W])return m?n:{};S=Q_(n,W,C)}}b||(b=new qe);var Z=b.get(n);if(Z)return Z;b.set(n,S),Tc(n)?n.forEach(function(it){S.add(We(it,o,u,it,n,b))}):Sc(n)&&n.forEach(function(it,ft){S.set(ft,We(it,o,u,ft,n,b))});var et=O?k?_a:ma:k?xe:ee,lt=D?e:et(n);return Ge(lt||n,function(it,ft){lt&&(ft=it,it=n[ft]),un(S,ft,We(it,o,u,ft,n,b))}),S}function c_(n){var o=ee(n);return function(u){return hu(u,n,o)}}function hu(n,o,u){var p=u.length;if(n==null)return!p;for(n=Et(n);p--;){var m=u[p],b=o[m],S=n[m];if(S===e&&!(m in n)||!b(S))return!1}return!0}function lu(n,o,u){if(typeof n!="function")throw new Oe(h);return _n(function(){n.apply(e,u)},o)}function cn(n,o,u,p){var m=-1,b=Qn,S=!0,C=n.length,k=[],O=o.length;if(!C)return k;u&&(o=Ft(o,Te(u))),p?(b=Oo,S=!1):o.length>=r&&(b=nn,S=!1,o=new Qi(o));t:for(;++m<C;){var D=n[m],W=u==null?D:u(D);if(D=p||D!==0?D:0,S&&W===W){for(var X=O;X--;)if(o[X]===W)continue t;k.push(D)}else b(o,W,p)||k.push(D)}return k}var Oi=Gu(ai),uu=Gu(Qo,!0);function d_(n,o){var u=!0;return Oi(n,function(p,m,b){return u=!!o(p,m,b),u}),u}function _r(n,o,u){for(var p=-1,m=n.length;++p<m;){var b=n[p],S=o(b);if(S!=null&&(C===e?S===S&&!Me(S):u(S,C)))var C=S,k=b}return k}function f_(n,o,u,p){var m=n.length;for(u=at(u),u<0&&(u=-u>m?0:m+u),p=p===e||p>m?m:at(p),p<0&&(p+=m),p=u>p?0:Mc(p);u<p;)n[u++]=o;return n}function cu(n,o){var u=[];return Oi(n,function(p,m,b){o(p,m,b)&&u.push(p)}),u}function ae(n,o,u,p,m){var b=-1,S=n.length;for(u||(u=ex),m||(m=[]);++b<S;){var C=n[b];o>0&&u(C)?o>1?ae(C,o-1,u,p,m):Bi(m,C):p||(m[m.length]=C)}return m}var Jo=Ou(),du=Ou(!0);function ai(n,o){return n&&Jo(n,o,ee)}function Qo(n,o){return n&&du(n,o,ee)}function xr(n,o){return Li(o,function(u){return bi(n[u])})}function es(n,o){o=Wi(o,n);for(var u=0,p=o.length;n!=null&&u<p;)n=n[li(o[u++])];return u&&u==p?n:e}function fu(n,o,u){var p=o(n);return ot(n)?p:Bi(p,u(n))}function de(n){return n==null?n===e?zp:xo:Ki&&Ki in Et(n)?j_(n):hx(n)}function ta(n,o){return n>o}function p_(n,o){return n!=null&&At.call(n,o)}function g_(n,o){return n!=null&&o in Et(n)}function m_(n,o,u){return n>=ue(o,u)&&n<Kt(o,u)}function ea(n,o,u){for(var p=u?Oo:Qn,m=n[0].length,b=n.length,S=b,C=B(b),k=1/0,O=[];S--;){var D=n[S];S&&o&&(D=Ft(D,Te(o))),k=ue(D.length,k),C[S]=!u&&(o||m>=120&&D.length>=120)?new Qi(S&&D):e}D=n[0];var W=-1,X=C[0];t:for(;++W<m&&O.length<k;){var Z=D[W],et=o?o(Z):Z;if(Z=u||Z!==0?Z:0,!(X?nn(X,et):p(O,et,u))){for(S=b;--S;){var lt=C[S];if(!(lt?nn(lt,et):p(n[S],et,u)))continue t}X&&X.push(et),O.push(Z)}}return O}function __(n,o,u,p){return ai(n,function(m,b,S){o(p,u(m),b,S)}),p}function dn(n,o,u){o=Wi(o,n),n=tc(n,o);var p=n==null?n:n[li(He(o))];return p==null?e:Ae(p,n,u)}function pu(n){return Ht(n)&&de(n)==we}function x_(n){return Ht(n)&&de(n)==sn}function y_(n){return Ht(n)&&de(n)==ri}function fn(n,o,u,p,m){return n===o?!0:n==null||o==null||!Ht(n)&&!Ht(o)?n!==n&&o!==o:b_(n,o,u,p,fn,m)}function b_(n,o,u,p,m,b){var S=ot(n),C=ot(o),k=S?ni:ce(n),O=C?ni:ce(o);k=k==we?Be:k,O=O==we?Be:O;var D=k==Be,W=O==Be,X=k==O;if(X&&Hi(n)){if(!Hi(o))return!1;S=!0,D=!1}if(X&&!D)return b||(b=new qe),S||Ls(n)?Vu(n,o,u,p,m,b):V_(n,o,k,u,p,m,b);if(!(u&v)){var Z=D&&At.call(n,"__wrapped__"),et=W&&At.call(o,"__wrapped__");if(Z||et){var lt=Z?n.value():n,it=et?o.value():o;return b||(b=new qe),m(lt,it,u,p,b)}}return X?(b||(b=new qe),q_(n,o,u,p,m,b)):!1}function v_(n){return Ht(n)&&ce(n)==jt}function ia(n,o,u,p){var m=u.length,b=m,S=!p;if(n==null)return!b;for(n=Et(n);m--;){var C=u[m];if(S&&C[2]?C[1]!==n[C[0]]:!(C[0]in n))return!1}for(;++m<b;){C=u[m];var k=C[0],O=n[k],D=C[1];if(S&&C[2]){if(O===e&&!(k in n))return!1}else{var W=new qe;if(p)var X=p(O,D,k,n,o,W);if(!(X===e?fn(D,O,v|T,p,W):X))return!1}}return!0}function gu(n){if(!Wt(n)||sx(n))return!1;var o=bi(n)?vm:cg;return o.test(ss(n))}function w_(n){return Ht(n)&&de(n)==Qs}function S_(n){return Ht(n)&&ce(n)==$e}function A_(n){return Ht(n)&&Fr(n.length)&&!!Bt[de(n)]}function mu(n){return typeof n=="function"?n:n==null?ye:typeof n=="object"?ot(n)?yu(n[0],n[1]):xu(n):Dc(n)}function sa(n){if(!mn(n))return Mm(n);var o=[];for(var u in Et(n))At.call(n,u)&&u!="constructor"&&o.push(u);return o}function T_(n){if(!Wt(n))return ax(n);var o=mn(n),u=[];for(var p in n)p=="constructor"&&(o||!At.call(n,p))||u.push(p);return u}function na(n,o){return n<o}function _u(n,o){var u=-1,p=_e(n)?B(n.length):[];return Oi(n,function(m,b,S){p[++u]=o(m,b,S)}),p}function xu(n){var o=ya(n);return o.length==1&&o[0][2]?Ju(o[0][0],o[0][1]):function(u){return u===n||ia(u,n,o)}}function yu(n,o){return va(n)&&Ku(o)?Ju(li(n),o):function(u){var p=Ia(u,n);return p===e&&p===o?Ra(u,n):fn(o,p,v|T)}}function yr(n,o,u,p,m){n!==o&&Jo(o,function(b,S){if(m||(m=new qe),Wt(b))C_(n,o,S,u,yr,p,m);else{var C=p?p(Sa(n,S),b,S+"",n,o,m):e;C===e&&(C=b),Zo(n,S,C)}},xe)}function C_(n,o,u,p,m,b,S){var C=Sa(n,u),k=Sa(o,u),O=S.get(k);if(O){Zo(n,u,O);return}var D=b?b(C,k,u+"",n,o,S):e,W=D===e;if(W){var X=ot(k),Z=!X&&Hi(k),et=!X&&!Z&&Ls(k);D=k,X||Z||et?ot(C)?D=C:Xt(C)?D=me(C):Z?(W=!1,D=Iu(k,!0)):et?(W=!1,D=Ru(k,!0)):D=[]:xn(k)||ns(k)?(D=C,ns(C)?D=Pc(C):(!Wt(C)||bi(C))&&(D=Zu(k))):W=!1}W&&(S.set(k,D),m(D,k,p,b,S),S.delete(k)),Zo(n,u,D)}function bu(n,o){var u=n.length;if(u)return o+=o<0?u:0,yi(o,u)?n[o]:e}function vu(n,o,u){o.length?o=Ft(o,function(b){return ot(b)?function(S){return es(S,b.length===1?b[0]:b)}:b}):o=[ye];var p=-1;o=Ft(o,Te(tt()));var m=_u(n,function(b,S,C){var k=Ft(o,function(O){return O(b)});return{criteria:k,index:++p,value:b}});return Qg(m,function(b,S){return W_(b,S,u)})}function M_(n,o){return wu(n,o,function(u,p){return Ra(n,p)})}function wu(n,o,u){for(var p=-1,m=o.length,b={};++p<m;){var S=o[p],C=es(n,S);u(C,S)&&pn(b,Wi(S,n),C)}return b}function P_(n){return function(o){return es(o,n)}}function ra(n,o,u,p){var m=p?Jg:ws,b=-1,S=o.length,C=n;for(n===o&&(o=me(o)),u&&(C=Ft(n,Te(u)));++b<S;)for(var k=0,O=o[b],D=u?u(O):O;(k=m(C,D,k,p))>-1;)C!==n&&lr.call(C,k,1),lr.call(n,k,1);return n}function Su(n,o){for(var u=n?o.length:0,p=u-1;u--;){var m=o[u];if(u==p||m!==b){var b=m;yi(m)?lr.call(n,m,1):la(n,m)}}return n}function oa(n,o){return n+dr(su()*(o-n+1))}function E_(n,o,u,p){for(var m=-1,b=Kt(cr((o-n)/(u||1)),0),S=B(b);b--;)S[p?b:++m]=n,n+=u;return S}function aa(n,o){var u="";if(!n||o<1||o>rt)return u;do o%2&&(u+=n),o=dr(o/2),o&&(n+=n);while(o);return u}function ct(n,o){return Aa(Qu(n,o,ye),n+"")}function k_(n){return ou(Bs(n))}function I_(n,o){var u=Bs(n);return Er(u,ts(o,0,u.length))}function pn(n,o,u,p){if(!Wt(n))return n;o=Wi(o,n);for(var m=-1,b=o.length,S=b-1,C=n;C!=null&&++m<b;){var k=li(o[m]),O=u;if(k==="__proto__"||k==="constructor"||k==="prototype")return n;if(m!=S){var D=C[k];O=p?p(D,k,C):e,O===e&&(O=Wt(D)?D:yi(o[m+1])?[]:{})}un(C,k,O),C=C[k]}return n}var Au=fr?function(n,o){return fr.set(n,o),n}:ye,R_=ur?function(n,o){return ur(n,"toString",{configurable:!0,enumerable:!1,value:Ba(o),writable:!0})}:ye;function L_(n){return Er(Bs(n))}function Ue(n,o,u){var p=-1,m=n.length;o<0&&(o=-o>m?0:m+o),u=u>m?m:u,u<0&&(u+=m),m=o>u?0:u-o>>>0,o>>>=0;for(var b=B(m);++p<m;)b[p]=n[p+o];return b}function B_(n,o){var u;return Oi(n,function(p,m,b){return u=o(p,m,b),!u}),!!u}function br(n,o,u){var p=0,m=n==null?p:n.length;if(typeof o=="number"&&o===o&&m<=Dt){for(;p<m;){var b=p+m>>>1,S=n[b];S!==null&&!Me(S)&&(u?S<=o:S<o)?p=b+1:m=b}return m}return ha(n,o,ye,u)}function ha(n,o,u,p){var m=0,b=n==null?0:n.length;if(b===0)return 0;o=u(o);for(var S=o!==o,C=o===null,k=Me(o),O=o===e;m<b;){var D=dr((m+b)/2),W=u(n[D]),X=W!==e,Z=W===null,et=W===W,lt=Me(W);if(S)var it=p||et;else O?it=et&&(p||X):C?it=et&&X&&(p||!Z):k?it=et&&X&&!Z&&(p||!lt):Z||lt?it=!1:it=p?W<=o:W<o;it?m=D+1:b=D}return ue(b,Pt)}function Tu(n,o){for(var u=-1,p=n.length,m=0,b=[];++u<p;){var S=n[u],C=o?o(S):S;if(!u||!je(C,k)){var k=C;b[m++]=S===0?0:S}}return b}function Cu(n){return typeof n=="number"?n:Me(n)?_t:+n}function Ce(n){if(typeof n=="string")return n;if(ot(n))return Ft(n,Ce)+"";if(Me(n))return nu?nu.call(n):"";var o=n+"";return o=="0"&&1/n==-z?"-0":o}function Di(n,o,u){var p=-1,m=Qn,b=n.length,S=!0,C=[],k=C;if(u)S=!1,m=Oo;else if(b>=r){var O=o?null:X_(n);if(O)return er(O);S=!1,m=nn,k=new Qi}else k=o?[]:C;t:for(;++p<b;){var D=n[p],W=o?o(D):D;if(D=u||D!==0?D:0,S&&W===W){for(var X=k.length;X--;)if(k[X]===W)continue t;o&&k.push(W),C.push(D)}else m(k,W,u)||(k!==C&&k.push(W),C.push(D))}return C}function la(n,o){o=Wi(o,n);var u=-1,p=o.length;if(!p)return!0;for(var m=n==null||typeof n!="object"&&typeof n!="function";++u<p;){var b=o[u];if(typeof b=="string"){if(b==="__proto__"&&!At.call(n,"__proto__"))return!1;if(b==="constructor"&&u+1<p&&typeof o[u+1]=="string"&&o[u+1]==="prototype"){if(m&&u===0)continue;return!1}}}var S=tc(n,o);return S==null||delete S[li(He(o))]}function Mu(n,o,u,p){return pn(n,o,u(es(n,o)),p)}function vr(n,o,u,p){for(var m=n.length,b=p?m:-1;(p?b--:++b<m)&&o(n[b],b,n););return u?Ue(n,p?0:b,p?b+1:m):Ue(n,p?b+1:0,p?m:b)}function Pu(n,o){var u=n;return u instanceof gt&&(u=u.value()),Do(o,function(p,m){return m.func.apply(m.thisArg,Bi([p],m.args))},u)}function ua(n,o,u){var p=n.length;if(p<2)return p?Di(n[0]):[];for(var m=-1,b=B(p);++m<p;)for(var S=n[m],C=-1;++C<p;)C!=m&&(b[m]=cn(b[m]||S,n[C],o,u));return Di(ae(b,1),o,u)}function Eu(n,o,u){for(var p=-1,m=n.length,b=o.length,S={};++p<m;){var C=p<b?o[p]:e;u(S,n[p],C)}return S}function ca(n){return Xt(n)?n:[]}function da(n){return typeof n=="function"?n:ye}function Wi(n,o){return ot(n)?n:va(n,o)?[n]:nc(Tt(n))}var F_=ct;function Ui(n,o,u){var p=n.length;return u=u===e?p:u,!o&&u>=p?n:Ue(n,o,u)}var ku=wm||function(n){return oe.clearTimeout(n)};function Iu(n,o){if(o)return n.slice();var u=n.length,p=Jl?Jl(u):new n.constructor(u);return n.copy(p),p}function fa(n){var o=new n.constructor(n.byteLength);return new ar(o).set(new ar(n)),o}function G_(n,o){var u=o?fa(n.buffer):n.buffer;return new n.constructor(u,n.byteOffset,n.byteLength)}function O_(n){var o=new n.constructor(n.source,pl.exec(n));return o.lastIndex=n.lastIndex,o}function D_(n){return ln?Et(ln.call(n)):{}}function Ru(n,o){var u=o?fa(n.buffer):n.buffer;return new n.constructor(u,n.byteOffset,n.length)}function Lu(n,o){if(n!==o){var u=n!==e,p=n===null,m=n===n,b=Me(n),S=o!==e,C=o===null,k=o===o,O=Me(o);if(!C&&!O&&!b&&n>o||b&&S&&k&&!C&&!O||p&&S&&k||!u&&k||!m)return 1;if(!p&&!b&&!O&&n<o||O&&u&&m&&!p&&!b||C&&u&&m||!S&&m||!k)return-1}return 0}function W_(n,o,u){for(var p=-1,m=n.criteria,b=o.criteria,S=m.length,C=u.length;++p<S;){var k=Lu(m[p],b[p]);if(k){if(p>=C)return k;var O=u[p];return k*(O=="desc"?-1:1)}}return n.index-o.index}function Bu(n,o,u,p){for(var m=-1,b=n.length,S=u.length,C=-1,k=o.length,O=Kt(b-S,0),D=B(k+O),W=!p;++C<k;)D[C]=o[C];for(;++m<S;)(W||m<b)&&(D[u[m]]=n[m]);for(;O--;)D[C++]=n[m++];return D}function Fu(n,o,u,p){for(var m=-1,b=n.length,S=-1,C=u.length,k=-1,O=o.length,D=Kt(b-C,0),W=B(D+O),X=!p;++m<D;)W[m]=n[m];for(var Z=m;++k<O;)W[Z+k]=o[k];for(;++S<C;)(X||m<b)&&(W[Z+u[S]]=n[m++]);return W}function me(n,o){var u=-1,p=n.length;for(o||(o=B(p));++u<p;)o[u]=n[u];return o}function hi(n,o,u,p){var m=!u;u||(u={});for(var b=-1,S=o.length;++b<S;){var C=o[b],k=p?p(u[C],n[C],C,u,n):e;k===e&&(k=n[C]),m?mi(u,C,k):un(u,C,k)}return u}function U_(n,o){return hi(n,ba(n),o)}function H_(n,o){return hi(n,qu(n),o)}function wr(n,o){return function(u,p){var m=ot(u)?$g:l_,b=o?o():{};return m(u,n,tt(p,2),b)}}function ks(n){return ct(function(o,u){var p=-1,m=u.length,b=m>1?u[m-1]:e,S=m>2?u[2]:e;for(b=n.length>3&&typeof b=="function"?(m--,b):e,S&&fe(u[0],u[1],S)&&(b=m<3?e:b,m=1),o=Et(o);++p<m;){var C=u[p];C&&n(o,C,p,b)}return o})}function Gu(n,o){return function(u,p){if(u==null)return u;if(!_e(u))return n(u,p);for(var m=u.length,b=o?m:-1,S=Et(u);(o?b--:++b<m)&&p(S[b],b,S)!==!1;);return u}}function Ou(n){return function(o,u,p){for(var m=-1,b=Et(o),S=p(o),C=S.length;C--;){var k=S[n?C:++m];if(u(b[k],k,b)===!1)break}return o}}function z_(n,o,u){var p=o&w,m=gn(n);function b(){var S=this&&this!==oe&&this instanceof b?m:n;return S.apply(p?u:this,arguments)}return b}function Du(n){return function(o){o=Tt(o);var u=Ss(o)?Ve(o):e,p=u?u[0]:o.charAt(0),m=u?Ui(u,1).join(""):o.slice(1);return p[n]()+m}}function Is(n){return function(o){return Do(Gc(Fc(o).replace(Rg,"")),n,"")}}function gn(n){return function(){var o=arguments;switch(o.length){case 0:return new n;case 1:return new n(o[0]);case 2:return new n(o[0],o[1]);case 3:return new n(o[0],o[1],o[2]);case 4:return new n(o[0],o[1],o[2],o[3]);case 5:return new n(o[0],o[1],o[2],o[3],o[4]);case 6:return new n(o[0],o[1],o[2],o[3],o[4],o[5]);case 7:return new n(o[0],o[1],o[2],o[3],o[4],o[5],o[6])}var u=Es(n.prototype),p=n.apply(u,o);return Wt(p)?p:u}}function N_(n,o,u){var p=gn(n);function m(){for(var b=arguments.length,S=B(b),C=b,k=Rs(m);C--;)S[C]=arguments[C];var O=b<3&&S[0]!==k&&S[b-1]!==k?[]:Fi(S,k);if(b-=O.length,b<u)return Nu(n,o,Sr,m.placeholder,e,S,O,e,e,u-b);var D=this&&this!==oe&&this instanceof m?p:n;return Ae(D,this,S)}return m}function Wu(n){return function(o,u,p){var m=Et(o);if(!_e(o)){var b=tt(u,3);o=ee(o),u=function(C){return b(m[C],C,m)}}var S=n(o,u,p);return S>-1?m[b?o[S]:S]:e}}function Uu(n){return xi(function(o){var u=o.length,p=u,m=De.prototype.thru;for(n&&o.reverse();p--;){var b=o[p];if(typeof b!="function")throw new Oe(h);if(m&&!S&&Mr(b)=="wrapper")var S=new De([],!0)}for(p=S?p:u;++p<u;){b=o[p];var C=Mr(b),k=C=="wrapper"?xa(b):e;k&&wa(k[0])&&k[1]==(G|M|L|Y)&&!k[4].length&&k[9]==1?S=S[Mr(k[0])].apply(S,k[3]):S=b.length==1&&wa(b)?S[C]():S.thru(b)}return function(){var O=arguments,D=O[0];if(S&&O.length==1&&ot(D))return S.plant(D).value();for(var W=0,X=u?o[W].apply(this,O):D;++W<u;)X=o[W].call(this,X);return X}})}function Sr(n,o,u,p,m,b,S,C,k,O){var D=o&G,W=o&w,X=o&A,Z=o&(M|P),et=o&q,lt=X?e:gn(n);function it(){for(var ft=arguments.length,xt=B(ft),Pe=ft;Pe--;)xt[Pe]=arguments[Pe];if(Z)var pe=Rs(it),Ee=em(xt,pe);if(p&&(xt=Bu(xt,p,m,Z)),b&&(xt=Fu(xt,b,S,Z)),ft-=Ee,Z&&ft<O){var $t=Fi(xt,pe);return Nu(n,o,Sr,it.placeholder,u,xt,$t,C,k,O-ft)}var Ze=W?u:this,wi=X?Ze[n]:n;return ft=xt.length,C?xt=lx(xt,C):et&&ft>1&&xt.reverse(),D&&k<ft&&(xt.length=k),this&&this!==oe&&this instanceof it&&(wi=lt||gn(wi)),wi.apply(Ze,xt)}return it}function Hu(n,o){return function(u,p){return __(u,n,o(p),{})}}function Ar(n,o){return function(u,p){var m;if(u===e&&p===e)return o;if(u!==e&&(m=u),p!==e){if(m===e)return p;typeof u=="string"||typeof p=="string"?(u=Ce(u),p=Ce(p)):(u=Cu(u),p=Cu(p)),m=n(u,p)}return m}}function pa(n){return xi(function(o){return o=Ft(o,Te(tt())),ct(function(u){var p=this;return n(o,function(m){return Ae(m,p,u)})})})}function Tr(n,o){o=o===e?" ":Ce(o);var u=o.length;if(u<2)return u?aa(o,n):o;var p=aa(o,cr(n/As(o)));return Ss(o)?Ui(Ve(p),0,n).join(""):p.slice(0,n)}function Y_(n,o,u,p){var m=o&w,b=gn(n);function S(){for(var C=-1,k=arguments.length,O=-1,D=p.length,W=B(D+k),X=this&&this!==oe&&this instanceof S?b:n;++O<D;)W[O]=p[O];for(;k--;)W[O++]=arguments[++C];return Ae(X,m?u:this,W)}return S}function zu(n){return function(o,u,p){return p&&typeof p!="number"&&fe(o,u,p)&&(u=p=e),o=vi(o),u===e?(u=o,o=0):u=vi(u),p=p===e?o<u?1:-1:vi(p),E_(o,u,p,n)}}function Cr(n){return function(o,u){return typeof o=="string"&&typeof u=="string"||(o=ze(o),u=ze(u)),n(o,u)}}function Nu(n,o,u,p,m,b,S,C,k,O){var D=o&M,W=D?S:e,X=D?e:S,Z=D?b:e,et=D?e:b;o|=D?L:R,o&=~(D?R:L),o&I||(o&=-4);var lt=[n,o,m,Z,W,et,X,C,k,O],it=u.apply(e,lt);return wa(n)&&ec(it,lt),it.placeholder=p,ic(it,n,o)}function ga(n){var o=Zt[n];return function(u,p){if(u=ze(u),p=p==null?0:ue(at(p),292),p&&iu(u)){var m=(Tt(u)+"e").split("e"),b=o(m[0]+"e"+(+m[1]+p));return m=(Tt(b)+"e").split("e"),+(m[0]+"e"+(+m[1]-p))}return o(u)}}var X_=Ms&&1/er(new Ms([,-0]))[1]==z?function(n){return new Ms(n)}:Oa;function Yu(n){return function(o){var u=ce(o);return u==jt?Xo(o):u==$e?hm(o):tm(o,n(o))}}function _i(n,o,u,p,m,b,S,C){var k=o&A;if(!k&&typeof n!="function")throw new Oe(h);var O=p?p.length:0;if(O||(o&=-97,p=m=e),S=S===e?S:Kt(at(S),0),C=C===e?C:at(C),O-=m?m.length:0,o&R){var D=p,W=m;p=m=e}var X=k?e:xa(n),Z=[n,o,u,p,m,D,W,b,S,C];if(X&&ox(Z,X),n=Z[0],o=Z[1],u=Z[2],p=Z[3],m=Z[4],C=Z[9]=Z[9]===e?k?0:n.length:Kt(Z[9]-O,0),!C&&o&(M|P)&&(o&=-25),!o||o==w)var et=z_(n,o,u);else o==M||o==P?et=N_(n,o,C):(o==L||o==(w|L))&&!m.length?et=Y_(n,o,u,p):et=Sr.apply(e,Z);var lt=X?Au:ec;return ic(lt(et,Z),n,o)}function Xu(n,o,u,p){return n===e||je(n,Cs[u])&&!At.call(p,u)?o:n}function $u(n,o,u,p,m,b){return Wt(n)&&Wt(o)&&(b.set(o,n),yr(n,o,e,$u,b),b.delete(o)),n}function $_(n){return xn(n)?e:n}function Vu(n,o,u,p,m,b){var S=u&v,C=n.length,k=o.length;if(C!=k&&!(S&&k>C))return!1;var O=b.get(n),D=b.get(o);if(O&&D)return O==o&&D==n;var W=-1,X=!0,Z=u&T?new Qi:e;for(b.set(n,o),b.set(o,n);++W<C;){var et=n[W],lt=o[W];if(p)var it=S?p(lt,et,W,o,n,b):p(et,lt,W,n,o,b);if(it!==e){if(it)continue;X=!1;break}if(Z){if(!Wo(o,function(ft,xt){if(!nn(Z,xt)&&(et===ft||m(et,ft,u,p,b)))return Z.push(xt)})){X=!1;break}}else if(!(et===lt||m(et,lt,u,p,b))){X=!1;break}}return b.delete(n),b.delete(o),X}function V_(n,o,u,p,m,b,S){switch(u){case bs:if(n.byteLength!=o.byteLength||n.byteOffset!=o.byteOffset)return!1;n=n.buffer,o=o.buffer;case sn:return!(n.byteLength!=o.byteLength||!b(new ar(n),new ar(o)));case Ii:case ri:case Se:return je(+n,+o);case Ri:return n.name==o.name&&n.message==o.message;case Qs:case tn:return n==o+"";case jt:var C=Xo;case $e:var k=p&v;if(C||(C=er),n.size!=o.size&&!k)return!1;var O=S.get(n);if(O)return O==o;p|=T,S.set(n,o);var D=Vu(C(n),C(o),p,m,b,S);return S.delete(n),D;case jn:if(ln)return ln.call(n)==ln.call(o)}return!1}function q_(n,o,u,p,m,b){var S=u&v,C=ma(n),k=C.length,O=ma(o),D=O.length;if(k!=D&&!S)return!1;for(var W=k;W--;){var X=C[W];if(!(S?X in o:At.call(o,X)))return!1}var Z=b.get(n),et=b.get(o);if(Z&&et)return Z==o&&et==n;var lt=!0;b.set(n,o),b.set(o,n);for(var it=S;++W<k;){X=C[W];var ft=n[X],xt=o[X];if(p)var Pe=S?p(xt,ft,X,o,n,b):p(ft,xt,X,n,o,b);if(!(Pe===e?ft===xt||m(ft,xt,u,p,b):Pe)){lt=!1;break}it||(it=X=="constructor")}if(lt&&!it){var pe=n.constructor,Ee=o.constructor;pe!=Ee&&"constructor"in n&&"constructor"in o&&!(typeof pe=="function"&&pe instanceof pe&&typeof Ee=="function"&&Ee instanceof Ee)&&(lt=!1)}return b.delete(n),b.delete(o),lt}function xi(n){return Aa(Qu(n,e,hc),n+"")}function ma(n){return fu(n,ee,ba)}function _a(n){return fu(n,xe,qu)}var xa=fr?function(n){return fr.get(n)}:Oa;function Mr(n){for(var o=n.name+"",u=Ps[o],p=At.call(Ps,o)?u.length:0;p--;){var m=u[p],b=m.func;if(b==null||b==n)return m.name}return o}function Rs(n){var o=At.call(y,"placeholder")?y:n;return o.placeholder}function tt(){var n=y.iteratee||Fa;return n=n===Fa?mu:n,arguments.length?n(arguments[0],arguments[1]):n}function Pr(n,o){var u=n.__data__;return ix(o)?u[typeof o=="string"?"string":"hash"]:u.map}function ya(n){for(var o=ee(n),u=o.length;u--;){var p=o[u],m=n[p];o[u]=[p,m,Ku(m)]}return o}function is(n,o){var u=rm(n,o);return gu(u)?u:e}function j_(n){var o=At.call(n,Ki),u=n[Ki];try{n[Ki]=e;var p=!0}catch{}var m=rr.call(n);return p&&(o?n[Ki]=u:delete n[Ki]),m}var ba=Vo?function(n){return n==null?[]:(n=Et(n),Li(Vo(n),function(o){return tu.call(n,o)}))}:Da,qu=Vo?function(n){for(var o=[];n;)Bi(o,ba(n)),n=hr(n);return o}:Da,ce=de;(qo&&ce(new qo(new ArrayBuffer(1)))!=bs||on&&ce(new on)!=jt||jo&&ce(jo.resolve())!=qn||Ms&&ce(new Ms)!=$e||an&&ce(new an)!=en)&&(ce=function(n){var o=de(n),u=o==Be?n.constructor:e,p=u?ss(u):"";if(p)switch(p){case Im:return bs;case Rm:return jt;case Lm:return qn;case Bm:return $e;case Fm:return en}return o});function Z_(n,o,u){for(var p=-1,m=u.length;++p<m;){var b=u[p],S=b.size;switch(b.type){case"drop":n+=S;break;case"dropRight":o-=S;break;case"take":o=ue(o,n+S);break;case"takeRight":n=Kt(n,o-S);break}}return{start:n,end:o}}function K_(n){var o=n.match(sg);return o?o[1].split(ng):[]}function ju(n,o,u){o=Wi(o,n);for(var p=-1,m=o.length,b=!1;++p<m;){var S=li(o[p]);if(!(b=n!=null&&u(n,S)))break;n=n[S]}return b||++p!=m?b:(m=n==null?0:n.length,!!m&&Fr(m)&&yi(S,m)&&(ot(n)||ns(n)))}function J_(n){var o=n.length,u=new n.constructor(o);return o&&typeof n[0]=="string"&&At.call(n,"index")&&(u.index=n.index,u.input=n.input),u}function Zu(n){return typeof n.constructor=="function"&&!mn(n)?Es(hr(n)):{}}function Q_(n,o,u){var p=n.constructor;switch(o){case sn:return fa(n);case Ii:case ri:return new p(+n);case bs:return G_(n,u);case yo:case bo:case vo:case wo:case So:case Ao:case To:case Co:case Mo:return Ru(n,u);case jt:return new p;case Se:case tn:return new p(n);case Qs:return O_(n);case $e:return new p;case jn:return D_(n)}}function tx(n,o){var u=o.length;if(!u)return n;var p=u-1;return o[p]=(u>1?"& ":"")+o[p],o=o.join(u>2?", ":" "),n.replace(ig,`{
/* [wrapped with `+o+`] */
`)}function ex(n){return ot(n)||ns(n)||!!(eu&&n&&n[eu])}function yi(n,o){var u=typeof n;return o=o??rt,!!o&&(u=="number"||u!="symbol"&&fg.test(n))&&n>-1&&n%1==0&&n<o}function fe(n,o,u){if(!Wt(u))return!1;var p=typeof o;return(p=="number"?_e(u)&&yi(o,u.length):p=="string"&&o in u)?je(u[o],n):!1}function va(n,o){if(ot(n))return!1;var u=typeof n;return u=="number"||u=="symbol"||u=="boolean"||n==null||Me(n)?!0:Jp.test(n)||!Kp.test(n)||o!=null&&n in Et(o)}function ix(n){var o=typeof n;return o=="string"||o=="number"||o=="symbol"||o=="boolean"?n!=="__proto__":n===null}function wa(n){var o=Mr(n),u=y[o];if(typeof u!="function"||!(o in gt.prototype))return!1;if(n===u)return!0;var p=xa(u);return!!p&&n===p[0]}function sx(n){return!!Kl&&Kl in n}var nx=sr?bi:Wa;function mn(n){var o=n&&n.constructor,u=typeof o=="function"&&o.prototype||Cs;return n===u}function Ku(n){return n===n&&!Wt(n)}function Ju(n,o){return function(u){return u==null?!1:u[n]===o&&(o!==e||n in Et(u))}}function rx(n){var o=Lr(n,function(p){return u.size===f&&u.clear(),p}),u=o.cache;return o}function ox(n,o){var u=n[1],p=o[1],m=u|p,b=m<(w|A|G),S=p==G&&u==M||p==G&&u==Y&&n[7].length<=o[8]||p==(G|Y)&&o[7].length<=o[8]&&u==M;if(!(b||S))return n;p&w&&(n[2]=o[2],m|=u&w?0:I);var C=o[3];if(C){var k=n[3];n[3]=k?Bu(k,C,o[4]):C,n[4]=k?Fi(n[3],d):o[4]}return C=o[5],C&&(k=n[5],n[5]=k?Fu(k,C,o[6]):C,n[6]=k?Fi(n[5],d):o[6]),C=o[7],C&&(n[7]=C),p&G&&(n[8]=n[8]==null?o[8]:ue(n[8],o[8])),n[9]==null&&(n[9]=o[9]),n[0]=o[0],n[1]=m,n}function ax(n){var o=[];if(n!=null)for(var u in Et(n))o.push(u);return o}function hx(n){return rr.call(n)}function Qu(n,o,u){return o=Kt(o===e?n.length-1:o,0),function(){for(var p=arguments,m=-1,b=Kt(p.length-o,0),S=B(b);++m<b;)S[m]=p[o+m];m=-1;for(var C=B(o+1);++m<o;)C[m]=p[m];return C[o]=u(S),Ae(n,this,C)}}function tc(n,o){return o.length<2?n:es(n,Ue(o,0,-1))}function lx(n,o){for(var u=n.length,p=ue(o.length,u),m=me(n);p--;){var b=o[p];n[p]=yi(b,u)?m[b]:e}return n}function Sa(n,o){if(!(o==="constructor"&&typeof n[o]=="function")&&o!="__proto__")return n[o]}var ec=sc(Au),_n=Am||function(n,o){return oe.setTimeout(n,o)},Aa=sc(R_);function ic(n,o,u){var p=o+"";return Aa(n,tx(p,ux(K_(p),u)))}function sc(n){var o=0,u=0;return function(){var p=Pm(),m=Q-(p-u);if(u=p,m>0){if(++o>=K)return arguments[0]}else o=0;return n.apply(e,arguments)}}function Er(n,o){var u=-1,p=n.length,m=p-1;for(o=o===e?p:o;++u<o;){var b=oa(u,m),S=n[b];n[b]=n[u],n[u]=S}return n.length=o,n}var nc=rx(function(n){var o=[];return n.charCodeAt(0)===46&&o.push(""),n.replace(Qp,function(u,p,m,b){o.push(m?b.replace(ag,"$1"):p||u)}),o});function li(n){if(typeof n=="string"||Me(n))return n;var o=n+"";return o=="0"&&1/n==-z?"-0":o}function ss(n){if(n!=null){try{return nr.call(n)}catch{}try{return n+""}catch{}}return""}function ux(n,o){return Ge(re,function(u){var p="_."+u[0];o&u[1]&&!Qn(n,p)&&n.push(p)}),n.sort()}function rc(n){if(n instanceof gt)return n.clone();var o=new De(n.__wrapped__,n.__chain__);return o.__actions__=me(n.__actions__),o.__index__=n.__index__,o.__values__=n.__values__,o}function cx(n,o,u){(u?fe(n,o,u):o===e)?o=1:o=Kt(at(o),0);var p=n==null?0:n.length;if(!p||o<1)return[];for(var m=0,b=0,S=B(cr(p/o));m<p;)S[b++]=Ue(n,m,m+=o);return S}function dx(n){for(var o=-1,u=n==null?0:n.length,p=0,m=[];++o<u;){var b=n[o];b&&(m[p++]=b)}return m}function fx(){var n=arguments.length;if(!n)return[];for(var o=B(n-1),u=arguments[0],p=n;p--;)o[p-1]=arguments[p];return Bi(ot(u)?me(u):[u],ae(o,1))}var px=ct(function(n,o){return Xt(n)?cn(n,ae(o,1,Xt,!0)):[]}),gx=ct(function(n,o){var u=He(o);return Xt(u)&&(u=e),Xt(n)?cn(n,ae(o,1,Xt,!0),tt(u,2)):[]}),mx=ct(function(n,o){var u=He(o);return Xt(u)&&(u=e),Xt(n)?cn(n,ae(o,1,Xt,!0),e,u):[]});function _x(n,o,u){var p=n==null?0:n.length;return p?(o=u||o===e?1:at(o),Ue(n,o<0?0:o,p)):[]}function xx(n,o,u){var p=n==null?0:n.length;return p?(o=u||o===e?1:at(o),o=p-o,Ue(n,0,o<0?0:o)):[]}function yx(n,o){return n&&n.length?vr(n,tt(o,3),!0,!0):[]}function bx(n,o){return n&&n.length?vr(n,tt(o,3),!0):[]}function vx(n,o,u,p){var m=n==null?0:n.length;return m?(u&&typeof u!="number"&&fe(n,o,u)&&(u=0,p=m),f_(n,o,u,p)):[]}function oc(n,o,u){var p=n==null?0:n.length;if(!p)return-1;var m=u==null?0:at(u);return m<0&&(m=Kt(p+m,0)),tr(n,tt(o,3),m)}function ac(n,o,u){var p=n==null?0:n.length;if(!p)return-1;var m=p-1;return u!==e&&(m=at(u),m=u<0?Kt(p+m,0):ue(m,p-1)),tr(n,tt(o,3),m,!0)}function hc(n){var o=n==null?0:n.length;return o?ae(n,1):[]}function wx(n){var o=n==null?0:n.length;return o?ae(n,z):[]}function Sx(n,o){var u=n==null?0:n.length;return u?(o=o===e?1:at(o),ae(n,o)):[]}function Ax(n){for(var o=-1,u=n==null?0:n.length,p={};++o<u;){var m=n[o];p[m[0]]=m[1]}return p}function lc(n){return n&&n.length?n[0]:e}function Tx(n,o,u){var p=n==null?0:n.length;if(!p)return-1;var m=u==null?0:at(u);return m<0&&(m=Kt(p+m,0)),ws(n,o,m)}function Cx(n){var o=n==null?0:n.length;return o?Ue(n,0,-1):[]}var Mx=ct(function(n){var o=Ft(n,ca);return o.length&&o[0]===n[0]?ea(o):[]}),Px=ct(function(n){var o=He(n),u=Ft(n,ca);return o===He(u)?o=e:u.pop(),u.length&&u[0]===n[0]?ea(u,tt(o,2)):[]}),Ex=ct(function(n){var o=He(n),u=Ft(n,ca);return o=typeof o=="function"?o:e,o&&u.pop(),u.length&&u[0]===n[0]?ea(u,e,o):[]});function kx(n,o){return n==null?"":Cm.call(n,o)}function He(n){var o=n==null?0:n.length;return o?n[o-1]:e}function Ix(n,o,u){var p=n==null?0:n.length;if(!p)return-1;var m=p;return u!==e&&(m=at(u),m=m<0?Kt(p+m,0):ue(m,p-1)),o===o?um(n,o,m):tr(n,Nl,m,!0)}function Rx(n,o){return n&&n.length?bu(n,at(o)):e}var Lx=ct(uc);function uc(n,o){return n&&n.length&&o&&o.length?ra(n,o):n}function Bx(n,o,u){return n&&n.length&&o&&o.length?ra(n,o,tt(u,2)):n}function Fx(n,o,u){return n&&n.length&&o&&o.length?ra(n,o,e,u):n}var Gx=xi(function(n,o){var u=n==null?0:n.length,p=Ko(n,o);return Su(n,Ft(o,function(m){return yi(m,u)?+m:m}).sort(Lu)),p});function Ox(n,o){var u=[];if(!(n&&n.length))return u;var p=-1,m=[],b=n.length;for(o=tt(o,3);++p<b;){var S=n[p];o(S,p,n)&&(u.push(S),m.push(p))}return Su(n,m),u}function Ta(n){return n==null?n:km.call(n)}function Dx(n,o,u){var p=n==null?0:n.length;return p?(u&&typeof u!="number"&&fe(n,o,u)?(o=0,u=p):(o=o==null?0:at(o),u=u===e?p:at(u)),Ue(n,o,u)):[]}function Wx(n,o){return br(n,o)}function Ux(n,o,u){return ha(n,o,tt(u,2))}function Hx(n,o){var u=n==null?0:n.length;if(u){var p=br(n,o);if(p<u&&je(n[p],o))return p}return-1}function zx(n,o){return br(n,o,!0)}function Nx(n,o,u){return ha(n,o,tt(u,2),!0)}function Yx(n,o){var u=n==null?0:n.length;if(u){var p=br(n,o,!0)-1;if(je(n[p],o))return p}return-1}function Xx(n){return n&&n.length?Tu(n):[]}function $x(n,o){return n&&n.length?Tu(n,tt(o,2)):[]}function Vx(n){var o=n==null?0:n.length;return o?Ue(n,1,o):[]}function qx(n,o,u){return n&&n.length?(o=u||o===e?1:at(o),Ue(n,0,o<0?0:o)):[]}function jx(n,o,u){var p=n==null?0:n.length;return p?(o=u||o===e?1:at(o),o=p-o,Ue(n,o<0?0:o,p)):[]}function Zx(n,o){return n&&n.length?vr(n,tt(o,3),!1,!0):[]}function Kx(n,o){return n&&n.length?vr(n,tt(o,3)):[]}var Jx=ct(function(n){return Di(ae(n,1,Xt,!0))}),Qx=ct(function(n){var o=He(n);return Xt(o)&&(o=e),Di(ae(n,1,Xt,!0),tt(o,2))}),t0=ct(function(n){var o=He(n);return o=typeof o=="function"?o:e,Di(ae(n,1,Xt,!0),e,o)});function e0(n){return n&&n.length?Di(n):[]}function i0(n,o){return n&&n.length?Di(n,tt(o,2)):[]}function s0(n,o){return o=typeof o=="function"?o:e,n&&n.length?Di(n,e,o):[]}function Ca(n){if(!(n&&n.length))return[];var o=0;return n=Li(n,function(u){if(Xt(u))return o=Kt(u.length,o),!0}),No(o,function(u){return Ft(n,Uo(u))})}function cc(n,o){if(!(n&&n.length))return[];var u=Ca(n);return o==null?u:Ft(u,function(p){return Ae(o,e,p)})}var n0=ct(function(n,o){return Xt(n)?cn(n,o):[]}),r0=ct(function(n){return ua(Li(n,Xt))}),o0=ct(function(n){var o=He(n);return Xt(o)&&(o=e),ua(Li(n,Xt),tt(o,2))}),a0=ct(function(n){var o=He(n);return o=typeof o=="function"?o:e,ua(Li(n,Xt),e,o)}),h0=ct(Ca);function l0(n,o){return Eu(n||[],o||[],un)}function u0(n,o){return Eu(n||[],o||[],pn)}var c0=ct(function(n){var o=n.length,u=o>1?n[o-1]:e;return u=typeof u=="function"?(n.pop(),u):e,cc(n,u)});function dc(n){var o=y(n);return o.__chain__=!0,o}function d0(n,o){return o(n),n}function kr(n,o){return o(n)}var f0=xi(function(n){var o=n.length,u=o?n[0]:0,p=this.__wrapped__,m=function(b){return Ko(b,n)};return o>1||this.__actions__.length||!(p instanceof gt)||!yi(u)?this.thru(m):(p=p.slice(u,+u+(o?1:0)),p.__actions__.push({func:kr,args:[m],thisArg:e}),new De(p,this.__chain__).thru(function(b){return o&&!b.length&&b.push(e),b}))});function p0(){return dc(this)}function g0(){return new De(this.value(),this.__chain__)}function m0(){this.__values__===e&&(this.__values__=Cc(this.value()));var n=this.__index__>=this.__values__.length,o=n?e:this.__values__[this.__index__++];return{done:n,value:o}}function _0(){return this}function x0(n){for(var o,u=this;u instanceof gr;){var p=rc(u);p.__index__=0,p.__values__=e,o?m.__wrapped__=p:o=p;var m=p;u=u.__wrapped__}return m.__wrapped__=n,o}function y0(){var n=this.__wrapped__;if(n instanceof gt){var o=n;return this.__actions__.length&&(o=new gt(this)),o=o.reverse(),o.__actions__.push({func:kr,args:[Ta],thisArg:e}),new De(o,this.__chain__)}return this.thru(Ta)}function b0(){return Pu(this.__wrapped__,this.__actions__)}var v0=wr(function(n,o,u){At.call(n,u)?++n[u]:mi(n,u,1)});function w0(n,o,u){var p=ot(n)?Hl:d_;return u&&fe(n,o,u)&&(o=e),p(n,tt(o,3))}function S0(n,o){var u=ot(n)?Li:cu;return u(n,tt(o,3))}var A0=Wu(oc),T0=Wu(ac);function C0(n,o){return ae(Ir(n,o),1)}function M0(n,o){return ae(Ir(n,o),z)}function P0(n,o,u){return u=u===e?1:at(u),ae(Ir(n,o),u)}function fc(n,o){var u=ot(n)?Ge:Oi;return u(n,tt(o,3))}function pc(n,o){var u=ot(n)?Vg:uu;return u(n,tt(o,3))}var E0=wr(function(n,o,u){At.call(n,u)?n[u].push(o):mi(n,u,[o])});function k0(n,o,u,p){n=_e(n)?n:Bs(n),u=u&&!p?at(u):0;var m=n.length;return u<0&&(u=Kt(m+u,0)),Gr(n)?u<=m&&n.indexOf(o,u)>-1:!!m&&ws(n,o,u)>-1}var I0=ct(function(n,o,u){var p=-1,m=typeof o=="function",b=_e(n)?B(n.length):[];return Oi(n,function(S){b[++p]=m?Ae(o,S,u):dn(S,o,u)}),b}),R0=wr(function(n,o,u){mi(n,u,o)});function Ir(n,o){var u=ot(n)?Ft:_u;return u(n,tt(o,3))}function L0(n,o,u,p){return n==null?[]:(ot(o)||(o=o==null?[]:[o]),u=p?e:u,ot(u)||(u=u==null?[]:[u]),vu(n,o,u))}var B0=wr(function(n,o,u){n[u?0:1].push(o)},function(){return[[],[]]});function F0(n,o,u){var p=ot(n)?Do:Xl,m=arguments.length<3;return p(n,tt(o,4),u,m,Oi)}function G0(n,o,u){var p=ot(n)?qg:Xl,m=arguments.length<3;return p(n,tt(o,4),u,m,uu)}function O0(n,o){var u=ot(n)?Li:cu;return u(n,Br(tt(o,3)))}function D0(n){var o=ot(n)?ou:k_;return o(n)}function W0(n,o,u){(u?fe(n,o,u):o===e)?o=1:o=at(o);var p=ot(n)?a_:I_;return p(n,o)}function U0(n){var o=ot(n)?h_:L_;return o(n)}function H0(n){if(n==null)return 0;if(_e(n))return Gr(n)?As(n):n.length;var o=ce(n);return o==jt||o==$e?n.size:sa(n).length}function z0(n,o,u){var p=ot(n)?Wo:B_;return u&&fe(n,o,u)&&(o=e),p(n,tt(o,3))}var N0=ct(function(n,o){if(n==null)return[];var u=o.length;return u>1&&fe(n,o[0],o[1])?o=[]:u>2&&fe(o[0],o[1],o[2])&&(o=[o[0]]),vu(n,ae(o,1),[])}),Rr=Sm||function(){return oe.Date.now()};function Y0(n,o){if(typeof o!="function")throw new Oe(h);return n=at(n),function(){if(--n<1)return o.apply(this,arguments)}}function gc(n,o,u){return o=u?e:o,o=n&&o==null?n.length:o,_i(n,G,e,e,e,e,o)}function mc(n,o){var u;if(typeof o!="function")throw new Oe(h);return n=at(n),function(){return--n>0&&(u=o.apply(this,arguments)),n<=1&&(o=e),u}}var Ma=ct(function(n,o,u){var p=w;if(u.length){var m=Fi(u,Rs(Ma));p|=L}return _i(n,p,o,u,m)}),_c=ct(function(n,o,u){var p=w|A;if(u.length){var m=Fi(u,Rs(_c));p|=L}return _i(o,p,n,u,m)});function xc(n,o,u){o=u?e:o;var p=_i(n,M,e,e,e,e,e,o);return p.placeholder=xc.placeholder,p}function yc(n,o,u){o=u?e:o;var p=_i(n,P,e,e,e,e,e,o);return p.placeholder=yc.placeholder,p}function bc(n,o,u){var p,m,b,S,C,k,O=0,D=!1,W=!1,X=!0;if(typeof n!="function")throw new Oe(h);o=ze(o)||0,Wt(u)&&(D=!!u.leading,W="maxWait"in u,b=W?Kt(ze(u.maxWait)||0,o):b,X="trailing"in u?!!u.trailing:X);function Z($t){var Ze=p,wi=m;return p=m=e,O=$t,S=n.apply(wi,Ze),S}function et($t){return O=$t,C=_n(ft,o),D?Z($t):S}function lt($t){var Ze=$t-k,wi=$t-O,Wc=o-Ze;return W?ue(Wc,b-wi):Wc}function it($t){var Ze=$t-k,wi=$t-O;return k===e||Ze>=o||Ze<0||W&&wi>=b}function ft(){var $t=Rr();if(it($t))return xt($t);C=_n(ft,lt($t))}function xt($t){return C=e,X&&p?Z($t):(p=m=e,S)}function Pe(){C!==e&&ku(C),O=0,p=k=m=C=e}function pe(){return C===e?S:xt(Rr())}function Ee(){var $t=Rr(),Ze=it($t);if(p=arguments,m=this,k=$t,Ze){if(C===e)return et(k);if(W)return ku(C),C=_n(ft,o),Z(k)}return C===e&&(C=_n(ft,o)),S}return Ee.cancel=Pe,Ee.flush=pe,Ee}var X0=ct(function(n,o){return lu(n,1,o)}),$0=ct(function(n,o,u){return lu(n,ze(o)||0,u)});function V0(n){return _i(n,q)}function Lr(n,o){if(typeof n!="function"||o!=null&&typeof o!="function")throw new Oe(h);var u=function(){var p=arguments,m=o?o.apply(this,p):p[0],b=u.cache;if(b.has(m))return b.get(m);var S=n.apply(this,p);return u.cache=b.set(m,S)||b,S};return u.cache=new(Lr.Cache||gi),u}Lr.Cache=gi;function Br(n){if(typeof n!="function")throw new Oe(h);return function(){var o=arguments;switch(o.length){case 0:return!n.call(this);case 1:return!n.call(this,o[0]);case 2:return!n.call(this,o[0],o[1]);case 3:return!n.call(this,o[0],o[1],o[2])}return!n.apply(this,o)}}function q0(n){return mc(2,n)}var j0=F_(function(n,o){o=o.length==1&&ot(o[0])?Ft(o[0],Te(tt())):Ft(ae(o,1),Te(tt()));var u=o.length;return ct(function(p){for(var m=-1,b=ue(p.length,u);++m<b;)p[m]=o[m].call(this,p[m]);return Ae(n,this,p)})}),Pa=ct(function(n,o){var u=Fi(o,Rs(Pa));return _i(n,L,e,o,u)}),vc=ct(function(n,o){var u=Fi(o,Rs(vc));return _i(n,R,e,o,u)}),Z0=xi(function(n,o){return _i(n,Y,e,e,e,o)});function K0(n,o){if(typeof n!="function")throw new Oe(h);return o=o===e?o:at(o),ct(n,o)}function J0(n,o){if(typeof n!="function")throw new Oe(h);return o=o==null?0:Kt(at(o),0),ct(function(u){var p=u[o],m=Ui(u,0,o);return p&&Bi(m,p),Ae(n,this,m)})}function Q0(n,o,u){var p=!0,m=!0;if(typeof n!="function")throw new Oe(h);return Wt(u)&&(p="leading"in u?!!u.leading:p,m="trailing"in u?!!u.trailing:m),bc(n,o,{leading:p,maxWait:o,trailing:m})}function ty(n){return gc(n,1)}function ey(n,o){return Pa(da(o),n)}function iy(){if(!arguments.length)return[];var n=arguments[0];return ot(n)?n:[n]}function sy(n){return We(n,_)}function ny(n,o){return o=typeof o=="function"?o:e,We(n,_,o)}function ry(n){return We(n,g|_)}function oy(n,o){return o=typeof o=="function"?o:e,We(n,g|_,o)}function ay(n,o){return o==null||hu(n,o,ee(o))}function je(n,o){return n===o||n!==n&&o!==o}var hy=Cr(ta),ly=Cr(function(n,o){return n>=o}),ns=pu((function(){return arguments})())?pu:function(n){return Ht(n)&&At.call(n,"callee")&&!tu.call(n,"callee")},ot=B.isArray,uy=Fl?Te(Fl):x_;function _e(n){return n!=null&&Fr(n.length)&&!bi(n)}function Xt(n){return Ht(n)&&_e(n)}function cy(n){return n===!0||n===!1||Ht(n)&&de(n)==Ii}var Hi=Tm||Wa,dy=Gl?Te(Gl):y_;function fy(n){return Ht(n)&&n.nodeType===1&&!xn(n)}function py(n){if(n==null)return!0;if(_e(n)&&(ot(n)||typeof n=="string"||typeof n.splice=="function"||Hi(n)||Ls(n)||ns(n)))return!n.length;var o=ce(n);if(o==jt||o==$e)return!n.size;if(mn(n))return!sa(n).length;for(var u in n)if(At.call(n,u))return!1;return!0}function gy(n,o){return fn(n,o)}function my(n,o,u){u=typeof u=="function"?u:e;var p=u?u(n,o):e;return p===e?fn(n,o,e,u):!!p}function Ea(n){if(!Ht(n))return!1;var o=de(n);return o==Ri||o==ys||typeof n.message=="string"&&typeof n.name=="string"&&!xn(n)}function _y(n){return typeof n=="number"&&iu(n)}function bi(n){if(!Wt(n))return!1;var o=de(n);return o==Le||o==oi||o==Vn||o==ul}function wc(n){return typeof n=="number"&&n==at(n)}function Fr(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=rt}function Wt(n){var o=typeof n;return n!=null&&(o=="object"||o=="function")}function Ht(n){return n!=null&&typeof n=="object"}var Sc=Ol?Te(Ol):v_;function xy(n,o){return n===o||ia(n,o,ya(o))}function yy(n,o,u){return u=typeof u=="function"?u:e,ia(n,o,ya(o),u)}function by(n){return Ac(n)&&n!=+n}function vy(n){if(nx(n))throw new nt(a);return gu(n)}function wy(n){return n===null}function Sy(n){return n==null}function Ac(n){return typeof n=="number"||Ht(n)&&de(n)==Se}function xn(n){if(!Ht(n)||de(n)!=Be)return!1;var o=hr(n);if(o===null)return!0;var u=At.call(o,"constructor")&&o.constructor;return typeof u=="function"&&u instanceof u&&nr.call(u)==ym}var ka=Dl?Te(Dl):w_;function Ay(n){return wc(n)&&n>=-rt&&n<=rt}var Tc=Wl?Te(Wl):S_;function Gr(n){return typeof n=="string"||!ot(n)&&Ht(n)&&de(n)==tn}function Me(n){return typeof n=="symbol"||Ht(n)&&de(n)==jn}var Ls=Ul?Te(Ul):A_;function Ty(n){return n===e}function Cy(n){return Ht(n)&&ce(n)==en}function My(n){return Ht(n)&&de(n)==Np}var Py=Cr(na),Ey=Cr(function(n,o){return n<=o});function Cc(n){if(!n)return[];if(_e(n))return Gr(n)?Ve(n):me(n);if(rn&&n[rn])return am(n[rn]());var o=ce(n),u=o==jt?Xo:o==$e?er:Bs;return u(n)}function vi(n){if(!n)return n===0?n:0;if(n=ze(n),n===z||n===-z){var o=n<0?-1:1;return o*$}return n===n?n:0}function at(n){var o=vi(n),u=o%1;return o===o?u?o-u:o:0}function Mc(n){return n?ts(at(n),0,dt):0}function ze(n){if(typeof n=="number")return n;if(Me(n))return _t;if(Wt(n)){var o=typeof n.valueOf=="function"?n.valueOf():n;n=Wt(o)?o+"":o}if(typeof n!="string")return n===0?n:+n;n=$l(n);var u=ug.test(n);return u||dg.test(n)?Yg(n.slice(2),u?2:8):lg.test(n)?_t:+n}function Pc(n){return hi(n,xe(n))}function ky(n){return n?ts(at(n),-rt,rt):n===0?n:0}function Tt(n){return n==null?"":Ce(n)}var Iy=ks(function(n,o){if(mn(o)||_e(o)){hi(o,ee(o),n);return}for(var u in o)At.call(o,u)&&un(n,u,o[u])}),Ec=ks(function(n,o){hi(o,xe(o),n)}),Or=ks(function(n,o,u,p){hi(o,xe(o),n,p)}),Ry=ks(function(n,o,u,p){hi(o,ee(o),n,p)}),Ly=xi(Ko);function By(n,o){var u=Es(n);return o==null?u:au(u,o)}var Fy=ct(function(n,o){n=Et(n);var u=-1,p=o.length,m=p>2?o[2]:e;for(m&&fe(o[0],o[1],m)&&(p=1);++u<p;)for(var b=o[u],S=xe(b),C=-1,k=S.length;++C<k;){var O=S[C],D=n[O];(D===e||je(D,Cs[O])&&!At.call(n,O))&&(n[O]=b[O])}return n}),Gy=ct(function(n){return n.push(e,$u),Ae(kc,e,n)});function Oy(n,o){return zl(n,tt(o,3),ai)}function Dy(n,o){return zl(n,tt(o,3),Qo)}function Wy(n,o){return n==null?n:Jo(n,tt(o,3),xe)}function Uy(n,o){return n==null?n:du(n,tt(o,3),xe)}function Hy(n,o){return n&&ai(n,tt(o,3))}function zy(n,o){return n&&Qo(n,tt(o,3))}function Ny(n){return n==null?[]:xr(n,ee(n))}function Yy(n){return n==null?[]:xr(n,xe(n))}function Ia(n,o,u){var p=n==null?e:es(n,o);return p===e?u:p}function Xy(n,o){return n!=null&&ju(n,o,p_)}function Ra(n,o){return n!=null&&ju(n,o,g_)}var $y=Hu(function(n,o,u){o!=null&&typeof o.toString!="function"&&(o=rr.call(o)),n[o]=u},Ba(ye)),Vy=Hu(function(n,o,u){o!=null&&typeof o.toString!="function"&&(o=rr.call(o)),At.call(n,o)?n[o].push(u):n[o]=[u]},tt),qy=ct(dn);function ee(n){return _e(n)?ru(n):sa(n)}function xe(n){return _e(n)?ru(n,!0):T_(n)}function jy(n,o){var u={};return o=tt(o,3),ai(n,function(p,m,b){mi(u,o(p,m,b),p)}),u}function Zy(n,o){var u={};return o=tt(o,3),ai(n,function(p,m,b){mi(u,m,o(p,m,b))}),u}var Ky=ks(function(n,o,u){yr(n,o,u)}),kc=ks(function(n,o,u,p){yr(n,o,u,p)}),Jy=xi(function(n,o){var u={};if(n==null)return u;var p=!1;o=Ft(o,function(b){return b=Wi(b,n),p||(p=b.length>1),b}),hi(n,_a(n),u),p&&(u=We(u,g|x|_,$_));for(var m=o.length;m--;)la(u,o[m]);return u});function Qy(n,o){return Ic(n,Br(tt(o)))}var tb=xi(function(n,o){return n==null?{}:M_(n,o)});function Ic(n,o){if(n==null)return{};var u=Ft(_a(n),function(p){return[p]});return o=tt(o),wu(n,u,function(p,m){return o(p,m[0])})}function eb(n,o,u){o=Wi(o,n);var p=-1,m=o.length;for(m||(m=1,n=e);++p<m;){var b=n==null?e:n[li(o[p])];b===e&&(p=m,b=u),n=bi(b)?b.call(n):b}return n}function ib(n,o,u){return n==null?n:pn(n,o,u)}function sb(n,o,u,p){return p=typeof p=="function"?p:e,n==null?n:pn(n,o,u,p)}var Rc=Yu(ee),Lc=Yu(xe);function nb(n,o,u){var p=ot(n),m=p||Hi(n)||Ls(n);if(o=tt(o,4),u==null){var b=n&&n.constructor;m?u=p?new b:[]:Wt(n)?u=bi(b)?Es(hr(n)):{}:u={}}return(m?Ge:ai)(n,function(S,C,k){return o(u,S,C,k)}),u}function rb(n,o){return n==null?!0:la(n,o)}function ob(n,o,u){return n==null?n:Mu(n,o,da(u))}function ab(n,o,u,p){return p=typeof p=="function"?p:e,n==null?n:Mu(n,o,da(u),p)}function Bs(n){return n==null?[]:Yo(n,ee(n))}function hb(n){return n==null?[]:Yo(n,xe(n))}function lb(n,o,u){return u===e&&(u=o,o=e),u!==e&&(u=ze(u),u=u===u?u:0),o!==e&&(o=ze(o),o=o===o?o:0),ts(ze(n),o,u)}function ub(n,o,u){return o=vi(o),u===e?(u=o,o=0):u=vi(u),n=ze(n),m_(n,o,u)}function cb(n,o,u){if(u&&typeof u!="boolean"&&fe(n,o,u)&&(o=u=e),u===e&&(typeof o=="boolean"?(u=o,o=e):typeof n=="boolean"&&(u=n,n=e)),n===e&&o===e?(n=0,o=1):(n=vi(n),o===e?(o=n,n=0):o=vi(o)),n>o){var p=n;n=o,o=p}if(u||n%1||o%1){var m=su();return ue(n+m*(o-n+Ng("1e-"+((m+"").length-1))),o)}return oa(n,o)}var db=Is(function(n,o,u){return o=o.toLowerCase(),n+(u?Bc(o):o)});function Bc(n){return La(Tt(n).toLowerCase())}function Fc(n){return n=Tt(n),n&&n.replace(pg,im).replace(Lg,"")}function fb(n,o,u){n=Tt(n),o=Ce(o);var p=n.length;u=u===e?p:ts(at(u),0,p);var m=u;return u-=o.length,u>=0&&n.slice(u,m)==o}function pb(n){return n=Tt(n),n&&qp.test(n)?n.replace(dl,sm):n}function gb(n){return n=Tt(n),n&&tg.test(n)?n.replace(Po,"\\$&"):n}var mb=Is(function(n,o,u){return n+(u?"-":"")+o.toLowerCase()}),_b=Is(function(n,o,u){return n+(u?" ":"")+o.toLowerCase()}),xb=Du("toLowerCase");function yb(n,o,u){n=Tt(n),o=at(o);var p=o?As(n):0;if(!o||p>=o)return n;var m=(o-p)/2;return Tr(dr(m),u)+n+Tr(cr(m),u)}function bb(n,o,u){n=Tt(n),o=at(o);var p=o?As(n):0;return o&&p<o?n+Tr(o-p,u):n}function vb(n,o,u){n=Tt(n),o=at(o);var p=o?As(n):0;return o&&p<o?Tr(o-p,u)+n:n}function wb(n,o,u){return u||o==null?o=0:o&&(o=+o),Em(Tt(n).replace(Eo,""),o||0)}function Sb(n,o,u){return(u?fe(n,o,u):o===e)?o=1:o=at(o),aa(Tt(n),o)}function Ab(){var n=arguments,o=Tt(n[0]);return n.length<3?o:o.replace(n[1],n[2])}var Tb=Is(function(n,o,u){return n+(u?"_":"")+o.toLowerCase()});function Cb(n,o,u){return u&&typeof u!="number"&&fe(n,o,u)&&(o=u=e),u=u===e?dt:u>>>0,u?(n=Tt(n),n&&(typeof o=="string"||o!=null&&!ka(o))&&(o=Ce(o),!o&&Ss(n))?Ui(Ve(n),0,u):n.split(o,u)):[]}var Mb=Is(function(n,o,u){return n+(u?" ":"")+La(o)});function Pb(n,o,u){return n=Tt(n),u=u==null?0:ts(at(u),0,n.length),o=Ce(o),n.slice(u,u+o.length)==o}function Eb(n,o,u){var p=y.templateSettings;u&&fe(n,o,u)&&(o=e),n=Tt(n),o=Or({},o,p,Xu);var m=Or({},o.imports,p.imports,Xu),b=ee(m),S=Yo(m,b),C,k,O=0,D=o.interpolate||Zn,W="__p += '",X=$o((o.escape||Zn).source+"|"+D.source+"|"+(D===fl?hg:Zn).source+"|"+(o.evaluate||Zn).source+"|$","g"),Z="//# sourceURL="+(At.call(o,"sourceURL")?(o.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Dg+"]")+`
`;n.replace(X,function(it,ft,xt,Pe,pe,Ee){return xt||(xt=Pe),W+=n.slice(O,Ee).replace(gg,nm),ft&&(C=!0,W+=`' +
__e(`+ft+`) +
'`),pe&&(k=!0,W+=`';
`+pe+`;
__p += '`),xt&&(W+=`' +
((__t = (`+xt+`)) == null ? '' : __t) +
'`),O=Ee+it.length,it}),W+=`';
`;var et=At.call(o,"variable")&&o.variable;if(!et)W=`with (obj) {
`+W+`
}
`;else if(og.test(et))throw new nt(l);W=(k?W.replace(Yp,""):W).replace(Xp,"$1").replace($p,"$1;"),W="function("+(et||"obj")+`) {
`+(et?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(C?", __e = _.escape":"")+(k?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+W+`return __p
}`;var lt=Oc(function(){return St(b,Z+"return "+W).apply(e,S)});if(lt.source=W,Ea(lt))throw lt;return lt}function kb(n){return Tt(n).toLowerCase()}function Ib(n){return Tt(n).toUpperCase()}function Rb(n,o,u){if(n=Tt(n),n&&(u||o===e))return $l(n);if(!n||!(o=Ce(o)))return n;var p=Ve(n),m=Ve(o),b=Vl(p,m),S=ql(p,m)+1;return Ui(p,b,S).join("")}function Lb(n,o,u){if(n=Tt(n),n&&(u||o===e))return n.slice(0,Zl(n)+1);if(!n||!(o=Ce(o)))return n;var p=Ve(n),m=ql(p,Ve(o))+1;return Ui(p,0,m).join("")}function Bb(n,o,u){if(n=Tt(n),n&&(u||o===e))return n.replace(Eo,"");if(!n||!(o=Ce(o)))return n;var p=Ve(n),m=Vl(p,Ve(o));return Ui(p,m).join("")}function Fb(n,o){var u=H,p=U;if(Wt(o)){var m="separator"in o?o.separator:m;u="length"in o?at(o.length):u,p="omission"in o?Ce(o.omission):p}n=Tt(n);var b=n.length;if(Ss(n)){var S=Ve(n);b=S.length}if(u>=b)return n;var C=u-As(p);if(C<1)return p;var k=S?Ui(S,0,C).join(""):n.slice(0,C);if(m===e)return k+p;if(S&&(C+=k.length-C),ka(m)){if(n.slice(C).search(m)){var O,D=k;for(m.global||(m=$o(m.source,Tt(pl.exec(m))+"g")),m.lastIndex=0;O=m.exec(D);)var W=O.index;k=k.slice(0,W===e?C:W)}}else if(n.indexOf(Ce(m),C)!=C){var X=k.lastIndexOf(m);X>-1&&(k=k.slice(0,X))}return k+p}function Gb(n){return n=Tt(n),n&&Vp.test(n)?n.replace(cl,cm):n}var Ob=Is(function(n,o,u){return n+(u?" ":"")+o.toUpperCase()}),La=Du("toUpperCase");function Gc(n,o,u){return n=Tt(n),o=u?e:o,o===e?om(n)?pm(n):Kg(n):n.match(o)||[]}var Oc=ct(function(n,o){try{return Ae(n,e,o)}catch(u){return Ea(u)?u:new nt(u)}}),Db=xi(function(n,o){return Ge(o,function(u){u=li(u),mi(n,u,Ma(n[u],n))}),n});function Wb(n){var o=n==null?0:n.length,u=tt();return n=o?Ft(n,function(p){if(typeof p[1]!="function")throw new Oe(h);return[u(p[0]),p[1]]}):[],ct(function(p){for(var m=-1;++m<o;){var b=n[m];if(Ae(b[0],this,p))return Ae(b[1],this,p)}})}function Ub(n){return c_(We(n,g))}function Ba(n){return function(){return n}}function Hb(n,o){return n==null||n!==n?o:n}var zb=Uu(),Nb=Uu(!0);function ye(n){return n}function Fa(n){return mu(typeof n=="function"?n:We(n,g))}function Yb(n){return xu(We(n,g))}function Xb(n,o){return yu(n,We(o,g))}var $b=ct(function(n,o){return function(u){return dn(u,n,o)}}),Vb=ct(function(n,o){return function(u){return dn(n,u,o)}});function Ga(n,o,u){var p=ee(o),m=xr(o,p);u==null&&!(Wt(o)&&(m.length||!p.length))&&(u=o,o=n,n=this,m=xr(o,ee(o)));var b=!(Wt(u)&&"chain"in u)||!!u.chain,S=bi(n);return Ge(m,function(C){var k=o[C];n[C]=k,S&&(n.prototype[C]=function(){var O=this.__chain__;if(b||O){var D=n(this.__wrapped__),W=D.__actions__=me(this.__actions__);return W.push({func:k,args:arguments,thisArg:n}),D.__chain__=O,D}return k.apply(n,Bi([this.value()],arguments))})}),n}function qb(){return oe._===this&&(oe._=bm),this}function Oa(){}function jb(n){return n=at(n),ct(function(o){return bu(o,n)})}var Zb=pa(Ft),Kb=pa(Hl),Jb=pa(Wo);function Dc(n){return va(n)?Uo(li(n)):P_(n)}function Qb(n){return function(o){return n==null?e:es(n,o)}}var tv=zu(),ev=zu(!0);function Da(){return[]}function Wa(){return!1}function iv(){return{}}function sv(){return""}function nv(){return!0}function rv(n,o){if(n=at(n),n<1||n>rt)return[];var u=dt,p=ue(n,dt);o=tt(o),n-=dt;for(var m=No(p,o);++u<n;)o(u);return m}function ov(n){return ot(n)?Ft(n,li):Me(n)?[n]:me(nc(Tt(n)))}function av(n){var o=++xm;return Tt(n)+o}var hv=Ar(function(n,o){return n+o},0),lv=ga("ceil"),uv=Ar(function(n,o){return n/o},1),cv=ga("floor");function dv(n){return n&&n.length?_r(n,ye,ta):e}function fv(n,o){return n&&n.length?_r(n,tt(o,2),ta):e}function pv(n){return Yl(n,ye)}function gv(n,o){return Yl(n,tt(o,2))}function mv(n){return n&&n.length?_r(n,ye,na):e}function _v(n,o){return n&&n.length?_r(n,tt(o,2),na):e}var xv=Ar(function(n,o){return n*o},1),yv=ga("round"),bv=Ar(function(n,o){return n-o},0);function vv(n){return n&&n.length?zo(n,ye):0}function wv(n,o){return n&&n.length?zo(n,tt(o,2)):0}return y.after=Y0,y.ary=gc,y.assign=Iy,y.assignIn=Ec,y.assignInWith=Or,y.assignWith=Ry,y.at=Ly,y.before=mc,y.bind=Ma,y.bindAll=Db,y.bindKey=_c,y.castArray=iy,y.chain=dc,y.chunk=cx,y.compact=dx,y.concat=fx,y.cond=Wb,y.conforms=Ub,y.constant=Ba,y.countBy=v0,y.create=By,y.curry=xc,y.curryRight=yc,y.debounce=bc,y.defaults=Fy,y.defaultsDeep=Gy,y.defer=X0,y.delay=$0,y.difference=px,y.differenceBy=gx,y.differenceWith=mx,y.drop=_x,y.dropRight=xx,y.dropRightWhile=yx,y.dropWhile=bx,y.fill=vx,y.filter=S0,y.flatMap=C0,y.flatMapDeep=M0,y.flatMapDepth=P0,y.flatten=hc,y.flattenDeep=wx,y.flattenDepth=Sx,y.flip=V0,y.flow=zb,y.flowRight=Nb,y.fromPairs=Ax,y.functions=Ny,y.functionsIn=Yy,y.groupBy=E0,y.initial=Cx,y.intersection=Mx,y.intersectionBy=Px,y.intersectionWith=Ex,y.invert=$y,y.invertBy=Vy,y.invokeMap=I0,y.iteratee=Fa,y.keyBy=R0,y.keys=ee,y.keysIn=xe,y.map=Ir,y.mapKeys=jy,y.mapValues=Zy,y.matches=Yb,y.matchesProperty=Xb,y.memoize=Lr,y.merge=Ky,y.mergeWith=kc,y.method=$b,y.methodOf=Vb,y.mixin=Ga,y.negate=Br,y.nthArg=jb,y.omit=Jy,y.omitBy=Qy,y.once=q0,y.orderBy=L0,y.over=Zb,y.overArgs=j0,y.overEvery=Kb,y.overSome=Jb,y.partial=Pa,y.partialRight=vc,y.partition=B0,y.pick=tb,y.pickBy=Ic,y.property=Dc,y.propertyOf=Qb,y.pull=Lx,y.pullAll=uc,y.pullAllBy=Bx,y.pullAllWith=Fx,y.pullAt=Gx,y.range=tv,y.rangeRight=ev,y.rearg=Z0,y.reject=O0,y.remove=Ox,y.rest=K0,y.reverse=Ta,y.sampleSize=W0,y.set=ib,y.setWith=sb,y.shuffle=U0,y.slice=Dx,y.sortBy=N0,y.sortedUniq=Xx,y.sortedUniqBy=$x,y.split=Cb,y.spread=J0,y.tail=Vx,y.take=qx,y.takeRight=jx,y.takeRightWhile=Zx,y.takeWhile=Kx,y.tap=d0,y.throttle=Q0,y.thru=kr,y.toArray=Cc,y.toPairs=Rc,y.toPairsIn=Lc,y.toPath=ov,y.toPlainObject=Pc,y.transform=nb,y.unary=ty,y.union=Jx,y.unionBy=Qx,y.unionWith=t0,y.uniq=e0,y.uniqBy=i0,y.uniqWith=s0,y.unset=rb,y.unzip=Ca,y.unzipWith=cc,y.update=ob,y.updateWith=ab,y.values=Bs,y.valuesIn=hb,y.without=n0,y.words=Gc,y.wrap=ey,y.xor=r0,y.xorBy=o0,y.xorWith=a0,y.zip=h0,y.zipObject=l0,y.zipObjectDeep=u0,y.zipWith=c0,y.entries=Rc,y.entriesIn=Lc,y.extend=Ec,y.extendWith=Or,Ga(y,y),y.add=hv,y.attempt=Oc,y.camelCase=db,y.capitalize=Bc,y.ceil=lv,y.clamp=lb,y.clone=sy,y.cloneDeep=ry,y.cloneDeepWith=oy,y.cloneWith=ny,y.conformsTo=ay,y.deburr=Fc,y.defaultTo=Hb,y.divide=uv,y.endsWith=fb,y.eq=je,y.escape=pb,y.escapeRegExp=gb,y.every=w0,y.find=A0,y.findIndex=oc,y.findKey=Oy,y.findLast=T0,y.findLastIndex=ac,y.findLastKey=Dy,y.floor=cv,y.forEach=fc,y.forEachRight=pc,y.forIn=Wy,y.forInRight=Uy,y.forOwn=Hy,y.forOwnRight=zy,y.get=Ia,y.gt=hy,y.gte=ly,y.has=Xy,y.hasIn=Ra,y.head=lc,y.identity=ye,y.includes=k0,y.indexOf=Tx,y.inRange=ub,y.invoke=qy,y.isArguments=ns,y.isArray=ot,y.isArrayBuffer=uy,y.isArrayLike=_e,y.isArrayLikeObject=Xt,y.isBoolean=cy,y.isBuffer=Hi,y.isDate=dy,y.isElement=fy,y.isEmpty=py,y.isEqual=gy,y.isEqualWith=my,y.isError=Ea,y.isFinite=_y,y.isFunction=bi,y.isInteger=wc,y.isLength=Fr,y.isMap=Sc,y.isMatch=xy,y.isMatchWith=yy,y.isNaN=by,y.isNative=vy,y.isNil=Sy,y.isNull=wy,y.isNumber=Ac,y.isObject=Wt,y.isObjectLike=Ht,y.isPlainObject=xn,y.isRegExp=ka,y.isSafeInteger=Ay,y.isSet=Tc,y.isString=Gr,y.isSymbol=Me,y.isTypedArray=Ls,y.isUndefined=Ty,y.isWeakMap=Cy,y.isWeakSet=My,y.join=kx,y.kebabCase=mb,y.last=He,y.lastIndexOf=Ix,y.lowerCase=_b,y.lowerFirst=xb,y.lt=Py,y.lte=Ey,y.max=dv,y.maxBy=fv,y.mean=pv,y.meanBy=gv,y.min=mv,y.minBy=_v,y.stubArray=Da,y.stubFalse=Wa,y.stubObject=iv,y.stubString=sv,y.stubTrue=nv,y.multiply=xv,y.nth=Rx,y.noConflict=qb,y.noop=Oa,y.now=Rr,y.pad=yb,y.padEnd=bb,y.padStart=vb,y.parseInt=wb,y.random=cb,y.reduce=F0,y.reduceRight=G0,y.repeat=Sb,y.replace=Ab,y.result=eb,y.round=yv,y.runInContext=E,y.sample=D0,y.size=H0,y.snakeCase=Tb,y.some=z0,y.sortedIndex=Wx,y.sortedIndexBy=Ux,y.sortedIndexOf=Hx,y.sortedLastIndex=zx,y.sortedLastIndexBy=Nx,y.sortedLastIndexOf=Yx,y.startCase=Mb,y.startsWith=Pb,y.subtract=bv,y.sum=vv,y.sumBy=wv,y.template=Eb,y.times=rv,y.toFinite=vi,y.toInteger=at,y.toLength=Mc,y.toLower=kb,y.toNumber=ze,y.toSafeInteger=ky,y.toString=Tt,y.toUpper=Ib,y.trim=Rb,y.trimEnd=Lb,y.trimStart=Bb,y.truncate=Fb,y.unescape=Gb,y.uniqueId=av,y.upperCase=Ob,y.upperFirst=La,y.each=fc,y.eachRight=pc,y.first=lc,Ga(y,(function(){var n={};return ai(y,function(o,u){At.call(y.prototype,u)||(n[u]=o)}),n})(),{chain:!1}),y.VERSION=i,Ge(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){y[n].placeholder=y}),Ge(["drop","take"],function(n,o){gt.prototype[n]=function(u){u=u===e?1:Kt(at(u),0);var p=this.__filtered__&&!o?new gt(this):this.clone();return p.__filtered__?p.__takeCount__=ue(u,p.__takeCount__):p.__views__.push({size:ue(u,dt),type:n+(p.__dir__<0?"Right":"")}),p},gt.prototype[n+"Right"]=function(u){return this.reverse()[n](u).reverse()}}),Ge(["filter","map","takeWhile"],function(n,o){var u=o+1,p=u==J||u==N;gt.prototype[n]=function(m){var b=this.clone();return b.__iteratees__.push({iteratee:tt(m,3),type:u}),b.__filtered__=b.__filtered__||p,b}}),Ge(["head","last"],function(n,o){var u="take"+(o?"Right":"");gt.prototype[n]=function(){return this[u](1).value()[0]}}),Ge(["initial","tail"],function(n,o){var u="drop"+(o?"":"Right");gt.prototype[n]=function(){return this.__filtered__?new gt(this):this[u](1)}}),gt.prototype.compact=function(){return this.filter(ye)},gt.prototype.find=function(n){return this.filter(n).head()},gt.prototype.findLast=function(n){return this.reverse().find(n)},gt.prototype.invokeMap=ct(function(n,o){return typeof n=="function"?new gt(this):this.map(function(u){return dn(u,n,o)})}),gt.prototype.reject=function(n){return this.filter(Br(tt(n)))},gt.prototype.slice=function(n,o){n=at(n);var u=this;return u.__filtered__&&(n>0||o<0)?new gt(u):(n<0?u=u.takeRight(-n):n&&(u=u.drop(n)),o!==e&&(o=at(o),u=o<0?u.dropRight(-o):u.take(o-n)),u)},gt.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},gt.prototype.toArray=function(){return this.take(dt)},ai(gt.prototype,function(n,o){var u=/^(?:filter|find|map|reject)|While$/.test(o),p=/^(?:head|last)$/.test(o),m=y[p?"take"+(o=="last"?"Right":""):o],b=p||/^find/.test(o);m&&(y.prototype[o]=function(){var S=this.__wrapped__,C=p?[1]:arguments,k=S instanceof gt,O=C[0],D=k||ot(S),W=function(ft){var xt=m.apply(y,Bi([ft],C));return p&&X?xt[0]:xt};D&&u&&typeof O=="function"&&O.length!=1&&(k=D=!1);var X=this.__chain__,Z=!!this.__actions__.length,et=b&&!X,lt=k&&!Z;if(!b&&D){S=lt?S:new gt(this);var it=n.apply(S,C);return it.__actions__.push({func:kr,args:[W],thisArg:e}),new De(it,X)}return et&&lt?n.apply(this,C):(it=this.thru(W),et?p?it.value()[0]:it.value():it)})}),Ge(["pop","push","shift","sort","splice","unshift"],function(n){var o=ir[n],u=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",p=/^(?:pop|shift)$/.test(n);y.prototype[n]=function(){var m=arguments;if(p&&!this.__chain__){var b=this.value();return o.apply(ot(b)?b:[],m)}return this[u](function(S){return o.apply(ot(S)?S:[],m)})}}),ai(gt.prototype,function(n,o){var u=y[o];if(u){var p=u.name+"";At.call(Ps,p)||(Ps[p]=[]),Ps[p].push({name:o,func:u})}}),Ps[Sr(e,A).name]=[{name:"wrapper",func:e}],gt.prototype.clone=Gm,gt.prototype.reverse=Om,gt.prototype.value=Dm,y.prototype.at=f0,y.prototype.chain=p0,y.prototype.commit=g0,y.prototype.next=m0,y.prototype.plant=x0,y.prototype.reverse=y0,y.prototype.toJSON=y.prototype.valueOf=y.prototype.value=b0,y.prototype.first=y.prototype.head,rn&&(y.prototype[rn]=_0),y}),Ts=gm();Zi?((Zi.exports=Ts)._=Ts,Fo._=Ts):oe._=Ts}).call(DT)})(En,En.exports)),En.exports}var UT=WT();const le=zh(UT);class Gs{constructor(t,e){this.onlyLastListener=t,this.onlyLastEvent=e,this.listeners=[],this.once=[],this.events=[],this.active=!1,this.publish=i=>{this.events.push(i),this.active||(requestAnimationFrame(this.process),this.active=!0)},this.publishSync=i=>{for(le.clone(this.listeners).forEach(a=>a(i));this.once.length>0;)this.once.shift()(i)},this.clear=()=>{this.listeners=[],this.once=[],this.events=[],this.active=!1},this.process=()=>{for(this.active=!1,this.onlyLastEvent&&(this.events=[this.events.pop()]);this.events.length>0;){let i=this.events.shift();for(le.clone(this.listeners).forEach(a=>a(i));this.once.length>0;)this.once.shift()(i)}}}addListener(t){this.onlyLastListener?this.listeners=[t]:this.listeners.push(t)}removeListener(t){let e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}addOnce(t){this.once.push(t)}}const Vi={WINDOW_RESIZE:new Gs,ACTIVITY_LOG:new Gs,APP_LOG:new Gs,SWITCH_ACTIVATED:new Gs,LEVEL_COMPLETE:new Gs},ll=class ll{static initialize(t,e){Vi.ACTIVITY_LOG.addListener(i=>{switch(i.slug){case"PLAYER_STATE":this.states.groundState=i.text;break;case"VELOCITY":this.states.velocity=i.text;break}e.innerHTML=`${this.states.groundState} / ${this.states.velocity}`}),Vi.APP_LOG.addListener(i=>{console.log("APP:",i.type," : ",i.text)})}};ll.states={groundState:"",velocity:""};let Uh=ll;const bt=class bt{static initialize(t){bt.renderer=t.renderer,HT()}static addTextureBackgrounds(t,e){bt.backgrounds[t]||(bt.backgrounds[t]=[]);for(let i=0;i<e.length;i++){let r=bt.getTextureFromUrl(e[i]);bt.backgrounds[t][i]=r}}static addTextureParalax(t,e){bt.paralaxes[t]=bt.getTextureFromUrl(e)}static getTextureBackgrounds(t){return bt.backgrounds[t]}static getTextureParalax(t){return bt.paralaxes[t]}};bt.addTextureFromGraphic=(t,e)=>{bt.cache[t]&&console.warn("overwriting texture",t);let i=bt.renderer.generateTexture(e);return bt.cache[t]=i,i},bt.addTextureFromNodeGraphic=(t,e,i)=>{let r=`${t}-${e}`;bt.cache[r]&&console.warn("overwriting texture",r);let a=bt.renderer.generateTexture(i);return bt.cache[r]=a,a},bt.getTextureFromUrl=t=>{if(bt.cache[t])return bt.cache[t];{let e=ht.WHITE;return bt.cache[t]=e,e}},bt.getGraphicTexture=t=>bt.cache[t]?bt.cache[t]:ht.WHITE,bt.getNodeGraphicTexture=(t,e)=>{e=Math.ceil(e/5)*5;let i=`${t}-${e}`;return bt.cache[i]?bt.cache[i]:bt.cache["circle-5"]},bt.cache={},bt.backgrounds=[],bt.paralaxes=[];let Qe=bt;function HT(){let s=new ve;for(let i=5;i<=30;i+=5)s.clear(),s.setStrokeStyle({width:2,color:16777215}),s.circle(0,0,i),s.fill(3355443),Qe.addTextureFromNodeGraphic("circle",i,s);let t=["square","triangle","thin-rect","fat-rect","pentagon","hexagon"],e=[[-1,-1,-1,1,1,1,1,-1],[-1,.75,0,-1,1,.75],[-1,-.3,-1,.3,1,.3,1,-.3],[-1,-.7,-1,.7,1,.7,1,-.7],[1,0,(Math.sqrt(5)-1)/4,-Math.sqrt(10+2*Math.sqrt(5))/4,-(Math.sqrt(5)+1)/4,-Math.sqrt(10-2*Math.sqrt(5))/4,-(Math.sqrt(5)+1)/4,Math.sqrt(10-2*Math.sqrt(5))/4,(Math.sqrt(5)-1)/4,Math.sqrt(10+2*Math.sqrt(5))/4],[1,0,1/2,Math.sqrt(3)/2,-1/2,Math.sqrt(3)/2,-1,0,-1/2,-Math.sqrt(3)/2,1/2,-Math.sqrt(3)/2]];for(let i=0;i<e.length;i++)for(let r=5;r<=30;r+=5)s.clear(),s.setStrokeStyle({width:2,color:16777215}),s.poly(zT(e[i],r)),s.fill(3355443),Qe.addTextureFromNodeGraphic(t[i],r,s);s.clear().circle(0,0,4).fill(16777215),Qe.addTextureFromGraphic("crawler",s),s.clear().circle(0,0,5).fill(15658734),Qe.addTextureFromGraphic("chieftain",s),s.clear().circle(0,0,4).fill(16777215),s.moveTo(0,-6).lineTo(-6,-1).lineTo(6,-1).fill(13421772),Qe.addTextureFromGraphic("shaman",s),s.clear().rect(0,0,2,2).fill(16777215),Qe.addTextureFromGraphic("crawler-power",s),s=new ve,s.circle(0,0,5).fill(16777215),Qe.addTextureFromGraphic("firework",s)}function zT(s,t){return s=s.map(e=>e*t),s.push(s[0]),s.push(s[1]),s}const gs={TEXTURES_PER_TILEMAP:16,use32bitIndex:!1};var NT=Object.defineProperty,YT=(s,t,e)=>t in s?NT(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,Yi=(s,t,e)=>(YT(s,typeof t!="symbol"?t+"":t,e),e);const Hn=class kn extends lp{constructor(t){const e=new $i({data:new Float32Array(2),label:"tilemap-buffer",usage:Vt.VERTEX|Vt.COPY_DST,shrinkToFit:!1}),i=kn.stride;super({indexBuffer:t,attributes:{aVertexPosition:{buffer:e,format:"float32x2",stride:i,offset:0},aTextureCoord:{buffer:e,format:"float32x2",stride:i,offset:8},aFrame:{buffer:e,format:"float32x4",stride:i,offset:16},aAnim:{buffer:e,format:"float32x2",stride:i,offset:32},aTextureId:{buffer:e,format:"sint32",stride:i,offset:40},aAnimDivisor:{buffer:e,format:"float32",stride:i,offset:44},aAlpha:{buffer:e,format:"float32",stride:i,offset:48}}}),Yi(this,"lastTimeAccess",0),Yi(this,"vertSize",kn.vertSize),Yi(this,"vertPerQuad",kn.vertPerQuad),Yi(this,"stride",kn.stride),Yi(this,"buf"),this.buf=e}};Yi(Hn,"vertSize",13);Yi(Hn,"vertPerQuad",4);Yi(Hn,"stride",Hn.vertSize*4);let XT=Hn;var $T=Object.defineProperty,VT=(s,t,e)=>t in s?$T(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,Ni=(s,t,e)=>(VT(s,typeof t!="symbol"?t+"":t,e),e);class Gp{constructor(){Ni(this,"pipe_uniforms",new Yn({u_proj_trans:{value:new pt,type:"mat3x3<f32>"},u_anim_frame:{value:new Float32Array(2),type:"vec2<f32>"}}))}}class Op{constructor(t,e){Ni(this,"renderer"),Ni(this,"tileAnim",[0,0]),Ni(this,"ibLen",0),Ni(this,"indexBuffer",null),Ni(this,"shader"),Ni(this,"adaptor"),this.renderer=t,this.adaptor=e,this.adaptor.init(),this.indexBuffer=new $i({data:new Uint16Array([0,1,2,0,2,3]),label:"index-tilemap-buffer",usage:Vt.INDEX|Vt.COPY_DST}),this.indexBuffer.destroy=Nh,this.checkIndexBuffer(2e3)}start(){}createVb(){const t=new XT(this.indexBuffer);return t.lastTimeAccess=Date.now(),t}getShader(){return this.shader}destroy(){this.shader=null}checkIndexBuffer(t){const e=t*6;e<=this.ibLen||(this.ibLen=e,this.indexBuffer.data=qT(t,gs.use32bitIndex?new Uint32Array(e):new Uint16Array(e)))}destroyRenderable(t){t.vb.destroy(!0),t.vb=null}addRenderable(t,e){const i=this.renderer.renderPipes.batch;t.updateBuffer(this),t.checkValid(),t.getTileset().update(),t.is_valid&&(i.break(e),e.add(t._instruction))}updateRenderable(t,e){t.updateBuffer(this),t.getTileset().update()}validateRenderable(t){return t.checkValid()}execute({tilemap:t}){if(!t.isRenderable)return;t.state.blendMode=t.groupBlendMode;const{pipe_uniforms:e}=this.adaptor,i=e.uniforms.u_proj_trans,r=this.renderer.globalUniforms._activeUniforms.at(-1).uniforms;let a=this.tileAnim;const{u_anim_frame:h}=e.uniforms;r.uProjectionMatrix.copyTo(i).append(r.uWorldTransformMatrix).append(t.worldTransform),t.compositeParent&&(a=t.parent.tileAnim||a),h[0]=a[0],h[1]=a[1],e.update(),this.adaptor.execute(this,t)}}Ni(Op,"extension",{type:[V.WebGLPipes,V.WebGPUPipes],name:"tilemap"});function qT(s,t){const e=s*6;if(t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let i=0,r=0;i<e;i+=6,r+=4)t[i+0]=r+0,t[i+1]=r+1,t[i+2]=r+2,t[i+3]=r+0,t[i+4]=r+2,t[i+5]=r+3;return t}var jT=Object.defineProperty,ZT=(s,t,e)=>t in s?jT(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,ui=(s,t,e)=>(ZT(s,typeof t!="symbol"?t+"":t,e),e);class ps{constructor(t){ui(this,"max_textures"),ui(this,"arr",[]),ui(this,"count",0),ui(this,"dirty",!1),ui(this,"dirty_gpu",!1),ui(this,"bind_group",null),ui(this,"bind_group_resources",{}),ui(this,"tex_sizes",null),ui(this,"null_color",new Float32Array([0,0,0,.5])),ui(this,"tex_buf",null),this.max_textures=t,this.tex_sizes=new Float32Array(this.max_textures*4+4),this.tex_buf=new $i({usage:Vt.UNIFORM|Vt.COPY_DST})}get length(){return this.count}push(t){this.arr[this.count++]=t,this.dirty=!0}at(t){return this.arr[t]}update(){if(!this.dirty)return;this.dirty=!1,this.dirty_gpu=!0;const{tex_sizes:t,arr:e,count:i,max_textures:r,null_color:a}=this;for(let h=0;h<i;h++){const l=e[h];l&&(t[h*4]=l.pixelWidth,t[h*4+1]=l.pixelHeight,t[h*4+2]=1/l.pixelWidth,t[h*4+3]=1/l.pixelHeight)}t[r*4]=a[0],t[r*4+1]=a[1],t[r*4+2]=a[2],t[r*4+3]=a[3]}markDirty(){this.dirty=!0}getBindGroup(){if(this.update(),!this.dirty_gpu)return this.bind_group;const{bind_group_resources:t,max_textures:e,arr:i,count:r}=this;let a=0;t[a++]=new Yn({u_texture_size:{value:this.tex_sizes,type:"vec4<f32>",size:e},u_null_color:{value:this.null_color,type:"vec4<f32>"}});for(let h=0;h<e;h++){const l=(h<r?i[h]:null)||ht.EMPTY.source;t[a++]=l.source,t[a++]=l.style}return this.bind_group||(this.bind_group=new zs(t)),this.bind_group}static generate_gpu_textures(t){const e=[];e.push("struct TextureArrayFields {"),e.push(`    u_texture_size: array<vec4f, ${t}>,`),e.push("    u_null_color: vec4f"),e.push("}"),e.push("@group(1) @binding(0) var<uniform> taf: TextureArrayFields;");for(let i=0;i<t;i++)e.push(`@group(1) @binding(${i*2+1}) var u_texture_${i}: texture_2d<f32>;`),e.push(`@group(1) @binding(${i*2+2}) var u_sampler_${i}: sampler;`);e.push("fn sampleMultiTexture(texture_id: i32, uv: vec2f, dx: vec2f, dy: vec2f) -> vec4f {"),e.push("switch texture_id {");for(let i=0;i<t;i++)e.push(`  case ${i}: { return textureSampleGrad(u_texture_${i}, u_sampler_${i}, uv, dx, dy); }`);return e.push("  default: { return taf.u_null_color; }"),e.push("} }"),e.join(`
`)}static generate_gl_textures(t){const e=[];e.push(`uniform vec4 u_texture_size[${t+1}];`),e.push(`uniform sampler2D u_textures[${t}];`),e.push("uniform vec4 u_null_color;"),e.push("vec4 sampleMultiTexture(float texture_id, vec2 uv) {"),e.push(`if(texture_id < -0.5) return u_texture_size[${t}];`);for(let i=0;i<t;i++)e.push(`if(texture_id < ${i}.5) return texture(u_textures[${i}], uv * u_texture_size[${i}].zw);`);return e.push(`return u_texture_size[${t}];`),e.push("}"),e.join(`
`)}static gl_gen_resources(t){const e=[];for(let r=0;r<t;r++)e[r]=r;const i=[];for(let r=0;r<t;r++)i.push(2048),i.push(2048),i.push(1/2048),i.push(1/2048);return{u_textures:{value:e,type:"i32",size:t},u_texture_size:{value:i,type:"vec4<f32>",size:t}}}}var KT=Object.defineProperty,JT=(s,t,e)=>t in s?KT(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,Hh=(s,t,e)=>(JT(s,typeof t!="symbol"?t+"":t,e),e);const QT=`
in vec2 aVertexPosition;
in vec2 aTextureCoord;
in vec4 aFrame;
in vec2 aAnim;
in float aAnimDivisor;
in float aTextureId;
in float aAlpha;

uniform mat3 u_proj_trans;
uniform vec2 u_anim_frame;

out vec2 vTextureCoord;
out float vTextureId;
out vec4 vFrame;
out float vAlpha;

void main(void)
{
  gl_Position = vec4((u_proj_trans * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
  vec2 animCount = floor((aAnim + 0.5) / 2048.0);
  vec2 animFrameOffset = aAnim - animCount * 2048.0;
  vec2 currentFrame = floor(u_anim_frame / aAnimDivisor);
  vec2 loop_num = floor((currentFrame + 0.5) / animCount);
  vec2 animOffset = animFrameOffset * floor(currentFrame - loop_num * animCount);

  vTextureCoord = aTextureCoord + animOffset;
  vFrame = aFrame + vec4(animOffset, animOffset);
  vTextureId = aTextureId;
  vAlpha = aAlpha;
}
`,tC=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
in vec2 vTextureCoord;
in vec4 vFrame;
in float vTextureId;
in float vAlpha;

//include_textures

void main(void)
{
  float textureId = floor(vTextureId + 0.5);
  vec2 textureCoord = clamp(vTextureCoord, vFrame.xy, vFrame.zw);
  vec4 color = sampleMultiTexture(textureId, textureCoord);
  finalColor = color * vAlpha;
}
`;class Dp extends Gp{constructor(){super(...arguments),Hh(this,"_shader",null),Hh(this,"max_textures",gs.TEXTURES_PER_TILEMAP)}destroy(){this._shader.destroy(!0),this._shader=null}execute(t,e){const i=t.renderer,r=this._shader,a=e.getTileset(),h=r.resources.texture_uniforms;h.uniforms.u_texture_size!==a.tex_sizes&&(h.uniforms.u_texture_size=a.tex_sizes,h.update());for(let l=0;l<a.length;l++)i.texture.bind(a.arr[l],l);i.encoder.draw({geometry:e.vb,shader:r,state:e.state,size:e.rects_count*6})}init(){this._shader=new Xn({glProgram:qh.from({vertex:QT,fragment:tC.replace("//include_textures",ps.generate_gl_textures(this.max_textures))}),resources:{texture_uniforms:new Yn(ps.gl_gen_resources(this.max_textures),{isStatic:!0}),pipe_uniforms:this.pipe_uniforms.uniformStructures}})}}Hh(Dp,"extension",{type:[V.WebGLPipesAdaptor],name:"tilemap"});var eC=Object.defineProperty,iC=(s,t,e)=>t in s?eC(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,so=(s,t,e)=>(iC(s,typeof t!="symbol"?t+"":t,e),e);const sC=`
struct GlobalUniforms {
  uProjectionMatrix:mat3x3f,
  uWorldTransformMatrix:mat3x3f,
  uWorldColorAlpha: vec4f,
  uResolution: vec2f,
}

struct TilemapUniforms {
  u_proj_trans:mat3x3f,
  u_anim_frame:vec2f
}

@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
@group(2) @binding(0) var<uniform> loc: TilemapUniforms;

struct VSOutput {
  @builtin(position) vPosition: vec4f,
  @location(0) @interpolate(flat) vTextureId : i32,
  @location(1) vTextureCoord : vec2f,
  @location(2) @interpolate(flat) vFrame : vec4f,
  @location(3) vAlpha : f32
};

@vertex
fn mainVert(
   @location(6) aVertexPosition: vec2f,
   @location(4) aTextureCoord: vec2f,
   @location(3) aFrame: vec4f,
   @location(1) aAnim: vec2f,
   @location(2) aAnimDivisor: f32,
   @location(5) aTextureId: i32,
   @location(0) aAlpha: f32,
 ) -> VSOutput {

  var vPosition = vec4((loc.u_proj_trans * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
  var animCount = floor((aAnim + 0.5) / 2048.0);
  var animFrameOffset = aAnim - animCount * 2048.0;
  var currentFrame = floor(loc.u_anim_frame / aAnimDivisor);
  var loop_num = floor((currentFrame + 0.5) / animCount);
  var animOffset = animFrameOffset * floor(currentFrame - loop_num * animCount);
  var vTextureCoord = aTextureCoord + animOffset;
  var vFrame = aFrame + vec4(animOffset, animOffset);

  return VSOutput(vPosition, aTextureId, vTextureCoord, vFrame, aAlpha);
};
`,nC=`
//include_textures

@fragment
fn mainFrag(
  @location(0) @interpolate(flat) vTextureId : i32,
  @location(1) vTextureCoord : vec2f,
  @location(2) @interpolate(flat) vFrame : vec4f,
  @location(3) vAlpha : f32,
  ) -> @location(0) vec4f {
  var textureCoord = clamp(vTextureCoord, vFrame.xy, vFrame.zw);
  var uv = textureCoord * taf.u_texture_size[vTextureId].zw;
  var dx = dpdx(uv);
  var dy = dpdy(uv);
  var color = sampleMultiTexture(vTextureId, uv, dx, dy);
  return color * vAlpha;
};
`;class Wp extends Gp{constructor(){super(...arguments),so(this,"_shader",null),so(this,"max_textures",gs.TEXTURES_PER_TILEMAP),so(this,"bind_group",null)}destroy(){this._shader.destroy(!0),this._shader=null}execute(t,e){const i=t.renderer,r=this._shader;r.groups[0]=i.globalUniforms.bindGroup,r.groups[1]=e.getTileset().getBindGroup(),r.groups[2]=this.bind_group,i.encoder.draw({geometry:e.vb,shader:r,state:e.state,size:e.rects_count*6})}init(){this._shader=new Xn({gpuProgram:Nn.from({vertex:{source:sC,entryPoint:"mainVert"},fragment:{source:nC.replace("//include_textures",ps.generate_gpu_textures(this.max_textures))}})}),this.bind_group=new zs({ut:this.pipe_uniforms})}}so(Wp,"extension",{type:[V.WebGPUPipesAdaptor],name:"tilemap"});var rC=Object.defineProperty,oC=(s,t,e)=>t in s?rC(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,Jt=(s,t,e)=>(oC(s,typeof t!="symbol"?t+"":t,e),e),Up=(s=>(s[s.U=0]="U",s[s.V=1]="V",s[s.X=2]="X",s[s.Y=3]="Y",s[s.TILE_WIDTH=4]="TILE_WIDTH",s[s.TILE_HEIGHT=5]="TILE_HEIGHT",s[s.ROTATE=6]="ROTATE",s[s.ANIM_X=7]="ANIM_X",s[s.ANIM_Y=8]="ANIM_Y",s[s.TEXTURE_INDEX=9]="TEXTURE_INDEX",s[s.ANIM_COUNT_X=10]="ANIM_COUNT_X",s[s.ANIM_COUNT_Y=11]="ANIM_COUNT_Y",s[s.ANIM_DIVISOR=12]="ANIM_DIVISOR",s[s.ALPHA=13]="ALPHA",s))(Up||{});const Je=Object.keys(Up).length/2;class rf extends fo{constructor(t){super({}),Jt(this,"shadowColor",new Float32Array([0,0,0,.5])),Jt(this,"state",jh.for2d()),Jt(this,"is_valid",!1),Jt(this,"renderPipeId","tilemap"),Jt(this,"canBundle",!0),Jt(this,"_instruction",{renderPipeId:"tilemap",tilemap:this}),Jt(this,"tileAnim",null),Jt(this,"rects_count",0),Jt(this,"compositeParent",!1),Jt(this,"tileset",new ps(gs.TEXTURES_PER_TILEMAP)),Jt(this,"tilemapBounds",new Re),Jt(this,"hasAnimatedTile",!1),Jt(this,"pointsBuf",[]),Jt(this,"batched"),Jt(this,"vbId",0),Jt(this,"vb",null),Jt(this,"vbBuffer",null),Jt(this,"vbArray",null),Jt(this,"vbInts",null),this.setTileset(t)}checkValid(){const t=this.tileset.count>0&&this.pointsBuf.length>0,e=this.is_valid!==t;return this.is_valid=t,e!==t}updateBounds(){const t=this.tilemapBounds;this._bounds.minX=t.minX,this._bounds.maxX=t.maxX,this._bounds.minY=t.minY,this._bounds.maxY=t.maxY}getTileset(){return this.tileset}setTileset(t=[]){let e=this.tileset;if(t instanceof ps)this.tileset=t,this.didViewUpdate=!0;else if(t instanceof Xe){if(e.count===1&&e.arr[0]===t)return this;e=this.tileset=new ps(gs.TEXTURES_PER_TILEMAP),e.push(t),this.didViewUpdate=!0}else{if(t.length===e.count){let i=!0;for(let r=0;r<t.length;r++)if(t[r]?.source!==e.arr[r]){i=!1;break}if(i)return this}e=this.tileset=new ps(gs.TEXTURES_PER_TILEMAP);for(let i=0;i<t.length;i++)e.push(t[i]?.source);this.didViewUpdate=!0}return this}clear(){return this.pointsBuf.length=0,this.rects_count=0,this.tilemapBounds.clear(),this.hasAnimatedTile=!1,this}tile(t,e,i,r={}){this.didViewUpdate=!0;let a,h=-1,l=!1;if(typeof t=="number")h=t,l=!0,a=this.tileset.arr[h];else{let P;typeof t=="string"?P=ht.from(t):P=t;const L=this.tileset;for(let R=0;R<L.count;R++)if(L.arr[R]===P.source){h=R;break}"frame"in P&&(r.u=r.u??P.frame.x,r.v=r.v??P.frame.y,r.tileWidth=r.tileWidth??P.orig.width,r.tileHeight=r.tileHeight??P.orig.height),a=P.source}if(!l&&!a)return console.error("The tile texture was not found in the tilemap tileset."),this;const{u:c=0,v:f=0,tileWidth:d=a.width,tileHeight:g=a.height,animX:x=0,animY:_=0,rotate:v=0,animCountX:T=1024,animCountY:w=1024,animDivisor:A=1,alpha:I=1}=r,M=this.pointsBuf;return this.hasAnimatedTile=this.hasAnimatedTile||x>0||_>0,M.push(c),M.push(f),M.push(e),M.push(i),M.push(d),M.push(g),M.push(v),M.push(x|0),M.push(_|0),M.push(h),M.push(T),M.push(w),M.push(A),M.push(I),this.tilemapBounds.addFrame(e,i,e+d,i+g),this}tileRotate(t){const e=this.pointsBuf;e[e.length-(Je-9)]=t}tileAnimX(t,e){const i=this.pointsBuf;i[i.length-(Je-7)]=t,i[i.length-(Je-10)]=e}tileAnimY(t,e){const i=this.pointsBuf;i[i.length-(Je-8)]=t,i[i.length-(Je-11)]=e}tileAnimDivisor(t){const e=this.pointsBuf;e[e.length-(Je-12)]=t}tileAlpha(t){const e=this.pointsBuf;e[e.length-(Je-13)]=t}destroyVb(){this.vb&&(this.vb.destroy(),this.vb=null)}updateBuffer(t){const e=this.pointsBuf,i=e.length/Je;let r=this.vb;if(this.tileset.count===0||i===0||this.rects_count===i&&r)return;this.rects_count=i,r||(r=t.createVb(),this.vb=r,this.vbId=r.id,this.vbBuffer=null);const a=i*r.vertPerQuad;t.checkIndexBuffer(i);const h=r.getBuffer("aVertexPosition"),l=r.stride*a;if(!this.vbBuffer||this.vbBuffer.byteLength<l){let x=r.stride;for(;x<l;)x*=2;this.vbBuffer=new ArrayBuffer(x),this.vbArray=new Float32Array(this.vbBuffer),this.vbInts=new Uint32Array(this.vbBuffer)}const c=this.vbArray,f=this.vbInts;let d=0,g=0;for(let x=0;x<e.length;x+=Je){this.compositeParent&&(g=e[x+9]);const v=e[x+2],T=e[x+3],w=e[x+4],A=e[x+5],I=e[x+0],M=e[x+1];let P=e[x+6];const L=e[x+7],R=e[x+8],G=e[x+10]||1024,Y=e[x+11]||1024,q=L+G*2048,H=R+Y*2048,U=e[x+12],K=e[x+13];let Q,J,yt,N,z,rt,$,_t;if(P===0)Q=I,J=M,yt=I+w,N=M,z=I+w,rt=M+A,$=I,_t=M+A;else{let dt=w/2,Pt=A/2;P%4!==0&&(dt=A/2,Pt=w/2);const Dt=I+dt,re=M+Pt;P=ut.add(P,ut.NW),Q=Dt+dt*ut.uX(P),J=re+Pt*ut.uY(P),P=ut.add(P,2),yt=Dt+dt*ut.uX(P),N=re+Pt*ut.uY(P),P=ut.add(P,2),z=Dt+dt*ut.uX(P),rt=re+Pt*ut.uY(P),P=ut.add(P,2),$=Dt+dt*ut.uX(P),_t=re+Pt*ut.uY(P)}c[d++]=v,c[d++]=T,c[d++]=Q,c[d++]=J,c[d++]=I+.5,c[d++]=M+.5,c[d++]=I+w-.5,c[d++]=M+A-.5,c[d++]=q,c[d++]=H,f[d++]=g,c[d++]=U,c[d++]=K,c[d++]=v+w,c[d++]=T,c[d++]=yt,c[d++]=N,c[d++]=I+.5,c[d++]=M+.5,c[d++]=I+w-.5,c[d++]=M+A-.5,c[d++]=q,c[d++]=H,f[d++]=g,c[d++]=U,c[d++]=K,c[d++]=v+w,c[d++]=T+A,c[d++]=z,c[d++]=rt,c[d++]=I+.5,c[d++]=M+.5,c[d++]=I+w-.5,c[d++]=M+A-.5,c[d++]=q,c[d++]=H,f[d++]=g,c[d++]=U,c[d++]=K,c[d++]=v,c[d++]=T+A,c[d++]=$,c[d++]=_t,c[d++]=I+.5,c[d++]=M+.5,c[d++]=I+w-.5,c[d++]=M+A-.5,c[d++]=q,c[d++]=H,f[d++]=g,c[d++]=U,c[d++]=K}h.data=c}isModified(t){return!!(this.rects_count*Je!==this.pointsBuf.length||t&&this.hasAnimatedTile)}clearModify(){this.rects_count=this.pointsBuf.length/Je}addBounds(t){const e=this.tilemapBounds;t.addFrame(e.minX,e.minY,e.maxX,e.maxY)}get bounds(){return this.tilemapBounds}destroy(t){super.destroy(t),this.destroyVb()}addFrame(t,e,i,r,a){return this.tile(t,e,i,{animX:r,animY:a}),!0}addRect(t,e,i,r,a,h,l,c=0,f=0,d=0,g=1024,x=1024,_=1,v=1){return this.tile(t,r,a,{u:e,v:i,tileWidth:h,tileHeight:l,animX:c,animY:f,rotate:d,animCountX:g,animCountY:x,animDivisor:_,alpha:v})}}Mt.add(Op);Mt.add(Dp);Mt.add(Wp);const mt=class mt{static async initialize(){gs.use32bitIndex=!0;const t=await Ws.load({src:this.TilemapSrc,data:{mipmap:!1}});this.mainTextureSource=new ht(t).source,this.characterTexture=await Ws.load({src:this.PlayerSrc,data:{mipmap:!1}});for(let e=0;e<7;e++){let i=[];this.skins.push(i);for(let r=0;r<3;r++)i.push(new ht({source:this.characterTexture,frame:new kt(r*this.CHAR_SIZE,e*this.CHAR_SIZE,this.CHAR_SIZE,this.CHAR_SIZE)}));i=[],this.skins.push(i);for(let r=3;r<6;r++)i.push(new ht({source:this.characterTexture,frame:new kt(r*this.CHAR_SIZE,e*this.CHAR_SIZE,this.CHAR_SIZE,this.CHAR_SIZE)}))}}static drawBlock(t){let e=new rf(mt.mainTextureSource),i=t.type;function r(a,h){return!(h<0||a<0||h>=t.height/mt.TILE_SIZE||a>=t.width/mt.TILE_SIZE)}for(let a=0;a<t.width/this.TILE_SIZE;a++)for(let h=0;h<t.height/this.TILE_SIZE;h++){let l=[r(a,h-1),r(a-1,h),r(a-1,h-1)],c=[r(a,h-1),r(a+1,h),r(a+1,h-1)],f=[r(a,h+1),r(a-1,h),r(a-1,h+1)],d=[r(a,h+1),r(a+1,h),r(a+1,h+1)];e.tile(0,a*mt.TILE_SIZE,h*mt.TILE_SIZE,this.getHalfTileMapOption(i,0,l)),e.tile(0,(a+.5)*mt.TILE_SIZE,h*mt.TILE_SIZE,this.getHalfTileMapOption(i,1,c)),e.tile(0,a*mt.TILE_SIZE,(h+.5)*mt.TILE_SIZE,this.getHalfTileMapOption(i,2,f)),e.tile(0,(a+.5)*mt.TILE_SIZE,(h+.5)*mt.TILE_SIZE,this.getHalfTileMapOption(i,3,d))}return e}static async makeLevelDataFromUrl(t){let e=new Image;return e.src=t,await new Promise(r=>{e.onload=()=>{createImageBitmap(e).then(a=>{let h=this.makeLevelData(a);r(h)})}})}static getTypeFromColor(t,e,i){if(t=Math.floor(t/100),e=Math.floor(e/100),i=Math.floor(i/100),t===0)if(e===0){if(i===0)return"secret"}else return i===0?"normal":"checkpoint";else if(t===2)if(e===0){if(i===0)return"player"}else{if(e===2)return i===0?"spring":"goal";if(i===0)return"exploding"}else if(t===1&&e!==0){if(i===0)return"mud"}}static makeLevelData(t){let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let i=e.getContext("2d");i.drawImage(t,0,0);let r=i.getImageData(0,0,t.width,t.height).data,a={tiles:void 0,objects:[],startingPosition:void 0,width:t.width*mt.TILE_SIZE,height:t.height*mt.TILE_SIZE,img:new rf(this.mainTextureSource)},h=[];function l(c,f,d){return d<0||f<0||d>=t.height||f>=t.width?!1:h[f][d]===c}for(let c=0;c<t.width;c++){let f=[];h.push(f);for(let d=0;d<t.height;d++){let g=(d*t.width+c)*4,x=this.getTypeFromColor(r[g],r[g+1],r[g+2]);f.push(x)}}a.tiles=h;for(let c=0;c<t.width;c++)for(let f=0;f<t.height;f++){let d=h[c][f];if(d==="player")a.startingPosition={x:c*mt.TILE_SIZE,y:f*mt.TILE_SIZE},h[c][f]=void 0;else if(d&&(d==="exploding"&&a.objects.push({x:c*mt.TILE_SIZE,y:f*mt.TILE_SIZE,width:mt.TILE_SIZE,height:mt.TILE_SIZE,type:d}),d!=="exploding")){let g=[l(d,c,f-1),l(d,c-1,f),l(d,c-1,f-1)],x=[l(d,c,f-1),l(d,c+1,f),l(d,c+1,f-1)],_=[l(d,c,f+1),l(d,c-1,f),l(d,c-1,f+1)],v=[l(d,c,f+1),l(d,c+1,f),l(d,c+1,f+1)];a.img.tile(0,c*mt.TILE_SIZE,f*mt.TILE_SIZE,this.getHalfTileMapOption(d,0,g)),a.img.tile(0,(c+.5)*mt.TILE_SIZE,f*mt.TILE_SIZE,this.getHalfTileMapOption(d,1,x)),a.img.tile(0,c*mt.TILE_SIZE,(f+.5)*mt.TILE_SIZE,this.getHalfTileMapOption(d,2,_)),a.img.tile(0,(c+.5)*mt.TILE_SIZE,(f+.5)*mt.TILE_SIZE,this.getHalfTileMapOption(d,3,v))}}for(let c=0;c<a.objects.length;c++){let f;do{let d=a.objects[c];f=a.objects.find(g=>g.y===d.y&&g.x===d.x+d.width&&g.type===d.type),f&&(d.width+=f.width,a.objects=a.objects.filter(g=>g!==f))}while(f)}for(let c=0;c<a.objects.length;c++){let f;do{let d=a.objects[c];f=a.objects.find(g=>g.x===d.x&&g.y===d.y+d.height&&d.width===g.width&&g.type===d.type),f&&(d.height+=f.height,a.objects=a.objects.filter(g=>g!==f))}while(f)}return a}static getHalfTileMapOption(t,e,i){let r=hC[t],a=e+(i[0]?"T":"F")+(i[1]?"T":"F")+(i[2]?"T":"F"),[h,l]=aC[a];return h+=r[0],l+=r[1],{u:h*this.TILE_SIZE/2,v:l*this.TILE_SIZE/2,tileWidth:this.TILE_SIZE/2,tileHeight:this.TILE_SIZE/2}}};mt.levelSources=["assets/Level1.bmp","assets/Level2.bmp","assets/Level3.bmp","assets/Level4.bmp","assets/Level5.bmp","assets/Level6.bmp","assets/Level7.bmp","assets/Level8.bmp","assets/Level9.bmp","assets/Level10.bmp","assets/Level11.bmp","assets/Level12.bmp"],mt.TilemapSrc="assets/Tilemap24PLUS.png",mt.PlayerSrc="assets/Characters24.png",mt.TILE_SIZE=24,mt.CHAR_SIZE=24,mt.DRAW_OUTLINES=!1,mt.skins=[];let vt=mt;const aC={"0FFF":[0,0],"0FFT":[0,0],"0FTF":[1,0],"0FTT":[1,0],"0TFF":[0,1],"0TFT":[0,1],"0TTF":[4,1],"0TTT":[1,1],"1FFF":[2,0],"1FFT":[2,0],"1FTF":[1,0],"1FTT":[1,0],"1TFF":[2,1],"1TFT":[2,1],"1TTF":[3,1],"1TTT":[1,1],"2FFF":[0,2],"2FFT":[0,2],"2FTF":[1,2],"2FTT":[1,2],"2TFF":[0,1],"2TFT":[0,1],"2TTF":[4,0],"2TTT":[1,1],"3FFF":[2,2],"3FFT":[2,2],"3FTF":[1,2],"3FTT":[1,2],"3TFF":[2,1],"3TFT":[2,1],"3TTF":[3,0],"3TTT":[1,1]},hC={normal:[0,0],spring:[5,0],exploding:[10,0],switch:[0,0],door:[0,0],player:[0,0],goal:[0,3],secret:[5,3],checkpoint:[15,0],mud:[10,3],speed:[15,3],lava:[0,6]};class Hp extends Gt{}const lC={UI:"Roboto"},Rt=class Rt{constructor(t,e=200){this.object=t,this.totalTime=e,this.running=!1,this.properties=[],this.onUpdate=i=>(this.onUpdateCallback=i,this),this.onComplete=i=>(this.onCompleteCallback=i,this),this.onWaitComplete=i=>(this.onWaitCompleteCallback=i,this),this.yoyo=(i=!0,r=1)=>(this._Yoyo=i,this._Repeat=r-.5,this),this.loop=(i=!0,r=1/0)=>(this._Loop=i,this._Repeat=r,this),this.stop=i=>(i?this.complete(this.endTime):(this.running=!1,Rt._remove(this)),this),this.reset=()=>(this.tickThis=this.firstTick,this.waitTime&&(this.hasWait=!0),this),this.wait=i=>(this.waitTime=i,this.hasWait=!0,this),this.over=i=>(this.totalTime=i,this),this.start=()=>(this.running=!0,this.properties.forEach(i=>{i.to||i.to===0?(i.start=this.object[i.key]||0,i.end=i.to):(i.from||i.from===0)&&(i.start=i.from,i.end=this.object[i.key]||0),i.isColor?(i.incR=Math.floor(i.end/65536)-Math.floor(i.start/65536),i.incG=Math.floor(i.end%65536/256)-Math.floor(i.start%65536/256),i.incB=Math.floor(i.end%256)-Math.floor(i.start%256)):i.inc=i.end-i.start,this.object[i.key]=i.start}),Rt._add(this),this),this.to=(i,r=!0)=>{for(let a of Object.keys(i))this.properties.push({key:a,eased:r,to:i[a]});return this},this.from=(i,r=!0)=>{for(let a of Object.keys(i))this.properties.push({key:a,eased:r,from:i[a]});return this},this.colorTo=(i,r=!0)=>{for(let a of Object.keys(i))this.properties.push({key:a,eased:r,to:i[a],isColor:!0});return this},this.colorFrom=(i,r=!0)=>{for(let a of Object.keys(i))this.properties.push({key:a,eased:r,from:i[a],isColor:!0});return this},this.easing=i=>(this._Easing=i,this),this.complete=i=>(this.properties.forEach(r=>{this.object[r.key]=r.end}),this._Loop&&this._Repeat>0?(this._Repeat--,this.reset(),this.startTime=i,this.endTime=this.startTime+(this.totalTime||0)):this._Yoyo&&this._Repeat>0?(this._Repeat-=.5,this.reverseProps(),this.startTime=i,this.endTime=this.startTime+(this.totalTime||0)):(this.running=!1,Rt._remove(this),this.tickThis=()=>{},this.onCompleteCallback&&this.onCompleteCallback(this.object),this.nextTween&&(this.nextTween.reset(),this.nextTween.start(),this.nextTween.tickThis(i))),this),this.firstTick=i=>{this.hasWait?this.startTime=i+this.waitTime/(Rt.speedFactor||1):this.startTime=i,this.endTime=this.startTime+(this.totalTime/(Rt.speedFactor||1)||0),this.tickThis=this.tailTick},this.tailTick=i=>{if(this.hasWait&&i>this.startTime&&(this.hasWait=!1,this.onWaitCompleteCallback&&this.onWaitCompleteCallback(this.object)),i>this.endTime)this.complete(i);else if(i>this.startTime){let r=(i-this.startTime)/(this.endTime-this.startTime),a=this._Easing?this._Easing(r):r;this.properties.forEach(h=>{let l=h.eased?a:r;h.isColor?this.object[h.key]=Math.round(h.start+Math.floor(h.incR*l)*65536+Math.floor(h.incG*l)*256+Math.floor(h.incB*l)):this.object[h.key]=h.start+h.inc*l}),this.onUpdateCallback&&this.onUpdateCallback(this.object)}},this.reverseProps=()=>{this.properties.forEach(i=>{let r=i.start;i.start=i.end,i.end=r,i.isColor?(i.incR=Math.floor(i.end/65536)-Math.floor(i.start/65536),i.incG=Math.floor(i.end%65536/256)-Math.floor(i.start%65536/256),i.incB=Math.floor(i.end%256)-Math.floor(i.start%256)):i.inc=i.end-i.start})},this.tickThis=this.firstTick}chain(t,e){return this.nextTween=new Rt(t,e),this.nextTween}chainTween(t){return this.nextTween=t,t}};Rt.speedFactor=1,Rt.running=!1,Rt.tweens=[],Rt._add=t=>{Rt.tweens.push(t),Rt._tryRun()},Rt._remove=t=>{let e=Rt.tweens.indexOf(t);e>=0&&Rt.tweens.splice(e,1)},Rt._tryRun=()=>{!Rt.running&&Rt.tweens.length>0&&(Rt.running=!0,requestAnimationFrame(Rt._tick))},Rt._tick=t=>{Rt.running=!1,Rt.tweens.forEach(e=>e.tickThis(t)),Rt._tryRun()};let qi=Rt;const to={Quadratic:{In:s=>s*s,Out:s=>s*(2-s),InOut:s=>(s*=2,s<1?.5*s*s:-.5*(--s*(s-2)-1))},Sinusoidal:{In:s=>1-Math.cos(s*Math.PI/2),Out:s=>Math.sin(s*Math.PI/2),InOut:s=>.5*(1-Math.cos(Math.PI*s))}};function ms(s,t=0){let e=Math.floor(s/65536),i=Math.floor(s%65536/256),r=s%256;return e=Math.min(Math.max(Math.round(e*t),0),255),i=Math.min(Math.max(Math.round(i*t),0),255),r=Math.min(Math.max(Math.round(r*t),0),255),e*65536+i*256+r}const uC={width:200,height:50,rounding:8,color:7851263,hoverScale:.1},cC={fill:0,fontFamily:lC.UI};class uo extends Gt{constructor(t){super(),this.config=t,this.disabledColor=10066329,this.selectedColor=14535731,this.config=t=le.defaults(t,uC),this.color=t.color,this.defaultColor=t.color,this.hitArea=new kt(0,0,t.width,t.height),this.inner=new Gt,this.inner.pivot.set(t.width/2,t.height/2),this.inner.position.set(t.width/2,t.height/2),this.addChild(this.inner),this.background=new ve,this.background.roundRect(0,0,t.width,t.height,t.rounding).fill(16777215).stroke({width:2,color:0}),this.background.tint=t.color;let e=le.defaults(t.labelStyle,cC);this.inner.addChild(this.background),this.buttonLabel=new xs({text:t.buttonLabel,style:e,textureStyle:{scaleMode:"nearest"}}),this.addLabel(),this.inner.addChild(this.buttonLabel),this.eventMode="static",this.cursor="pointer",this.addListener("mouseover",()=>{this._Disabled||(this.background.tint=ms(this.color,.8))}),this.addListener("mouseout",()=>{this._Disabled||(this.background.tint=this.color)}),this.addListener("mouseup",i=>{this._Disabled||(this.background.tint=ms(this.color,.8),this.inner.scale.set(1),i.target===this&&t.onClick())}),this.addListener("touchend",i=>{this._Disabled||(this.background.tint=this.color,this.inner.scale.set(1),i.target===this&&t.onClick())}),this.addListener("pointerdown",()=>{this._Disabled||(this.background.tint=ms(this.color,.8),this.inner.scale.set(1-this.config.hoverScale))})}set disabled(t){this._Disabled=t,this.cursor=t?"auto":"pointer",t?this.color=this.disabledColor:this.color=this.defaultColor,this.background.tint=this.color}get disabled(){return this._Disabled}set selected(t){this._Selected=t,t?this.color=this.selectedColor:this.color=this.defaultColor,this.background.tint=this.color}get selected(){return this._Selected}startCustomDraw(t=!0){return t&&this.background.clear(),this.background.beginFill(16777215),this.background}setColor(t){this.color=t,this.background.tint=t}addLabel(t){t&&(this.buttonLabel.text=t),this.buttonLabel.scale.set(1,1),this.buttonLabel.width>this.background.width*.9&&(this.buttonLabel.width=this.background.width*.9),this.buttonLabel.scale.y=this.buttonLabel.scale.x,this.buttonLabel.x=(this.background.width-this.buttonLabel.width)/2,this.buttonLabel.y=(this.background.height-this.buttonLabel.height)/2}getLabel(){return this.buttonLabel.text}getWidth(t=!0){return this.config.width*(t?this.scale.x:1)}getHeight(t=!0){return this.config.height*(t?this.scale.y:1)}highlight(t,e=1/0){if(t){if(this._Highlight)return;this._Highlight=new ve,this._Highlight.roundRect(0,0,this.getWidth(),this.getHeight(),this.config.rounding).stroke({width:3,color:16776960}),this._HighlightTween=new qi(this._Highlight,500).to({alpha:0}).yoyo(!0,e).start().onComplete(()=>this.highlight(!1)),this.inner.addChild(this._Highlight)}else this._HighlightTween&&(this._HighlightTween.stop(),this._HighlightTween=null),this._Highlight&&(this._Highlight.destroy(),this._Highlight=null)}}const dC={width:200,height:50,rounding:8,color:7851263,hoverScale:.1,spriteScale:.8};class of extends Gt{constructor(t){super(),this.config=t,this.disabledColor=10066329,this.selectedColor=14535731,this.config=t=le.defaults(t,dC),this.color=t.color,this.defaultColor=t.color,this.hitArea=new kt(0,0,t.width,t.height),this.inner=new Gt,this.inner.pivot.set(t.width/2,t.height/2),this.inner.position.set(t.width/2,t.height/2),this.addChild(this.inner),this.background=new ve,this.background.roundRect(0,0,t.width,t.height,t.rounding).fill(16777215).stroke({width:2,color:0}),this.background.tint=t.color,this.inner.addChild(this.background),this.sprite=new ii(t.texture),this.inner.addChild(this.sprite),this.sprite.width=this.width*t.spriteScale,this.sprite.scale.y=this.sprite.scale.x,this.sprite.position.set((-this.sprite.width+t.width)/2,(-this.sprite.height+t.height)/2),this.eventMode="static",this.cursor="pointer",this.addListener("mouseover",()=>{this._Disabled||(this.background.tint=ms(this.color,.8))}),this.addListener("mouseout",()=>{this._Disabled||(this.background.tint=this.color)}),this.addListener("mouseup",e=>{this._Disabled||(this.background.tint=ms(this.color,.8),this.inner.scale.set(1),e.target===this&&t.onClick())}),this.addListener("touchend",e=>{this._Disabled||(this.background.tint=this.color,this.inner.scale.set(1),e.target===this&&t.onClick())}),this.addListener("pointerdown",()=>{this._Disabled||(this.background.tint=ms(this.color,.8),this.inner.scale.set(1-this.config.hoverScale))})}set disabled(t){this._Disabled=t,this.cursor=t?"auto":"pointer",t?this.color=this.disabledColor:this.color=this.defaultColor,this.background.tint=this.color}get disabled(){return this._Disabled}set selected(t){this._Selected=t,t?this.color=this.selectedColor:this.color=this.defaultColor,this.background.tint=this.color}get selected(){return this._Selected}startCustomDraw(t=!0){return t&&this.background.clear(),this.background.beginFill(16777215),this.background}setColor(t){this.color=t,this.background.tint=t}addTexture(t){t&&(this.sprite.texture=t)}getWidth(t=!0){return this.config.width*(t?this.scale.x:1)}getHeight(t=!0){return this.config.height*(t?this.scale.y:1)}highlight(t,e=1/0){if(t){if(this._Highlight)return;this._Highlight=new ve,this._Highlight.roundRect(0,0,this.getWidth(),this.getHeight(),this.config.rounding).stroke({width:3,color:16776960}),this._HighlightTween=new qi(this._Highlight,500).to({alpha:0}).yoyo(!0,e).start().onComplete(()=>this.highlight(!1)),this.inner.addChild(this._Highlight)}else this._HighlightTween&&(this._HighlightTween.stop(),this._HighlightTween=null),this._Highlight&&(this._Highlight.destroy(),this._Highlight=null)}}class fC extends Hp{constructor(t){super(),this.levelItems=[],this.togglePlayerCount=()=>{Ct.gamePage.control.togglePlayerCount(),Ct.gamePage.control.TWO_PLAYER?(this.playerB.addLabel("Two Players"),this.player2Avatar.visible=!0):(this.playerB.addLabel("One Player"),this.player2Avatar.visible=!1)},this.toggleGhost=()=>{switch(Ct.gamePage.control.GHOST_MODE){case"off":Ct.gamePage.control.GHOST_MODE="replay",this.ghostB.addLabel("Replay Ghost");break;case"replay":Ct.gamePage.control.GHOST_MODE="off",this.ghostB.addLabel("No Ghost");break}},this.navIn=()=>{Ct.gamePage.control.player&&this.player1Avatar.addTexture(Ct.gamePage.control.player.head.texture),Ct.gamePage.control.player2&&this.player2Avatar.addTexture(Ct.gamePage.control.player2.head.texture),Ct.saveM.getExtrinsic().levelGhosts.forEach(a=>{let h=this.levelItems.find(l=>l.index===a.mapId);h&&h.updateTime(a.time)})},this.navOut=()=>{};let e=new ve;e.rect(0,0,t.width,t.height).fill(52479);let i=new xs({text:"Level Up Speed Run: D.A.D.A.!",style:{fontSize:50}});i.position.set(25,50),this.addChild(e,i),this.addColumn("Dad's Levels:",[["Loopy",0],["Super Obby",4],["Hurdles",9]],100,150,10),this.addColumn("Pizza Rainbow Levels:",[["The Mountains",1],["Fall Secrets",7],["Escape Room",8]],375,150,10),this.addColumn("Electric Orb Levels:",[["Treasure Hunt",2],["Sky Base",3],["AOAO",5],["Secret Passage",6],["Level AW",10]],675,150,10),this.ghostB=new uo({buttonLabel:"Replay Ghost",onClick:this.toggleGhost,color:52479,width:90,height:30,labelStyle:{fontSize:15}}),this.ghostB.position.set(50,505),this.playerB=new uo({buttonLabel:"One Player",onClick:this.togglePlayerCount,color:13434726,width:150,height:40,labelStyle:{fontSize:20}}),this.playerB.position.set(275,500),this.player1Avatar=new of({texture:vt.skins[0][2],onClick:()=>this.toggleAvatar(0),color:16763904,width:40,height:40,spriteScale:.9}),this.player2Avatar=new of({texture:vt.skins[3][2],onClick:()=>this.toggleAvatar(1),color:15632435,width:40,height:40,spriteScale:.9}),this.player1Avatar.position.set(435,500),this.player2Avatar.position.set(485,500),this.player2Avatar.visible=!1,this.addChild(this.playerB),this.addChild(this.player1Avatar),this.addChild(this.player2Avatar),this.addChild(this.ghostB)}addColumn(t,e,i,r,a){let h=new xs({text:t,style:{fontSize:25}});h.position.set(i-h.width/2,r),this.addChild(h),e.forEach((l,c)=>{let f=new pC(l[0],l[1],this.startLevel);this.levelItems.push(f),f.position.set(i-75,r+40+(40+a)*c),this.addChild(f)})}startLevel(t){Ct.gamePage.control.loadLevel(t),Ct.setPage(Ct.gamePage)}toggleAvatar(t=0){if(t===0){let e=Ct.gamePage.control.player;e.nextSkin(1),this.player1Avatar.addTexture(e.head.texture)}else{let e=Ct.gamePage.control.player2;e.nextSkin(1),this.player2Avatar.addTexture(e.head.texture)}}}class pC extends Gt{constructor(t,e,i){super(),this.index=e,this.button=new uo({buttonLabel:t,onClick:()=>i(e),color:16763904,width:150,height:40,labelStyle:{fontSize:20}}),this.addChild(this.button)}updateTime(t){this.highscore||(this.highscore=new xs({style:{fontSize:12}}),this.highscore.position.set(155,14),this.addChild(this.highscore));let e=Math.floor(t/60),i=Math.floor(t-e*60),r=Math.floor((t-Math.floor(t))*1e3);this.highscore.text=`${this.addZeroes(e,1)}:${this.addZeroes(i,2)}:${this.addZeroes(r,3)}`}addZeroes(t,e){let i=t.toString();for(;i.length<e;)i="0"+i;return i}}const gC={x:0,y:0,count:20,offRadius:0,angle_min:0,angle_max:Math.PI*2,mag_min:1,mag_max:3,fade:.06,size_min:2,size_max:5,tint:13421772},Qt=class Qt{static makeExplosion(t,e){le.defaults(e,gC),Qt.initialized||Qt.initialize();for(let i=0;i<e.count;i++){let r=new ii(Qt.TEXTURE);t.addChild(r);let a=le.random(e.size_min,e.size_max);r.width=a,r.anchor.set(.5),r.scale.y=r.scale.x,r.alpha=le.random(1,2,!0),r.position.set(e.x,e.y),r.tint=e.tint;let h=le.random(e.mag_min,e.mag_max),l=le.random(e.angle_min,e.angle_max);if(e.offRadius){let f=Math.random()*e.offRadius;r.x+=f*Math.cos(l),r.y+=f*Math.cos(l)}let c={display:r,local:!1,delay:0,vX:h*Math.cos(l),vY:h*Math.sin(l),fade:e.fade};Qt.particles.push(c)}}static initialize(){Qt.initialized||(Qt.TEXTURE=Qe.getGraphicTexture("firework"),Ct.app.ticker.add(Qt.onTick),Qt.initialized=!0)}static updateParticle(t){t.display.x+=t.vX,t.display.y+=t.vY,t.display.alpha-=t.fade}};Qt.particles=[],Qt.initialized=!1,Qt.onTick=()=>{for(let t=0;t<Qt.particles.length;t++)Qt.updateParticle(Qt.particles[t]),Qt.particles[t].display.alpha<.1&&(Qt.particles[t].display.destroy(),Qt.particles.splice(t,1),t--)};let Ci=Qt;class mC extends Gt{constructor(t){super(),this.config=t,this.animating=!1,this.overlay=new ve,this.usedByGhost=!1,this.usedByPlayer=!1,this.tiling=vt.drawBlock(t),this.addChild(this.tiling),vt.DRAW_OUTLINES&&(this.addChild(this.overlay),this.overlay.rect(0,0,t.width,t.height),this.overlay.stroke({width:2,color:0})),this.position.set(t.x,t.y)}randomTint(){this.tint=Math.random()*16777215}shrinkAway(t){if(this.animating)return;this.animating=!0;let e=this.config.height,i=this.config.y;new qi(this).to({y:this.y+this.config.height}).over(300).start(),new qi(this.scale).to({y:0}).over(300).onUpdate(()=>{this.config.height=e*this.scale.y,this.config.y=i+e-this.config.height}).onComplete(()=>{t&&t()}).start()}explode(){this.animating||(this.visible=!1,this.animating=!0,this.parent&&Ci.makeExplosion(this.parent,{x:this.x+this.config.width/2,y:this.y+this.config.height/2,tint:no[this.config.type],count:20}))}}const no={normal:43537,spring:13421619,exploding:13386769,switch:4517631,door:43690,player:16711680,goal:5592405,secret:47906,checkpoint:2254489,mud:8934690,speed:11141290,lava:16711680},ie=class ie extends Gt{constructor(t,e,i=1){super(),this.boundWidth=t,this.boundHeight=e,this.baseScale=i,this.blocks=[],this.background=new ve,this.foreground=new ve,this.backgroundRatio=.7,this.movingLayer=new Gt,this.staticLayer=new Gt,this.layers=[this.background,new Gt,new Gt,new Gt,new Gt],this.addChild(this.background,this.movingLayer,this.staticLayer),this.movingLayer.addChild(this.layers[ie.OBJECTS],this.layers[ie.PLAYER],this.layers[ie.EFFECTS]),this.staticLayer.addChild(this.layers[ie.UI]),this.eventMode="dynamic"}parallaxBackground(){let t=this.movingLayer.x/this.boundWidth,e=this.movingLayer.y/this.boundHeight;this.background.position.set(this.boundWidth*this.backgroundRatio*t,this.boundHeight*this.backgroundRatio*e)}resetBounds(t,e,i){i=3368703,this.background.clear(),this.background.rect(0,0,t,e),this.background.fill(i);let r=t*e;for(let a=0;a<r;a+=1e5)this.background.ellipse(Math.random()*t,Math.random()*e,50+Math.random()*50,50+Math.random()*50),this.background.fill(ms(i,1.05+Math.random()*.1));this.boundWidth=t,this.boundHeight=e}addConfig(t){this.blocks=[],this.layers[ie.OBJECTS].removeChildren(),this.layers[ie.OBJECTS].addChild(t.img),this.layers[ie.OBJECTS].addChild(this.foreground),this.foreground.clear(),this.resetBounds(t.width,t.height,t.bgcolor);let e=t.objects;if(e.forEach(i=>{if(i.type==="exploding"){let r=new mC(i);this.blocks.push(r),this.layers[ie.OBJECTS].addChild(r)}}),vt.DRAW_OUTLINES)for(let i=0;i<this.boundWidth;i+=vt.TILE_SIZE)for(let r=0;r<this.boundHeight;r+=vt.TILE_SIZE){let a=this.findBlockAt(e,i,r),h=this.findBlockAt(e,i+vt.TILE_SIZE,r),l=this.findBlockAt(e,i,r+vt.TILE_SIZE);(a===void 0!=(h===void 0)||a!==void 0&&a.type!=h.type)&&(a===void 0||h===void 0||(a.type!=="normal"||h.type!=="secret")&&(a.type!=="secret"||h.type!=="normal"))&&this.foreground.moveTo(i+vt.TILE_SIZE,r).lineTo(i+vt.TILE_SIZE,r+vt.TILE_SIZE).stroke({width:2,color:0}),(a===void 0!=(l===void 0)||a!==void 0&&a.type!=l.type)&&(a===void 0||l===void 0||(a.type!=="normal"||l.type!=="secret")&&(a.type!=="secret"||l.type!=="normal"))&&this.foreground.moveTo(i,r+vt.TILE_SIZE).lineTo(i+vt.TILE_SIZE,r+vt.TILE_SIZE).stroke({width:2,color:0})}}findBlockAt(t,e,i){return t.find(r=>r.x<=e&&r.x+r.width>e&&r.y<=i&&r.y+r.height>i&&r.type!=="exploding")}removeObject(t){let e=this.blocks.findIndex(i=>i.config===t);e!==-1&&(this.layers[ie.OBJECTS].removeChild(this.blocks[e]),this.blocks.splice(e,1))}addPlayer(t){this.layers[ie.PLAYER].addChild(t)}removePlayer(t){try{this.layers[ie.PLAYER].removeChild(t)}catch{}}};ie.BACKGROUND=0,ie.OBJECTS=1,ie.PLAYER=2,ie.EFFECTS=3,ie.UI=4;let ti=ie;class _C{constructor(t){this.canvas=t,this.x=0,this.y=0,this.playerX=.5,this.playerY=.6,this.cameraSpeed=.2,this.viewWidth=t.boundWidth,this.viewHeight=t.boundHeight}update(t,e=!1){this.canvas.scale.set(this.canvas.baseScale);let i=t.x-this.viewWidth*this.playerX/this.canvas.scale.x,r=t.y-this.viewHeight*this.playerY/this.canvas.scale.y;e?(this.x=i,this.y=r):(this.x=this.x+(i-this.x)*this.cameraSpeed,this.y=this.y+(r-this.y)*this.cameraSpeed),this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x>this.canvas.boundWidth-this.viewWidth/this.canvas.scale.x&&(this.x=this.canvas.boundWidth-this.viewWidth/this.canvas.scale.x),this.y>this.canvas.boundHeight-this.viewHeight/this.canvas.scale.y&&(this.y=this.canvas.boundHeight-this.viewHeight/this.canvas.scale.y),this.canvas.movingLayer.x=-this.x,this.canvas.movingLayer.y=-this.y,this.canvas.parallaxBackground()}updateTwo(t,e){let i=Math.abs(t.x-e.x),r=Math.abs(Math.max(t.y,0)-Math.max(e.y,0)),a=this.viewWidth/i,h=this.viewHeight/r,l=Math.min(a,h)*.8,c=Math.min(1,l)*this.canvas.baseScale;this.canvas.scale.set(this.canvas.scale.x+(c-this.canvas.scale.x)*this.cameraSpeed);let f=(t.x+e.x)/2,d=(t.y+e.y)/2,g=f-this.viewWidth*this.playerX/this.canvas.scale.x,x=d-this.viewHeight*this.playerY/this.canvas.scale.y;this.x=this.x+(g-this.x)*this.cameraSpeed,this.y=this.y+(x-this.y)*this.cameraSpeed,this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x>this.canvas.boundWidth-this.viewWidth/this.canvas.scale.x&&(this.x=this.canvas.boundWidth-this.viewWidth/this.canvas.scale.x),this.y>this.canvas.boundHeight-this.viewHeight/this.canvas.scale.y&&(this.y=this.canvas.boundHeight-this.viewHeight/this.canvas.scale.y),this.canvas.movingLayer.x=-this.x,this.canvas.movingLayer.y=-this.y,this.canvas.parallaxBackground()}}class xC{constructor(t){this.canvas=t,this.worldLeft=0,this.worldRight=1900,this.TILE_SIZE=24,this.worldBottom=900,this.objects=[],this.checkTop=(e,i=!0)=>{let r=Math.floor((e.top-1)/this.TILE_SIZE),a=Math.floor((e.left+1)/this.TILE_SIZE),h=Math.floor((e.right-2)/this.TILE_SIZE),l=[this.getTypeAt(a,r),this.getTypeAt(h,r)],c=[this.isObjectType(l[0])&&this.getObjectAt(a*this.TILE_SIZE,r*this.TILE_SIZE),this.isObjectType(l[1])&&this.getObjectAt(h*this.TILE_SIZE,r*this.TILE_SIZE)],f=h*this.TILE_SIZE;Math.abs(e.left-f)<Math.abs(e.right-f)&&(l=[l[1],l[0]],c=[c[1],c[0]]);let d,g;if(l[0]&&(!c[0]||i&&!c[0].usedByGhost||!i&&!c[0].usedByPlayer))d=l[0],g=c[0];else if(l[1]&&(!c[1]||i&&!c[1].usedByGhost||!i&&!c[1].usedByPlayer))d=l[1],g=c[1];else return null;let x=(r+1)*this.TILE_SIZE-e.top;return{type:d,depth:x,block:g}},this.checkBottom=(e,i=!0)=>{if(e.bottom>=this.worldBottom)return{type:void 0,depth:this.worldBottom-e.bottom};let r=Math.floor(e.bottom/this.TILE_SIZE),a=Math.floor((e.left+1)/this.TILE_SIZE),h=Math.floor((e.right-2)/this.TILE_SIZE),l=h*this.TILE_SIZE;if(Math.abs(e.left-l)<Math.abs(e.right-l)){let d=a;a=h,h=d}let c=this.getTypeAt(a,r),f=this.getObjectAt(a*this.TILE_SIZE,r*this.TILE_SIZE);return c&&(!f||i&&!f.usedByGhost||!i&&!f.usedByPlayer)?{type:c,block:f,depth:e.bottom-r*this.TILE_SIZE}:(c=this.getTypeAt(h,r),f=this.getObjectAt(h*this.TILE_SIZE,r*this.TILE_SIZE),c&&(!f||i&&!f.usedByGhost||!i&&!f.usedByPlayer)?{type:c,block:f,depth:e.bottom-r*this.TILE_SIZE}:null)},this.checkLeft=(e,i=!0)=>{let r=Math.floor((e.left-1)/this.TILE_SIZE),a=Math.floor((e.top+1)/this.TILE_SIZE),h=Math.floor((e.bottom-2)/this.TILE_SIZE),l=[this.getTypeAt(r,a),this.getTypeAt(r,h)],c=[this.getObjectAt(r*this.TILE_SIZE,a*this.TILE_SIZE),this.getObjectAt(r*this.TILE_SIZE,h*this.TILE_SIZE)],f=h*this.TILE_SIZE;Math.abs(e.left-f)<Math.abs(e.right-f)&&(l=[l[1],l[0]],c=[c[1],c[0]]);let d,g;if(l[0]&&(!c[0]||i&&!c[0].usedByGhost||!i&&!c[0].usedByPlayer))d=l[0],g=c[0];else if(l[1]&&(!c[1]||i&&!c[1].usedByGhost||!i&&!c[1].usedByPlayer))d=l[1],g=c[1];else return null;let x=(r+1)*this.TILE_SIZE-e.left-1;return{type:d,depth:x,block:g}},this.checkRight=(e,i=!0)=>{let r=Math.floor(e.right/this.TILE_SIZE),a=Math.floor((e.top+1)/this.TILE_SIZE),h=Math.floor((e.bottom-2)/this.TILE_SIZE),l=[this.getTypeAt(r,a),this.getTypeAt(r,h)],c=[this.getObjectAt(r*this.TILE_SIZE,a*this.TILE_SIZE),this.getObjectAt(r*this.TILE_SIZE,h*this.TILE_SIZE)],f=h*this.TILE_SIZE;Math.abs(e.right-f)<Math.abs(e.right-f)&&(l=[l[1],l[0]],c=[c[1],c[0]]);let d,g;if(l[0]&&(!c[0]||i&&!c[0].usedByGhost||!i&&!c[0].usedByPlayer))d=l[0],g=c[0];else if(l[1]&&(!c[1]||i&&!c[1].usedByGhost||!i&&!c[1].usedByPlayer))d=l[1],g=c[1];else return null;let x=e.right-r*this.TILE_SIZE;return{type:d,depth:x,block:g}},this.checkLR=(e,i=!0,r)=>r<0?this.checkLeft(e,i):r>0?this.checkRight(e,i):null}setupLevel(t){this.data=t,this.worldRight=t.width,this.worldBottom=t.height,this.tiles=t.tiles,this.objects=t.objects,this.TILE_SIZE=vt.TILE_SIZE}removeObject(t){let e=this.objects.indexOf(t);e!==-1&&(this.objects.splice(e,1),this.canvas.removeObject(t))}getTypeAt(t,e){if(t<0)return"normal";if(e<0)return;if(t>=this.tiles.length)return"normal";if(e>=this.tiles[t].length)return;let i=this.tiles[t][e];return i==="secret"&&(i=void 0),i}getObject(t){return this.canvas.blocks.find(e=>e.config===t)}getObjectAt(t,e){for(let i of this.canvas.blocks)if(i.x<=t&&i.x+i.width>t&&i.y<=e&&i.y+i.height>e)return i;return null}globalToTile(t){return{x:Math.floor(t.x/this.TILE_SIZE),y:Math.floor(t.y/this.TILE_SIZE)}}getRightmostTile(t,e){t=Math.floor(t/this.TILE_SIZE);for(let i=t;i>=0;i--)for(let r=0;r<this.tiles[i].length;r++)if(this.tiles[i][r]===e)return{x:i*this.TILE_SIZE,y:r*this.TILE_SIZE};return null}tileToGlobal(t){return{x:t.x*this.TILE_SIZE,y:t.y*this.TILE_SIZE}}isObjectType(t){return t==="exploding"}}class _h extends Gt{constructor(){super(),this.keys={down:!1,up:!1,left:!1,right:!1,jetpack:!1,dash:!1},this.holdUp=!1,this.holdLeft=!1,this.holdRight=!1,this.isGhost=!1,this.skinIndex=0,this.doubleJumpsRemaining=1,this.wallGrabsRemaining=1,this.isGrounded=!1,this.isCrouching=!1,this.isInMud=!1,this.vX=0,this.vY=0,this.bounceTime=0,this.landTime=0,this.skewMult=-1.2/vt.CHAR_SIZE,this.vStretchMult=.1,this.maxVStretch=.2,this.animationSpeed=.2,this.handAnimationSpeed=.2,this.maxStepDelay=10,this.stepDelay=0,this.handsTick=0,this.handsTime=40,this.collider=new kt;let t=Math.round(.4*vt.CHAR_SIZE),e=Math.round(1.5*vt.CHAR_SIZE);this.collider.set(-t/2,-e,t,e),this.drawPlayer()}reset(){this.actionState=null,this.bounceTime=this.landTime=0,this.vX=this.vY=0,this.isGrounded=!0,this.isCrouching=!1}makeGhost(){this.head.alpha=.4,this.body.alpha=.4,this.leftHand.alpha=.4,this.rightHand.alpha=.4,this.isGhost=!0}getMidPoint(){return new qt(this.x,this.y-this.collider.height/2)}getFootPoint(){return new qt(this.x,this.y)}drawPlayer(){this.head=new ii(ht.EMPTY),this.body=new ii(ht.EMPTY),this.head.anchor.set(.5,1+14/20),this.body.anchor.set(.5,1),this.leftHand=new ii(ht.EMPTY),this.rightHand=new ii(ht.EMPTY),this.rightHand.scale.x=-1,this.leftHand.anchor.set(.5),this.rightHand.anchor.set(.5),this.addChild(this.body,this.head,this.leftHand,this.rightHand)}nextSkin(t){this.skinIndex=(this.skinIndex+t+vt.skins.length)%vt.skins.length,this.loadSkin(vt.skins[this.skinIndex])}loadSkin(t){this.head.texture=t[2],this.body.texture=t[1],this.leftHand.texture=t[0],this.rightHand.texture=t[0]}landing(){let t=no[this.stepBlock];Ci.makeExplosion(this.parent,{x:this.x,y:this.y,count:5,tint:t,angle_min:Math.PI,angle_max:Math.PI*2,mag_min:.7,mag_max:1})}takeoff(){let t=no[this.stepBlock];Ci.makeExplosion(this.parent,{x:this.x,y:this.y,count:5,tint:t,angle_min:Math.PI,angle_max:Math.PI*2,mag_min:.7,mag_max:1})}getCollider(t=!1){return this.isCrouching&&!t?{left:this.x+this.collider.x,top:this.y+this.collider.y+this.collider.height/2,right:this.x+this.collider.x+this.collider.width,bottom:this.y+this.collider.y+this.collider.height}:{left:this.x+this.collider.x,top:this.y+this.collider.y,right:this.x+this.collider.x+this.collider.width,bottom:this.y+this.collider.y+this.collider.height}}getTopCollider(){return{left:this.x+this.collider.x,top:this.y+this.collider.y,right:this.x+this.collider.x+this.collider.width,bottom:this.y+this.collider.y+this.collider.height/4}}updateView(){if(this.vX>0&&(this.head.scale.x=Math.abs(this.head.scale.x)),this.vX<0&&(this.head.scale.x=-Math.abs(this.head.scale.x)),this.actionState&&this.actionState.type==="victory"){this.updateVictoryAnimation();return}if(this.stepDelay--,this.stepDelay<=0&&(this.stepDelay=this.maxStepDelay,this.isGrounded&&this.vX!=0)){let l=8947848;this.stepBlock&&(l=no[this.stepBlock]),Ci.makeExplosion(this.parent,{x:this.x,y:this.y,count:2,tint:l,angle_min:Math.PI,angle_max:Math.PI*2,mag_min:.3,mag_max:.8})}if(this.updateHands(),this.actionState&&this.actionState.type==="jetpacking"&&Ci.makeExplosion(Ct.gamePage.canvas.layers[ti.OBJECTS],le.defaults(this.getMidPoint(),{count:1,tint:16764006,mag_min:1,mag_max:2})),this.actionState){if(this.actionState.type==="wall-grab"){this.body.skew.x=0,this.body.x=0,this.body.scale.y=.8,this.head.y=0,this.body.scale.x=1.1,this.body.y=-this.body.height*.4;return}else if(this.actionState.type==="rolling"){this.body.skew.x=0;let l=this.body.scale.y,c=.5-l;l=l+c*this.animationSpeed,this.body.scale.y=l;let f=this.actionState.timeRemaining/this.actionState.maxTime*Math.PI*2*Math.sign(-this.vX);this.body.rotation=f,this.head.rotation=f;let d=new qt(0,-this.collider.height*(l*.5+.08)),g=new qt(0,-(this.collider.height*.6)),x=this.collider.height*-.05,_=this.collider.height*(.2-.5*(l-.5)),v=Math.cos(f)*d.x-Math.sin(f)*d.y-d.x,T=Math.sin(f)*d.x+Math.cos(f)*d.y-d.y,w=Math.cos(f)*g.x-Math.sin(f)*g.y-g.x,A=Math.sin(f)*g.x+Math.cos(f)*g.y-g.y;this.body.x=-v,this.body.y=-T+x,this.head.x=-w,this.head.y=-A+_;return}}this.body.rotation=0,this.body.scale.x=1,this.head.rotation=0,this.head.scale.x=1*Math.sign(this.head.scale.x),this.head.scale.y=1,this.head.x=0;let t=this.vX*this.skewMult,e=1;if(this.isCrouching&&this.isGrounded&&(t*=4),e=1+Math.min(Math.abs(this.vY)*this.vStretchMult,this.maxVStretch),(this.isCrouching&&this.isGrounded||this.actionState&&this.actionState.type==="climbing")&&(e*=.5),this.vX===0){let l=this.handsTick/this.handsTime;l=Math.abs(l*2-1),e+=-.02+l*.04}this.landTime>0&&(e*=.6);let i=this.body.skew.x,r=t-i;this.body.skew.x=i+r*this.animationSpeed,this.body.x=this.body.skew.x*(this.collider.height*.65-(1-this.body.scale.y)*15);let a=this.body.scale.y,h=e-a;this.body.scale.y=a+h*this.animationSpeed,this.body.y=0,this.head.y=this.collider.height*(1-this.body.scale.y)*.7}updateVictoryAnimation(){if(this.body.skew.x=0,this.body.rotation=0,this.body.x=0,this.head.x=0,this.head.rotation=0,this.stepDelay=(this.stepDelay+1)%60,this.stepDelay<30){let t=this.stepDelay/30;this.body.scale.y=1-t*.3,this.body.y=0,this.head.y=this.collider.height*(1-this.body.scale.y)*.7,this.leftHand.x=-this.collider.width*.5,this.rightHand.x=this.collider.width*.5,this.leftHand.y=this.rightHand.y=this.collider.height*(-.6+t*.3)}else if(this.stepDelay<45){let t=(this.stepDelay-30)/15,e=to.Quadratic.Out(t);this.body.scale.y=1-(1-e)*.3,this.body.y=-e*15,this.head.y=this.collider.height*(1-this.body.scale.y)*.7-e*15,this.leftHand.y=this.rightHand.y=this.collider.height*(-.3-e*1.3),this.leftHand.x=this.collider.width*(-.5-e*.5),this.rightHand.x=this.collider.width*(.5+e*.5)}else{let t=(this.stepDelay-45)/15,e=to.Quadratic.In(t);this.body.scale.y=1,this.body.y=-(1-e)*15,this.head.y=-(1-e)*15,this.leftHand.y=this.rightHand.y=this.collider.height*(-1.5+1*e),this.leftHand.x=this.collider.width*(-1+.5*e),this.rightHand.x=this.collider.width*(1-e*.5)}}updateHands(){this.handsTick=(this.handsTick+1)%this.handsTime;let t=0,e=0,i=0,r=0;if(this.actionState){let a=this.actionState.timeRemaining/this.actionState.maxTime;switch(this.actionState.type){case"rolling":this.handAnimationSpeed=.2;let h=1-a;e=r=this.collider.height*-.1,t=i=this.collider.width*(Math.sign(this.vX)*(2-h*4));break;case"wall-grab":this.handAnimationSpeed=.5,e=this.collider.height*(-1+.1*this.actionState.direction+a*.3),r=this.collider.height*(-1-.1*this.actionState.direction+a*.3),t=i=this.collider.width*this.actionState.direction;break;case"climbing":this.handAnimationSpeed=.2,e=r=Math.round((this.y-this.height/2)/vt.TILE_SIZE)*vt.TILE_SIZE-this.y+5,t=i=this.collider.width*this.actionState.direction;break;case"jetpacking":this.handAnimationSpeed=.1,e=this.collider.height*-.4,r=this.collider.height*-.4,t=this.collider.width*-.6,i=this.collider.width*.6;break}}else if(this.isGrounded)if(this.vX===0)if(this.isCrouching)this.handAnimationSpeed=.2,e=this.collider.height*-.1,r=this.collider.height*-.1,t=this.collider.width*-.6,i=this.collider.width*.6;else{this.handAnimationSpeed=.2;let a=this.handsTick/this.handsTime,h=Math.abs(a*2-1);e=this.collider.height*(-.4+.02-.04*h),r=this.collider.height*(-.4+.02-.04*h),t=this.collider.width*(-.7-.03*(1-h)),i=this.collider.width*(.7+.03*(1-h))}else if(this.isCrouching){this.handAnimationSpeed=.2;let a=this.handsTick/this.handsTime,h=1-Math.abs(Math.min(a,.5)*4-1),l=1-Math.abs(Math.max(a,.5)*4-3);e=this.collider.height*(-.1-(this.vX>0?h:l)*.3),r=this.collider.height*(-.1-(this.vX>0?l:h)*.3),t=this.collider.width*(1.5*(1-Math.abs(a*4-2))),i=this.collider.width*(1.5*(Math.abs(a*4-2)-1))}else{this.handAnimationSpeed=.2;let a=this.handsTick/this.handsTime,h=Math.abs(a*2-1),l=1-Math.abs(a*2-1),c=to.Sinusoidal.Out(h),f=to.Sinusoidal.Out(l);h=(h*Math.PI*1.2-Math.PI*.5)*Math.sign(this.vX),l=(l*Math.PI*1.2-Math.PI*.5)*Math.sign(this.vX);let d=8-c*3,g=8-f*3;e=-this.collider.height*.5+Math.cos(h)*d,t=-this.collider.width*.2+Math.sin(h)*d,r=-this.collider.height*.5+Math.cos(l)*g,i=this.collider.width*.2+Math.sin(l)*g}else this.handAnimationSpeed=.05,e=r=this.collider.height*(-1-le.clamp(this.vY,-5,5)*.1),t=this.collider.width*(-.6+this.vX*.12),i=this.collider.width*(.6+this.vX/this.collider.width*1.56);this.setChildIndex(this.rightHand,this.vX<=0?3:0),this.setChildIndex(this.leftHand,this.vX>=0?3:0),this.landTime>0&&(e+=10,r+=10),this.leftHand.x+=(t-this.leftHand.position.x)*this.handAnimationSpeed,this.leftHand.y+=(e-this.leftHand.position.y)*this.handAnimationSpeed,this.rightHand.x+=(i-this.rightHand.position.x)*this.handAnimationSpeed,this.rightHand.y+=(r-this.rightHand.position.y)*this.handAnimationSpeed}}class yC{constructor(t){this.world=t,this.moveSpeed=1.2,this.maxSpeed=12,this.minSpeed=.12,this.minBounceSpeed=3,this.jumpSpeed=-9,this.mudJumpSpeedMin=-3,this.mudJumpSpeedMult=2.5,this.airMoveSpeed=.4,this.jetpackXSpeed=.2,this.jetpackYSpeed=-.3,this.springSpeed=-18,this.climbGravity=.54,this.fallGravity=.4,this.parachuteGravity=.3,this.terminalVelocity=12,this.parachuteTerminal=10,this.kickVX=8,this.climbSpeed=1.2,this.minGrabSpeedX=2.4,this.maxGrabSpeedY=-1.2,this.divingSpeed=12,this.grabSlideSpeed=.6,this.maxRollSpeed=9,this.rollSpeedNeeded=2.448,this.jetpackMaxSpeed=-6,this.climbInset=3.6,this.mudFall=.1,this.minMudJumpStop=0,this.wallCoyoteVY=-.1,this.vaultSpeed=4,this.mudXExtraFrictionBase=.3,this.mudXExtraFrictionMult=-.1,this.crouchSpeedMult=.5,this.rollSpeedMult=1.5,this.friction=.8,this.extraLandFriction=.8,this.airFriction=.93,this.bounce=-.7,this.bounceTime=5,this.kickTime=15,this.grabTime=50,this.rollTime=20,this.coyoteWallTime=20,this.rollAfterTime=5,this.landTimeBase=5,this.landTimeVMult=1,this.mudMaxSink=-10,this.maxDoubleJumps=1,this.maxWallGrabs=1/0,this.playerTick=e=>{e&&(e.landTime>0&&e.landTime--,e.bounceTime>0&&e.bounceTime--,e.actionState&&(e.actionState.timeRemaining--,e.actionState.timeRemaining<=0&&(e.actionState?.onExpire(),e.actionState=null)),this.updatePlayerActions(e),this.moveAndCollide(e),Vi.ACTIVITY_LOG.publish({slug:"VELOCITY",text:`${e.vX.toFixed(2)}, ${e.vY.toFixed(2)}`}))}}respawn(t){let e=this.world.getRightmostTile(t.x,"checkpoint");e?(t.x=e.x+vt.TILE_SIZE/2,t.y=e.y,t.actionState=null,t.vX=0,t.vY=0,t.isGrounded=!0,t.isCrouching=!1):(t.x=this.world.data.startingPosition.x,t.y=this.world.data.startingPosition.y)}updatePlayerActions(t){t.keys.jetpack?t.actionState===null&&this.startJetpacking(t,0):t.actionState&&t.actionState.type==="jetpacking"&&(t.actionState=null),t.keys.up?this.canJump(t)?(!t.isGrounded&&!t.actionState&&t.doubleJumpsRemaining--,t.vY=Math.max(this.jumpSpeed,t.vY+this.jumpSpeed),t.takeoff(),t.isGrounded=!1,t.isCrouching=!1,t.landTime=0,t.stepBlock=null,t.holdUp=!0,t?.actionState?.onJump?.()):!t.isGrounded&&t.vY<0&&(t.holdUp=!0):t.holdUp=!1,t.keys.down?t.actionState?t.actionState?.onDown?.():t.isGrounded?!t.isCrouching&&Math.abs(t.vX)>this.rollSpeedNeeded?this.startRoll(t,Math.sign(t.vX)):t.isCrouching=!0:t.vY=Math.max(this.divingSpeed,t.vY):t.actionState||t.isGrounded&&t.isCrouching&&!this.world.checkTop(t.getCollider(!0),t.isGhost)&&(t.isCrouching=!1),!t.isGrounded&&(!t.actionState||t.actionState.hasPhysics)&&(t.vY<0?t.vY=Math.min(t.vY+this.climbGravity,this.terminalVelocity):t.holdUp&&t.vY<=this.parachuteTerminal?t.vY=Math.min(t.vY+this.parachuteGravity,this.parachuteTerminal):t.vY=Math.min(t.vY+this.fallGravity,this.terminalVelocity));let e=1,i=0;t.actionState?t.actionState.type==="jetpacking"?(i=this.jetpackXSpeed,e=this.airFriction):t.actionState.type==="wall-grab"&&t.actionState.hasPhysics&&(i=this.airMoveSpeed,e=this.airFriction):t.isGrounded?(i=this.moveSpeed,e=this.friction,t.isCrouching&&(i*=this.crouchSpeedMult)):t.isGrounded||(i=this.airMoveSpeed,e=this.airFriction),t.landTime>0&&(e*=this.extraLandFriction),t.bounceTime<=0&&(t.keys.left&&!t.holdLeft&&(t.actionState?.onLR?.(-1),t.vX+=-i),t.keys.right&&!t.holdRight&&(t.actionState?.onLR?.(1),t.vX+=i)),t.keys.left||(t.holdLeft=!1),t.keys.right||(t.holdRight=!1),t.vX*=e,t.vX=le.clamp(t.vX,-this.maxSpeed,this.maxSpeed),Math.abs(t.vX)<this.minSpeed&&(t.vX=0)}canJump(t){return t.holdUp?!1:t.actionState?t.actionState.canJump:t.isCrouching||t.landTime>0?!1:!!(t.isGrounded||!t.isGrounded&&t.doubleJumpsRemaining>0)}moveAndCollide(t){if(t.actionState?.updateY?.(),t.y+=t.vY,t.vY<0){let e=this.world.checkTop(t.getCollider(),t.isGhost);e&&(t.isGrounded?t.isCrouching=!0:t.vY<0&&(t.y+=e.depth,this.specialBlockCheck(t,e,0,-1)||(t.actionState&&t.actionState.onCollisionUp?t.actionState.onCollisionUp(e):t.vY=0)))}else{let e=this.world.checkBottom(t.getCollider(),t.isGhost);if(e){if(t.holdLeft=!1,t.holdRight=!1,t.actionState&&t.actionState.onCollisionDown)t.actionState.onCollisionDown(e);else if(!t.isGrounded&&t.vY>0){if(e.type)t.isGrounded=!0,t.landTime=this.landTimeBase+Math.abs(t.vY)*this.landTimeVMult,t.doubleJumpsRemaining=this.maxDoubleJumps,t.wallGrabsRemaining=this.maxWallGrabs,t.stepBlock=e.type,t.y-=e.depth,t.vY=0,t.landing();else if(e.depth<-t.height){this.respawn(t);return}}}t.isGrounded&&(!t.actionState||t.actionState.hasPhysics)&&this.checkIfFall(t,e)}if(t.x+=t.vX,t.actionState&&t.actionState.onCollisionLR)t.actionState.onCollisionLR();else{let e=Math.sign(t.vX),i=this.world.checkLR(t.getCollider(),t.isGhost,e);if(i&&i.depth>0){if(t.x-=i.depth*e,this.specialBlockCheck(t,i,e,0))return;if(!t.actionState){let r=this.world.checkLR(t.getTopCollider(),t.isGhost,e);if(!t.isCrouching&&!r&&(t.vX===0||Math.sign(t.vX)===e)){this.startClimbing(t,e);return}else if(!t.isGrounded&&t.wallGrabsRemaining>0){let a=e<0?t.keys.left:t.keys.right,h=e<0?t.keys.right:t.keys.left,l=e<0?t.holdRight:t.holdLeft;if((!h||l)&&Math.sign(t.vX)===e&&Math.abs(t.vX)>this.minGrabSpeedX||a&&t.vY<0&&t.vY>this.maxGrabSpeedY){this.startWallGrab(t,e);return}}}Math.sign(t.vX)===e&&(Math.abs(t.vX)<this.minBounceSpeed?t.vX=0:(t.vX=this.bounce*t.vX,t.bounceTime=this.bounceTime))}}}specialBlockCheck(t,e,i,r){return e.type?e.type==="spring"||e.type==="exploding"?(e.type==="exploding"&&e.block&&(t.isGhost?e.block.usedByGhost=!0:(e.block.usedByPlayer=!0,e.block.explode())),r!==0&&(t.vY=this.springSpeed*r),i!==0&&(t.vX=this.springSpeed*i),t.bounceTime=0,t.landTime=0,r===1&&(t.isGrounded=!1),!0):e.type==="goal"&&r===1?(this.startVictory(t,Math.sign(t.vX)),!0):!1:!1}checkIfFall(t,e){if(!e||e.depth<0){if(t.isCrouching){let i=this.world.checkTop(t.getCollider(!0),t.isGhost);i&&(t.y+=i.depth)}return t.stepBlock=null,t.isGrounded=!1,t.isCrouching=!1,!0}else if(e.type&&(t.stepBlock=e.type),e.depth===0)return this.specialBlockCheck(t,e,0,1);return!1}startVictory(t,e){t.actionState={type:"victory",direction:e,maxTime:1/0,timeRemaining:1/0},t.vX=t.vY=0,t.isGrounded=!0,t.isCrouching=!1,t.isGhost||Vi.LEVEL_COMPLETE.publish()}startRoll(t,e){t.actionState={type:"rolling",direction:e,maxTime:this.rollTime,timeRemaining:this.rollTime-1,onExpire:()=>{t.bounceTime=this.rollAfterTime,t.isCrouching=!0},hasPhysics:!0},t.isCrouching=!0,t.landTime=0,t.vX=le.clamp(t.vX*this.rollSpeedMult,-this.maxRollSpeed,this.maxRollSpeed)}startWallGrab(t,e){let i=-1;t.actionState={type:"wall-grab",direction:e,maxTime:this.grabTime,timeRemaining:this.grabTime,onExpire:()=>{t.isGrounded=!1},canJump:!0,onDown:()=>{t.actionState=null,t.isGrounded=!1,t.isCrouching=!0},onJump:()=>(t.vY=this.jumpSpeed,t.vX=-this.kickVX*t.actionState.direction,t.bounceTime=this.kickTime,t.actionState=null,!0),onLR:r=>{i<0&&r!==e&&(i=this.coyoteWallTime,t.actionState.hasPhysics=!0,t.isGrounded=!1)},updateY:()=>{i>0?(t.vY+=this.wallCoyoteVY,i--,i===0&&(t.actionState=null)):t.y+=this.grabSlideSpeed},onCollisionDown:r=>{t.y-=r.depth,t.actionState=null},onCollisionLR:()=>{if(!this.world.checkLR(t.getCollider(),t.isGhost,e)&&i<=0){t.actionState=null;return}}},t.vX=0,t.vY=0,t.wallGrabsRemaining--,t.isGrounded=!0,e===1?t.holdRight=!0:t.holdLeft=!0}startJetpacking(t,e){t.actionState={type:"jetpacking",direction:e,maxTime:1/0,timeRemaining:1/0,hasPhysics:!1,canJump:!1,updateY:()=>{t.vY=Math.max(t.vY+this.jetpackYSpeed,this.jetpackMaxSpeed)},onCollisionUp:i=>{t.vY=this.bounce*t.vY,t.bounceTime=this.bounceTime},onCollisionDown:i=>{t.vY>=0&&(t.y-=i.depth,t.vY=this.bounce*t.vY,t.bounceTime=this.bounceTime)}},t.isCrouching=!1,t.isGrounded=!1}startClimbing(t,e){t.actionState={type:"climbing",direction:e,maxTime:1/0,canJump:!0,timeRemaining:1/0,updateY:()=>t.y-=this.climbSpeed,onJump:()=>{t.actionState=null,t.isGrounded=!1,t.isCrouching=!0,t.holdLeft=t.holdRight=!1},onCollisionLR:()=>{let i=this.world.checkLR(t.getCollider(),t.isGhost,e);if(!i){t.isCrouching=!0,t.isGrounded=!0,t.x+=this.climbInset*t.actionState.direction,t.y+=10;let r=this.world.checkBottom(t.getCollider(),t.isGhost);r&&r.depth>0&&(t.y-=r.depth),i=this.world.checkLR(t.getCollider(),t.isGhost,e),i&&i.depth>0&&(t.x-=i.depth*e),t.actionState=null}},onDown:()=>{t.actionState=null,t.isGrounded=!1,t.isCrouching=!0},onLR:i=>{if(i===e&&e===1&&!t.holdRight||e===-1&&!t.holdLeft){t.actionState=null;let r=Math.round((t.y-t.height/2)/vt.TILE_SIZE)*vt.TILE_SIZE;t.y=r,t.x+=this.climbInset*e,t.vX=this.vaultSpeed*e,this.startRoll(t,e)}}},e===1?t.holdRight=!0:t.holdLeft=!0,t.isCrouching=!0,t.isGrounded=!0,t.vX=0,t.vY=0}}class bC extends Gt{constructor(){super(),this.time=0,this.recording=!0,this.text=new xs({text:"0.00",style:{fontSize:18,fill:16777215,dropShadow:{color:0,blur:2,distance:3}}}),this.addChild(this.text)}update(t){this.recording&&(this.time+=t,this.text.text=(this.time/1e3).toFixed(2))}reset(){this.time=0,this.text.text="0.00"}getTime(){return this.time}pause(){this.recording=!1}start(){this.recording=!0}}class Gn{constructor(t){this.data=t,this.recordingStep=0,this.replayingStep=0,this.replayIndex=0,this.keys=["down","up","left","right","jetpack","dash"]}resetPlayback(){this.replayIndex=0,this.recordingStep=0,this.replayingStep=0,this.previousState=null}recordStep(t){if(this.recordingStep++,this.previousState)for(let e of this.keys){const i=t.keys[e],r=this.previousState[e];i!==r&&(this.data.record.push({time:this.recordingStep,key:e,state:i}),this.previousState[e]=i)}else{this.previousState={...t.keys};for(let e of this.keys)this.data.record.push({time:this.recordingStep,key:e,state:this.previousState[e]})}}playStep(t){for(this.replayingStep++;this.replayIndex<this.data.record.length&&this.data.record[this.replayIndex].time<=this.replayingStep;)t.keys[this.data.record[this.replayIndex].key]=this.data.record[this.replayIndex].state,this.replayIndex++}clone(){return new Gn(le.cloneDeep(this.data))}}class vC{constructor(t,e){this.canvas=t,this.keyboard=e,this.GHOST_MODE="replay",this.TWO_PLAYER=!1,this.currentLevelIndex=4,this.running=!0,this.timer=new bC,this.levelCompleteText=new xs({text:"Level Complete!",style:{fontSize:40,fill:16777215,dropShadow:{color:0,blur:4,distance:6}}}),this.gameStartText=new xs({text:"Press any key to start",style:{fontSize:40,fill:16777215,dropShadow:{color:0,blur:4,distance:6}}}),this.togglePlayerCount=()=>{this.TWO_PLAYER=!this.TWO_PLAYER},this.onLevelComplete=()=>{this.running=!1,this.loopingFireworks();let i=this.timer.getTime()/1e3;if(this.levelCompleteText.text=`Level Complete!
  Time: ${i.toFixed(2)}s`,this.canvas.layers[ti.UI].addChild(this.levelCompleteText),this.GHOST_MODE!=="live"&&(!this.replayingStream||i<this.replayingStream.data.time)){this.recordingStream.data.time=i;let r=Ct.saveM.getExtrinsic(),a=r.levelGhosts.findIndex(h=>h.mapId===this.currentLevelIndex);a<0?r.levelGhosts.push(this.recordingStream.data):r.levelGhosts[a]=this.recordingStream.data,Ct.saveM.saveExtrinsic(),this.levelCompleteText.text+=`
New Record!`,console.log("a")}},this.onTick=i=>{if(!this.running){this.player.updateView(),this.player2&&this.player2.updateView();return}this.timer.update(i.deltaMS),this.ghostPlayer&&this.replayingStream&&(this.replayingStream.playStep(this.ghostPlayer),this.playerMovement.playerTick(this.ghostPlayer),this.ghostPlayer.updateView()),this.recordingStream&&this.recordingStream.recordStep(this.player),this.playerMovement.playerTick(this.player),this.player.updateView(),this.TWO_PLAYER?(this.playerMovement.playerTick(this.player2),this.player2.updateView(),this.camera.updateTwo(this.player,this.player2)):this.camera.update(this.player);for(let r=this.canvas.blocks.length-1;r>=0;r--)this.canvas.blocks[r].destroyed&&this.gameEnvironment.removeObject(this.canvas.blocks[r].config)},this.gameEnvironment=new xC(t),this.playerMovement=new yC(this.gameEnvironment),this.camera=new _C(this.canvas),this.timer.position.set(Ct.worldBounds.width-80,20),this.levelCompleteText.anchor.set(.5),this.levelCompleteText.position.set(this.camera.viewWidth/2,this.camera.viewHeight/2),this.gameStartText.anchor.set(.5),this.gameStartText.position.set(this.camera.viewWidth/2,this.camera.viewHeight/2),this.player=new _h,this.player.nextSkin(0),this.canvas.addPlayer(this.player),this.player2=new _h,this.player2.nextSkin(3),Vi.SWITCH_ACTIVATED.addListener(i=>{let r=i.subtype;this.canvas.blocks.forEach(a=>{a.config.type==="door"&&a.config.subtype===r&&a.shrinkAway()})}),Vi.LEVEL_COMPLETE.addListener(this.onLevelComplete),this.canvas.addEventListener("mousedown",i=>{let r=i.getLocalPosition(this.canvas);Ci.makeExplosion(this.canvas.layers[ti.UI],{x:r.x,y:r.y})})}loopingFireworks(){setTimeout(()=>{Ci.makeExplosion(this.canvas.layers[ti.UI],{x:Math.random()*this.camera.viewWidth,y:Math.random()*this.camera.viewHeight,tint:Math.random()*16777215}),!this.running&&this.canvas.layers[ti.UI].children.indexOf(this.levelCompleteText)>=0&&this.loopingFireworks()},50)}loadLevel(t){this.currentLevelIndex=t,this.running=!0,vt.makeLevelDataFromUrl(vt.levelSources[t]).then(e=>this.loadLevelFromData(e))}loadLevelFromData(t){Ct.gamePage.addChild(this.timer),this.timer.reset(),this.timer.pause(),this.canvas.layers[ti.UI].removeChild(this.levelCompleteText),this.gameEnvironment.setupLevel(t),this.canvas.addConfig(t),this.player.position.set(t.startingPosition.x,t.startingPosition.y),this.player.reset(),this.TWO_PLAYER?(this.player2.position.set(t.startingPosition.x,t.startingPosition.y),this.player2.reset(),this.canvas.addPlayer(this.player2)):this.canvas.removePlayer(this.player2),this.setupKeys(),this.setupGhost(t),this.camera.update(this.player,!0),this.running=!1,window.requestAnimationFrame(()=>{this.canvas.layers[ti.UI].addChild(this.gameStartText),this.keyboard.onAnyKey(()=>{this.running=!0,this.gameStartText.parent.removeChild(this.gameStartText),this.timer.start()})})}addGhostPlayer(){this.ghostPlayer||(this.ghostPlayer=new _h,this.ghostPlayer.nextSkin(0),this.ghostPlayer.makeGhost(),this.canvas.layers[ti.PLAYER].addChildAt(this.ghostPlayer,0))}setupGhost(t){if(this.currentLevelIndex!==-1)if(this.GHOST_MODE==="live"){let e=new Gn({mapId:this.currentLevelIndex,record:[],time:0});this.recordingStream=e,this.replayingStream=e,e.resetPlayback(),e.replayingStep=-50,this.addGhostPlayer(),this.ghostPlayer.position.set(t.startingPosition.x,t.startingPosition.y),this.ghostPlayer.reset()}else{this.recordingStream=new Gn({mapId:this.currentLevelIndex,record:[],time:0});let e=Ct.saveM.getExtrinsic().levelGhosts.find(i=>i.mapId===this.currentLevelIndex);e?(this.replayingStream=new Gn(e),this.GHOST_MODE==="replay"?(this.addGhostPlayer(),this.ghostPlayer.position.set(t.startingPosition.x,t.startingPosition.y),this.ghostPlayer.reset()):this.ghostPlayer&&(this.canvas.removePlayer(this.ghostPlayer),this.ghostPlayer=null)):(this.replayingStream=null,this.ghostPlayer&&(this.canvas.removePlayer(this.ghostPlayer),this.ghostPlayer=null))}}setupKeys(){this.keyboard.clear(),this.TWO_PLAYER?(this.keyboard.addKey({keys:["w"],onDown:()=>this.player.keys.up=!0,onUp:()=>this.player.keys.up=!1}),this.keyboard.addKey({keys:["a"],onDown:()=>this.player.keys.left=!0,onUp:()=>this.player.keys.left=!1}),this.keyboard.addKey({keys:["s"],onDown:()=>this.player.keys.down=!0,onUp:()=>this.player.keys.down=!1}),this.keyboard.addKey({keys:["d"],onDown:()=>this.player.keys.right=!0,onUp:()=>this.player.keys.right=!1}),this.keyboard.addKey({keys:["x"],onDown:()=>this.player.keys.jetpack=!0,onUp:()=>this.player.keys.jetpack=!1}),this.keyboard.addKey({keys:["q"],onDown:()=>this.player.nextSkin(1)}),this.keyboard.addKey({keys:["e"],onDown:()=>this.player.nextSkin(-1)}),this.keyboard.addKey({keys:["arrowup"," "],onDown:()=>this.player2.keys.up=!0,onUp:()=>this.player2.keys.up=!1}),this.keyboard.addKey({keys:["arrowleft"],onDown:()=>this.player2.keys.left=!0,onUp:()=>this.player2.keys.left=!1}),this.keyboard.addKey({keys:["arrowdown"],onDown:()=>this.player2.keys.down=!0,onUp:()=>this.player2.keys.down=!1}),this.keyboard.addKey({keys:["arrowright"],onDown:()=>this.player2.keys.right=!0,onUp:()=>this.player2.keys.right=!1}),this.keyboard.addKey({keys:["/","v"],onDown:()=>this.player2.keys.jetpack=!0,onUp:()=>this.player2.keys.jetpack=!1}),this.keyboard.addKey({keys:["."],onDown:()=>this.player2.nextSkin(1)}),this.keyboard.addKey({keys:[","],onDown:()=>this.player2.nextSkin(-1)})):(this.keyboard.addKey({keys:["w"," ","arrowup"],onDown:()=>this.player.keys.up=!0,onUp:()=>this.player.keys.up=!1}),this.keyboard.addKey({keys:["a","arrowleft"],onDown:()=>this.player.keys.left=!0,onUp:()=>this.player.keys.left=!1}),this.keyboard.addKey({keys:["s","arrowdown","control"],onDown:()=>this.player.keys.down=!0,onUp:()=>this.player.keys.down=!1}),this.keyboard.addKey({keys:["d","arrowright"],onDown:()=>this.player.keys.right=!0,onUp:()=>this.player.keys.right=!1}),this.keyboard.addKey({keys:["v"],onDown:()=>this.player.keys.jetpack=!0,onUp:()=>this.player.keys.jetpack=!1}),this.keyboard.addKey({keys:["."],onDown:()=>this.player.nextSkin(1)}),this.keyboard.addKey({keys:[","],onDown:()=>this.player.nextSkin(-1)})),this.keyboard.addKey({keys:["escape"],onDown:()=>Ct.setPage(Ct.mainPage)}),this.keyboard.addKey({keys:["enter"],onDown:()=>this.loadLevel(this.currentLevelIndex)}),this.keyboard.addKey({keys:["p"],onDown:()=>this.running=!this.running});for(let t=0;t<=9;t++){let e=t;this.keyboard.addKey({keys:[(e+1).toString()],onDown:()=>this.loadLevel(e)})}}}class wC{constructor(){this.disabled=!1,this.hotkeys=[],this.onKeyDown=t=>{if(this.disabled)return;let e=t.key.toLowerCase();this.hotkeys.forEach(i=>{i.keys.includes(e)&&i.onDown&&i.onDown()}),this.oneTimeCallback&&(this.oneTimeCallback(),this.oneTimeCallback=null),t.preventDefault()},this.onKeyUp=t=>{if(this.disabled)return;let e=t.key.toLowerCase();this.hotkeys.forEach(i=>{i.keys.includes(e)&&i.onUp&&i.onUp()})},window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}destroy(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}clear(){this.hotkeys=[]}addKey(t){this.hotkeys.push(t)}removeKey(t){le.pull(this.hotkeys,t)}onAnyKey(t){this.oneTimeCallback=t}}class SC extends Hp{constructor(t,e){super(),this.ticker=e,this.navIn=()=>{this.keyboard.disabled=!1,this.ticker.add(this.control.onTick)},this.navOut=()=>{this.keyboard.disabled=!0,this.ticker.remove(this.control.onTick)},this.keyboard=new wC,this.canvas=new ti(t.width,t.height),this.control=new vC(this.canvas,this.keyboard),this.keyboard.disabled=!0;let i=new uo({buttonLabel:"<",onClick:()=>Ct.setPage(Ct.mainPage),color:16763904,width:40,height:40,labelStyle:{fontSize:20,fontWeight:"bold"}});i.position.set(30,30),this.addChild(this.canvas,i)}}class AC{constructor(t,e,i=[]){this.config=t,this.dSave=e,this.versionChanges=i,this.saveEvent=new Gs,this.resetData=()=>this.confirmReset,this.null=()=>new Promise(r=>{this.config.SaveLoc}),this.confirmReset=()=>{this.extrinsic=le.cloneDeep(this.dSave),this.saveExtrinsic()},this.virtualSave={version:t.CurrentVersion,extrinsic:e}}async init(){if(this.config.SaveLoc==="local")try{let t=window.localStorage.getItem(this.config.DocName)}catch{this.config.SaveLoc="virtual"}return new Promise(t=>{this.loadExtrinsic().then(e=>{e?this.loadVersion().then(i=>{this.saveEvent.publish({text:`Data Version: ${i}`}),i<this.config.CurrentVersion&&(this.saveEvent.publish({text:"Version Update"}),e=this.versionControl(i,e),this.saveVersion(this.config.CurrentVersion),this.saveExtrinsic(e)),this.extrinsic=e,t(null)}):(this.saveEvent.publish({text:"Save Data Reset"}),this.confirmReset(),this.saveVersion(this.config.CurrentVersion),this.saveExtrinsic(this.getExtrinsic()),t(null))})})}versionControl(t,e){return this.versionChanges.forEach(i=>{t<i.version&&(e=i.callback(e))}),e}getExtrinsic(){if(this.extrinsic)return this.extrinsic}async saveCurrent(){return new Promise(t=>{let e=1;this.saveExtrinsic().then(()=>{e--,e===0&&t(null)})})}async saveExtrinsic(t,e){return new Promise(i=>{switch(t=t||this.extrinsic,e&&(this.extrinsic=t),this.config.SaveLoc){case"virtual":this.virtualSave.extrinsic=t;break;case"local":typeof Storage!==void 0?window.localStorage.setItem(this.config.DocName,JSON.stringify(t)):console.log("NO STORAGE!");break}i(t)})}async loadExtrinsic(){let t;return new Promise(e=>{switch(this.config.SaveLoc){case"virtual":t=this.virtualSave.extrinsic;break;case"local":if(typeof Storage!==void 0){let i=window.localStorage.getItem(this.config.DocName);i!=="undefined"&&(t=JSON.parse(i))}else console.log("NO STORAGE!");break}e(t)})}loadVersion(){return new Promise(t=>{let e;switch(this.config.SaveLoc){case"virtual":e=this.virtualSave.version;break;case"local":typeof Storage!==void 0?e=Number(window.localStorage.getItem(this.config.VerName)):(console.log("NO STORAGE!"),t(0));break}t(e)})}saveVersion(t){switch(this.config.SaveLoc){case"virtual":this.virtualSave.version=t;break;case"local":typeof Storage!==void 0?window.localStorage.setItem(this.config.VerName,String(t)):console.log("NO STORAGE!");break}}}let TC="desktop";const Ct=new class{constructor(){this.worldBounds=new kt(0,0,950,600),this.blackScreen=new ve,this.transition=!1;try{document.createEvent("TouchEvent"),TC="mobile"}catch{}this.initializeApplication(),this.initializeBitmapSelect()}async initializeApplication(){this.app=new ip,await this.app.init({width:this.worldBounds.width,height:this.worldBounds.height,backgroundColor:1973790,autoDensity:!0,antialias:!0}),document.getElementById("canvas-holder").appendChild(this.app.canvas);let t=document.getElementById("debug-reporting");Uh.initialize(this.app,t),Vi.APP_LOG.publish({type:"INITIALIZE",text:"Primary Setup"}),Qe.initialize(this.app),this.saveM=new AC({CurrentVersion:.01,DocName:"Windwarp-Save",VerName:"Windwarp-Version",SaveLoc:"local"},CC),await this.saveM.init(),await vt.initialize(),this.init()}init(){this.mainPage=new fC(this.worldBounds),this.gamePage=new SC(this.worldBounds,this.app.ticker),this.blackScreen.rect(0,0,this.worldBounds.width,this.worldBounds.height).fill(0),this.setPage(this.mainPage),Vi.APP_LOG.publish({type:"INITIALIZE",text:"Setup Complete"})}setPage(s){this.transition||s!==this.currentPage&&(this.transition=!0,this.app.stage.addChild(this.blackScreen),this.blackScreen.alpha=0,new qi(this.blackScreen,200).to({alpha:1}).start().onComplete(()=>{this.currentPage&&(this.currentPage.navOut(),this.app.stage.removeChild(this.currentPage)),this.currentPage=s,this.app.stage.addChildAt(s,0),s.navIn(),new qi(this.blackScreen,200).to({alpha:0}).start().onComplete(()=>{this.app.stage.removeChild(this.blackScreen),this.transition=!1})}))}initializeBitmapSelect(){document.getElementById("level-select").addEventListener("input",t=>{console.log("input received");let e=t.target.files[0];var i=new FileReader;i.readAsDataURL(e),i.onload=r=>{var a=r.target.result;const h=new Image;h.src=a,h.onload=()=>{createImageBitmap(h).then(l=>{let c=vt.makeLevelData(l);Ct.gamePage.control.loadLevelFromData(c),Ct.setPage(Ct.gamePage)})}}})}},CC={levelGhosts:[]};export{Xe as $,_o as A,$i as B,zi as C,Lt as D,fi as E,Ei as F,Nn as G,Ef as H,qs as I,Zf as J,Ch as K,Mt as L,pt as M,Ds as N,Kv as O,qt as P,Gt as Q,kt as R,Xn as S,ht as T,ro as U,Jw as V,$n as W,yd as X,zs as Y,Vh as Z,Vf as _,jh as a,Yn as a0,PS as a1,kS as a2,OS as a3,BS as a4,Ov as a5,US as a6,be as a7,_f as a8,Re as a9,co as aa,ed as ab,ii as ac,BT as ad,p1 as ae,sd as af,ja as ag,nd as ah,m1 as ai,bf as aj,aT as ak,Kf as al,zn as am,_w as an,dw as ao,lp as ap,nS as aq,ES as ar,IS as as,DS as at,GS as au,WS as av,qh as b,$s as c,wt as d,Dh as e,Wh as f,Qr as g,te as h,lo as i,ne as j,ut as k,gT as l,O1 as m,eS as n,Vt as o,Yt as p,eo as q,yf as r,V as s,ve as t,q1 as u,Nt as v,Ot as w,iA as x,mo as y,VS as z};
